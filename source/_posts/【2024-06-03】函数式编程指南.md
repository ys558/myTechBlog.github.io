---
title: js çš„å‡½æ•°å¼ç¼–ç¨‹ (æ›´æ–°è‡³ 2024-06-12)
date: 2024-06-03 09:10:43
tags:
  - å‡½æ•°å¼ç¼–ç¨‹
  - ç¼–ç¨‹æ€æƒ³
cover: https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@1.70/articles/functional_programming.webp
---

å‡½æ•°å¼ç¼–ç¨‹, è¿‘å¹´æ¥é€æ¸ç”±å­¦æœ¯é¢†åŸŸå‘å•†ç”¨é¢†åŸŸæ¸—é€, æ¯”èµ·ä¼ ç»Ÿçš„`OOP`, å‡½æ•°å¼ç¼–ç¨‹æœ‰ç€éå¸¸å¤§çš„ä¼˜åŠ¿, é€»è¾‘æ¸…æ™°, ç¡®å®šçš„è¾“å…¥è¾“å‡º, å¯ä»¥éšæ„ç»„åˆ, ä¸”æ˜“äºæ‰©å±•.

å¯¹äº js çš„å‡½æ•°å¼ç¼–ç¨‹, æŸäº›æ ‡å‡†ä»æœªåˆ—å…¥ ES è§„åˆ™ä¸­, æ‰€ä»¥, è¿™é‡Œå°† `Scala` è¿™ç§çº¯å‡½æ•°æ ‡å‡†ç¼–ç¨‹ä½œä¸ºå¯¹æ¯”, è®©æˆ‘å¯¹å‡½æ•°å¼ç¼–ç¨‹ç†è§£æ›´åŠ æ·±åˆ».

æœ¬æ–‡ä»£ç å¯ä»¥çœ‹è¿™ä¸ª[ä»“åº“](https://github.com/ys558/functional-programming-by-js)

<!-- more -->

## å‡½æ•°ä½œä¸ºä¸€ç­‰å…¬æ°‘

å‡½æ•°å¼ç¼–ç¨‹, æ˜¯ä¸€ä¸ªå¤è€çš„æ¦‚å¿µ, ç”šè‡³æ¯”è®¡ç®—æœºçš„è¯ç”Ÿè¿˜æ—©, å¹¶ä¼´éšç€ `React` çš„æµè¡Œå¸¦ç«çš„, `React` æ˜¯å…¶æœ€æœ‰åŠ›çš„æ¨å¹¿è€…. è€Œè·Ÿç€ç«çˆ†çš„ `js` å¹¶ä¸æ˜¯çº¯å‡½æ•°è¯­è¨€, ç°åœ¨è¾ƒä¸ºä¸»æµçš„çº¯å‡½æ•°è¯­è¨€, åŒ…æ‹¬è¯¸å¦‚: `Haskell`, `Rust`, `Scala`, `Clojure`, `Erlang`, `F#` ç­‰ç­‰. ä»–ä»¬æœ‰äº›è¯­æ³•ç‰¹æ€§, æ˜¯ `js` æ‰€ç¼ºå°‘çš„, ä¾‹å¦‚ `Haskell` æ‘’å¼ƒäº†å¤§å¤šæ•°è¯­è¨€çš„ `loop` å¾ªç¯(`for`, `while`), è¿›è€Œä½¿ç”¨é€’å½’å’Œé«˜é˜¶å‡½æ•°æ¥å¤„ç†è¿­ä»£. å‡ ä¹æ‰€æœ‰çš„å‡½æ•°å¼è¯­è¨€éƒ½å…·å¤‡çš„ **æ¨¡å¼åŒ¹é…ï¼ˆPattern Matchingï¼‰** å’Œ **Monadï¼ˆå¦‚ Optionã€Eitherã€Futureï¼‰ç­‰ç‰¹æ€§**. è¿™äº›éƒ½æ˜¯ `js` ç¼ºå°‘çš„, æœ¬æ–‡æ¥è®¨è®ºè¿™äº›é—®é¢˜.

### å‡½æ•°æ—¢å¯ä»¥ä½œä¸ºå‚æ•°, ä¹Ÿå¯ä»¥ä½œä¸ºè¿”å›å€¼

å‡½æ•°ä½œä¸ºä¸€ç­‰å…¬æ°‘, å‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°, ä¹Ÿå¯ä»¥ä½œä¸ºè¿”å›å€¼, å¦‚:

```js
// è¿™è¡Œ
ajaxCall((json) => callback(json));

// ç­‰ä»·äºè¿™è¡Œ --> å‡½æ•°ä½œä¸ºå‚æ•°
ajaxCall(callback);

// é‚£ä¹ˆï¼Œé‡æ„ä¸‹ getServerStuff
const getServerStuff = (callback) => ajaxCall(callback);

// ...å°±ç­‰äº --> å‡½æ•°ä½œä¸ºè¿”å›å€¼
const getServerStuff = ajaxCall; // <-- çœ‹ï¼Œæ²¡æœ‰æ‹¬å·å“¦
```

è¿™ç§ç®€åŒ–å¯ä»¥ä½¿å¾—ä»£ç æ›´ç®€æ´, æ›´å®¹æ˜“ç†è§£, æ›´å®¹æ˜“æ‰©å±•.

### å‘½åçš„é€šç”¨æ€§, ä½¿å¾—åæœŸæ˜“äºæ‰©å±•

ä½œè€…ä¸¾ä¾‹:

```js
// åªé’ˆå¯¹å½“å‰çš„åšå®¢
const validArticles = articles =>
  articles.filter(article => article !== null && article !== undefined),

// å¯¹æœªæ¥çš„é¡¹ç›®æ›´å‹å¥½
const compact = xs => xs.filter(x => x !== null && x !== undefined);
```

`xs`, `x` è¿™ç§å‘½åæ˜¯é€šç”¨çš„, å®¹æ˜“ç†è§£, å®¹æ˜“æ‰©å±•. ä½¿å¾—æˆ‘ä»¬é¿å…é‡å¤é€ è½®å­

### JS çš„ bug: `this`

ä½œè€…æåŠ›åå¯¹åœ¨ `this` ä¸Šåšæ“ä½œ

> `this` å°±åƒä¸€å—è„å°¿å¸ƒï¼Œæˆ‘å°½å¯èƒ½åœ°é¿å…ä½¿ç”¨å®ƒï¼Œå› ä¸ºåœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­æ ¹æœ¬ç”¨ä¸åˆ°å®ƒã€‚... ä¹Ÿæœ‰äººåé©³è¯´ `this` èƒ½æé«˜æ‰§è¡Œé€Ÿåº¦ã€‚å¦‚æœä½ æ˜¯è¿™ç§å¯¹é€Ÿåº¦å¹æ¯›æ±‚ç–µçš„äººï¼Œé‚£ä½ è¿˜æ˜¯åˆä¸Šè¿™æœ¬ä¹¦å§ã€‚è¦æ˜¯æ²¡æ³•é€€è´§é€€æ¬¾ï¼Œä¹Ÿè®¸ä½ å¯ä»¥å»æ¢ä¸€æœ¬æ›´å…¥é—¨çš„ä¹¦æ¥è¯»ã€‚

## çº¯å‡½æ•° Pure Function

> çº¯å‡½æ•°æ˜¯è¿™æ ·ä¸€ç§å‡½æ•°ï¼Œå³ç›¸åŒçš„è¾“å…¥ï¼Œæ°¸è¿œä¼šå¾—åˆ°ç›¸åŒçš„è¾“å‡ºï¼Œè€Œä¸”æ²¡æœ‰ä»»ä½•å¯è§‚å¯Ÿçš„å‰¯ä½œç”¨ã€‚

> å‰¯ä½œç”¨æ˜¯åœ¨è®¡ç®—ç»“æœçš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»ŸçŠ¶æ€çš„ä¸€ç§å˜åŒ–ï¼Œæˆ–è€…ä¸å¤–éƒ¨ä¸–ç•Œè¿›è¡Œçš„å¯è§‚å¯Ÿçš„äº¤äº’ã€‚

> > å‰¯ä½œç”¨å¯èƒ½åŒ…å«ï¼Œä½†ä¸é™äºï¼š
> > æ›´æ”¹æ–‡ä»¶ç³»ç»Ÿ
> > å¾€æ•°æ®åº“æ’å…¥è®°å½•
> > å‘é€ä¸€ä¸ª http è¯·æ±‚
> > å¯å˜æ•°æ®
> > æ‰“å°/log
> > è·å–ç”¨æˆ·è¾“å…¥
> > DOM æŸ¥è¯¢
> > è®¿é—®ç³»ç»ŸçŠ¶æ€
> > ...

åŸä¹¦ä¸¾äº†ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­è¯´æ˜çº¯å‡½æ•°çš„æ¦‚å¿µ, å³ `slice` å’Œ `splice`:

```js
var xs = [1, 2, 3, 4, 5];

// çº¯çš„
xs.slice(0, 3); // [1,2,3]
xs.slice(0, 3); // [1,2,3]
xs.slice(0, 3); // [1,2,3]

// ä¸çº¯çš„
xs.splice(0, 3); // [1,2,3]
xs.splice(0, 3); // [4,5]
xs.splice(0, 3); // []
```

ä»ä¸Šé¢çš„ç¤ºä¾‹å¯ä»¥çœ‹å‡º

- `slice` æ˜¯çº¯å‡½æ•°, å› ä¸ºæ— è®ºè°ƒç”¨å¤šå°‘æ¬¡, éƒ½ä¼šè¿”å›ç›¸åŒçš„ç»“æœ.
- `splice` ä¸æ˜¯çº¯å‡½æ•°, å› ä¸ºæ¯æ¬¡è°ƒç”¨éƒ½ä¼šæ”¹å˜åŸæ•°ç»„, å¹¶ä¸”è¿”å›å€¼ä¹Ÿä¸ä¸€æ ·.

å¦ä¸€ä¸ªä¾‹å­:

```js
// ä¸çº¯çš„: checkAgeçš„å€¼å–å†³äºå¤–éƒ¨å˜é‡
let minimum = 21;
const checkAge = (age) => age > minimum;

console.log(checkAge(24)); // true

minimum = 27;
console.log(checkAge(24)); // false

minimum = 18;
console.log(checkAge(24)); // true
```

æ”¹ä¸ºçº¯å‡½æ•°, å°† `minimum` å˜é‡ä½œä¸ºå†…éƒ¨å˜é‡æˆ–å‡½æ•°å‚æ•°, é¿å…äº†å¤–éƒ¨å˜é‡çš„å½±å“.

```js
const checkAge = (age) => {
  const minimum = 21;
  return age >= minimum;
};
console.log(checkAge(24)); // true

minimum = 27;
console.log(checkAge(24)); // true

minimum = 18;
console.log(checkAge(24)); // true
```

å¦ä¸€ç§æ”¹æ³•:

```js
const immutableMinimum = Object.freeze({
  value: 21,
});
const checkAge = (age) => age > immutableMinimum;

console.log(checkAge(24)); // true
```

åˆ©ç”¨ es6+ çš„è¯­æ³•, æˆ‘ä»¬å¯ä»¥æ›´è½»æ¾çš„å®ç°çº¯å‡½æ•°, ä¾‹å¦‚:

```js
const a = [1, 2];
const f = (a, el) => [...a, el];

const result = f(a, 3);

// æ— è®ºæ‰“å°å¤šå°‘æ¬¡, è¾“å‡ºçš„ç»“æœåªå–å†³äºè¾“å…¥ç»“æœ, æ˜¯çº¯å‡½æ•°:
console.log(result); // [1,2,3]
console.log(result); // [1,2,3]
```

### ç‰¹å¾

çº¯å‡½æ•°å…·æœ‰æ‰§è¡Œä¸ä¾èµ–å¤–éƒ¨å˜é‡, å¯ç¼“å­˜ (Cacheable), å¯ç§»æ¤æ€§ï¼è‡ªæ–‡æ¡£åŒ–ï¼ˆPortable / Self-Documentingï¼‰, å¯æµ‹è¯•æ€§ï¼ˆTestableï¼‰, åˆç†æ€§ï¼ˆReasonableï¼‰, ä»£ç å¯å¹¶è¡Œä¸ä¼šè¿›å…¥ç«äº‰æ€ ç­‰ç‰¹ç‚¹.

### å‡½æ•°æ‰§è¡Œä¸ä¾èµ–å¤–éƒ¨å˜é‡

```js
// ä¸çº¯çš„
var minimum = 21;

var checkAge = function (age) {
  return age >= minimum;
};
```

```js
// ä¸çº¯çš„
const arr = [1, 2];
const pushElementImpure = (arr, ele) => {
  arr.push(ele);
};

// å˜æˆçº¯å‡½æ•°:
const pushElementPure = (arr, ele) => {
  return [...arr, ele];
};
// çº¯å‡½æ•°æ— è®ºè°ƒç”¨å¤šå°‘æ¬¡, éƒ½ä¸ä¼šæ”¹å˜åŸæ•°ç»„, è€Œä¸”è¯¥å‡½æ•°çš„å˜åŒ–ä¸ä¼šå—å¤–éƒ¨å˜é‡çš„å½±å“
pushElementPure(3);
pushElementPure(3);
console.log(arr); // [1,2]
```

### å¯ç¼“å­˜æ€§

å¯ç¼“å­˜ç‰¹æ€§çš„ç¤ºä¾‹ä»£ç :

```js
// ç”¨äºç¼“å­˜:
const memoize = (fn) => {
  const cache = {};
  return (...args) => {
    const key = JSON.stringify(args);
    if (!cache[key]) {
      cache[key] = fn(...args);
    }
    return cache[key];
  };
};

const square = (x) => x * x;

const sum = (a, b) => a + b;

const sumOfSquares = (arr) => arr.map(square).reduce(sum, 0);

const memoizedSumOfSquares = memoize(sumOfSquares);

console.log(memoizedSumOfSquares(numbers)); // 55 ç¬¬ä¸€æ¬¡è®¡ç®—
console.log(memoizedSumOfSquares(numbers)); // 55 ç¬¬äºŒæ¬¡ä½¿ç”¨ç¼“å­˜ï¼Œæå‡æ€§èƒ½
```

ä½œè€…åœ¨ä¹¦ä¸­å°†å‡½æ•°å˜ä¸ºçº¯å‡½æ•°çš„ä¾‹å­:

```js
// ä¸çº¯çš„
var signUp = function(attrs) {
  var user = saveUser(attrs);
  welcomeUser(user);
};

var saveUser = function(attrs) {
    var user = Db.save(attrs);
    ...
};

var welcomeUser = function(user) {
    Email(user, ...);
    ...
};

// çº¯çš„
var signUp = function(Db, Email, attrs) {
  return function() {
    var user = saveUser(Db, attrs);
    welcomeUser(Email, user);
  };
};

var saveUser = function(Db, attrs) {
    ...
};

var welcomeUser = function(Email, user) {
    ...
};
```

å¯ç¼“å­˜å¹¶ä¸éœ€ä¸€å®šå†™ç±»ä¼¼ä¸Šé¢ çš„ `momerize` å‡½æ•°, å¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªä¸ä¼ å…¥ä»»ä½•å‚æ•°çš„å‡½æ•°, ä½¿å¾—å‡½æ•°å˜çº¯:

```js
// impure
const signUpImpure = (Db, Email, attrs) => {
  const user = saveUser(Db, attrs);
  welcomeUser(Email);
};

// pure
const signUp = (Db, Email, attrs) => () => {
  const user = saveUser(Db, attrs);
  welcomeUser(Email);
};
```

ç›¸åº”çš„, ä»–ä»¬åœ¨è°ƒç”¨æ—¶å°±äº§ç”ŸåŒºåˆ«:

```js
// impure è°ƒç”¨: ç«‹å³æ‰§è¡Œ:
const signUpUserImpure = signUp(database, emailService, userAttrs);
// signUpUserImpure ç›´æ¥åœ¨ä¸‹ä¸€æ­¥ä½¿ç”¨
signUpUserImpure;

// prue è°ƒç”¨: å¤šä¸€æ¬¡æ‰§è¡Œ, å³å»¶è¿Ÿæ‰§è¡Œ:
const signUpUserPure = signUp(database, emailService, userAttrs);
signUpUserPure();
```

### å¯ç§»æ¤æ€§ï¼è‡ªæ–‡æ¡£åŒ–ï¼ˆPortable / Self-Documentingï¼‰

ä¹¦é‡Œä½œè€…å¼•ç”¨äº†è¿™æ ·ä¸€æ®µè¯:

> ä½ ä¸Šä¸€æ¬¡æŠŠæŸä¸ªç±»æ–¹æ³•æ‹·è´åˆ°æ–°çš„åº”ç”¨ä¸­æ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿæˆ‘æœ€å–œæ¬¢çš„åè¨€ä¹‹ä¸€æ˜¯ Erlang è¯­è¨€çš„ä½œè€… Joe Armstrong è¯´çš„è¿™å¥è¯ï¼šâ€œé¢å‘å¯¹è±¡è¯­è¨€çš„é—®é¢˜æ˜¯ï¼Œå®ƒä»¬æ°¸è¿œéƒ½è¦éšèº«æºå¸¦é‚£äº›éšå¼çš„ç¯å¢ƒã€‚ä½ åªéœ€è¦ä¸€ä¸ªé¦™è•‰ï¼Œä½†å´å¾—åˆ°ä¸€ä¸ªæ‹¿ç€é¦™è•‰çš„å¤§çŒ©çŒ©...ä»¥åŠæ•´ä¸ªä¸›æ—â€ã€‚

ä¸‹é¢æ˜¯æˆ‘è‡ªå·±ç»™çš„ä¾‹å­é˜è¿°å¯ç§»æ¤æ€§å’Œè‡ªæ–‡æ¡£æ€§çš„:

```js
const add = (a, b) => a + b;
const multiply = (a, b) => a * b;

const operate = (operator, args) => args.reduce(operator);

const numbers = [2, 3, 4];

const sumResult = operate(add, numbers);
console.log(sumResult); // è¾“å‡ºï¼š9

const productResult = operate(multiply, numbers);
console.log(productResult);
```

`operate` å‡½æ•°çš„å‚æ•°æ˜¯ `add`, `multiply`, ä¸­çš„ä»»æ„ä¸€ä¸ª, æ‰€ä»¥ `operate` å‡½æ•°æ˜¯å¯ç§»æ¤çš„, ä¹Ÿæ˜¯å¯è‡ªæ–‡æ¡£åŒ–çš„.

### åˆç†æ€§åˆ©äºé‡æ„

çœ‹ä¸‹é¢ä¸€æ®µä»£ç : `npm i immutable`

```js
const { Map } = require("immutable");

// Aliases: p = player, a = attacker, t = target
const jobe = Map({ name: "Jobe", hp: 20, team: "red" });
const michael = Map({ name: "Michael", hp: 20, team: "green" });

const decrementHP = (p) => p.set("hp", p.get("hp") - 1);

const isSameTeam = (p1, p2) => p1.get("team") === p2.get("team");

const punch = (a, t) => (isSameTeam(a, t) ? t : decrementHP(t));

console.log(punch(jobe, michael).toJS()); // å°† Map è½¬æ¢ä¸ºæ™®é€šçš„ JS å¯¹è±¡è¿›è¡Œè¾“å‡º
```

ä¸Šé¢çš„ `punch` å‡½æ•°, å¯ä»¥è¿›è¡Œä¸‹é¢çš„ç®€åŒ–, å› ä¸ºåˆ¤æ–­ä¸¤è€…é˜Ÿä¼ç›¸åŒçš„æ“ä½œ`p1.get("team") === p2.get("team")`, å®è´¨ä¸Šæ˜¯åˆ¤æ–­ `'red'==='green'`, è€Œæˆ‘ä»¬çŸ¥é“, è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ˜¯æ°¸è¿œä¸å¯èƒ½ç›¸ç­‰çš„, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°† `isSameTeam(a, t)` å‡½æ•°çš„åˆ¤æ–­åœ¨`punch`å‡½æ•°é‡Œå»æ‰, ç›´æ¥è¿”å› `decrementHP(t)`:

```diff
- const punch = (a, t) => (isSameTeam(a, t) ? t : decrementHP(t));
+ const punch = (a, t) => decrementHP(t);
```

æ¥ç€, `decrementHP(t)` ç»§ç»­ç®€åŒ–:

```diff
- const punch = (a, t) => decrementHP(t)
+ const punch = (t) => t.set("hp", t.get("hp") - 1)
```

æœ€ç»ˆä»£ç :

```js
const { Map } = require("immutable");

// Aliases: p = player, a = attacker, t = target
const jobe = Map({ name: "Jobe", hp: 20, team: "red" });
const michael = Map({ name: "Michael", hp: 20, team: "green" });

const punch = (t) => t.set("hp", t.get("hp") - 1);

console.log(punch(jobe, michael).toJS()); // { name: 'Michael', hp: 19, team: 'green' }
```

## æŸ¯é‡ŒåŒ– Curry (é‡ç‚¹)

> curry çš„æ¦‚å¿µå¾ˆç®€å•ï¼šåªä¼ é€’ç»™å‡½æ•°ä¸€éƒ¨åˆ†å‚æ•°æ¥è°ƒç”¨å®ƒï¼Œè®©å®ƒè¿”å›ä¸€ä¸ªå‡½æ•°å»å¤„ç†å‰©ä¸‹çš„å‚æ•°ã€‚(partial application)

è¿™æ˜¯æˆ‘çœ‹è¿‡æœ€ç®€æ´, ä¸”æœ€ç¡®åˆ‡çš„å¯¹æŸ¯é‡ŒåŒ–çš„è§£é‡Š. å¾ˆå¤šæ—¶å€™ä¸€äº›ç¼–ç¨‹çš„ç†å¿µæ²¡æœ‰åœ¨é¡¹ç›®ä¸­å¾—åˆ°å®ç°, å¾€å¾€æ˜¯å¯¹å…¶å‘æ˜çš„ç›®çš„è¿˜ä¸å¤Ÿæ˜ç¡®. å¦‚æœç›®çš„æ˜ç¡®äº†, æˆ‘ä»¬å¤§å¯ä»¥åœ¨é¡¹ç›®ä¸­å»é‡æ„æˆ‘ä»¬çš„ä»£ç . ä¸‹é¢æ˜¯æŸ¯é‡ŒåŒ–åœ¨ ğŸ“– ä¸­ä½œè€…ä¸¾çš„ä¸€ä¸ªæœ€ç®€å•ä¾‹å­:

```js
var add = function (x) {
  return function (y) {
    return x + y;
  };
};

// å®šä¹‰çš„éƒ¨åˆ†, increment å‡½æ•°å¹¶ä¼ å…¥ç¬¬ä¸€ä¸ªå‚æ•°
var increment = add(1);
var addTen = add(10);

// å†æ ¹æ®è‡ªå·±çš„éœ€è¦, è°ƒç”¨å‡½æ•°å¹¶ä¼ å…¥è‡ªå·±éœ€è¦çš„å‚æ•°
increment(2);
// 3

addTen(2);
// 12
```

å†çœ‹ä¸‹é¢çš„ä»£ç , æœªä½¿ç”¨æŸ¯é‡ŒåŒ–çš„æ™®é€šè¯·æ±‚:

```js
// æœªä½¿ç”¨æŸ¯é‡ŒåŒ–
const sendRequest = (method, url, data) => {
  return fetch(url, {
    method: method,
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(data),
  }).then((response) => response.json());
};

// ä½¿ç”¨åŸå§‹å‡½æ•°
sendRequest("POST", "https://jsonplaceholder.typicode.com/todos", {
  key: "value",
}).then((response) => console.log("unused curry:", response));
```

å°†ä¸Šé¢çš„ä»£ç æ”¹é€ å, æˆ‘ä»¬å¯ä»¥çœ‹åˆ°, å‡½æ•° `currySendRequest`, åˆ›å»ºä¸“é—¨çš„è¯·æ±‚å‡½æ•° `postToApi` å’Œ `getFromApi`, å¦‚æœä»–ä»¬æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œå†å¯¼å‡º`postToApi` å’Œ `getFromApi`, é‚£ä¹ˆè°ƒç”¨çš„æ—¶å€™, æˆ‘ä»¬åªéœ€ä¼ å…¥ post çš„å‚æ•°å³å¯, å‡å°‘é‡å¤ä»£ç .

```js
// ä½¿ç”¨æŸ¯é‡ŒåŒ–
const currySendRequest = (method) => (url) => (data) => {
  return fetch(url, {
    method: method,
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(data),
  }).then((response) => response.json());
};

// åˆ›å»ºä¸“é—¨çš„è¯·æ±‚å‡½æ•°
const postRequest = currySendRequest("POST");
const getRequest = currySendRequest("GET");

const postToApi = postRequest("https://jsonplaceholder.typicode.com/posts");
const getFromApi = getRequest("https://jsonplaceholder.typicode.com/todos/12");

// è°ƒç”¨çš„åœ°æ–¹, æ— éœ€å†å…³å¿ƒ method, apiç­‰å‚æ•°
postToApi({ key: "value" }).then((response) =>
  console.log("POST Response:", response)
);

getFromApi().then((response) => console.log("GET Response:", response));
```

æŸ¯é‡ŒåŒ–çš„æ–¹æ³•ç‰¹åˆ«é€‚ç”¨äºéœ€è¦é‡å¤è°ƒç”¨åŒä¸€å‡½æ•°ä½†ä½¿ç”¨ä¸åŒå‚æ•°çš„æƒ…å†µ, å‚æ•°å¯ä»¥ç‹¬ç«‹è¿›è¡Œç»´æŠ¤

## ç»„åˆ Compose (é‡ç‚¹)

æœ€ç®€å•çš„ç»„åˆå‡½æ•°, å¦‚ä¸‹, ä½œè€…å°†å…¶ç§°ä¸ºå‡½æ•°é¥²å…»

```js
var compose = function (f, g) {
  return function (x) {
    return f(g(x));
  };
};
```

å½“ç„¶, è¿™ç§åµŒå¥—çš„å†™æ³•`f(g(x))`å¯è¯»æ€§æ˜¯æ¯”è¾ƒå·®çš„, ä½œè€…åœ¨ä¹¦ä¸­ä¸¾ä¾‹äº†å¦ä¸€ç§å†™æ³•, æˆ‘æ„¿æ„ç§°ä¹‹ä¸ºç®¡é“æ“ä½œ, ä½†å¿…é¡»å®‰è£…ä»–çš„åº“ `npm i @mostly-adequate/support` æ‰èƒ½ä½¿ç”¨ä»¥ä¸‹ä»£ç :

```js
var toUpperCase = function (x) {
  return x.toUpperCase();
};
var exclaim = function (x) {
  return x + "!";
};
var shout = compose(exclaim, toUpperCase);

shout("send in the clowns");
//=> "SEND IN THE CLOWNS!"

// ä¸å®ç”¨ç®¡é“åˆ™å¾—åµŒå¥—: exclaim(toUpperCase(x))
var shout = function (x) {
  return exclaim(toUpperCase(x));
};
```

æˆ‘è¿™é‡Œè‡ªå·±å†™äº†ä¸€ä¸ªç±»ä¼¼çš„ compose ç®¡é“å‡½æ•°çš„ä¾‹å­å¦‚ä¸‹:

```js
const composePipe = (...fns) => {
  const execute = (initialValue) => {
    return fns.reduce((value, fn) => fn(value), initialValue);
  };
  return { execute };
};

// ç¤ºä¾‹å‡½æ•°
const toUpperCase = (x) => x.toUpperCase();
const exclaim = (x) => x + "!";
const reverse = (x) => x.split("").reverse().join("");

// åˆ›å»ºç»„åˆå‡½æ•°
const result = composePipe(toUpperCase, exclaim, reverse).execute("hello");

console.log(result); // è¾“å‡º: !OLLEH
```

å½“ç„¶ä¸Šé¢çš„ `composePipe` å‡½æ•°è¿˜å¯ä»¥ç®€åŒ–ä¸ºæŸ¯é‡ŒåŒ–çš„å½¢å¼:

```js
const composePipeCurry =
  (...fns) =>
  (initialValue) =>
    fns.reduce((value, fn) => fn(value), initialValue);

// ç¤ºä¾‹å‡½æ•°
const toUpperCase = (x) => x.toUpperCase();
const exclaim = (x) => x + "!";
const reverse = (x) => x.split("").reverse().join("");

// ("hello") ç›¸å½“äº composePipeCurry å‡½æ•°é‡Œ (initialValue)
const result = composePipeCurry(toUpperCase, exclaim, reverse)("hello");

console.log(result); // è¾“å‡º: !OLLEH
```

å…¶å®, æˆ‘è¿˜æ˜¯å–œæ¬¢ç¬¬ä¸€ç§ `composePipe` çš„å†™æ³•, æŸ¯é‡ŒåŒ–è™½ç„¶ç®€æ´äº†äº›, ä½†å¯è¯»æ€§åè€Œå˜å·®äº†

### åˆ†ç»„

> ç»“åˆå¾‹çš„ä¸€å¤§å¥½å¤„æ˜¯ä»»ä½•ä¸€ä¸ªå‡½æ•°åˆ†ç»„éƒ½å¯ä»¥è¢«æ‹†å¼€æ¥ï¼Œç„¶åå†ä»¥å®ƒä»¬è‡ªå·±çš„ç»„åˆæ–¹å¼æ‰“åŒ…åœ¨ä¸€èµ·ã€‚

```js
var loudLastUpper = compose(exclaim, toUpperCase, head, reverse);

// æˆ–
var last = compose(head, reverse);
var loudLastUpper = compose(exclaim, toUpperCase, last);

// æˆ–
var last = compose(head, reverse);
var angry = compose(exclaim, toUpperCase);
var loudLastUpper = compose(angry, last);

// æ›´å¤šå˜ç§...
```

ç”±äº `compose` å‡½æ•°ç”¨ `reduce` å®ç°, æ‰€ä»¥, ä¼ å…¥çš„å‡½æ•°æ²¡æœ‰é™åˆ¶, æ‰€ä»¥å¯ä»¥ä»»æ„è¿›è¡Œç»„åˆæˆ–è€…åˆ†ç»„, è¿™ä¹Ÿä½“ç°äº†ç»„åˆçš„çµæ´»æ€§.

### `pointFree` æ¨¡å¼

> pointfree æ¨¡å¼æŒ‡çš„æ˜¯ï¼Œæ°¸è¿œä¸å¿…è¯´å‡ºä½ çš„æ•°æ®ã€‚

ä»¥ä¸‹æ˜¯ä¹¦ä¸­çš„ä¾‹å­

```js
// é pointfreeï¼Œå› ä¸ºæåˆ°äº†æ•°æ®ï¼šword
var snakeCase = function (word) {
  return word.toLowerCase().replace(/\s+/gi, "_");
};

// pointfree
var snakeCase = compose(replace(/\s+/gi, "_"), toLowerCase);
```

ä»¥ä¸‹æ˜¯æˆ‘å¯¹ `point free` æ¨¡å¼çš„ç†è§£å†™çš„ demo:

```js
const people = [
  { name: "Alice", age: 25 },
  { name: "Bob", age: 30 },
  { name: "Charlie", age: 35 },
];

// ä¼ ç»Ÿæ–¹æ³•, å¿…é¡»æœ‰ person å‚æ•°æ‰èƒ½å‚ä¸
const processPerson = (person) => {
  const upperCaseName = person.name.toUpperCase();
  const incrementedAge = person.age + 1;
  const greeting = `Hello, ${upperCaseName}!`;

  return {
    name: upperCaseName,
    age: incrementedAge,
    greeting: greeting,
  };
};

// ä¼ ç»Ÿæ¨¡å¼: å‡å¦‚ä¸Šé¢çš„ä»£ç æ”¾åœ¨å¦ä¸€ä¸ªæ–‡ä»¶, æˆ‘ä»¬è¦æŸ¥æ¸…æ¥š processPerson é‡Œé¢çš„æ“ä½œ,
// è¿˜å¿…é¡»è·‘å» processPerson å‡½æ•°é‡Œé˜…è¯»ä»£ç åŠ debug
const processedPeople = people.map(processPerson);
console.log(processedPeople);
```

```js
// ä»¥ä¸‹ä¸ºæ”¹ç”¨ç»„åˆæ¨¡å¼ compose
const compose = (...fns) => {
  const execute = (initialArray) => {
    return initialArray.map((item) =>
      fns.reduce((value, fn) => fn(value), item)
    );
  };

  return { execute };
};

const toUpperCase = (str) => str.toUpperCase();
const increment = (n) => n + 1;
const createGreeting = (name) => `Hello, ${name}!`;

// Pointfree functions
const toUpperCaseName = (obj) => ({ ...obj, name: toUpperCase(obj.name) });
const incrementAge = (obj) => ({ ...obj, age: increment(obj.age) });
const addGreeting = (obj) => ({ ...obj, greeting: createGreeting(obj.name) });

// compose æ–¹æ³•, å¯ä»¥æ ¹æ®å‡½æ•°åå­—, æ¸…æ™°çš„çŸ¥é“åšäº†å“ªäº›æ“ä½œ
const composedPeople = compose(
  toUpperCaseName,
  incrementAge,
  addGreeting
).execute(people);
console.log(composedPeople);
```

### debug compose å‡½æ•°çš„æ–¹æ³•

å½“æˆ‘ä»¬åœ¨ debug compose å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ ä¸€ä¸ª `trace` æ¥è¿½è¸ªé”™è¯¯, ä»¥ä¸‹æ˜¯æˆ‘è‡ªå·±å†™çš„ `trace` å‡½æ•°, æ²¡æœ‰ç”¨ä¹¦ä¸­çš„ä¾‹å­:

```js
const debug = (label) => (value) => {
  console.log(`${label}:`, value);
  return value;
};
```

`label` æŒ‡çš„æ˜¯æˆ‘ä»¬è‡ªå·±å†™çš„æ ‡å¿—, `value`å°±æ˜¯æ¯ä¸€æ­¥æ‰€äº§ç”Ÿçš„å€¼, è¿™ä¸ªå‡½æ•°å¯ä»¥æ’åœ¨ compose å‡½æ•°ä¸­çš„æ¯ä¸€æ­¥, æˆ‘ä»¬ç”¨ä¸Šé¢ `composedPeople` çš„ä»£ç ä¸¾ä¾‹, å¦‚:

```js
const composedPeople = compose(
  toUpperCaseName,
  debug("After toUpperCaseName"),
  incrementAge,
  debug("After incrementAge"),
  addGreeting,
  debug("After addGreeting")
);
```

### èŒƒç•´å­¦ (category theory)

ç»„åˆèƒŒåçš„å¼ºå¤§ç†è®ºåŸºç¡€. åœ¨ç¼–ç¨‹ä¸­ä½“ç°ä¸ºå¤„ç†:

> å¯¹è±¡ Object
> æ€å°„ morphism
> å˜åŒ–å¼ transformation

åœ¨ç¼–ç¨‹é‡Œ, èŒƒç•´å­¦çš„åº”ç”¨ä½“ç°åœ¨:

- å¯¹è±¡çš„é›†åˆ
  - ä¾‹å¦‚ `Boolean` å°±æ˜¯ `[true, false]`çš„é›†åˆ, `Number`å°±æ˜¯æ‰€æœ‰å®æ•°çš„é›†åˆ
  - å¯ä»¥ç”¨é›†åˆè®º(set theory)æ¥å¤„ç†ç±»å‹
- æ€å°„çš„é›†åˆ, å³æ ‡å‡†çš„çº¯å‡½æ•°
- æ€å°„çš„ç»„åˆ
  - ç»“åˆå¾‹æ˜¯åœ¨èŒƒç•´å­¦ä¸­å¯¹ä»»ä½•ç»„åˆéƒ½é€‚ç”¨çš„ä¸€ä¸ªç‰¹æ€§
- ä¸€ç§ç‰¹æ®Šæ€å°„ identity `const id = x => x`

### æ€»ç»“

> ç»„åˆåƒä¸€ç³»åˆ—ç®¡é“é‚£æ ·æŠŠä¸åŒçš„å‡½æ•°è”ç³»åœ¨ä¸€èµ·ï¼Œæ•°æ®åœ¨å…¶ä¸­æµåŠ¨

> ç»„åˆæ˜¯é«˜äºå…¶ä»–æ‰€æœ‰åŸåˆ™çš„è®¾è®¡åŸåˆ™

> èŒƒç•´å­¦å°†ç”¨åœ¨æŒ‡å¯¼åº”ç”¨æ¶æ„ã€å‰¯ä½œç”¨å»ºæ¨¡å’Œä¿è¯æ­£ç¡®æ€§

## type signature ç±»å‹ç­¾å

> ç±»å‹ï¼ˆtypeï¼‰æ˜¯è®©æ‰€æœ‰ä¸åŒèƒŒæ™¯çš„äººéƒ½èƒ½é«˜æ•ˆæ²Ÿé€šçš„å…ƒè¯­è¨€ã€‚

å®è´¨ä¸Š, æˆ‘æ„Ÿè§‰å°±æ˜¯ type script çš„ä¸€ç§å­ç±»å‹. æ¯” type script ç®€å•, type script æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å·²ç»ç”¨çš„ä¸å°‘äº†, è¿™é‡Œä¸è¿‡å¤šè§£é‡Š, ä¸‹é¢åªç»™å‡ºä¸€äº›ä¹¦ä¸­çš„ç¤ºä¾‹:

```js
//  capitalize :: String -> String
var capitalize = function (s) {
  return toUpperCase(head(s)) + toLowerCase(tail(s));
};

capitalize("smurf");
//=> "Smurf"
```

```js
//  strLength :: String -> Number
var strLength = function (s) {
  return s.length;
};

// [] æ˜¯æŒ‡æ•°ç»„, ç±»ä¼¼ ts çš„ string[]
//  join :: String -> [String] -> String
var join = curry(function (what, xs) {
  return xs.join(what);
});

//  match :: Regex -> (String -> [String])
var match = curry(function (reg, s) {
  return s.match(reg);
});

//  replace :: Regex -> (String -> (String -> String))
var replace = curry(function (reg, sub, s) {
  return s.replace(reg, sub);
});
```

> ç›¸åŒçš„å˜é‡åï¼Œå…¶ç±»å‹ä¹Ÿä¸€å®šç›¸åŒ

ç±»ä¼¼ ts çš„æ³›å‹:

```js
// id :: a -> a
const id = (x) => x;

// mapï¼šï¼š ï¼ˆa -> bï¼‰ -> ï¼»a] -> ï¼»bï¼½
const map = curry((f, xs) => xs.map(f));
```

æ¥å£åœ¨ç±»å‹ç­¾åä¸­çš„è¡¨ç¤º:

```js
// sort :: Ord a => [a] -> [a]

// assertEqual :: (Eq a, Show a) => a -> a -> Assertion
```

è¿™é‡Œçš„ `Ord`, `Eq` , `Show` å‡ä¸ºæ¥å£, æ¥å£çš„å®ç°å®ç°ç”¨ `=>` è¡¨ç¤º

## `Functor` å‡½å­ (é‡ç‚¹)

> `Functor` æ˜¯å®ç°äº† `map` å‡½æ•°å¹¶éµå®ˆä¸€äº›ç‰¹å®šè§„åˆ™çš„å®¹å™¨ç±»å‹ã€‚

æœ¬æ–‡èŠ±è´¹äº†å¤§é‡æ—¶é—´äº `Functor` è¿™ç« çš„å†…å®¹, å› ä¸º Functor é‡Œçš„ `Maybe`, `Either` ç­‰æ¦‚å¿µåœ¨ js é‡Œæ²¡æœ‰åŸç”Ÿæ”¯æŒ, è€Œåè§‚çº¯å‡½æ•°å¼è¯­è¨€çš„ `Haskell`, `Scala`, `F#` ç­‰è¯­è¨€éƒ½æœ‰.

ä¸‹é¢æ˜¯æé—® Chatgpt åçš„å›ç­”:

> `Functor` æ˜¯ä¸€ä¸ªå…·æœ‰ `map` æ–¹æ³•çš„å®¹å™¨æˆ–ä¸Šä¸‹æ–‡ï¼Œè¯¥æ–¹æ³•å…è®¸ä½ å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨åˆ°å®¹å™¨å†…çš„æ¯ä¸ªå€¼ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å®¹å™¨ã€‚

æ€»ç»“èµ·æ¥, **Functor å°±æ˜¯å…è®¸ä½¿ç”¨ map å‡½æ•°å˜æ¢é‡Œé¢å†…å®¹çš„å®¹å™¨**. åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­, æˆ‘ä»¬å·²ç»ä½¿ç”¨å¾ˆä¹…äº†, ä½†å¯èƒ½ä½ å¹¶æ²¡æ„è¯†åˆ°ä½ åœ¨ä½¿ç”¨å®ƒ. ä¾‹å¦‚, åœ¨ JavaScript ä¸­, `Array` å’Œ `String` éƒ½æ˜¯ functor, å› ä¸ºå®ƒä»¬éƒ½å®ç°äº† `map` æ–¹æ³•.

### `Functor` çš„ç‰¹æ€§è§£æ

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå‡½å­ `Functor` çš„æœ€ç®€å•å®ç°, ç¬¦åˆäº† `Functor` çš„å®šä¹‰:

- `map` æ–¹æ³•æ¥æ”¶ä¸€ä¸ªå‡½æ•°, å¹¶è¿”å›ä¸€ä¸ªå‡½å­.
- å¤–éƒ¨ä¼ è¿›æ¥çš„å€¼, åˆ©ç”¨ç§æœ‰å˜é‡ `#value` ä¿å­˜èµ·æ¥
- æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åŸºäºç§æœ‰å˜é‡ `#value` , ä»–å§‹ç»ˆä¿å­˜åœ¨å®¹å™¨å†….

```ts
class Container<T> {
  #value: T;

  constructor(value: T) {
    this.#value = value;
  }

  map<U>(fn: (value: T) => U): Container<U> {
    // mapé€’å½’åˆ›å»ºä¸€ä¸ªæ–°çš„ Container, æ›´æ–°ç§æœ‰å˜é‡ #value:
    return new Container(fn(this.#value));
  }

  get value(): T {
    return this.#value;
  }
}

const c = new Container(2).map((x) => x + 3).map((x) => x * x);
console.log(c.value); // 25
```

æ¥ç€, æˆ‘ä»¬ä¸€æ­¥æ­¥æ¥å®Œå–„ä¸Šé¢çš„å®ç°

### Pointed Functor

> å®ç°äº†é™æ€æ–¹æ³• `of` çš„å‡½å­, `of` æ–¹æ³•æ˜¯æŠŠå€¼æ”¾åˆ°ä¸Šä¸‹æ–‡ `Context` ä¸­, ä½¿ç”¨ `map` æ¥å¤„ç†

æˆ‘ä»¬åœ¨è°ƒç”¨ `Container` æ—¶ä»éœ€è¦ `new` å…³é”®å­—, è¿™å¾ˆä¸ç¬¦åˆå‡½æ•°å¼ç¼–ç¨‹çš„é€»è¾‘, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘å°† `new` å…³é”®å­—å»æ‰, ä¼˜åŒ– `Functor` ç±», æ·»åŠ é™æ€æ–¹æ³• `of` æ›¿ä»£, å¦‚:

```ts
class Container<T> {
  #value: T;

  constructor(value: T) {
    this.#value = value;
  }

  // é™æ€æ–¹æ³• of æ›¿æ¢è°ƒç”¨æ—¶çš„ new å…³é”®å­—
  static of<T>(value: T): Container<T> {
    return new Container(value);
  }

  map<U>(fn: (value: T) => U): Container<U> {
    return Container.of(fn(this.#value));
  }

  get value(): T {
    return this.#value;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const c = Container.of(3)
  .map((x) => x + 1)
  .map((x) => x * x);

console.log(c.value); // è¾“å‡º: 16
```

### `extract` å‡½æ•°è·å–å€¼

ç”±äº `Functor` æœ€ç»ˆçš„äº§ç‰©å§‹ç»ˆæ˜¯ä¸€ä¸ªå®¹å™¨, ä¸Šé¢çš„ä»£ç ä¸­, è¿˜æ˜¯åˆ©ç”¨é¢å‘å¯¹è±¡çš„æ€ç»´, ç”¨ getter æ–¹æ³•, è·å–å®¹å™¨å†…çš„å€¼. å®é™…ä¸Š, ä¸¥æ ¼æ„ä¹‰ä¸Šå‡½æ•°å¼ç¼–ç¨‹ä»æ˜¯ç”¨å‡½æ•°çš„æ–¹å¼æ¥è·å–å®¹å™¨å†…çš„å€¼. å¦‚ä¸‹:

```ts
class Container<T> {
  #value: T;

  constructor(value: T) {
    this.#value = value;
  }

  static of<T>(value: T): Container<T> {
    return new Container(value);
  }

  map<U>(fn: (value: T) => U): Container<U> {
    return Container.of(fn(this.#value));
  }

  // extract æ–¹æ³•ï¼Œç”¨äºæœ€ç»ˆå¤„ç†å’Œæå–å€¼
  extract<U>(fn: (value: T) => U): U {
    return fn(this.#value);
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const c = Container.of(3)
  .map((x) => x + 1)
  .map((x) => x * x)
  .extract((x) => x);

console.log(c); // è¾“å‡º: 16
```

å°†å…¶æ”¹ä¸ºå‡½æ•°çš„å½¢å¼:

```ts
const Container = <T>(value: T) => ({
  map: <U>(fn: (value: T) => U) => Container(fn(value)),
  extract: <U>(fn: (value: T) => U): U => fn(value),
});

// ä½¿ç”¨ç¤ºä¾‹
const c = Container(3)
  .map((x) => x + 1)
  .map((x) => x * x)
  .extract((x) => x);

console.log(c); // è¾“å‡º: 16
```

`Functor` é™¤äº†ä¸Šé¢æ‰€æåŠçš„åŸºç¡€å†…å®¹, åœ¨å®é™…å¼€å‘ä¸­, è¿˜æœ‰ä¸€ä¸ªå¤§åŠŸèƒ½, æ˜¯ç”¨æ¥è§£å†³çº¯å‡½æ•°ç¼–ç¨‹çš„å‰¯ä½œç”¨é—®é¢˜. æŠŠå‰¯ä½œç”¨æ§åˆ¶åœ¨æˆ‘ä»¬å¯æ§çš„èŒƒå›´å†…. è¿™äº›å‰¯ä½œç”¨åŒ…æ‹¬

- å¤„ç†å¼‚å¸¸
- å¼‚æ­¥æ“ä½œ
- I/O æ“ä½œ

ä¸‹é¢, æˆ‘ä»¬å°± `Functor` çš„å‰¯ä½œç”¨ç‰¹å¾, æ¥å±•å¼€è®¨è®º.

### Maybe Functor

`Maybe` æ˜¯ç”¨äºå¤„ç†åˆ¤æ–­ä¼ å…¥çš„å€¼æ˜¯å¦ä¸º `null` å’Œ `undefined` çš„ `Functor`. **åœ¨ `Scala` ä¸­, ç›¸å½“äº `Option`**

è€Œå¦‚æœåœ¨ JS é‡Œè¿ç”¨ä¸Š `Maybe` çš„ç±»å‹æ£€æŸ¥, é‚£ä¹ˆå¯ä»¥é¿å…å¾ˆå¤šçš„ `if` åˆ¤æ–­. ä»–åŸç”Ÿçš„æ•è·äº† `null` å’Œ `undefined` çš„é—®é¢˜, å¹¶ä¸”æä¾›äº† `map` æ–¹æ³•, ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ `Maybe` ç±»å‹ä¸­åº”ç”¨ `map` æ–¹æ³•. ä½¿å¾—ç¨‹åºä¸ä¼šå› ä¸º `null` å’Œ`undefined` å€¼æŠ¥é”™ä»è€Œä½¿ç¨‹åºæŠ¥é”™æˆ–ä¸­æ–­.

æˆ‘ä»¬è‡ªå·±æ¥å®ç°ä¸€ä¸ª `Maybe` ç±»å‹:

```ts
class Maybe<T> {
  #value: T;
  constructor(value) {
    this.#value = value;
  }
  static of<T>(value: T): Maybe<T> {
    return new Maybe(value);
  }

  map<U>(fn: (value: T) => U | null): Maybe<U | null> {
    return this.isNone() ? Maybe.of(null) : Maybe.of(fn(this.#value));
  }

  extract<U>(fn: (value: T) => U): U {
    return fn(this.#value);
  }

  isNone(): boolean {
    return this.#value === null || this.#value === undefined;
  }
}

// è°ƒç”¨ç¤ºä¾‹:
const m = Maybe.of<string | null>(null)
  .map((x) => x?.toUpperCase())
  .extract((x) => x);

console.log(m);
```

å°†ä¸Šé¢çš„ `Maybe` class ç±»å‹æ”¹ä¸ºå‡½æ•°å¼:

```ts
const Maybe = <T>(value: T) => ({
  map: <U>(fn: (value: T) => U | null): ReturnType<typeof Maybe<U | null>> =>
    Maybe(fn(value)),
  extract: <U>(fn: (value: T) => U): U => fn(value),
});

// ä½¿ç”¨ç¤ºä¾‹
const m = Maybe<string | null>(null)
  .map((x) => x?.toUpperCase() || null)
  .extract((x) => x);

console.log(m); // null

const m1 = Maybe("hello world")
  .map((x) => x.toUpperCase())
  .extract((x) => x);

console.log(m1); // 'HELLO WORLD'
```

ç¨å¾®è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ä»£ç :

- ä¸Šé¢çš„ä»£ç æ”¹ä¸ºå‡½æ•°å¼å, æ›´ä¸ºç²¾ç®€, è¿ class é‡Œçš„ `isNone` æ–¹æ³•, éƒ½ä¸éœ€è¦äº†
- æ³›å‹ `<U>` ä»£è¡¨å‡½æ•°çš„è¿”å›å€¼ç±»å‹, å¦‚æœä¸€ä¸ªæ³›å‹, ä»–çš„è¿”å›å€¼ç±»å‹å’Œä»–ä¼ å…¥çš„ç±»å‹ä¸ä¸€æ ·, é‚£ä¹ˆå°±å¿…é¡»åœ¨å‡½æ•°çš„æ‹¬å·å‰, åŠ ä¸Šä¸€ä¸ªæ–°çš„æ³›å‹, ä½œä¸ºè¿”å›å€¼, å¦‚ä¸Šé¢æ‰€ç¤º

### Either Functor

ä¸Šé¢`Maybe Functor` çš„å®ç°, è§£å†³äº†ä¼ å…¥çš„å‚æ•°ä¸ºç©ºå€¼çš„éœ€æ±‚. ä½†å¦‚æœåœ¨é“¾å¼è°ƒç”¨çš„è¿‡ç¨‹ä¸­, æŸä¸€æ¬¡å‡ºç°ç©ºå€¼çš„æƒ…å†µ, é‚£ä¹ˆå¯¹äºè°ƒè¯•æˆ–è€…ç¼–ç æ¥è¯´, æ˜¯éš¾ä»¥é¢„æµ‹çš„, æ¯”å¦‚:

```ts
const m1 = Maybe("hello world")
  .map((x) => x.toUpperCase())
  // å‡è®¾æŸä¸€æ¬¡è°ƒç”¨å‡ºç°äº†ç©ºå€¼:
  .map((x) => undefined)
  .extract((x) => x);

// è¾“å‡ºçš„ç»“æœè™½ç„¶æ•è·åˆ°, ä½†æ˜¯è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœ:
console.log(m1); // undefined
```

è¿™æ—¶, `Either` å°±æ´¾ä¸Šç”¨åœºäº†.

> `Either` æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†è°ƒç”¨è¿‡ç¨‹ä¸­é”™è¯¯å’Œå¼‚å¸¸çš„ `Functor`.

> `Either`æ˜¯ä¸€ä¸ªè¡¨ç¤ºå¯èƒ½å«æœ‰ä¸¤ç§ç±»å‹å€¼çš„æ•°æ®ç»“æ„ï¼Œå®ƒé€šå¸¸ç”¨äºè¡¨ç¤ºä¸€ä¸ªè®¡ç®—çš„ç»“æœå¯èƒ½æˆåŠŸï¼ˆå«æœ‰ä¸€ä¸ªå€¼ï¼‰æˆ–å¤±è´¥ï¼ˆå«æœ‰ä¸€ä¸ªé”™è¯¯æˆ–å¦ä¸€ç§å€¼ï¼‰ã€‚

> `Either` æœ‰ä¸¤ä¸ªå­æ„é€ ï¼š`Left` å’Œ `Right`ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œ`Right` é€šå¸¸è¡¨ç¤ºæˆåŠŸï¼Œè€Œ `Left` é€šå¸¸è¡¨ç¤ºå¤±è´¥æˆ–é”™è¯¯ã€‚`Either` æ˜¯è¿™ä¸¤ç§æ„é€ çš„å åŠ æ€.

ä»¥ä¸‹æ˜¯ `Scala` å…³äº `Either` çš„ä¸€ä¸ªç®€å•ä¾‹å­, å¯ä»¥è¯´æ˜ `Either` çš„ä½œç”¨:

```scala
def divide(a: Int, b: Int): Either[String, Double] = {
  // å½“é™¤æ•°ä¸º0æ—¶ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯Left
  if (b == 0) Left("Division by zero")
  // å½“é™¤æ•°ä¸ä¸º0æ—¶ï¼Œè¿”å›ç»“æœRight
  else Right(a.toDouble / b)
}
```

åŒæ ·çš„, æˆ‘ä»¬ç”¨ ts æ¥ç®€å•çš„å®ç° `Either`:

```ts
class Either<L, R> {
  static left<L, R>(value: L): Either<L, R> {
    return new Left(value);
  }

  static right<L, R>(value: R): Either<L, R> {
    return new Right(value);
  }

  map<U>(fn: (value: R) => U): Either<L, U> {
    return this.isRight()
      ? Either.right(fn(this.getValue()))
      : Either.left(this.getError());
  }

  flatMap<U>(fn: (value: R) => Either<L, U>): Either<L, U> {
    return this.isRight() ? fn(this.getValue()) : Either.left(this.getError());
  }

  getOrElse(defaultValue: R): R {
    return this.isRight() ? this.getValue() : defaultValue;
  }

  isLeft(): this is Left<L> {
    return false;
  }

  isRight(): this is Right<R> {
    return false;
  }

  getValue(): R {
    throw new Error("Cannot get value from Left");
  }

  getError(): L {
    throw new Error("Cannot get error from Right");
  }
}

class Left<L> extends Either<L, never> {
  private value: L;

  constructor(value: L) {
    super();
    this.value = value;
  }

  isLeft(): this is Left<L> {
    return true;
  }

  getError(): L {
    return this.value;
  }
}

class Right<R> extends Either<never, R> {
  private value: R;

  constructor(value: R) {
    super();
    this.value = value;
  }

  isRight(): this is Right<R> {
    return true;
  }

  getValue(): R {
    return this.value;
  }
}

// ä½¿ç”¨ä»£ç :
const rightValue: Either<string, number> = Either.right(5);
const leftValue: Either<string, number> = Either.left("Error");

const result1 = rightValue
  .map((x) => x + 1)
  .flatMap((x) => Either.right(x * 2))
  .getOrElse(0);

const result2 = leftValue
  .map((x) => x + 1)
  .flatMap((x) => Either.right(x * 2))
  .getOrElse(0);

console.log(result1); // è¾“å‡º: 12
console.log(result2); // è¾“å‡º: 0
```

å°†ä¸Šé¢çš„ `Either` class ç±»å‹æ”¹ä¸ºå‡½æ•°å¼:

```ts
type Either<L, R> = { type: "Left"; value: L } | { type: "Right"; value: R };

const left = <L, R>(value: L): Either<L, R> => ({ type: "Left", value });
const right = <L, R>(value: R): Either<L, R> => ({ type: "Right", value });

const isRight = <L, R>(
  either: Either<L, R>
): either is { type: "Right"; value: R } => either.type === "Right";

const map = <L, R, U>(
  either: Either<L, R>,
  fn: (value: R) => U
): Either<L, U> => (isRight(either) ? right(fn(either.value)) : either);

const flatMap = <L, R, U>(
  either: Either<L, R>,
  fn: (value: R) => Either<L, U>
): Either<L, U> => (isRight(either) ? fn(either.value) : either);

const getOrElse = <L, R>(either: Either<L, R>, defaultValue: R): R =>
  isRight(either) ? either.value : defaultValue;

// ç¤ºä¾‹ä»£ç :
const rightValue: Either<string, number> = right(5);
const leftValue: Either<string, number> = left("Error");

// Using map and flatMap directly
const ret1 = getOrElse(
  flatMap(
    map(rightValue, (x) => x + 1),
    (x) => right(x * 2)
  ),
  0
);

const ret2 = getOrElse(
  flatMap(
    map(leftValue, (x) => x + 1),
    (x) => right(x * 2)
  ),
  0
);

console.log(ret1); // è¾“å‡º: 12
console.log(ret2); // è¾“å‡º: 0
```

### IO Functor

IO Functor ç›¸æ¯”äºä¸Šé¢æåˆ°çš„ Functor, æœ‰ä»¥ä¸‹ç‰¹ç‚¹:

- IO Functor çš„ç§æœ‰å˜é‡ `#value` æ˜¯ä¸€ä¸ªå‡½æ•°, æŠŠå‡½æ•°å½“åšå€¼æ¥å¤„ç†.
- `#value` ä½œä¸ºå‡½æ•°å­˜å‚¨, å¥½å¤„æ˜¯å¯ä»¥ç¼“å­˜, æƒ°æ€§æ‰§è¡Œ. è°ƒç”¨äº†æ‰æ‰§è¡Œ
- æŠŠä¸æ˜¯çº¯å‡½æ•°çš„æ“ä½œäº¤ç»™è°ƒç”¨è€…å¤„ç†

ä¸‹é¢æ˜¯ä¸€ä¸ª `IO` çš„ä¾‹å­

```ts
class IO<T> {
  #effect: () => T;

  constructor(effect: () => T) {
    if (typeof effect !== "function") {
      throw new TypeError("IO expects a function");
    }
    this.#effect = effect;
  }

  // map method to transform the value inside IO
  map<U>(fn: (value: T) => U): IO<U> {
    return IO.of(() => fn(this.#effect()));
  }

  // run method to execute the effect
  run(): T {
    return this.#effect();
  }

  // static of method to create an IO instance
  static of<T>(value: T | (() => T)): IO<T> {
    return new IO(
      // ä¸ºäº†å…¼å®¹æ™®é€šå€¼, å¦‚æœç”¨ of ä¼ å…¥çš„æ™®é€šå‚æ•°, å°†å…¶è§†ä¸ºä¸€ä¸ªå‡½æ•°æ‰§è¡Œ
      typeof value === "function" ? (value as () => T) : () => value
    );
  }
}

// ä½¿ç”¨ç¤ºä¾‹

// åˆ›å»ºä¸€ä¸ªIOå®ä¾‹ï¼Œå°†å…¶åŒ…è£…ä¸€ä¸ªå‰¯ä½œç”¨å‡½æ•°
const io = IO.of(5)
  .map((x) => x + 1)
  .map((x) => x * 2);

// è¿è¡Œå¹¶è·å–æœ€ç»ˆçš„ç»“æœ
const result = io.run();
console.log(result); // è¾“å‡º: 12

// åˆ›å»ºä¸€ä¸ªè¯»å–ç”¨æˆ·è¾“å…¥çš„IO Functor
const readInput = IO.of(() => prompt("Enter a value:"));
const p = (x: string) => IO.of(() => console.log(`You entered: ${x}`));

const app = readInput
  .map((input) => input?.toUpperCase() || "")
  .map((input) => `Hello, ${input}!`)
  .map(p)
  .map((io) => io.run());

app.run(); // å°†æ˜¾ç¤ºä¸€ä¸ªæç¤ºè¾“å…¥æ¡†ï¼Œç„¶åæ‰“å°ç”¨æˆ·è¾“å…¥çš„å€¼
```

å°†å…¶æ”¹ä¸ºå‡½æ•°å¼è¡¨è¾¾, çœç•¥æ‰é™æ€æ–¹æ³• `of`:

```ts
type Effect<T> = () => T;

interface IO<T> {
  map<U>(fn: (value: T) => U): IO<U>;
  run(): T;
}

const IO = <T>(value: T | Effect<T>): IO<T> => {
  const effect: Effect<T> =
    typeof value === "function" ? (value as Effect<T>) : () => value;

  return {
    map<U>(fn: (value: T) => U): IO<U> {
      return IO(() => fn(effect()));
    },
    run(): T {
      return effect();
    },
  };
};

// ä½¿ç”¨ç¤ºä¾‹

// åˆ›å»ºä¸€ä¸ªIOå®ä¾‹ï¼Œå°†å…¶åŒ…è£…ä¸€ä¸ªå‰¯ä½œç”¨å‡½æ•°
const io = IO(5)
  .map((x) => x + 1)
  .map((x) => x * 2);

// è¿è¡Œå¹¶è·å–æœ€ç»ˆçš„ç»“æœ
const result = io.run();
console.log(result); // è¾“å‡º: 12

// åˆ›å»ºä¸€ä¸ªè¯»å–ç”¨æˆ·è¾“å…¥çš„IO Functor
const readInput = IO(() => prompt("Enter a value:"));
const p = (x: string) => IO(() => console.log(`You entered: ${x}`));

const app = readInput
  .map((input) => input?.toUpperCase() || "")
  .map((input) => `Hello, ${input}!`)
  .map(p)
  .map((io) => io.run());

app.run(); // å°†æ˜¾ç¤ºä¸€ä¸ªæç¤ºè¾“å…¥æ¡†ï¼Œç„¶åæ‰“å°ç”¨æˆ·è¾“å…¥çš„å€¼
```

## Monad å•å­ (é‡ç‚¹)

(å¾…æ›´æ–°)

å‚è€ƒèµ„æ–™:

- https://mostly-adequate.gitbook.io/mostly-adequate-guide
