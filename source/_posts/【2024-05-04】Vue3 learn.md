---
title: Vue3 æ–°ç‰¹æ€§ä¸€è§ˆ (æ›´æ–°ä¸­ 2024-05-11 æ›´æ–°å®Œæ¯•ICC)
date: 2024-05-04 10:00:00
tags:
  - Vue
cover: https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@1.55/articles/Vue3å­¦ä¹ /cover.png
---

<div style="display: flex; justify-content: center;">

<script src="https://unpkg.com/@dotlottie/player-component@latest/dist/dotlottie-player.mjs" type="module"></script><dotlottie-player src="https://lottie.host/7b916581-6d8b-425d-8df1-1d363691a65f/0QJRiGVfSP.json" background="transparent" speed="2" style="height: 40vh" direction="1" playMode="normal" loop autoplay></dotlottie-player>
</div>

æœ€è¿‘å­¦ä¹  Vue3, è¿™é‡Œåšä¸ªç®€å•çš„è®°å½•ï¼ŒVue3 åœ¨ Vue2 çš„å‡çº§ï¼Œè¯­æ³•å’Œ API éƒ½å‘ç”Ÿäº†å˜åŒ–ã€‚ä¸‹é¢å°±ä¸€äº›æ–°å¢çš„ APIï¼Œå†™ä¸€äº›ç®€å•çš„ demo è¿›è¡Œè®°å½•ã€‚

<!-- more -->

## åˆ›å»ºé¡¹ç›®

vue3 åˆ›å»ºé¡¹ç›®ï¼Œä½¿ç”¨ `Vite` è„šæ‰‹æ¶ã€‚æ”¾å¼ƒäº†åŸæ¥çš„ `vue-cli`ã€‚

```bash
# è·Ÿç€cliçš„æç¤ºä¸€æ­¥æ­¥åˆ›å»ºå³å¯ï¼š
npm init vite@latest
```

æˆ‘å°è¯•ç€åˆ é™¤ `src` ç›®å½•ï¼Œé‡æ–°æ–°å»ºä¸€ä¸ª src ç›®å½•ï¼Œè‡ªå·±å†™ä¸€ä¸ª `src/main.ts` å’Œ `src/App.vue`ã€‚

![App.vueæ–‡ä»¶å¼•å…¥typescript æ–‡ä»¶æŠ¥é”™](https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@1.55/articles/Vue3å­¦ä¹ /vueå¼•å…¥é”™è¯¯.png)

ä¼šå‘ç° ts æ£€æŸ¥åœ¨ `App.vue` ä¸­æŠ¥é”™ã€‚è¿™æ—¶å› ä¸º ts çš„æ£€æŸ¥ä¸­ï¼Œä¸è®¤è¯†.vue æ–‡ä»¶ï¼Œéœ€è¦é…ç½® `env.d.ts`æ–‡ä»¶ã€‚cmd (Mac)/ctrl (Windows) + å·¦é”®ç‚¹å‡»ä¸‹é¢çš„ `"vite/client"` è·¯å¾„

```typescript
/// <reference types="vite/client" />
```

ä¼šè·³è½¬åˆ° `vite/client` æ–‡ä»¶ï¼Œæ·»åŠ ï¼š

```typescript
declare module "*.vue" {
  import { ComponentOptions } from "vue";
  const componentOptions: ComponentOptions;
  export default componentOptions;
}
```

å³å¯

## Vue3 å…¥å£æ–‡ä»¶ä¸€äº›æ¦‚å¿µ

- `Vite` é¡¹ç›®ä¸­ï¼Œ`index.html` æ˜¯é¡¹ç›®çš„å…¥å£æ–‡ä»¶ï¼Œåœ¨é¡¹ç›®æœ€å¤–å±‚ã€‚
- åŠ è½½ `index.html` åï¼Œ`Vite` è§£æ `<script type="module" src="xxx">`æŒ‡å›çš„ Javascript
- Vue3 ä¸­æ˜¯é€šè¿‡`createApp`å‡½æ•°åˆ›å»ºä¸€ä¸ªåº”ç”¨å®ä¾‹ã€‚

## `Options API` å’Œ `Composition API`

Vue2 å±äº `Option API` (é…ç½®é€‰é¡¹å¼ API)ï¼ŒVue3 å±äº `Composition API`ï¼ˆç»„åˆå¼ APIï¼‰ï¼Œæˆ‘æ„¿æ„ç§°ä»–ä¸ºåŠŸèƒ½æ€§ç»„åˆ APIã€‚

éšç€ Vue2 é‡Œçš„å„ä¸ªç»„ä»¶è¶Šæ¥è¶Šå¤æ‚ï¼Œé…ç½®å¼ API ç¼ºç‚¹éå¸¸æ˜æ˜¾ï¼Œæ‰€æœ‰çš„å€¼æ•£è½åœ¨è¯¸å¦‚ data(), methods(), computed(), watch()ç­‰ç­‰æ–¹æ³•ä¸­ï¼Œä¿®æ”¹ä¸€å¤„æœ‰å¯èƒ½è¦ä¿®æ”¹å¤šå¤„ã€‚

æ¯”èµ·åŸæ¥ Options APIï¼ˆä¾‹å¦‚ï¼š`data()`,`methods()`ï¼‰ï¼Œ`setup`æœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š

- ä¸€ä¸ª vue æ–‡ä»¶å¯ä»¥åŒæ—¶å…·å¤‡ `data()`, `methods()` ç­‰ Vue2 çš„åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥åŒæ—¶å…·å¤‡ `setup()`å†™æ³•çš„ Vue3 åŠŸèƒ½ã€‚
- `setup()` å‡½æ•°ä¸­ï¼Œä¸èƒ½å†ä½¿ç”¨ `this`ã€‚è€Œä¸”`setup`æ˜¯æœ€æ—©çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚æ‰€ä»¥ data() å’Œ methods() å‡½æ•°ä¸­ï¼Œå¯ä»¥è®¿é—® setup() å‡½æ•°ä¸­å®šä¹‰çš„å˜é‡ã€‚ä½† setup() å‡½æ•°ä¸­ï¼Œä¸èƒ½è®¿é—® data() å’Œ methods() å‡½æ•°ä¸­å®šä¹‰çš„å˜é‡ã€‚

## `setup()`

è¿™ä¸ªæ˜¯ Vue3 è¿½èµ¶ React å‡½æ•°å¼ç¼–ç¨‹çš„æ–°æ¦‚å¿µï¼Œåœ¨ Vue2 é‡Œï¼Œ`setup`æ™®é€šçš„å†™æ³•ï¼Œä»–æ˜¯æ‰§è¡Œåœ¨ç”Ÿå‘½å‘¨æœŸé‡Œçš„ `beforeCreate` é˜¶æ®µä¹‹å‰çš„å‡½æ•°ï¼Œå› æ­¤ï¼ŒVue3 å°† `setup`å‡½æ•°æå‡åˆ°ä¸€ä¸ªæ–°çš„é«˜åº¦ã€‚

```html
<script>
  export default {
    setup() {},
  };
</script>
```

### è¯­æ³•ç³– `<script setup lang="ts">`

é‰´äº `setup()`çš„ç‰¹æ®Šæ€§ï¼ŒVue3 å°†å…¶ç‹¬ç«‹ä¸ºä¸€ä¸ªè¯­æ³•ç³–çš„å†™æ³•ï¼Œå°†å…¶æ•´åˆè¿› `<script lang="ts" setup>` é‡Œï¼Œä¸‹é¢æ˜¯ vue3 `App.vue` æ–‡ä»¶çš„ setup æ”¹æ³•ï¼š

```html
<template>
  <ChildComp />
</template>

<script setup lang="ts">
  // ç›´æ¥å¯¼å‡ºå­ç»„ä»¶å³å¯ï¼Œçœç•¥ export default
  import ChildComp from "./components/WatchEffectDemo.vue";
</script>
```

### `setup`æ’ä»¶: `VueSetupExtend` å¢å¼º script æ ‡ç­¾ç”¨æ³•

```bash
npm i vite-plugin-vue-setup-extend -D
```

`vite.config.ts` é…ç½®ï¼šplugins ä¸­æ·»åŠ  `VueSetupExtend()`ï¼Œå¦‚ï¼š

```ts
import { fileURLToPath, URL } from "node:url";

import { defineConfig } from "vite";
import vue from "@vitejs/plugin-vue";
import VueSetupExtend from "vite-plugin-vue-setup-extend";

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [vue(), VueSetupExtend()],
  resolve: {
    alias: {
      "@": fileURLToPath(new URL("./src", import.meta.url)),
    },
  },
});
```

## `ref` å’Œ `reactive`ï¼Œå°†æ•°å˜ä¸ºå“åº”å¼

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼š

```html
<template>
  <div class="car">
    <h2>{{ car.brand }} -> {{ car.price }}å…ƒ</h2>
    <button @click="addPrice">ä¿®æ”¹ä»·æ ¼+10ä¸‡</button>
    <button @click="minusPrice">ä¿®æ”¹ä»·æ ¼-1ä¸‡</button>
    <button @click="changeCarByReactive">ä¿®æ”¹æ•´è½¦by reactive</button>
  </div>
  <div>
    <h2>{{ car2.brand }} -> {{ car2.price }}å…ƒ</h2>
    <button @click="changeCarByRef">ä¿®æ”¹æ•´è½¦by ref</button>
  </div>
</template>

<script lang="ts" setup name="Car12">
  import { ref, reactive, toRefs } from "vue";

  let car = reactive({ brand: "Toyota", price: 200000 });
  // å¦‚æœè¦è§£æ„ï¼Œå¿…é¡»ç”¨toRefså¥—ä¸Šï¼Œå¦åˆ™é¡µé¢æ— æ³•å“åº”
  let { price } = toRefs(car);
  const addPrice = () => (price.value += 100000);

  // å¦‚æœåªä¿®æ”¹æŸä¸€ä¸ªå±æ€§ï¼Œç”¨.è¯­æ³•ä¿®æ”¹
  const minusPrice = () => (car.price -= 10000);
  const changeCarByReactive = () => {
    // å¦‚æœæ¶‰åŠæ•´ä¸ªå¯¹è±¡ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ç”¨Object.assign
    Object.assign(car, { brand: "Audi", price: 300000 });
  };

  let car2 = ref({ brand: "Benz", price: 800000 });
  const changeCarByRef = () => {
    // å¦‚æœæ”¹ç”¨refï¼Œå¿…é¡»ç”¨valueä¿®æ”¹ï¼Œè€Œä¸”.valueå°±æ˜¯å“åº”å¼ï¼Œé¡µé¢å¯ä»¥å®æ—¶å‘ˆç°
    car2.value = { brand: "Audi", price: 300000 };
  };
</script>
```

- `ref` å¯ä»¥åŒ…è£¹ä»»æ„æ•°æ®ç±»å‹ï¼Œä½œä¸ºå“åº”å¼æ•°æ®ï¼Œå¹¶å®æ—¶ä¿®æ”¹è§†å›¾çš„å€¼
- è¢« `ref` åŒ…è£¹çš„æ•°æ®ï¼Œå¦‚æœè¦æ›´æ”¹é¡µé¢çš„å€¼ï¼Œå¿…é¡»ç”¨ `.value` ä¿®æ”¹ã€‚ä¾‹å¦‚ä¾‹å­ä¸­çš„ï¼š`car2.value = { brand: "Audi", price: 300000 };`
- `reactive` åªèƒ½ç”¨æ¥åŒ…è£¹ä¸€ä¸ªå¯¹è±¡ï¼Œä½œä¸ºå“åº”å¼æ•°æ®ã€‚
- è¢« `reactive` åŒ…è£¹çš„å¯¹è±¡ï¼Œå¦‚æœè¦æ•´ä½“ä¿®æ”¹ï¼Œå¿…é¡»ç”¨ `Object.assign` ä¿®æ”¹ã€‚ä¾‹å¦‚ä¾‹å­ä¸­çš„: `Object.assign(car, { brand: "Audi", price: 300000 });`
- å¦‚æœé‡åˆ°è§£æ„ï¼Œå¿…é¡»ç”¨`toRefs` åŒ…è£¹æ™®é€šå¯¹è±¡ï¼Œä½¿å…¶å˜ä¸ºå“åº”å¼å¯¹è±¡ï¼Œè¦ä¸é¡µé¢ä¸Šçš„å“åº”å¼æ•°æ®å°±ä¸ä¼šæ›´æ–°ã€‚ä¾‹å¦‚ä¾‹å­ä¸­çš„ï¼š`let { price } = toRefs(car);`

## `computed` è®¡ç®—å±æ€§

`computed` æ˜¯ä¸€ä¸ªè®¡ç®—å±æ€§ï¼Œå®ƒä¾èµ–å…¶ä»–æ•°æ®ï¼Œå½“ä¾èµ–çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè®¡ç®—å±æ€§ä¼šé‡æ–°è®¡ç®—ã€‚è¿™æ˜¯æˆ‘ä»¬åœ¨ Vue2 ä¸­ç»å¸¸ä½¿ç”¨çš„ã€‚

ä½†æ˜¯ Vue3 ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨`computed`è‡ªå¸¦çš„ getter å’Œ setter æ¥å®ç°è®¡ç®—å±æ€§çš„è·å–å’Œä¿®æ”¹ã€‚

```html
<template>
  <div class="person">
    å…¨åï¼š<span>è¿™ä¸ªæ˜¯è®¡ç®—å±æ€§è®¡ç®—å‡ºæ¥çš„å…¨åï¼š{{ fullName }}</span>
    <button @click="changeFullName">ç‚¹å‡»ä¿®æ”¹å§“åä¸ºLi si</button>
  </div>
</template>

<script lang="ts" setup name="Person">
  import { ref, computed } from "vue";

  let firstName = ref("zhang");
  let lastName = ref("san");

  // ä¼ ç»Ÿvue2ï¼Œè®¡ç®—å±æ€§æ˜¯åªè¯»å±æ€§ï¼Œé¡µé¢ä¸Šå¹¶ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼š
  // const fullName = computed(
  //   () =>
  //     `${firstName.value.slice(0, 1).toUpperCase()}${firstName.value.slice(1)} - ${lastName.value}`
  // )

  // vue3çš„fullNameè®¡ç®—å±æ€§ï¼Œå¯è¯»å¯å†™ï¼šç”¨setterï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹
  const fullName = computed({
    get() {
      return `${firstName.value
        .slice(0, 1)
        .toUpperCase()}${firstName.value.slice(1)} - ${lastName.value}`;
    },
    set(val) {
      const [f, l] = val.split("-");
      firstName.value = f;
      lastName.value = l;
    },
  });

  const changeFullName = () => (fullName.value = "li-si");
</script>
```

## `watch` ç›‘è§†

`watch` æ˜¯ä¸€ä¸ªç›‘å¬å™¨ï¼Œå®ƒç›‘å¬æŸä¸ªæ•°æ®ï¼Œå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°ã€‚
`watch` ç›‘å¬çš„æ•°æ®å¯ä»¥æ˜¯ä¸€ä¸ªå“åº”å¼æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ™®é€šæ•°æ®ã€‚

```html
<template>
  <div class="person">
    <h2>å§“åï¼š{{ person.name }}</h2>
    <h2>æ±½è½¦ï¼š{{ person.car.c1 }} {{ person.car.c2 }}</h2>
    <button @click="changeName">æ”¹å</button>
    <button @click="changeCar1">æ”¹ç¬¬ä¸€å°ğŸš—</button>
    <button @click="changeCar2">æ”¹ç¬¬äºŒå°ğŸš—</button>
    <button @click="changeCars">æ”¹æ‰€æœ‰ğŸš—</button>
  </div>
</template>

<script lang="ts" setup>
  import { reactive, watch } from "vue";

  let person = reactive({
    name: "å¼ ä¸‰",
    car: {
      c1: "å¥”é©°",
      c2: "å®é©¬",
    },
  });
  const changeName = () => (person.name += "~");
  const changeCar1 = () => (person.car.c1 = "audi");
  const changeCar2 = () => (person.car.c2 = "Toyota");
  const changeCars = () => (person.car = { c1: "byd", c2: "yy" });

  // reactiveç›‘è§†å±æ€§æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»å†™ä¸ºå‡½æ•°è¿”å›ç±»å‹ï¼Œå¦åˆ™æŠ¥é”™
  watch(
    () => person.name,
    (newValue, oldValue) => {
      console.log("newValue", newValue);
      console.log("oldValue", oldValue);
    }
  );

  // ç›‘è§†çš„reactiveå¯¹è±¡å±æ€§ä¹Ÿæ˜¯objæ—¶
  // å¦‚æœè¦ç›‘è§†é™¤è¯¥
  watch(
    () => person.car,
    (newValue, oldValue) => {
      console.log("newValue", newValue);
      console.log("oldValue", oldValue);
    },
    // åŠ ä¸Šdeepï¼štrueï¼Œå¯ä»¥ç›‘è§†ä»»æ„personå¯¹è±¡é‡Œçš„ç»†å¾®å˜åŒ–
    { deep: true }
  );

  // ç›‘è§†å¤šä¸ªå±æ€§
  watch([() => person.name, () => person.car.c1], (newValue, oldValue) => {
    console.log("newValue", newValue);
    console.log("oldValue", oldValue);
  });
</script>

<style scoped></style>
```

å’Œ `watch` ç­‰ä»·çš„ï¼Œæœ‰å¦ä¸€ä¸ª api `watchEffect`ï¼Œå®ƒæ›´æ™ºèƒ½ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°é‡Œå¯ä»¥å†™å¼‚æ­¥ä»£ç ï¼Œå½“å‡½æ•°æ‰§è¡Œæ—¶ï¼Œä¼šè‡ªåŠ¨æ”¶é›†ä¾èµ–ï¼Œå½“ä¾èµ–çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šé‡æ–°æ‰§è¡Œå‡½æ•°ã€‚

ä¸‹é¢å†™ä¸€ä¸ª demo å®ç°ï¼šä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç›‘æµ‹æ°´æ¸©å’Œæ°´ä½çš„ä¾‹å­ï¼Œå½“æ°´æ¸©è¾¾åˆ°æˆ–è¶…è¿‡ 60â„ƒï¼Œæˆ–è€…æ°´ä½è¾¾åˆ°æˆ–è¶…è¿‡ 80cm æ—¶ï¼Œç»™æœåŠ¡å™¨å‘è¯·æ±‚ã€‚è¿™é‡Œçš„è¯·æ±‚ç”¨äº† console.logï¼Œå®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥å‘é€è¯·æ±‚ã€‚

```html
<template>
  <div>
    <h2>å½“æ°´æ¸©è¾¾åˆ°æˆ–è¶…è¿‡60â„ƒï¼Œæˆ–è€…æ°´ä½è¾¾åˆ°æˆ–è¶…è¿‡80cmæ—¶ï¼Œç»™æœåŠ¡å™¨å‘è¯·æ±‚</h2>
    <h2>æ°´æ¸©ï¼š{{ temp }}</h2>
    <h2>æ°´ä½ï¼š{{ height }}</h2>
    <button @click="changeTemp">æ°´æ¸©+10 â„ƒ</button>
    <button @click="changeHeight">æ°´ä½+10 cm</button>
  </div>
</template>

<script lang="ts" setup>
  import { ref, watch, watchEffect } from "vue";
  let temp = ref(10);
  let height = ref(0);

  const changeTemp = () => {
    temp.value += 10;
  };
  const changeHeight = () => {
    height.value += 10;
  };

  // watchå®ç°ï¼š
  watch([temp, height], (value) => {
    let [newTemp, newHeight] = value;
    if (newTemp >= 60 || newHeight >= 80) {
      console.log("ç»™æœåŠ¡å™¨å‘è¯·æ±‚");
    }
  });

  // watchEffectå®ç°ï¼š
  // wathcEffectå¯ä»¥ä¸ç”¨å†™å‡½æ•°ï¼Œç›´æ¥å†™ä»£ç ï¼Œä¼šè‡ªåŠ¨æ”¶é›†ä¾èµ–ã€‚
  watchEffect(() => {
    if (temp.value >= 60 || height.value >= 80) {
      console.log("ç»™æœåŠ¡å™¨å‘è¯·æ±‚");
    }
  });
</script>
```

## `defineExpose` æš´éœ²å“åº”å¼æ•°æ®

1. `ref` é™¤äº†å®šä¹‰ä¸€ä¸ªå¼•ç”¨ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç»™çœŸå® DOM å…ƒç´ æˆ–ç»„ä»¶å…ƒç´ æ‰“æ ‡è®°ï¼Œç„¶åé€šè¿‡ `ref` è·å–åˆ°è¯¥å…ƒç´ æˆ–è€…ç»„ä»¶å…ƒç´ å®ä¾‹ã€‚
2. å’Œ vue2 ä¸ä¸€æ ·ï¼Œvue3 çš„å¼•ç”¨å€¼ ref å¿…é¡»ç”¨ defineExpose æš´éœ²ç»™çˆ¶ç»„ä»¶ï¼Œçˆ¶ç»„ä»¶æ‰èƒ½è·å–åˆ°ä»–çš„å€¼

```html
<template>
  <div ref="x">hello vue3</div>
  <button @click="showRef">get ref DOM</button>
</template>

<script lang="ts" setup>
  import { ref, defineExpose } from "vue";

  // å’Œvue2ä¸ä¸€æ ·ï¼Œvue3çš„å¼•ç”¨å€¼refå¿…é¡»ç”¨defineExposeæš´éœ²
  let a = ref("1");
  defineExpose({ a });

  // x å¿…é¡»ä¸ä¸Šé¢çš„ ref æ ‡ç­¾åå­—ä¸€è‡´
  let x = ref();
  const showRef = () => {
    console.log(x.value); // <div>hello vue3</div>
  };
</script>
```

ref æ‰“åœ¨ç»„ä»¶æ ‡ç­¾ä¸Šï¼Œèƒ½æ‰“å°å‡ºç»„ä»¶å®ä¾‹

```html
<template>
  <RefDemo ref="aa" />
  <button @click="showRef">showRef</button>
</template>

<script setup lang="ts">
  import RefDemo from "./components/RefDemo.vue";
  import { ref } from "vue";
  let aa = ref();
  const showRef = () => {
    console.log(aa.value); // Proxy(Object)Â {__v_skip: true}
  };
</script>
```

## `props`, `defineProps` å’Œ `withDefaults`

ä¸åºŸè¯ï¼Œç›´æ¥ä¸Š demoï¼Œå’Œ React ä¸åŒçš„æ˜¯ï¼Œå­ç»„ä»¶å¦‚æœè¦æ˜¾ç¤º Propsï¼Œéœ€è¦ç”¨`defineProps`å®šä¹‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

çˆ¶ç»„ä»¶ï¼š

```html
<template>
  <div class="app">
    <PropsDemo a="hehe" :personsList="persons" />
  </div>
</template>

<script setup lang="ts">
  import PropsDemo from "./components/PropsDemo.vue";

  let persons = [
    { id: 1, name: "å¼ ä¸‰", age: 18 },
    { id: 2, name: "æå››", age: 19 },
  ];
</script>
```

å­ç»„ä»¶çš„å†™æ³•å°±æœ‰ç‚¹å¥‡è‘©ï¼Œå¦‚æœå®šä¹‰é»˜è®¤å€¼ï¼Œè¿˜è¦å†å¼•å…¥ä¸€ä¸ª`withDefaults`ï¼Œä»–çš„å®šä¹‰æ˜¯æ¯” vue2 å•°å—¦çš„ã€‚

```html
<template>
  <div>{{ a }}</div>
  <ul>
    <li :key="person.id" v-for="person in personsList">
      {{ person.name }}: {{ person.age }}
    </li>
  </ul>
</template>

<script lang="ts" setup>
  import { defineProps, withDefaults } from "vue";
  import type { Person } from "@/types";

  // å†™æ³•1ï¼šå¦‚æœä¸ç”¨tsçš„æ™®é€šå†™æ³•
  // const props1 = defineProps(['a', 'personsList'])
  // console.log(props1)

  // // å†™æ³•2ï¼šç”¨ä¸ŠtsåŠwithDefaultsï¼Œå½“ç„¶ï¼ŒwithDefaultså¯ä»¥çœç•¥ä¸ç”¨
  const props = withDefaults(
    defineProps<{ a: string; personsList: Person[] }>(),
    {
      a: "xx",
      personsList: () => [{ id: "kk", name: "yy", age: 18 }],
    }
  );

  console.log(props); // Proxy(Object) {a: 'hehe', personsList: Array(2)}
</script>
```

## ç”Ÿå‘½å‘¨æœŸ

`Vue2` çš„ç”Ÿå‘½å‘¨æœŸï¼š
åˆ›å»ºé˜¶æ®µï¼š`beforeCreate` `created`
æŒ‚è½½é˜¶æ®µï¼š`beforeMount` `mounted`
æ›´æ–°é˜¶æ®µï¼š`beforeUpdate` `updated`
é”€æ¯€é˜¶æ®µï¼š`beforeDestroy` `destroyed`

`Vue3` çš„ç”Ÿå‘½å‘¨æœŸï¼š

åˆ›å»ºé˜¶æ®µï¼š`setup`
æŒ‚è½½é˜¶æ®µï¼š`onBeforeMount` `onMounted`
æ›´æ–°é˜¶æ®µï¼š`onBeforeUpdate` `onUpdated`
é”€æ¯é˜¶æ®µï¼š`onBeforeUnmount` `onUnmounted`

ç”±äº Vue3 æˆ‘ä»¬æŠŠ setup é˜¶æ®µå†™åœ¨ script æ ‡ç­¾é‡Œï¼Œæ‰€ä»¥ Vue3 çš„ç”Ÿå‘½å‘¨æœŸæ¯” Vue2 çš„å°‘äº† 2 ä¸ªï¼Œåˆ†åˆ«æ˜¯`beforeCreate`å’Œ`created`ã€‚

```html
<!-- vue2çš„å†™æ³•ï¼š -->
<script>
  export default {
    created() {
      console.log("created");
    },
  };
</script>

<!-- Vue3çš„å†™æ³•ï¼š -->
<script setup lang="ts">
  onMounted(() => {
    console.log("onMounted");
  });
</script>
```

## Custom Hooks æ¨¡å—åŒ–å°è£…

è¿™ä¸ªæ¦‚å¿µå®Œå…¨æ˜¯æŠ„è¢­ React hooksï¼Œç”±äº Vue3 è®¾è®¡æˆäº†`setup` è¯­æ³•ï¼Œæ‰€ä»¥ä½¿å¾—å‡½æ•°å¼ç¼–ç¨‹ç§°ä¸ºå¯èƒ½ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ª demo

```html
<template>
  <div class="person">
    <img v-for="(image, idx) in dogImages" :src="image" :key="idx" alt="dog" />
    <br />
    <button @click="addNewDogImage">æ·»åŠ ç‹—å›¾</button>
  </div>
</template>

<script lang="ts" setup>
  import useDogImages from "@/hooks/useDogImages";
  const { dogImages, addNewDogImage } = useDogImages();
</script>

<style scoped>
  img {
    height: 150px;
    margin-right: 10px;
  }
</style>
```

åœ¨ `useDogImages.ts` æ–‡ä»¶é‡Œï¼Œå¯ä»¥å†™ä¸‹

```ts
import { ref, reactive } from "vue";

// æ·»åŠ ç‹—å›¾
export default (url: string = "https://dog.ceo/api/breeds/image/random") => {
  // https://dog.ceo/api/breeds/image/random
  const defaultDogImage =
    "https://images.dog.ceo/breeds/affenpinscher/n02110627_11811.jpg";
  const dogImages = reactive([defaultDogImage]);

  const addNewDogImage = async () => {
    fetch(url)
      .then((res) => res.json())
      .then((data) => dogImages.push(data.message))
      .catch((err) => alert(err));
  };

  return {
    dogImages,
    addNewDogImage,
  };
};
```

## `Pinia` çŠ¶æ€ç®¡ç†

`pinia` æ˜¯ä¸€ä¸ª**ç¬¦åˆç›´è§‰**çš„çŠ¶æ€ç®¡ç†åº“ï¼Œå’Œ`vuex`ä¸€æ ·ï¼Œéƒ½æ˜¯åŸºäº`vue3`çš„ï¼Œä½†æ˜¯`pinia`æ¯”`vuex`æ›´ç®€å•æ˜“ç”¨ï¼Œè€Œä¸”`vuex`çš„ä½œè€…å·²ç»æ¨èä½¿ç”¨`pinia`äº†ã€‚
`pinia` çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨`main.ts`é‡Œå¼•å…¥`createPinia`ï¼Œç„¶å`app.use(createPinia())`ï¼Œç„¶åå°±å¯ä»¥åœ¨`setup`å‡½æ•°é‡Œä½¿ç”¨`defineStore`å®šä¹‰ä¸€ä¸ªçŠ¶æ€äº†ã€‚

```bash
npm i pinia
```

### `createApp`

`main.ts` å¼•å…¥ï¼š

```ts
import { createApp } from "vue";
import App from "./App.vue";
import { createPinia } from "pinia";

// ä¸‹é¢è¿™ä¸ªé¡ºåºä¸èƒ½ä¹±ï¼Œå¿…é¡»æŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œå…ˆcreatePinia()ï¼Œå†app.use(pinia), å†æŒ‚è½½åˆ°appçš„æ ¹èŠ‚ç‚¹ä¸Š
const app = createApp(App);
const pinia = createPinia();
app.use(pinia);
app.mount("#app");
```

### `defineStore`, `state`, `actions`

åˆ›å»ºä¸€ä¸ª`store/count.ts`ï¼š

```js
import { defineStore } from "pinia";

const useCountStore = defineStore("count", {
  actions: {
    addToMaxTwenty(value: number) {
      if (this.count <= 20) {
        this.count += value;
      }
    },
  },
  state() {
    return {
      count: 0,
      by: "X",
    };
  },
});

export default useCountStore;
```

åœ¨åº”ç”¨ä¸­ä½¿ç”¨ï¼š

```html
<template>
  <div class="talk">
    <div>
      <h1>countï¼š{{ countStore.count }}</h1>
      <h2>countStoreçš„å…¶ä»–æ•°æ®: {{ countStore.by }}</h2>
      <!-- v-model.number å¯ä»¥ç›´æ¥è½¬æ¢ä¸ºæ•°å­—ç±»å‹ -->
      <select v-model.number="n">
        <option value="1" selected>1</option>
        <option value="2">2</option>
        <option value="3">3</option>
      </select>
      <button @click="plus">+</button>
      <button @click="minus">-</button>
    </div>
  </div>
</template>

<script lang="ts" setup>
  import { ref, reactive } from "vue";
  import useCountStore from "@/store/count";
  import useTalkStore from "@/store/talks";

  const countStore = useCountStore();
  const n = ref(1);
  const plus = () => {
    // ç¬¬ä¸€ç§æ”¹æ³•ï¼špiniaç¬¦åˆç›´è§‰çš„çŠ¶æ€ç®¡ç†ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹å…¶å€¼ï¼Œä¾‹å¦‚ï¼š
    // countStore.count += n.value

    // ç¬¬äºŒç§æ”¹æ³•ï¼š$patch
    // countStore.$patch({
    //   count: 1,
    //   by: 'pinia'
    // })

    // ç¬¬ä¸‰ç§æ”¹æ³•ï¼šactionsï¼Œè¿™ç§æ–¹æ³•çš„å¥½å¤„æ˜¯å¯ä»¥åœ¨addToMaxTwentyé‡Œæ·»åŠ å¤æ‚é€»è¾‘
    countStore.addToMaxTwenty(n.value);
  };
  const minus = () => (countStore.count -= n.value);
</script>
```

#### `defineStore` ç¬¬äºŒä¸ªå‚æ•°æ”¹å†™ä¸ºç»„åˆå¼ API

ä¸Šé¢çš„ `talkStore` çš„ä¾‹å­ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å†™çš„æ˜¯é…ç½®å¼çš„ APIï¼ˆOptionAPIï¼‰ï¼Œä½†æ˜¯ `pinia` ä¹Ÿæ”¯æŒç»„åˆå¼ APIï¼Œå¯ä»¥æ”¹ä¸ºï¼š

```ts
import { defineStore } from "pinia";
import { reactive } from "vue";

type Talk = {
  id: number;
  content: string;
};
const useTalkStore = defineStore("talks", () => {
  const talkList = reactive<Talk[]>(
    JSON.parse(localStorage.getItem("talkList") as string) ?? []
  );

  const assertOneNewTalk = async () => {
    try {
      const response = await fetch(
        "https://api.uomg.com/api/rand.qinghua?format=json"
      );
      if (!response.ok) throw new Error("Network response was not ok");
      const { content } = await response.json();
      return talkList.push({ id: talkList.length + 1, content });
    } catch (err) {
      console.error(err);
    }
  };

  return { talkList, assertOneNewTalk };
});

export default useTalkStore;
```

### `storeToRefs`

å¦‚æœæˆ‘ä»¬è¦çœç•¥ä¸Šé¢çš„å†™æ³• `countStore.count`ï¼Œåœ¨ `pinia` ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ `storeToRefs` è§£æ„ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çœç•¥ `countStore.count`ï¼Œç›´æ¥ä½¿ç”¨ `count`ã€‚
è¿™é‡Œæœ€å¥½**ä¸è¦ä½¿ç”¨** `vue` è‡ªå¸¦çš„ **`toRefs`**ï¼Œå› ä¸º `toRefs` ä¼šå°†æ‰€æœ‰å±æ€§éƒ½å˜æˆå“åº”å¼ï¼Œè€Œ `storeToRefs` åªä¼šå°† `state` ä¸­çš„å±æ€§å˜æˆå“åº”å¼ã€‚

`TalkStore` çš„ä¾‹å­ï¼š

```html
<template>
  <div class="talk">
    <button @click="addNewTalk">è·å–ä¸€å¥åœŸå‘³æƒ…è¯</button>
    <ul>
      <li v-for="talk in talkList" :key="talk.id">{{ talk.content }}</li>
    </ul>
  </div>
</template>

<script lang="ts" setup>
  import { ref } from "vue";
  import { storeToRefs } from "pinia";
  import useCountStore from "@/store/count";
  import useTalkStore from "@/store/talks";

  const talkStore = useTalkStore();
  // ä¸èƒ½ç›´æ¥è§£æ„ï¼Œconst { talkList } = talkStoreï¼Œè¿™æ ·è§£æ„å‡ºæ¥çš„ talkList ä¸æ˜¯æ˜¯å“åº”å¼å¯¹è±¡æ•°æ®ï¼Œé¡µé¢ç”¨äº†ä¸ä¼šè§¦å‘æ›´æ–°
  const { talkList } = storeToRefs(talkStore);
  const addNewTalk = () => talkStore.assertOneNewTalk();
</script>
```

`store/talks` æ–‡ä»¶é‡Œï¼Œå¯ä»¥ç›´æ¥è¯·æ±‚æ•°æ®ï¼š

```ts
import { defineStore } from "pinia";

type Talk = {
  id: number;
  content: string;
};
const useTalkStore = defineStore("talks", {
  actions: {
    async assertOneNewTalk() {
      try {
        const response = await fetch(
          "https://api.uomg.com/api/rand.qinghua?format=json"
        );
        if (!response.ok) throw new Error("Network response was not ok");
        const { content } = await response.json();
        return this.talkList.push({ id: this.talkList.length + 1, content });
      } catch (err) {
        console.log(err);
      }
    },
  },
  state() {
    return {
      talkList: [] as Talk[],
    };
  },
});

export default useTalkStore;
```

### `getters` å¤„ç†æ•°æ®

æ¥ç€ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬åœ¨ `defineStore` å‡½æ•°ä¸­åŠ å…¥ï¼š`getters`, å¦‚ï¼š

```ts
import { defineStore } from "pinia";

const useCountStore = defineStore("count", {
  actions: {
    addToMaxTwenty(value: number) {
      if (this.count <= 20) {
        this.count += value;
      }
    },
  },
  state() {
    return {
      count: 0,
      by: "X",
    };
  },
  // ä¸¤ç§å†™æ³•å‡å¯
  getters: {
    doubleCount: (state) => state.count * 2,
    square(): number {
      return this.count ** 2;
    },
  },
});

export default useCountStore;
```

è¿™æ ·å°±å¯ä»¥åœ¨ `template` é‡Œé¢ç›´æ¥ä½¿ç”¨ `doubleCount` å’Œ `square` äº†ã€‚

### `$subscribe` store çš„è®¢é˜…

æ¥ç€ä¸Šé¢`TalkStore`çš„ä¾‹å­ï¼Œæ·»åŠ `$subscribe`ï¼Œç›‘è§†æ•°æ®ï¼Œå¹¶å°†å…¶å­˜åœ¨æµè§ˆå™¨ï¼Œè¿›è¡Œç®€å•çš„æ•°æ®æŒä¹…åŒ–ï¼Œå¦‚ï¼š

```js
talkStore.$subscribe((_, state) => {
  localStorage.setItem("talkList", JSON.stringify(state.talkList));
});
```

å†å°†`state`é‡Œçš„`talkList` æ¢æˆåœ¨ `localStorage` é‡Œå–ï¼šå½“ç„¶ï¼Œå¿…é¡»åˆ¤æ–­ç¬¬ä¸€æ¬¡æ‰“å¼€é¡µé¢æ—¶ï¼Œ`localStorage` é‡Œæ²¡æœ‰æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦å†™ä¸€ä¸‹ç©ºå€¼åˆ¤æ–­ç¬¦ï¼š

```ts
state: () => ({
  talkList: JSON.parse(localStorage.getItem("talkList") as string) ?? [],
});
```

## `vue-router` è·¯ç”±

å®‰è£…

```bash
npm i vue-router
```

### åˆ›å»ºè·¯ç”±

åˆ›å»º `src/router/index.ts`ï¼Œå½“ç„¶ï¼Œå‰æè¿˜å¿…é¡»åˆ›å»ºé¡µé¢çš„ç»„ä»¶å¦‚ `Home.vue` ç­‰ 3 ä¸ªï¼Œè¿™é‡Œä¸è¯¦ç»†ä»‹ç»ã€‚

```ts
import { createRouter, createWebHistory } from "vue-router";
import Home from "@/views/Home.vue";
import News from "@/views/News.vue";
import About from "@/views/About.vue";

const router = createRouter({
  // Provide the history routes to use.
  // æ¶ˆç­urlçš„#å·
  // ä½†history è·¯ç”±å¿…é¡»è¦æœåŠ¡å™¨é…åˆè®¾ç½®
  history: createWebHistory(),
  routes: [
    {
      path: "/",
      name: "Home",
      component: Home,
    },
    {
      path: "/news",
      name: "News",
      component: News,
    },
    {
      path: "/about",
      name: "About",
      component: About,
    },
  ],
});

export default router;
```

history æ¨¡å¼ åœ¨ `Nginx`ä¸Šé…ç½®å¦‚ä¸‹ï¼š

```bash
server {
    listen 80;
    server_name your-domain.com;

    root /path/to/your/webroot;
    index index.html;

    location / {
      # å½“Nginxæ¥æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå®ƒä¼šé¦–å…ˆå°è¯•æŒ‰ç…§è¯·æ±‚çš„URIæä¾›æ–‡ä»¶ï¼ˆ$uriï¼‰ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå®ƒä¼šå°è¯•å°†è¯·æ±‚å®šå‘åˆ°URIå¯¹åº”çš„ç›®å½•ï¼ˆ$uri/ï¼‰ï¼Œå¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œé‚£ä¹ˆæœ€ç»ˆä¼šæä¾›/index.htmlæ–‡ä»¶ã€‚
      try_files $uri $uri/ /index.html;
    }
}
```

åœ¨ `main.ts` ä¸­ï¼Œå¼•å…¥è·¯ç”±ï¼Œå¹¶æŒ‚è½½åˆ° `app` ä¸Šï¼š

```ts
import { createApp } from "vue";
import App from "./App.vue";
import router from "./router";

const app = createApp(App);
app.use(router);
app.mount("#app");
```

### ä½¿ç”¨è·¯ç”±

åœ¨è·¯ç”±é¡µé¢å¯ä»¥æ˜¾ç¤ºï¼š

```html
<template>
  <div class="router-demo">
    <h2 class="title">Vue Router</h2>
    <div class="navigator">
      <RouterLink to="/" active-class="active">é¦–é¡µ</RouterLink>
      <RouterLink :to="{ name: 'News' }" active-class="active">æ–°é—»</RouterLink>
      <RouterLink :to="{ path: '/about' }" active-class="active"
        >å…³äº</RouterLink
      >
    </div>
    <div class="content">
      <RouterView></RouterView>
    </div>
  </div>
</template>

<script lang="ts" setup>
  import { RouterView, RouterLink } from "vue-router";
</script>

<style scoped>
  /* a.active å¯¹åº”ä¸Šé¢çš„ active-classï¼Œ å…¶ä»–æ ·å¼çœç•¥ */
  .navigator a.active {
    background-color: rgb(76, 146, 199);
    font-weight: 900;
    text-shadow: 0 0 1px black;
  }
</style>
```

- `<RouterView></RouterView>` ä¸ºå„ä¸ªè·¯ç”±ç»„ä»¶çš„å ä½ç¬¦ï¼Œ
- `<RouterLink to="/" active-class="active"/>` æ˜¯`<a/>` æ ‡ç­¾çš„äºŒæ¬¡å°è£…
- å±æ€§ `to` æœ‰ 2 ç§å†™æ³•ï¼Œå¯`to="/"`, ä¹Ÿå¯ `:to="{path: '/'}"` æˆ– `:to="{name: 'Home'}"`, è¿™é‡Œçš„ name å¯¹åº”è·¯ç”±æ–‡ä»¶ `router/index.ts` é‡Œå®šä¹‰çš„ `name`
- è·¯ç”±å¯¼èˆªåˆ°çš„é¡µé¢ï¼ŒæŒ‚è½½åˆ°é¡µé¢çš„æ ¹èŠ‚ç‚¹ä¸Šï¼Œåˆ‡æ¢æ—¶åˆ™å¸è½½è¯¥èŠ‚ç‚¹ï¼Œå¯ä»¥ç”¨åœ¨å…·ä½“é¡µé¢é‡Œç”¨ `onMounted` å’Œ `onUnmounted` æ¥ç›‘å¬ï¼ŒéªŒè¯è¿™ç‚¹ã€‚

### å­è·¯ç”±

åœ¨ä¸Šé¢æˆ‘ä»¬åˆ›å»ºçš„ `router/index.ts` æ–‡ä»¶é‡Œï¼Œç”¨ `news` é¡µé¢åˆ›å»ºäºŒçº§è·¯ç”±ï¼Œ åœ¨ `/news`è·¯ç”±ä¸‹ï¼Œæ·»åŠ  `children` æ•°ç»„ï¼Œå¦‚ä¸‹ï¼š

```ts
import NewsDetail from '@/views/NewsDetail.vue'

...
    {
      path: '/news',
      name: 'News',
      component: News,
      children: [
        {
          path: 'newsDetail',
          name: 'NewsDetail',
          component: NewsDetail
        }
      ]
    }
...
```

### è·¯ç”±ä¼ å‚

#### `query` ä¼ å‚

è¿™ç§æ˜¯æ”¾åœ¨ url çš„åé¢ï¼Œå¦‚ï¼š`/news?id=1&title=xxx&content=xxx`ï¼Œæ¯”è¾ƒå•°å—¦ï¼Œä¸å¤ªæ¨èã€‚
æ”¹é€  `views/News.vue` æ–‡ä»¶ï¼Œæ·»åŠ  `RouterLink` ç»„ä»¶ï¼Œå¹¶æ·»åŠ  `query` å‚æ•°ï¼Œå¦‚ä¸‹ï¼š

```html
<template>
  <div class="news">
    <ul>
      <li v-for="news in newsList" :key="news.id">
        <!-- 1. åˆ©ç”¨å­—ç¬¦ä¸²æ¨¡æ¿ï¼Œæ‹¼æ¥queryå‚æ•°ï¼Œå¤ªé•¿ï¼Œæ¯”è¾ƒæ¶å¿ƒ -->
        <!-- <RouterLink
          :to="`/news/newsDetail?id=${news.id}&title=${news.title}&content=${news.content}`"
          >{{ news.title }}</RouterLink
        > -->

        <!-- 2. ä»¥å¯¹è±¡æ‹¼æ¥queryå‚æ•° -->
        <RouterLink
          :to="{
            path: '/news/newsDetail',
            query: {
              id: news.id,
              title: news.title,
              content: news.content
            }
          }"
          >{{ news.title }}
        </RouterLink>
      </li>
    </ul>
    <div class="news-content">
      <RouterView></RouterView>
    </div>
  </div>
</template>

<script lang="ts" setup>
  import { reactive } from "vue";
  import { RouterView, RouterLink } from "vue-router";
  const newsList = reactive([
    { id: 1, title: "1111111", content: "aaaaaa" },
    { id: 2, title: "2222222", content: "bbbbbb" },
    { id: 3, title: "3333333", content: "cccccc" },
  ]);
</script>
```

åœ¨ `views/NewsDetail.vue` æ–‡ä»¶é‡Œï¼Œæ·»åŠ  `props` æ¥æ”¶ä¼ å‚ï¼Œå¦‚ä¸‹ï¼š

```html
<template>
  <div>
    <div>ç¼–å·ï¼š{{ query.id }}</div>
    <div>æ ‡é¢˜ï¼š{{ query.title }}</div>
    <div>å†…å®¹ï¼š{{ query.content }}</div>
  </div>
</template>

<script lang="ts" setup>
  import { toRefs } from "vue";
  import { useRoute } from "vue-router";
  const route = useRoute();
  const { query } = toRefs(route);
</script>
```

#### `params` ä¼ å‚

è¿™ç§ä¼ å‚æ˜¯æ”¾åœ¨ url çš„åé¢ï¼Œå¦‚ï¼š`/news/newsDetail/1`ï¼Œå†™èµ·æ¥æ¯” query ä¼ å‚ç®€æ´äº›

å…ˆæ”¹é€  `router/index.ts` æ–‡ä»¶ï¼Œæ·»åŠ  `params` å‚æ•°ï¼Œå¦‚ä¸‹ï¼š

```ts
    {
      path: '/news',
      name: 'News',
      component: News,
      children: [
        {
          path: 'newsDetail/:id/:title/:content',
          name: 'NewsDetail',
          component: NewsDetail
        }
      ]
    },
```

åœ¨`views/News.vue` æ–‡ä»¶ï¼Œæ”¹é€ å¦‚ä¸‹ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå†™æ³• 2 å¯¹è±¡é‡Œä¸èƒ½ç”¨ `path`,å¿…é¡»å†™è·¯ç”±é‡Œçš„ `name` å‚æ•°

```html
<template>
  <div class="news">
    <ul>
      <li v-for="news in newsList" :key="news.id">
        <!-- parmasä¼ å‚å†™æ³•1 -->
        <!-- <RouterLink :to="`/news/newsDetail/${news.id}/${news.title}/${news.content}`">{{
          news.title
        }}</RouterLink> -->

        <!-- parmasä¼ å‚å†™æ³•2 -->
        <RouterLink
          :to="{
            name: 'NewsDetail',
            params: {
              id: news.id,
              title: news.title,
              content: news.content
            }
          }"
          >{{ news.title }}
        </RouterLink>
      </li>
    </ul>
    <div class="news-content">
      <RouterView></RouterView>
    </div>
  </div>
</template>

<script lang="ts" setup>
  import { reactive } from "vue";
  import { RouterView, RouterLink } from "vue-router";
  const newsList = reactive([
    { id: 1, title: "1111111", content: "aaaaaa" },
    { id: 2, title: "2222222", content: "bbbbbb" },
    { id: 3, title: "3333333", content: "cccccc" },
  ]);
</script>
```

`NewsDetail.vue` æ–‡ä»¶:

```html
<template>
  <div>
    <div>ç¼–å·ï¼š{{ params.id }}</div>
    <div>æ ‡é¢˜ï¼š{{ params.title }}</div>
    <div>å†…å®¹ï¼š{{ params.content }}</div>
  </div>
</template>

<script lang="ts" setup>
  import { toRefs } from "vue";
  import { useRoute } from "vue-router";
  const route = useRoute();
  const { params } = toRefs(route);
</script>
```

### è·¯ç”±`props`å‚æ•°

ä¸Šé¢æåˆ°çš„`params`ä¼ å‚ï¼Œéƒ½å¯ä»¥é€šè¿‡ `props` å‚æ•°æ¥æ¥æ”¶ï¼Œ**æœ€æ¨è**è¿™ç§å†™æ³•ï¼Œæ”¹å†™å¦‚ä¸‹ï¼š

åœ¨ `router/index.ts` æ–‡ä»¶é‡Œï¼Œæ·»åŠ  `props` å‚æ•°ï¼Œå¦‚ä¸‹ï¼š

```ts
    {
      path: '/news',
      name: 'News',
      component: News,
      children: [
        {
          path: 'newsDetail/:id/:title/:content',
          name: 'NewsDetail',
          component: NewsDetail,
          props: true,

          // propså¯ä»¥å†™æˆå›è°ƒå‡½æ•°çš„å†™æ³•ï¼Œä½†æ²¡å¿…è¦
          // props: ({ params: { id, title, content } }) => ({
          //   id
          //   title,
          //   content
          // })
        }
      ]
    }
```

`views/News.vue` æ–‡ä»¶ å’Œä¸Šé¢æåˆ°çš„ä¸€æ ·ï¼Œæ— éœ€æ”¹åŠ¨ï¼Œ`views/NewsDetail.vue` æ”¹é€ å¦‚ä¸‹ï¼š

```html
<template>
  <div>
    <div>ç¼–å·ï¼š{{ id }}</div>
    <div>æ ‡é¢˜ï¼š{{ title }}</div>
    <div>å†…å®¹ï¼š{{ content }}</div>
  </div>
</template>

<script lang="ts" setup>
  defineProps(["id", "title", "content"]);
</script>
```

### `replace`

`replace` æ˜¯ä¸€ä¸ª`<RouterLink>`ç»„ä»¶çš„å±æ€§ï¼ŒåŠ ä¸Šåˆ™è¡¨ç¤ºä¸ç¼“å­˜è¯¥é¡µé¢ï¼Œä¸èƒ½ç‚¹å‡»æµè§ˆå™¨ä¸Šçš„åé€€æŒ‰é’®ï¼Œå¦‚ï¼š

```html
<RouterLink replace to="/" active-class="active">é¦–é¡µ</RouterLink>
```

### `useRouter` ç¼–ç¨‹å¼è·¯ç”±å¯¼èˆª

ä¸Šé¢æˆ‘ä»¬æåˆ°çš„ä¾‹å­éƒ½æ˜¯`<RouterLink>`ç»„ä»¶ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œè¿˜æœ‰ä¸€ç§ç¼–ç¨‹å¼è·¯ç”±å¯¼èˆªï¼Œä½¿ç”¨é¢‘ç‡è¿œå¤§äº`<RouterLink>`ç»„ä»¶ï¼Œä¾‹å¦‚æˆ‘ä»¬ç”¨ä¸Šé¢çš„ä¾‹å­ï¼Œåœ¨é¦–é¡µæœ‰ä¸€ä¸ª buttonï¼Œç‚¹å‡»å¯ä»¥è·³è½¬åˆ° news æ–°é—»é¡µé¢ï¼Œ`views/Home.vue`æ–‡ä»¶å¦‚ä¸‹ï¼š

```html
<template>
  <div>home page</div>
  <button @click="jumpToNews">jump to news page</button>
</template>

<script lang="ts" setup>
  import { useRouter } from "vue-router";
  const navigateTo = useRouter();
  const jumpToNews = () => {
    // ç”¨pushï¼š
    // navigateTo.push('/news')
    // ä¹Ÿå¯è¿™ç§å†™æ³•ï¼š
    navigateTo.push({
      path: "/news",
    });

    // ç”¨replaceï¼šä¸èƒ½åé€€
    // navigateTo.replace('/news')
  };
</script>
```

### `redirect` é‡å®šå‘

è¿™ä¸ªå¤ªç®€å•ï¼Œä¸èµ˜è¿°äº†ï¼Œç›´æ¥ä¸Šä»£ç `router/index.ts`ï¼š

```ts
{
  path: "/",
  redirect: "/home",
}
```

## ç»„ä»¶é—´é€šä¿¡ ICC `inner-component communication`

### çˆ¶å­äº’ä¼ 

#### `definedProps` å’Œå›è°ƒå‡½æ•°

çˆ¶å­ç»„ä»¶é—´é€šä¿¡ï¼Œdemo å¦‚ä¸‹ï¼š

çˆ¶ç»„ä»¶ï¼š

```html
<template>
  <div class="parent">
    <h3>parent</h3>
    <h4>parent's houseï¼š{{ house }}</h4>
    <h4>toy fr childï¼š{{ toy }}</h4>
    <Child :house="house" :sendToyToParent="getToyFromChild" />
  </div>
</template>

<script lang="ts" setup>
  import Child from "./ChildComp.vue";
  import { ref } from "vue";

  const house = ref("ğŸ ");

  // å›è°ƒå‡½æ•°ï¼šåœ¨Childä¸Šå®šä¹‰çš„æ˜¯sendToyToParent
  const toy = ref("");
  const getToyFromChild = (value: string) => {
    console.log(value);
    toy.value = value;
  };
</script>
```

å­ç»„ä»¶ï¼š

```html
<template>
  <div class="app">
    house fr parentï¼š{{ house }}
    <div>my toy: {{ toy }}</div>
    <button @click="sendToyToParent(toy)">send to parent</button>
  </div>
</template>

<script lang="ts" setup>
  import { ref } from "vue";

  const toy = ref("ğŸ»");
  // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯çˆ¶ç»„ä»¶ä¼ è¿‡æ¥çš„æ•°æ®ï¼Œç¬¬äºŒä¸ªæ˜¯çˆ¶ç»„ä»¶ä¼ è¿‡æ¥çš„å‡½æ•°
  defineProps(["house", "sendToyToParent"]);
</script>
```

#### `v-model` åŒç»‘ -> ç»„ä»¶å°è£…

è¯´å®è¯ï¼Œè¿™ä¸ªå±æ€§åœ¨é¡¹ç›®ä¸­æ˜¯ä¸å¸¸ç”¨çš„ç‰¹æ€§ï¼Œé¡¹ç›®ä¸­æˆ‘ä»¬å¤šç”¨ç¬¬ä¸‰æ–¹ç»„ä»¶åº“ï¼Œ

è€Œ vue2 çš„`v-model`å¿…é¡»å†™åœ¨åŸç”Ÿçš„ input æ¡†ä¸Šï¼Œ

ä½† vue3 ä¸­çš„ `v-model`ï¼Œå¯ä»¥**ç›´æ¥å†™åœ¨ç»„ä»¶æ ‡ç­¾ä¸Š**ï¼Œæœ‰äº†è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥ä½¿å…¶æ‹¥æœ‰æ›´å¤šçš„ç”¨æ³•

é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ `v-model` åœ¨ vue2 ä¸­çš„å®ç°åŸç†

```html
<template>
  <div>{{ inputValue }}</div>
  <!-- v-model ç”¨åœ¨HTMLæ ‡ç­¾ä¸Š -->
  <input v-model="inputValue" type="text" />
  <!-- åŸç†ï¼š -->
  <input
    :value="inputValue"
    type="text"
    @input="inputValue = ($event.target as HTMLInputElement).value"
  />
</template>

<script lang="ts" setup>
  import { ref } from "vue";
  const inputValue = ref("hello");
</script>
```

åŸå§‹çš„ `v-model` æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå®é™…ä¸Šï¼Œæ˜¯å°† input æ¡†çš„ `:value` å’Œ `@input`ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªå¤š input çš„ç»„ä»¶ï¼Œå®ç°å’Œ vue2 çš„ v-model ä¸€æ ·çš„æ•ˆæœã€‚

è¢«å°è£…çš„å¤š input ç»„ä»¶ï¼š

```html
<template>
  <input
    type="text"
    :value="uName"
    @input="emit('update:uName', ($event.target as HTMLInputElement).value)"
  />

  <input
    type="password"
    :value="pwd"
    @input="emit('update:pwd', ($event.target as HTMLInputElement).value)"
  />
</template>

<script lang="ts" setup>
  defineProps(["uName", "pwd"]);
  const emit = defineEmits(["update:uName", "update:pwd"]);
</script>

<style scoped>
  /* ç‰¹åˆ«ç‰›å‰çš„æ ·å¼ï¼š */
  input {
    background-color: #26b9b1;
  }
</style>
```

åœ¨é¡µé¢é‡Œä½¿ç”¨ï¼š

```html
<template>
  <h4>{{ userName }}</h4>
  <h4>{{ userPwd }}</h4>
  <Inputs v-model:uName="userName" v-model:pwd="userPwd" />
</template>

<script lang="ts" setup>
  import { ref } from "vue";
  import Inputs from "./FormInputs.vue";

  const userName = ref("hello");
  const userPwd = ref("123456");
</script>
```

é€šè¿‡ä»¥ä¸Šçš„ä¾‹å­ï¼Œå¯ä»¥çœ‹å‡ºä»¥ä¸‹ç‰¹å¾ï¼š

- è¢«å°è£…çš„ç»„ä»¶ä¸­ï¼Œ`:value` å’Œ `@input` äº‹ä»¶ï¼Œå®ç°äº†ä½¿ç”¨ä¸­ `<Inputs v-model:uName="userName" v-model:pwd="userPwd" />` çš„ `v-model` æ•ˆæœã€‚
- `v-model:uName="userName"` å¯ä»¥å–åˆ«å`uName`ï¼Œæˆ‘ä»¬åœ¨å°è£…çš„ç»„ä»¶é‡Œæå–æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶åˆ«å

#### `slot`

ç›¸å½“äº react çš„ `children`ï¼Œè‡ªå®šä¹‰ç»„ä»¶åŒæ ‡ç­¾ä¸­åŒ…çš„é‚£ä¸€å—å†…å®¹

##### åŒ¿åæ’æ§½ï¼šæ•°æ® çˆ¶->å­

çˆ¶ç»„ä»¶ï¼š

```html
<template>
  <div class="parent">
    <h3>parent Comp</h3>
    <div class="content">
      <Category title="çƒ­é—¨æ¸¸æˆåˆ—è¡¨">
        <ul>
          <li v-for="game in ganmes" :key="game.id">{{ game.name }}</li>
        </ul>
      </Category>
    </div>
  </div>
</template>

<script lang="ts" setup>
  import Category from "./CategoryBoard.vue";
  import { reactive } from "vue";

  const ganmes = reactive([
    { id: 1, name: "è‹±é›„è”ç›Ÿ" },
    { id: 2, name: "ç‹è€…è£è€€" },
    { id: 3, name: "ç»åœ°æ±‚ç”Ÿ" },
    { id: 4, name: "åŸç¥" },
  ]);
</script>
```

å­ç»„ä»¶ï¼šç›¸å½“äºç”¨ slot è¿›è¡Œå ä½ html çš„å†…å®¹ï¼š

```html
<template>
  <div class="category">
    <h2>{{ title }}</h2>
    <!-- slot ç›¸å½“äºreact çš„ children -->
    <slot>é»˜è®¤å†…å®¹</slot>
  </div>
</template>

<script lang="ts" setup>
  defineProps(["title"]);
</script>
```

##### å…·åæ’æ§½ï¼šæ•°æ® çˆ¶->å­

çˆ¶ç»„ä»¶ï¼šå…¶ä¸­ #s1 #s2 æ˜¯æ’æ§½çš„åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œ#s1 å·æ˜¯`v-slot:s1`çš„ç¼©å†™

```html
<template>
  <div class="parent">
    <h3>parent Comp</h3>
    <div class="content">
      <Category title="çƒ­é—¨æ¸¸æˆåˆ—è¡¨">
        <template #s1>
          <h2>çƒ­é—¨æ¸¸æˆåˆ—è¡¨</h2>
        </template>
        <template #s2>
          <div class="games">
            <div v-for="game in ganmes" :key="game.id">{{ game.name }}</div>
          </div>
        </template>
      </Category>
    </div>
  </div>
</template>

<script lang="ts" setup>
  import Category from "./CategoryBoard.vue";
  import { reactive } from "vue";

  const ganmes = reactive([
    { id: 1, name: "è‹±é›„è”ç›Ÿ" },
    { id: 2, name: "ç‹è€…è£è€€" },
    { id: 3, name: "ç»åœ°æ±‚ç”Ÿ" },
    { id: 4, name: "åŸç¥" },
  ]);
</script>
```

å­ç»„ä»¶ï¼šå¯ä»¥çœ‹åˆ°ï¼Œslot åˆ†ä¸º s1 å’Œ s2ï¼Œåˆ†åˆ«å¯¹åº”å­ç»„ä»¶ä¸­çš„ä¸Šä¸‹çš„ä¸¤ä¸ªæ’æ§½

```html
<template>
  <div class="category">
    <slot name="s1">é»˜è®¤å†…å®¹1</slot>
    <slot name="s2">é»˜è®¤å†…å®¹2</slot>
  </div>
</template>
```

##### ä½œç”¨åŸŸæ’æ§½ï¼šæ•°æ® å­->çˆ¶

ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªæ˜¯è¦è§£å†³æ•°æ®æ”¾åœ¨å­ç»„ä»¶å¤„ï¼Œå°†å­ç»„ä»¶æ•°æ®ä¼ é€’ç»™çˆ¶ç»„ä»¶è€Œè®¾è®¡çš„æ’æ§½ã€‚

çˆ¶ç»„ä»¶ï¼š

```html
<template>
  <div class="game">
    <ScopedSlotChild>
      <template v-slot:game-slot="params">
        <ol>
          <li v-for="game in params.games" :key="game.id">{{ game.name }}</li>
        </ol>
      </template>
    </ScopedSlotChild>
  </div>
</template>

<script lang="ts" setup>
  import ScopedSlotChild from "./ScopedSlotChild.vue";
</script>
```

å­ç»„ä»¶ï¼š

```html
<template>
  <div class="game">
    <h2>æ¸¸æˆåˆ—è¡¨</h2>
    <slot name="game-slot" :games="games"></slot>
  </div>
</template>

<script lang="ts" setup>
  import { reactive } from "vue";

  const games = reactive([
    { id: 1, name: "Dota 2" },
    { id: 2, name: "Counter-Strike: Global Offensive" },
    { id: 3, name: "League of Legends" },
  ]);
</script>
```

ä»¥ä¸Šæœ‰å‡ ä¸ªæ³¨æ„çš„ç‚¹ï¼š

- slot çš„ name å±æ€§ `name="game-slot"`ï¼Œå¯ä»¥çœç•¥ï¼Œå½“ slot æ²¡æœ‰ name å±æ€§ï¼Œé‚£çˆ¶ç»„ä»¶ä¹Ÿä¸ç”¨èµ·åˆ«å
- slot çš„ name å±æ€§å¦‚æœå‡ºç°ï¼Œé‚£ä¹ˆåœ¨çˆ¶ç»„ä»¶çš„åˆ«åï¼Œä¾‹å¦‚ï¼š`v-slot:game-slot="params"` çš„`:game` å¿…é¡»å’Œ slot çš„ name å±æ€§ä¸€è‡´
- å½“ slot çš„ name å±æ€§å€¼ä¸º default æ—¶ï¼Œçˆ¶ç»„ä»¶çš„åˆ«åä¹Ÿå¯ä»¥çœç•¥

#### `emit` äº‹ä»¶

è¿™ç§æ–¹æ¡ˆå…¶å®æˆ‘æ¯”è¾ƒåæ„Ÿï¼Œå› ä¸ºä¸Šé¢çš„å›è°ƒå‡½æ•°å®Œå…¨å¯ä»¥å–ä»£ä»–ï¼Œä½†æ—¢ç„¶æ¡†æ¶æä¾›äº†ï¼Œé‚£ä¹Ÿå¾—ä»‹ç»ä¸€ä¸‹

æ¥ç€ä¸Šé¢çš„ä¾‹å­ï¼Œç®€å•æ¥è¯´å°±æ˜¯åœ¨å­ç»„ä»¶ä¸­

- å°†ç‚¹å‡»äº‹ä»¶åŠ ä¸Š `emit` api
- æ ¹æ® vue2 çš„æ–‡æ¡£ï¼Œå°†å‘½åç”±ä¸Šé¢çš„é©¼å³°æ³•ï¼Œæ”¹ä¸º `kebab-case` å‘½åæ³•åˆ™ï¼Œå³ç”¨ `-` è¿æ¥

```html
<button @click="emit('send-toy-to-parent', toy)">send to parent</button>

<script>
  // ...

  const emit = defineEmits(["send-toy-to-parent"]);
</script>
```

çˆ¶ç»„ä»¶ä¸­ï¼Œæ¥æ”¶å­ç»„ä»¶çš„ç‚¹å‡»äº‹ä»¶ï¼Œå¹¶åšç›¸åº”å¤„ç†

- å°†åŸæ¥çš„ `:click` æ”¹ä¸º vue2 çš„å†™æ³•ï¼š `@send-toy-to-parent`ï¼Œå¦‚ä¸‹ï¼š

```html
<Child :house="house" @send-toy-to-parent="getToyFromChild" />
```

#### `$ref` -> çˆ¶å­ï¼Œ `$parent` -> å­çˆ¶

å…ˆä¸Šä»£ç ï¼Œçˆ¶ç»„ä»¶ï¼š

```html
<template>
  <div class="parent">
    <h3>parent comp</h3>
    <h4>house: {{ house }}</h4>
    <button @click="getAllChildrenBooks($refs)">+ Children 3 books</button>
    <Child1Comp ref="child1" />
    <Child2Comp ref="child2" />
  </div>
</template>

<script lang="ts" setup>
  import { ref } from "vue";
  import Child1Comp from "./Child1Comp.vue";
  import Child2Comp from "./Child2Comp.vue";

  const house = ref(4);

  const getAllChildrenBooks = (refs: { [x: string]: any }) => {
    for (let key in refs) {
      refs[key].books += 3;
    }
  };

  defineExpose({ house });
</script>
```

å­ç»„ä»¶ï¼š

```html
<template>
  <div class="child">
    <h3>Child 1 Comp</h3>
    <h4>books: {{ books }}</h4>
    <button @click="minusHouse($parent)">take one house</button>
  </div>
</template>

<script lang="ts" setup>
  import { ref } from "vue";

  const books = ref(3);
  defineExpose({ books });

  const minusHouse = (parent: any) => {
    if (parent.house <= 0) return;
    parent.house--;
  };
</script>
```

- å¯ä»¥çœ‹å‡ºè¿™ä¸ªå±æ€§å¾—é…åˆ `defineExpose()` ä½¿ç”¨ï¼Œä¸”å¿…é¡»æ˜¯çˆ¶å­ç»„ä»¶
- åœ¨å„è‡ªç»„ä»¶é‡Œï¼Œé€šè¿‡å›è°ƒå‡½æ•° `$parent` è·å–çˆ¶ç»„ä»¶ï¼Œé€šè¿‡ `$refs` è·å–å­ç»„ä»¶
- è¿™ç§å†™æ³•ï¼Œå…è®¸åœ¨çˆ¶ç»„ä»¶è·å–å¤šä¸ªå­ç»„ä»¶çš„å˜é‡å€¼æ•°æ®

### éš”ä»£\è·¨ä»£ä¼ å€¼

#### `$attr`

`ParentComp.vue`

```html
<template>
  <div class="parent">
    <h1>Parent Comp</h1>
    <h2>a: {{ a }}</h2>
    <h2>b: {{ b }}</h2>
    <ChildComp :a="a" :b="b" v-bind="{ x: 100 }" :updateA="updateA" />
  </div>
</template>

<script lang="ts" setup>
  import ChildComp from "./ChildComp.vue";
  import { ref } from "vue";

  const a = ref(1);
  const b = ref(2);

  const updateA = (val: number) => {
    a.value += val;
  };
</script>
```

`ChildComp.vue`ä¸­é—´çš„ç»„ä»¶ï¼Œä»…å†™ä¸€ä¸ªå±æ€§å°±å¤Ÿäº† `v-bind="$attrs"`

```html
<template>
  <div class="child">
    <h1>Child Comp</h1>
    <GrandChildComp v-bind="$attrs" />
  </div>
</template>

<script lang="ts" setup>
  import GrandChildComp from "./GrandChildComp.vue";
</script>
```

`GrandChildComp.vue`æœ€åº•å±‚çš„ç»„ä»¶ç›´æ¥æ¥æ”¶

```html
<template>
  <div class="grandChild">
    <h1>Grand Child Comp</h1>
    <h2>props from Parent:</h2>
    <h3>{{ a }}</h3>
    <h3>{{ b }}</h3>
    <h3>{{ x }}</h3>
    <button @click="updateA(3)">cb to parent updateA</button>
  </div>
</template>

<script lang="ts" setup>
  defineProps(["a", "b", "x", "updateA"]);
</script>
```

ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œä¸­é—´çš„å±‚çº§å¦‚æœåªå†™ `v-bind="$attrs"` å°±å¯ä»¥æ— é™å±‚çº§çš„ä¼ å‚ï¼Œè€Œä»æœ€åº•å±‚çš„å­ç»„ä»¶å¼€å§‹ï¼Œå¦‚æœè¦å›ä¼ åˆ°æœ€é¡¶å±‚ï¼Œä¹Ÿåªéœ€å†™å›è°ƒå‡½æ•°å³å¯

![å¤šå±‚çº§ä¼ å‚](https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@1.55/articles/Vue3å­¦ä¹ /vueå¼•å…¥é”™è¯¯.png)

#### `provide` + `inject`

è¿™ä¸ªæ¯”èµ·ä¸Šä¸€ä¸ªæ›´ç®€å•ï¼Œä¸Šä¸€ä¸ªä¸­é—´ç»„ä»¶è¿˜éœ€è¦å†™ä¸€ä¸ª `v-bind="$attrs"`å±æ€§ï¼Œè€Œè¿™ç§æ–¹æ³•ä¸­é—´ç»„ä»¶ä¸ç”¨æ·»åŠ ä»»ä½•å±æ€§

ç¥–å…ˆç»„ä»¶ç”¨ provide æ³¨å…¥æ•°æ®ï¼Œåä»£ç»„ä»¶ç”¨ inject è·å–æ•°æ®

ç¥–å…ˆç»„ä»¶ï¼š

```html
<template>
  <div class="parent">
    <h1>Parent Comp</h1>
    <h2>house: {{ house }} ä¸‡å…ƒ</h2>
    <h2>car: {{ car.price }} ä¸‡å…ƒ</h2>
    <ChildComp />
  </div>
</template>

<script lang="ts" setup>
  import ChildComp from "./ChildComp.vue";
  import { ref, reactive, provide } from "vue";

  const house = ref(800);
  const car = reactive({
    brand: "Benz",
    price: 80,
  });

  const updateHousePrice = (value: number) => {
    house.value -= value;
  };

  provide("houseContext", { house, updateHousePrice });
  provide("car", car);
</script>
```

æœ€åº•å±‚çš„å­™å­ç»„ä»¶ï¼š

```html
<template>
  <div class="grandgrandChild">
    <h1>Grand Grand Child Comp</h1>
    <h2>house & car from parent:</h2>
    <h3>house: {{ house }} ä¸‡å…ƒ</h3>
    <h3>car: ä¸€è¾†{{ y.brand }}è½¦ï¼Œä»·å€¼{{ y.price }} ä¸‡å…ƒ</h3>
    <button @click="updateHousePrice(1)">ä¿®æ”¹houseä»·å€¼</button>
  </div>
</template>

<script lang="ts" setup>
  import { inject } from "vue";

  // ç›´æ¥è§£æ„å‡ºå›è°ƒå‡½æ•°updateHousePrice
  const { house, updateHousePrice } = inject("houseContext", {
    house: 0,
    updateHousePrice: (num: number) => {},
  });
  const y = inject("car", { brand: "BMW", price: 60 });
</script>
```

ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼š

- `provide` çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å®šä¹‰æ‰€ä¼ çš„å€¼çš„åå­—ï¼Œç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯å•ä¸€å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤æ‚çš„å¯¹è±¡
- `inject` çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å®šä¹‰æ‰€ä¼ çš„å€¼çš„åå­—ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯é»˜è®¤å€¼ï¼Œå¦‚æœä¼ å€¼å¤±è´¥ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼
- `provide` å’Œ `inject` æ˜¯ vue3 çš„æ–°ç‰¹æ€§ï¼Œåœ¨ vue2 ä¸­ï¼Œå¯ä»¥é€šè¿‡ `$parent` å’Œ `$children` æ¥å®ç°

### ä»»æ„ç»„ä»¶äº’ä¼ 

#### `mitt`

è¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹å‹ç¼©ååªæœ‰å‡ ç™¾å­—èŠ‚çš„åº“ [`mitt`](https://www.npmjs.com/package/mitt)ï¼Œnode ç¯å¢ƒä¸‹å‡å¯ç”¨ï¼Œä¸ä»…ä»…å±€é™äº vue

```bash
npm install mitt
```

åˆ›å»º `utils/emitter.ts` æ–‡ä»¶

```ts
import mitt, { type Emitter } from "mitt";

type Events = {
  [key: string]: string;
};
const emitter: Emitter<Events> = mitt();

export default emitter;
```

ç»„ä»¶ 1

```html
<template>
  <div class="comp1">
    <h2>ç»„ä»¶1</h2>
    <h3>æˆ‘çš„ç©å…·ï¼š{{ toyCar }}</h3>
    <button @click="emitter.emit('send-to-comp2', toyCar)">å‘é€ç»™ç»„ä»¶2</button>
  </div>
</template>

<script lang="ts" setup>
  import { ref } from "vue";
  import emitter from "@/utils/emitter";

  const toyCar = ref("ğŸš™");
</script>
```

ç»„ä»¶ 2

```html
<template>
  <div class="comp2">
    <div>my toy: {{ toyCarFrComp1 }}</div>
  </div>
</template>

<script lang="ts" setup>
  import { ref, onUnmounted } from "vue";
  import emitter from "@/utils/emitter";

  const toyCarFrComp1 = ref("");
  emitter.on("send-to-comp2", (value: string) => {
    toyCarFrComp1.value = value;
  });

  onUnmounted(() => {
    emitter.off("send-to-comp2");
  });
</script>
```

- å‘é€æ•°æ®æ–¹ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ `emitter` é‡Œè°ƒç”¨äº† `.emit()` æ–¹æ³•ï¼Œ`.emit()` æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº‹ä»¶åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯äº‹ä»¶æºå¸¦çš„æ•°æ®ã€‚
- æ¥å—æ•°æ®æ–¹ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ `emitter` é‡Œè°ƒç”¨äº† `.on()` æ–¹æ³•ï¼Œ`.on()` æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº‹ä»¶åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯äº‹ä»¶ç›‘å¬å‡½æ•°ã€‚èµ‹å€¼ç»™é¡µé¢å¯¹åº”çš„å˜é‡å
- `onUnmounted` çš„ä½œç”¨æ˜¯åœ¨ç»„ä»¶å¸è½½æ—¶ï¼Œä¹Ÿå¸è½½æ‰ç›‘å¬äº‹ä»¶ï¼Œé¿å…å†…å­˜ç•™å­˜

#### `Pinia`

è¿™ç§åœ¨ä¸Šé¢å•ç‹¬æ‹å‡ºæ¥çš„è®²äº†ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œç›´æ¥çœ‹ä¸Šé¢çš„ä¾‹å­
