---
title: koa洋葱模型及中间件原理简单实现
date: 2021-10-25 14:03:39
tags:
  - node
  - koa
  - 中间件
  - middleware
---

本篇简单的实现一遍koa的洋葱模型式的中间件原理。

<!-- more -->

## 中间件本质上是函数

在使用koa的时候，会了解过他们的中间件原理。下面我用自己简单的思路来描述一下中间件的基础实现，如下：

```js
function fn1() {
  console.log(1)
  fn2();
  console.log(1)
}
function fn2() {
  console.log(2)
  fn3();
  console.log(2)
}

function fn3() {
  console.log(3)
  return;
}
fn1();
```

我们会发现，执行结果如下：

```bash
1
2
3
2
1
```