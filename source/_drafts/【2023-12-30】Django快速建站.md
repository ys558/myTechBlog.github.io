---
title: Django快速建站体验
date: 2023-12-30 10:00:00
tags:
  - python
  - Django
---

最近工作上的需要，要维护一个内部的小网站，该站用Django做的，我很久没碰Django相关的东西了，这里复习一遍

<!-- more -->

# 安装

安装完 `python3` 后，需要安装python管理虚拟环境的工具 `pipenv`, 用 `pip3` 安装
```bash
pip3 install pipenv
```

# 初始化项目

先创建项目文件夹，注意，这里的项目文件夹不能用 `-` ，我用了驼峰法命名项目
```bash
mkdir djangoLearn
cd djangoLearn
```

安装 `Django`, 注意，用 `pipenv` 安装，这样我们的 `Django` 就直接安装在项目的虚拟环境里：

```bash
pipenv install django
```

安装完后显示：
```bash
(base) ➜  djangoLearn pipenv install django
Creating a virtualenv for this project...
Pipfile: /Users/ziyouzhiyi/Documents/code/djangoLearn/Pipfile
Using default python from /Users/ziyouzhiyi/anaconda3/bin/python (3.10.9) to create virtualenv...
⠼ Creating virtual environment...created virtual environment CPython3.10.9.final.0-64 in 258ms
  creator CPython3Posix(dest=/Users/ziyouzhiyi/.local/share/virtualenvs/djangoLearn-IXKtXON4, clear=False, no_vcs_ignore=False, global=False)
  seeder FromAppData(download=False, pip=bundle, setuptools=bundle, wheel=bundle, via=copy, app_data_dir=/Users/ziyouzhiyi/Library/Application Support/virtualenv)
    added seed packages: pip==23.3.1, setuptools==69.0.2, wheel==0.42.0
  activators BashActivator,CShellActivator,FishActivator,NushellActivator,PowerShellActivator,PythonActivator

✔ Successfully created virtual environment!
Virtualenv location: /Users/ziyouzhiyi/.local/share/virtualenvs/djangoLearn-IXKtXON4
Creating a Pipfile for this project...
Installing django...
Resolving django...
Added django to Pipfile's [packages] ...
✔ Installation Succeeded
Pipfile.lock not found, creating...
Locking [packages] dependencies...
Building requirements...
Resolving dependencies...
✔ Success!
Locking [dev-packages] dependencies...
Updated Pipfile.lock (7e6dca07b964c2888324e576ba6c1bc240d74a27b75619fc88bca2ee3979baf8)!
Installing dependencies from Pipfile.lock (79baf8)...
To activate this project's virtualenv, run pipenv shell.
Alternatively, run a command inside the virtualenv with pipenv run.
```

我们可以看到 `/Users/ziyouzhiyi/.local/share/virtualenvs/djangoLearn-IXKtXON4` 路径，里面有 `bin` 目录，放置了很多执行文件，包括你安装的 python3, django-admin文件等等。

在项目里创建的 django 虚拟环境，只在项目里生效。而我们项目里也多了2个文件，`Pipfile` 和 `Pipfile.lock`，多么熟悉的味道，将其应用到前端服务里，他们就相当于 `package.json` 和 `package-lock.json`。


接着，我们运行项目里的虚拟环境：

```bash
pipenv shell
```

会看到，命令行前，多了个 `(djangoLearn)`，这个代表我们成功运行了名为 (djangoLearn) 的虚拟环境
```bash
(base) ➜  djangoLearn pipenv shell
Launching subshell in virtual environment...
 . /Users/ziyouzhiyi/.local/share/virtualenvs/djangoLearn-IXKtXON4/bin/activate
(base) ➜  djangoLearn  . /Users/ziyouzhiyi/.local/share/virtualenvs/djangoLearn-IXKtXON4/bin/activate
(djangoLearn) (base) ➜  djangoLearn 
```

## 几个Django常用的管理命令

## `django-admin startproject`
我们把项目跑起来，用 `django-admin` 可以查看 Django 自带的所有管理命令：

```bash
(djangoLearn) (base) ➜  djangoLearn django-admin

Type 'django-admin help <subcommand>' for help on a specific subcommand.

Available subcommands:

[django]
    check
    compilemessages
    createcachetable
    dbshell
    diffsettings
    dumpdata
    flush
    inspectdb
    loaddata
    makemessages
    makemigrations
    migrate
    optimizemigration
    runserver
    sendtestemail
    shell
    showmigrations
    sqlflush
    sqlmigrate
    sqlsequencereset
    squashmigrations
    startapp
    startproject
    test
    testserver
Note that only Django core commands are listed as settings are not properly configured (error: Requested setting INSTALLED_APPS, but settings are not configured. You must either define the environment variable DJANGO_SETTINGS_MODULE or call settings.configure() before accessing settings.).
```

一般我们用 `django-admin startproject <projectName>` 命令来跑起一个项目，但现在由于我们在项目文件夹里，所以直接用`.` 代表当前文件夹创建项目，`django-admin startproject djangoLearn .`

## `django-admin runserver` 和 `python manage.py runserver <port>`

初始完项目后，在项目根目录，我们可以看到一个名为 `manage.py` 的文件，这个文件相当于 `django-admin` 命令，我们在项目下直接跑 `python manage.py`，看到显示的命令和我们用 `django-admin` 大部分几乎一样。

如果我们直接用 `django-admin runserver` 跑起服务，我们会发现报错：

```bash
django.core.exceptions.ImproperlyConfigured: Requested setting DEBUG, but settings are not configured. You must either define the environment variable DJANGO_SETTINGS_MODULE or call settings.configure() before accessing settings.
```

这段话的意思是要配置 DEBUG 模式才能跑起服务。我们不妨先用 `python manage.py runserver 9000` 先跑起服务。(最后的端口号如果不写，则默认为8000)

## 配置vscode python运行环境

跑 `pipenv --venv` 会显示虚拟环境的路径，复制以下路径，并在末尾拼接上`/bin/python`路径
```bash
(base) ➜  djangoLearn pipenv --venv
/Users/ziyouzhiyi/.local/share/virtualenvs/djangoLearn-IXKtXON4
```

在vscode中设置python环境，在vscode下运行：
- ctrl+p(windows)、cmd+p（mac）
- 输入 `> python` 找到 python解释器，如下图操作：

![选择](https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@0.44/articles/django自学/vscode配置python解释器.jpeg)

![输入解释器路径](https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@0.44/articles/django自学/vscode配置python解释器2.jpeg)

![粘贴解释器路径](https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@0.44/articles/django自学/vscode配置python解释器3.jpeg)

至此，我们可以在vscode自带的终端里看到已经应用上了对应的虚拟环境：

```bash
(djangoLearn-IXKtXON4) (base) ➜  djangoLearn
```

# 启用自己的app服务

Django 把服务中的各个模块称作App，开始自己功能的编写，需要先起一个app

```bash
python manage.py startapp playground
```

并在 `settings.py` 里注册app：

```python
INSTALLED_APPS = [
    "django.contrib.admin", # 管理模块，即其自带的管理界面
    "django.contrib.auth", # 
    "django.contrib.contenttypes",
    # "django.contrib.sessions", # sessions模块，现在sessions已经不用了
    "django.contrib.messages",
    "django.contrib.staticfiles", # 静态App 管理图片等静态文件
		"playground"
]
```

我们可以看到 `playground` 项目结构长这样：

`__init.py__`  defines this directory as a package

`admin.py` 可导入自己编写的模块进行管理，

`apps.py` 配置该app的设置

`models.py` models层，处理数据，从数据库增删改查

`test.py` 单元测试

`view.py` 视图层，前端页面展示

## 视图层 view.py 及Http请求

playground app 用上http模块, view.py修改如下：

```python
from django.shortcuts import render
from django.http import HttpResponse

def sayHello(request): 
    return HttpResponse('Hello world!') 
```

创建一个文件 `playground/urls.py` 用于解析playground app的路由

```python
from django.urls import path
from . import views

# url conf
urlpatterns = [
  path('hello/', views.sayHello)
]
```

在 `storefront/urls.py` 里添加 `path('playground/', include('playground.urls'))` 

```python
from django.contrib import admin
from django.urls import include, path

urlpatterns = [
    path("admin/", admin.site.urls),
    path('playground/', include('playground.urls'))
]
```

浏览器里输入 `http://127.0.0.1:8000/playground/hello/` 可以见到页面显示 `Hello world!` 。