[{"title":"è‡ªå­¦ Kubernetes (1) -- æ¦‚å¿µå’Œæ¶æ„","path":"/2024/05/24/ã€2024-05-24ã€‘è‡ªå­¦ Kubernetes é…ç½® (1) -- æ¦‚å¿µ/","content":"Kubernetes æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç¼–æ’å¹³å°ï¼Œå¯ä»¥è½»æ¾éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ç¨‹åºã€‚è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘è‡ªå­¦ Kubernetes çš„è¿‡ç¨‹ï¼Œæˆ‘å°†è¿‡ç¨‹è®°å½•ä¸‹æ¥ã€‚ åŸºç¡€æ¦‚å¿µå¼„æ¸…æ¥š Kubernetes æœåŠ¡ï¼Œè¦å…ˆå¼„æ¸…ä»¥ä¸‹å‡ ä¸ª Kubernates çš„åŸºç¡€æ¦‚å¿µ Node ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰æ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºæˆ–è€…ç‰©ç†æœº Pod Pod æ˜¯ Kubernetes æœ€å°çš„è°ƒåº¦å•å…ƒï¼Œä¸€ä¸ª Pod å¯ä»¥æ˜¯ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ï¼ˆcontainerï¼‰çš„ç»„åˆï¼Œä»–åˆ›å»ºäº†ä¸€ä¸ªå®¹å™¨çš„è¿è¡Œç¯å¢ƒï¼Œåœ¨è¿™ä¸ªå®¹å™¨ä¸­ï¼Œå®¹å™¨å¯ä»¥å…±äº«ä¸€äº›èµ„æºï¼Œæ¯”å¦‚ç½‘ç»œï¼Œå­˜å‚¨ä»¥åŠä¸€äº›è¿è¡Œæ—¶çš„é…ç½®ç­‰ç­‰ã€‚ æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºæˆ–ä¸€ä¸ªæ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶åˆ†åˆ«æ”¾åœ¨ä¸¤ä¸ªä¸åŒçš„ pod ä¸­ã€‚ä¸€ä¸ª Pod è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œè¿™æ˜¯ä¸€ç§æœ€ä½³å®è·µã€‚ å½“ç„¶ï¼Œä¸€äº›ç‰¹æ®Šæƒ…å†µï¼Œä¸€ä¸ª Pod ä¹Ÿå¯è¿è¡Œå¤šä¸ªå®¹å™¨ï¼Œè¿™ç§æƒ…å†µä¹Ÿä»…é™äºè¿™äº›å®¹å™¨æ˜¯é«˜åº¦è€¦åˆçš„æƒ…å†µï¼Œå³æˆ‘ä»¬æ‰€è¯´çš„è¾¹è½¦æ¨¡å¼ ï¼ˆSidecarï¼‰ï¼Œå¦‚ä¸‹å›¾ï¼š Service æ¯ä¸ª pod éƒ½ä¼šæœ‰ä¸€ä¸ªé›†ç¾¤å†…éƒ¨çš„ IP åœ°å€ï¼Œå¤–éƒ¨ä¸å¯ä»¥è®¿é—®åˆ°ã€‚pod å¹¶ä¸æ˜¯ä¸€ä¸ªç¨³å®šçš„å®ä¾‹ï¼Œååˆ†å®¹æ˜“è¢«åˆ›å»ºæˆ–é”€æ¯ï¼Œå½“ pod å‘ç”Ÿæ•…éšœæ—¶ï¼Œä¼šè¢«é”€æ¯ï¼ŒIP åœ°å€å°±ä¼šå˜æ›´ã€‚è¿™æ—¶å€™å°±éœ€è¦ Kubernetes çš„ Service æ¥ç®¡ç†å’Œåˆ›å»º IP åœ°å€çš„å˜æ›´ï¼Œå¦‚ä¸‹å›¾ï¼š service ä¸Šå›¾çš„ service è¿æ¥æ•°æ®åº“çš„ pod å’Œ App çš„ podï¼Œå½“ App è®¿é—® Service æ—¶ï¼ŒService ä¼šåˆ†é…å¯¹åº”çš„æ•°æ®åº“ IP ç»™ App è¿›è¡Œè®¿é—®ï¼Œå¦‚ä¸‹å›¾ï¼š Ingress å½“æˆ‘ä»¬æœåŠ¡åœ¨æœ¬åœ°å¼€å‘æ—¶ï¼Œå¯ä»¥ç”¨ IP å’Œç«¯å£å·è®¿é—®èŠ‚ç‚¹ï¼Œè€Œå½“éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œåˆ™å¿…é¡»é…ç½®åŸŸåï¼Œé€šè¿‡åŸŸåæ¥è®¿é—® è€Œ Ingress å°±æ˜¯ç”¨æ¥ç®¡ç†ä»é›†ç¾¤å¤–éƒ¨è®¿é—®é›†ç¾¤å†…éƒ¨æœåŠ¡çš„å…¥å£å’Œæ–¹å¼çš„ã€‚å¯ä»¥æ ¹æ® Ingress è§„å®šä¸åŒçš„è½¬å‘è§„åˆ™ï¼Œè®¿é—®é›†ç¾¤å†…éƒ¨ä¸åŒçš„ Service é™¤æ­¤ä¹‹å¤–ï¼ŒIngress è¿˜å¯ä»¥é…ç½® SSL è¯ä¹¦ã€è´Ÿè½½å‡è¡¡ç­‰ç­‰ ConfigMap é…ç½®å®Œä¸Šè¿°æè¿°çš„é…ç½®åï¼Œæˆ‘ä»¬å°±å¯ä»¥æä¾›å¯¹å¤–æœåŠ¡äº† ä½†è¿˜å¿½ç•¥ä¸€ä¸ªé—®é¢˜ï¼Œä¾‹å¦‚åº”ç”¨ç¨‹åºçš„ pod è®¿é—®æ•°æ®åº“ pod æ—¶ï¼Œå¼€å‘ä¸­æˆ‘ä»¬ä¼šæŠŠæ•°æ®åº“çš„åœ°å€ã€ç«¯å£ç­‰è¿æ¥ä¿¡æ¯å†™åˆ°é…ç½®æ–‡ä»¶æˆ–è€…ç¯å¢ƒå˜é‡ä¸­ï¼Œç„¶ååœ¨åº”ç”¨ç¨‹åºä¸­è¯»å–è¿™äº›ä¿¡æ¯ã€‚è¿™æ ·åšï¼Œé…ç½®ä¿¡æ¯ä¸åº”ç”¨ç¨‹åºå°±è€¦åˆåœ¨ä¸€èµ·äº†ã€‚ ä¸€æ—¦æ•°æ®åº“çš„åœ°å€æˆ–è€…ç«¯å£å‘ç”Ÿå˜åŒ–ï¼Œé‚£æˆ‘ä»¬å°±è¦é‡æ–°ç¼–è¯‘åº”ç”¨ç¨‹åºï¼Œå†é‡æ–°éƒ¨ç½²åˆ°é›†ç¾¤ä¸­ã€‚ ä¸ºäº†è§£å†³ä»¥ä¸Šé—®é¢˜ï¼ŒKubernetes æä¾›äº† ConfigMap çš„åŠŸèƒ½ï¼Œå°†ä¸€äº›é…ç½®ä¿¡æ¯å°è£…èµ·æ¥ï¼Œå°±å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­è¯»å–å’Œä½¿ç”¨äº†ã€‚ Secret å°±æ˜¯ ConfigMapçš„å»¶ä¼¸ï¼Œå¯¹å…¶é‡Œé¢çš„å†…å®¹è¿›è¡Œ base64 è¿›è¡Œç¼–ç ã€‚ConfigMapæ˜¯æ˜æ–‡çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬ä¼šé…ç½®æ•°æ®åº“è®¿é—®çš„ç”¨æˆ·åï¼Œå¯†ç ç­‰ï¼ŒSecret å¯¹è¿™äº›æ•æ„Ÿä¿¡æ¯åšç¼–ç ï¼Œæ³¨æ„ï¼Œè¿˜ä¸æ˜¯åŠ å¯†ã€‚base64 ç¼–ç å¯ä»¥é€šè¿‡ç¼–ç¨‹è¯­è¨€è¿›è¡Œè§£æã€‚ User, C.role, Sa è¿™ 3 ä¸ªåˆ†åˆ«æ˜¯èº«ä»½è®¤è¯ã€ç½‘ç»œå®‰å…¨ã€è®¿é—®æ§åˆ¶ Volumeæˆ‘ä»¬çŸ¥é“ pod æ˜¯å¾ˆå®¹æ˜“è¢«é”€æ¯çš„ï¼Œæ•°æ®åº“çš„ pod ä¸€æ—¦è¢«é”€æ¯ï¼Œå…¶åæœå¯èƒ½æ˜¯ç¾éš¾æ€§çš„ã€‚K8s æä¾›äº† Volume ç»„ä»¶ï¼Œä»–å¯ä»¥å°†æ•°æ®åº“ pod çš„æ•°æ®ï¼ŒåŒæ—¶åŒæ­¥æŒ‚è½½åˆ°æœ¬åœ°çš„ç£ç›˜ä¸Šæˆ–è€…é›†ç¾¤å¤–éƒ¨çš„è¿œç¨‹å­˜å‚¨ä¸Šã€‚ è¿™æ ·å³ä½¿ pod è¢«é”€æ¯ï¼Œæ•°æ®ä¹Ÿèƒ½æŒä¹…åŒ–å­˜å‚¨ã€‚ Deploymentç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜é¡»è€ƒè™‘åˆ°åº”ç”¨ç¨‹åºçš„ pod é«˜å¯ç”¨å§“ï¼Œæ¯”å¦‚æŸä¸ªåº”è¯¥ç¨‹åºçš„èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œæˆ–è€…èŠ‚ç‚¹éœ€è¦å‡çº§æˆ–æ›´æ–°ç»´æŠ¤æ—¶ï¼Œåº”ç”¨ç¨‹åºå°±ä¼šåœæ­¢æœåŠ¡ã€‚è¿™æ˜¾ç„¶æ˜¯ä¸èƒ½æ¥å—çš„ã€‚ è§£å†³æ–¹æ³•æ˜¯å¤åˆ¶å¤šä¸ª Nodeï¼Œå¹¶ç”¨ Service è¿›è¡Œå‡ ç§ç®¡ç†ï¼Œæ­¤æ—¶ k8s ä¼šè‡ªåŠ¨å°†è¯·æ±‚åˆ†æ•£åˆ°å…¶ä»–æ­£å¸¸å·¥ä½œçš„èŠ‚ç‚¹ä¸Šã€‚ è€Œ k8s æä¾›äº†ä¸€ä¸ª Deployment ç»„ä»¶ï¼Œç”¨äºç®¡ç†æ‰€æœ‰åº”ç”¨ç¨‹åº podï¼Œä»–å¯ä»¥å®šä¹‰å’Œç®¡ç†åº”ç”¨ç¨‹åºçš„å‰¯æœ¬æ•°é‡ï¼Œä»¥åŠåº”ç”¨ç¨‹åºçš„æ›´æ–°ç­–ç•¥ï¼Œç®€åŒ–åº”ç”¨ç¨‹åºçš„éƒ¨ç½²å’Œæ›´æ–°æ“ä½œã€‚å¦‚ä¸‹å›¾ï¼š Deployment è¿˜å…·å¤‡ å‰¯æœ¬æ§åˆ¶ ( å°±æ˜¯å®šä¹‰åº”ç”¨çš„å‰¯æœ¬æ•°é‡ï¼Œå¦‚ä¸Šå›¾ï¼Œå®šä¹‰äº† 3 ä¸ªï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªå‰¯æœ¬æœ‰æ•…éšœï¼Œé‚£ä¹ˆä»–ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„å‰¯æœ¬æ¥æ›¿ä»£åŸæœ‰å‰¯æœ¬ï¼Œç»´æŒå‰¯æœ¬çš„æ•°é‡åœ¨ 3 ä¸ª ) æ»šåŠ¨æ›´æ–° ( å¯ä»¥å®šä¹‰åº”ç”¨ç¨‹åºçš„å‡çº§ç­–ç•¥ï¼Œç”¨äºåº”ç”¨ç¨‹åºçš„ç‰ˆæœ¬å‡çº§ ) è‡ªåŠ¨æ‰©å®¹ ç­‰é«˜çº§åŠŸèƒ½ã€‚ StatefulSetç›¸è¾ƒäºä¸Šé¢ Deployment ç®¡ç†åº”ç”¨çš„å‰¯æœ¬ï¼Œæ•°æ®åº“å…¶å®ä¹Ÿéœ€è¦å¯¹åº”çš„å‰¯æœ¬ç®¡ç†å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·æ˜¯ StatefulSetã€‚ å’Œåº”ç”¨ä¸åŒçš„æ˜¯ï¼Œæ•°æ®åº“çš„æ¯ä¸ªå‰¯æœ¬ï¼Œéƒ½æ˜¯æœ‰ç‹¬ç«‹çš„çŠ¶æ€çš„ï¼Œè€Œåº”ç”¨æ˜¯æ— çŠ¶æ€çš„ã€‚ç®€å•æ¥è¯´ï¼Œ10 ç§’å‰å­˜å…¥çš„æ•°æ®çš„çŠ¶æ€ï¼Œå’Œç°åœ¨çš„æ•°æ®çš„çŠ¶æ€å¾€å¾€æ˜¯ä¸ä¸€æ ·çš„ã€‚æ‰€ä»¥æ•°æ®åº“çš„ podï¼Œéœ€è¦æŠŠæ•°æ®åŒæ­¥åˆ°å…¶ä»–çš„å‰¯æœ¬ä¸­ï¼Œæˆ–è€…æŠŠæ•°æ®å†™å…¥åˆ°ä¸€ä¸ªå…±äº«çš„å­˜å‚¨ä¸­ã€‚ å’Œ Deployment çš„åŠŸèƒ½ç±»ä¼¼ï¼Œä½† StatefulSet è¿˜ä¿è¯æ¯ä¸ªå‰¯æœ¬éƒ½æœ‰è‡ªå·±ç¨³å®šçš„ç½‘ç»œæ ‡è¯†ç¬¦å’ŒæŒä¹…åŒ–å­˜å‚¨ã€‚æ‰€ä»¥ï¼Œåƒæ•°æ®åº“ï¼Œç¼“å­˜ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ç­‰ç­‰ï¼Œä»¥åŠä¸€äº›ä¿ç•™äº†ä¼šè¯çŠ¶æ€çš„åº”ç”¨ï¼Œéƒ½ä½¿ç”¨ StatefulSet æ¥éƒ¨ç½²ã€‚ å½“ç„¶ï¼Œä¸€ç§æ›´å¥½çš„å®è·µæ˜¯å°†æœ‰çŠ¶æ€çš„ pod ä»å„ä¸ªèŠ‚ç‚¹ä¸­å‰¥ç¦»å‡ºæ¥ï¼Œè¿›è¡Œå•ç‹¬çš„éƒ¨ç½² æ¶æ„k8s æ˜¯ä¸€ä¸ªå…¸å‹çš„ master-workeræ¶æ„ã€‚æ‰€ä»¥ï¼Œæ¯”å¦‚ä»¥ä¸Šæ‰€æåˆ°çš„éƒ¨ç½²äº†åº”ç”¨å’Œæ•°æ®åº“çš„èŠ‚ç‚¹ï¼Œä¹Ÿè¢«ç§°ä¸ºå·¥ä½œèŠ‚ç‚¹ worker nodeã€‚è€Œå·¥ä½œèŠ‚ç‚¹é€šå¸¸æœ‰å¤šä¸ªï¼Œmasteråªæœ‰ä¸€ä¸ªï¼Œç”¨äºç®¡ç†æ‰€æœ‰ worker node å·¥ä½œèŠ‚ç‚¹ worker node ä¸ºäº†èƒ½æä¾›å¯¹å¤–æœåŠ¡ï¼Œæ¯ä¸ª Node èŠ‚ç‚¹ä¸Šéƒ½ä¼šåŒ…å« 3 ä¸ªå¯¹åº”çš„æœåŠ¡ç»„ä»¶ï¼Œåˆ†åˆ«æ˜¯: kubeletï¼Œè´Ÿè´£ç®¡ç†å’Œç»´æŠ¤æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ podï¼Œä¹Ÿä¼šå®šæœŸä» api-server ç»„ä»¶æ¥å—æ–°çš„ pod è§„èŒƒï¼Œç›‘è§†å·¥ä½œèŠ‚ç‚¹çš„è¿è¡Œæƒ…å†µï¼Œå°†ä¿¡æ¯æ±‡æŠ¥ç»™ api-server kube-proxyï¼Œè´Ÿè´£ä¸º pod æä¾›ç½‘ç»œä»£ç†å’Œè´Ÿè½½å‡è¡¡ container runtime å®¹å™¨è¿è¡Œæ—¶ container runtime å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ Docker-Engineï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¿…é¡»æœ‰å®¹å™¨è¿è¡Œæ—¶ï¼Œå½“ç„¶ï¼Œå®¹å™¨è¿è¡Œæ—¶ä¹Ÿä¸æ­¢ dockerï¼Œè¿˜æœ‰å¦‚ï¼šContainerdï¼ŒCRI-Oï¼ŒMirantis é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªé›†ç¾¤åŒ…å«å¤šä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹é—´çš„é€šä¿¡å’Œè´Ÿè½½å‡è¡¡å™¨å°±æ˜¯é€šè¿‡ k-proxy ç®¡ç†èŠ‚ç‚¹ master node ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œmaster èŠ‚ç‚¹çš„ç»“æ„å’Œ worker èŠ‚ç‚¹å®Œå…¨ä¸åŒï¼Œä»–åˆ†åˆ«åŒ…æ‹¬ API serverï¼Œschedulerï¼Œcontrol managerï¼Œ etcdå’Œ cloud control managerï¼Œé€šè¿‡ api server æ¥ç®¡ç†æ‰€æœ‰å·¥ä½œèŠ‚ç‚¹ã€‚ API server å°±åƒä¸€ä¸ªé›†ç¾¤çš„ç½‘å…³ï¼Œæ˜¯æ•´ä¸ªç³»ç»Ÿçš„å…¥å£ã€‚æ‰€æœ‰è¯·æ±‚éƒ½ä¼šç»è¿‡ä»–ï¼Œå†ç”±ä»–åˆ†å‘ç»™ä¸åŒçš„ç»„ä»¶è¿›è¡Œå¤„ç†ã€‚è€Œä¸”æ‰€æœ‰çš„ç»„ä»¶é—´ä¹Ÿä¼šé€šè¿‡ API server è¿›è¡Œé€šä¿¡ã€‚ ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªæ–°åº”ç”¨ pod æ—¶ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨å®¢æˆ·ç«¯ï¼Œä¾‹å¦‚ kubectl å‘½ä»¤è¡Œï¼Œdashboard æˆ–è€…å…¶ä»–çš„ UI ç•Œé¢å·¥å…·ã€‚ å½“ä½¿ç”¨kubectl å‘½ä»¤è¡Œåˆ›å»ºæ–°çš„ pod æ—¶ï¼Œè¿™ä¸ªè¯·æ±‚ä¼šå…ˆåˆ°è¾¾ api server å¹¶éªŒè¯è¿™ä¸ªè¯·æ±‚çš„åˆæ³•æ€§ï¼ŒéªŒè¯é€šè¿‡åå†è½¬å‘ç»™ç›¸åº”çš„ Scheduler è°ƒåº¦å™¨ç»„ä»¶è¿›è¡Œå¤„ç† Schedulerè´Ÿè´£ç›‘æ§é›†ç¾¤ä¸­æ‰€æœ‰èŠ‚ç‚¹èµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œæ ¹æ®ä¸€äº›è°ƒåº¦ç­–ç•¥ï¼Œå°† pod è°ƒåº¦åˆ°åˆé€‚çš„èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚ ä¾‹å¦‚ä¸‹å›¾ï¼š è°ƒåº¦å™¨ä¼šå°† pod éƒ¨ç½²æ—¶è¾ƒä¸ºç©ºé—²çš„èŠ‚ç‚¹ä¸Šè¿è¡Œ controller manager æ§åˆ¶è€…ç®¡ç†å™¨ï¼Œå¤åˆ¶ç®¡ç†é›†ç¾¤ä¸­å„ç§èµ„æºå¯¹è±¡çš„çŠ¶æ€ã€‚æ¯”å¦‚ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„ pod å‘ç”Ÿæ•…éšœæ—¶ï¼Œå¿…é¡»æœ‰ä¸€ç§æœºåˆ¶ç›‘æµ‹åˆ°è¿™ä¸ªæ•…éšœï¼Œå°½å¿«å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚ä¾‹å¦‚é‡å¯è¯¥ pod æˆ–è€…æ–°å¯ç”¨ä¸€ä¸ª pod è¿›è¡Œæ›¿æ¢ã€‚ controller manager æ˜¯å¦‚ä½•çŸ¥é“å“ªä¸ªèŠ‚ç‚¹å‘ç”Ÿæ•…éšœçš„å‘¢ï¼Ÿè¿™å°±éœ€è¦ä¸‹é¢ä»‹ç»çš„ etcd ç»„ä»¶ etcdè¿™ä¸ªæ˜¯ä¸€ä¸ªé«˜å¯ç”¨çš„é”®å€¼å­˜å‚¨ç³»ç»Ÿï¼Œç±»ä¼¼ Redisï¼Œå­˜å‚¨é›†ç¾¤ä¸­æ‰€æœ‰èµ„æºå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ã€‚æ¯”å¦‚å“ªä¸ª pod æŒ‚æ‰ï¼Œå“ªä¸ª pod åˆè¢«æ–°åˆ›å»ºäº†ã€‚å¯ä»¥ç†è§£ä¸ºé›†ç¾¤çš„å¤§è„‘ã€‚æ˜¯æ•´ä¸ªé›†ç¾¤çš„æ•°æ®å­˜å‚¨ä¸­å¿ƒã€‚ cloud controller manageräº‘æ§åˆ¶å™¨ç®¡ç†å™¨ï¼Œä»–æ˜¯ç”¨æ¥å’Œå„ç§äº‘ä¸Šçš„ api è¿›è¡Œäº¤äº’çš„ã€‚è€Œä¸”ä»–èƒ½æä¾›ä¸€è‡´çš„ç®¡ç†æ¥å£ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥åœ¨ä¸åŒäº‘å¹³å°ä¸­ç®¡ç†ä»–ä»¬çš„åº”ç”¨ç¨‹åºã€‚","tags":["Kubernetes","Docker","K8s","K3s","minikube"]},{"title":"Node çš„å¤šè¿›ç¨‹ç®¡ç†â€”â€”â€”â€”å¤šæ ¸CPUè§£å†³è®¡ç®—å¯†é›†å‹åº”ç”¨","path":"/2024/05/20/ã€2024-05-20ã€‘Nodeå¤šè¿›ç¨‹è§£å†³è®¡ç®—å¯†é›†å‹é—®é¢˜/","content":"æœ€è¿‘é¢è¯•è¢«é—®åˆ°è¿‡çš„é—®é¢˜ï¼ŒæŸ¥äº†èµ„æ–™åï¼Œè‡ªå·±æ€»ç»“ä¸€ä¸‹è®°å½•ä¸‹æ¥ã€‚ é—®é¢˜çš„æå‡ºä¼—æ‰€å‘¨çŸ¥ã€‚Node.js æ˜¯å•çº¿ç¨‹çš„ï¼Œå•çº¿ç¨‹ç‰¹æ€§ä½¿å¾—èƒ½å¤Ÿä»¥è¾ƒä½çš„ç³»ç»Ÿèµ„æºæ¶ˆè€—å¿«é€Ÿå¤„ç†è®¸å¤šè¯·æ±‚ã€‚ æœ‰å¼‚æ­¥ I/Oï¼Œæ‰€ä»¥ Node.js æ˜¯å¯ä»¥å¤„ç† IO å¯†é›†å‹ä»»åŠ¡ï¼Œä½†æ˜¯ Node.js ç¢°åˆ° CPU å¯†é›†å‹ï¼Œæˆ–è€…è¯´è®¡ç®—å¯†é›†å‹ä»»åŠ¡ï¼ˆä¾‹å¦‚æœºå™¨å­¦ä¹ ï¼Œæ±‚æ–æ³¢é‚£å¥‘æ•°åˆ—ï¼Œæ±‚ç´ æ•°ç­‰ï¼‰ï¼Œnode çš„å•çº¿ç¨‹ä¼˜åŠ¿å°±å¾€å¾€å˜æˆåŠ£åŠ¿ã€‚ æœ‰äººè¯´ï¼Œé‚£å¯ä»¥ç”¨ä»–çš„å¼‚æ­¥é˜Ÿåˆ—æ¥è§£å†³ã€‚é‚£è®©æˆ‘ä»¬çœ‹çœ‹ Promise çš„ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233// serverWithPromises.jsconst express = require(&quot;express&quot;);const app = express();app.get(&quot;/isprime&quot;, async (req, res) =&gt; &#123; const startTime = new Date(); const result = await isPrime(parseInt(req.query.number)); const endTime = new Date(); res.json(&#123; number: parseInt(req.query.number), isprime: result, time: endTime.getTime() - startTime.getTime() + &quot;ms&quot;, &#125;);&#125;);app.get(&quot;/testrequest&quot;, (req, res) =&gt; &#123; res.send(&quot;I am unblocked now&quot;);&#125;);const isPrime = (number) =&gt; &#123; return new Promise((resolve) =&gt; &#123; let isPrime = true; for (let i = 3; i &lt; number; i++) &#123; if (number % i === 0) &#123; isPrime = false; break; &#125; &#125; resolve(isPrime); &#125;);&#125;;app.listen(3000, () =&gt; console.log(&quot;listening on port 3000&quot;)); å¯ä»¥çœ‹å‡º Promise æ˜¯å¼‚æ­¥çš„éƒ¨åˆ†åœ¨ .then()ä»£ç é‡Œï¼Œä½†æ˜¯ä»–è‡ªèº«çš„é˜»å¡æ˜¯æ— æ³•é¿å…çš„ï¼Œä¾‹å¦‚ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬æŠŠfor (let i = 3; i &lt; number; i++) æ”¹æˆ for (let i = 3; i &lt; 1000000000; i++)ï¼Œé‚£ä¹ˆæ•´ä¸ªä»»åŠ¡å°±ä¼šå¡æ­»ã€‚ä»è€Œé˜»å¡ &#39;/testrequest&#39; api çš„è¯·æ±‚ã€‚ Promise ä¹‹æ‰€ä»¥åœ¨ JavaScript ç¤¾åŒºä¸­è¢«æ¨å´‡ä¸ºâ€œå¼‚æ­¥éé˜»å¡æ“ä½œâ€çš„ä¸€ç§æ–¹å¼ï¼Œæ˜¯å› ä¸º Promise æ“…é•¿å®Œæˆéœ€è¦æ›´å¤šæ—¶é—´è€Œä¸æ˜¯æ›´å¤š CPU çš„å·¥ä½œã€‚ è¿™é‡Œæ‰€è¯´çš„â€œéœ€è¦æ›´å¤šæ—¶é—´çš„å·¥ä½œâ€é€šå¸¸åŒ…æ‹¬ï¼šæ•°æ®åº“é€šä¿¡ã€è·¨æœåŠ¡å™¨é€šä¿¡ç­‰ï¼Œè¿™ä¹Ÿæ˜¯ Web æœåŠ¡å™¨æ‰€åšçš„ 99% çš„å·¥ä½œã€‚ JavaScript Promise é€šè¿‡å°†ä»»åŠ¡æ¨é€åˆ°ç‰¹æ®Šé˜Ÿåˆ—å¹¶ä¾¦å¬äº‹ä»¶ï¼ˆä¾‹å¦‚ï¼šæ•°æ®åº“è¿”å›ï¼‰å‘ç”Ÿå¹¶åœ¨è¯¥äº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™å°±æ˜¯è‘—åçš„äº‹ä»¶å¾ªç¯ã€‚ 1234567891011121314151617181920212223import express from &quot;express&quot;;import fetch from &quot;node-fetch&quot;;const app = express();// node-fetch ç”¨äºåœ¨Nodejsä¸­å‘é€æƒ…å†µapp.get(&quot;/calltoslowserver&quot;, async (req, res) =&gt; &#123; const result = await fetch(&quot;http://localhost:5000/slowrequest&quot;); // è¿”å›ä¸€ä¸ªPromise const resJson = await result.json(); res.json(resJson);&#125;);app.get(&quot;/slowrequest&quot;, (req, res) =&gt; &#123; setTimeout(() =&gt; res.json(&#123; message: &quot;sry i was late&quot; &#125;), 20000); // setTimeout æ¨¡æ‹Ÿ10sçš„æ—¶é—´èŠ±é”€ï¼Œå³ä½¿èŠ±é”€å¾ˆé•¿æ—¶é—´ä¹Ÿä¸ä¼šé˜»å¡å…¶ä»–è®¿é—®&#125;);app.get(&quot;/testrequest&quot;, (req, res) =&gt; &#123; res.send(&quot;I am unblocked now&quot;);&#125;);app.listen(4000, () =&gt; console.log(&quot;listening on port 4000&quot;)); åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿å¯¹ /slowrequest æˆ–è€… /calltoslowserver çš„è°ƒç”¨èŠ±è´¹äº†å¾ˆé•¿æ—¶é—´ï¼Œæ‰€æœ‰å…¶ä»–è¯·æ±‚ï¼Œæ¯”å¦‚ï¼š/testrequestï¼Œéƒ½æ²¡æœ‰è¢«é˜»æ­¢ã€‚ è¿™æ˜¯å› ä¸º node-fetch çš„ fetch å‡½æ•°è¿”å›ä¸€ä¸ª Promiseï¼Œè€Œ è¿™ç§å•çº¿ç¨‹ã€éé˜»å¡ã€å¼‚æ­¥çš„å¤„ç†æ–¹å¼æ˜¯ Node ä¸­é»˜è®¤çš„ã€‚ è§£å†³æ–¹æ¡ˆNode js æä¾›äº†ä¸‰ç§è§£å†³æ–¹æ¡ˆæ¥è§£å†³ä¸Šé¢é—®é¢˜ã€‚ child_process æ¨¡å—child_process æ¨¡å—æä¾›äº†ç”Ÿæˆæ‹¥æœ‰è‡ªå·±å†…å­˜çš„æ–°è¿›ç¨‹çš„èƒ½åŠ›ï¼Œ è¿™äº›è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ˜¯é€šè¿‡ OS æä¾›çš„ IPCï¼ˆInter-process Communicationï¼‰å»ºç«‹ã€‚ è¯¥æ¨¡å—å†…éƒ¨ä¸»è¦æœ‰ 3 ä¸ª apiï¼š child_process.exec() child_process.spawn() child_process.fork() exec()è¯¥ api å…è®¸ä½ æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚è™½ç„¶å®ƒä¸èƒ½ç›´æ¥è§£å†³ CPU å¯†é›†å‹ä»»åŠ¡ï¼Œä½†ä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥è°ƒç”¨å…¶ä»–è¯­è¨€ç¼–å†™çš„ç¨‹åºæˆ–è„šæœ¬æ¥å¤„ç† CPU å¯†é›†å‹ä»»åŠ¡ï¼Œå¦‚è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—ã€‚ é¦–å…ˆæˆ‘ä»¬å†™ä¸€ä¸ª fibonacci.py æ–‡ä»¶ï¼š 1234567891011121314# fibonacci.pyimport sysdef fibonacci(n): if n &lt;= 0: return 0 elif n == 1: return 1 else: return fibonacci(n-1) + fibonacci(n-2)if __name__ == &quot;__main__&quot;: n = int(sys.argv[1]) print(fibonacci(n)) æ¥ä¸‹æ¥ï¼Œåœ¨ Express ä¸­ä½¿ç”¨ child_process.exec() è°ƒç”¨è¿™ä¸ª Python è„šæœ¬ï¼š 12345678910111213141516171819202122232425262728293031323334const express = require(&quot;express&quot;);const bodyParser = require(&quot;body-parser&quot;);// npm i express body-parserconst &#123; execSync, exec &#125; = require(&quot;child_process&quot;);const app = express();const port = 3000;app.use(bodyParser.json());// é˜»å¡æ¥å£çš„ç¤ºä¾‹app.post(&quot;/testblock&quot;, (req, res) =&gt; &#123; const number = req.body.number || 10; // ä½¿ç”¨ execSync ä¼šé˜»å¡Node.jsäº‹ä»¶å¾ªç¯ const result = execSync(`python fibonacci.py $&#123;number&#125;`).toString().trim(); res.json(&#123; fibonacci: result &#125;);&#125;);// éé˜»å¡æ¥å£çš„ç¤ºä¾‹app.post(&quot;/fibonaccipy&quot;, (req, res) =&gt; &#123; const number = req.body.number || 10; exec(`python fibonacci.py $&#123;number&#125;`, (error, stdout, stderr) =&gt; &#123; if (error) &#123; return res.status(500).json(&#123; error: `æ‰§è¡Œçš„é”™è¯¯: $&#123;error.message&#125;` &#125;); &#125; if (stderr) &#123; return res.status(500).json(&#123; error: `æ ‡å‡†é”™è¯¯è¾“å‡º: $&#123;stderr&#125;` &#125;); &#125; res.json(&#123; fibonacci: stdout.trim() &#125;); &#125;);&#125;);app.listen(port, () =&gt; &#123; console.log(`Server is running on port $&#123;port&#125;`);&#125;); åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ª POST æ¥å£ã€‚/testblockæ¥å£ä½¿ç”¨ execSync æ¥åŒæ­¥æ‰§è¡Œ Python è„šæœ¬ï¼Œè¿™ä¼šé˜»å¡ Node.js çš„äº‹ä»¶å¾ªç¯ï¼Œç›´åˆ° Python è„šæœ¬æ‰§è¡Œå®Œæˆã€‚è€Œ/fibonaccipy æ¥å£åˆ™ä½¿ç”¨ exec æ¥å¼‚æ­¥æ‰§è¡Œ Python è„šæœ¬ï¼Œä¸ä¼šé˜»å¡ Node.js çš„äº‹ä»¶å¾ªç¯ã€‚ spawn()è¯¥æ–¹æ³•ç”¨äºå¼‚æ­¥ç”Ÿæˆå­è¿›ç¨‹ï¼Œè¯¥å­è¿›ç¨‹å¯ä»¥æ˜¯å…è®¸ç»ˆç«¯è¿è¡Œçš„ä»»ä½•å‘½ä»¤ã€‚ç”¨æ³•ä¸ä¸Šä¸€ä¸ª exec() æ–¹æ³•ç±»ä¼¼ï¼Œä½† spawn() æ–¹æ³•è¿”å›ä¸€ä¸ª ChildProcess å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å…·æœ‰ stdout å’Œ stderr å±æ€§ï¼Œç”¨äºè¯»å–å­è¿›ç¨‹çš„è¾“å‡ºã€‚ä»–å¯ä»¥å’Œå­è¿›ç¨‹é—´è¿›è¡Œé€šä¿¡ï¼Œè·å–å…¶è¾“å‡ºï¼Œè¿™ç‚¹æ˜¯ exec() æ–¹æ³•æ— æ³•åšåˆ°çš„ã€‚ 123456789101112131415161718192021const express = require(&quot;express&quot;);const app = express();const &#123; spawn &#125; = require(&quot;child_process&quot;);// å¯¼å…¥child_processå­è¿›ç¨‹app.get(&quot;/ls&quot;, (req, res) =&gt; &#123; const ls = spawn(&quot;ls&quot;, [&quot;-lash&quot;, req.query.directory]); ls.stdout.on(&quot;data&quot;, (data) =&gt; &#123; // stdin,stdout,stderr ç®¡é“ï¼ˆconnectionï¼‰æ˜¯é€šè¿‡çˆ¶çº§parentå»ºç«‹çš„ // Node.js è¿›ç¨‹å’Œç”Ÿæˆçš„å­è¿›ç¨‹ï¼Œå¯ä»¥åœ¨æ ‡å‡†è¾“å‡ºä¸Šç›‘å¬æ•°æ®äº‹ä»¶ res.write(data.toString()); // æ—¥æœŸå°†ä»¥æµï¼ˆæ•°æ®å—ï¼‰çš„å½¢å¼å‡ºç° // ç”±äº res æ˜¯ä¸€ä¸ªå¯å†™æµï¼Œæ”¯æŒå†™å…¥ &#125;); ls.on(&quot;close&quot;, (code) =&gt; &#123; console.log(`child process exited with code $&#123;code&#125;`); res.end(); // æœ€åï¼Œå½“å­è¿›ç¨‹é€€å‡ºæ—¶ï¼Œæ‰€æœ‰å†™å…¥çš„æµéƒ½ä¼šè¢«å‘é€å›æ¥ &#125;);&#125;);app.listen(7000, () =&gt; console.log(&quot;listening on port 7000&quot;)); fork() é‡ç‚¹å…³æ³¨child_process.fork() ä¸“é—¨ç”¨äºç”Ÿæˆæ–°çš„ Nodejs è¿›ç¨‹ã€‚ ä¸ spawn ä¸€æ ·ï¼Œè¿”å›çš„ childProcess å¯¹è±¡å°†å…·æœ‰å†…ç½®çš„ IPC é€šä¿¡é€šé“ï¼Œå…è®¸æ¶ˆæ¯åœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´æ¥å›ä¼ é€’ã€‚ ä¾‹å¦‚ä»¥ä¸‹ä¸»ç¨‹åºä»£ç ï¼š 1234567891011121314151617181920212223const express = require(&quot;express&quot;);const app = express();const &#123; fork &#125; = require(&quot;child_process&quot;);app.get(&quot;/isprime&quot;, (req, res) =&gt; &#123; const childProcess = fork(&quot;./forkedchild.js&quot;); // fork() çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­è¿›ç¨‹è¦è¿è¡Œçš„ js æ–‡ä»¶çš„åç§° childProcess.send(&#123; number: parseInt(req.query.number) &#125;); // sendæ–¹æ³•ç”¨äºé€šè¿‡IPCå‘å­è¿›ç¨‹å‘é€æ¶ˆæ¯ const startTime = new Date(); childProcess.on(&quot;message&quot;, (message) =&gt; &#123; // on(&quot;message&quot;)æ–¹æ³•ç”¨äºç›‘å¬å­è¿›ç¨‹å‘é€çš„æ¶ˆæ¯ const endTime = new Date(); res.json(&#123; ...message, time: endTime.getTime() - startTime.getTime() + &quot;ms&quot;, &#125;); &#125;);&#125;);app.get(&quot;/testrequest&quot;, (req, res) =&gt; &#123; res.send(&quot;I am unblocked now&quot;);&#125;);app.listen(3636, () =&gt; console.log(&quot;listening on port 3636&quot;)); å…¶ä¸­ï¼Œforkedchild.js æ–‡ä»¶å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223process.on(&quot;message&quot;, (message) =&gt; &#123; //å­è¿›ç¨‹æ­£åœ¨ç›‘å¬çˆ¶è¿›ç¨‹çš„æ¶ˆæ¯ const result = isPrime(message.number); process.send(result); // ä½¿ç”¨åè¦exit() é˜²æ­¢è¿›ç¨‹å­¤ç«‹ process.exit();&#125;);function isPrime(number) &#123; let isPrime = true; for (let i = 3; i &lt; number; i++) &#123; if (number % i === 0) &#123; isPrime = false; break; &#125; &#125; return &#123; number: number, isPrime: isPrime, &#125;;&#125; æ­¤æ—¶å½“è®¿é—® /isprime?number=29355126551 æ—¶å€™è™½ç„¶æµè§ˆå™¨ä¹Ÿä¼šä¸€ç›´å¤„äº loading ç­‰å¾…ç›´åˆ°è¿”å›ï¼Œä½†æ˜¯æ­¤æ—¶ä¸ä¼šé˜»å¡åç»­çš„å…¶ä»–è¯·æ±‚ï¼Œæ¯”å¦‚ï¼š/testrequest api çš„è¯·æ±‚ã€‚ æ€»ç»“ï¼š å¦‚æœä½ éœ€è¦æ‰§è¡Œä¸€ä¸ªç®€çŸ­çš„å‘½ä»¤å¹¶è·å–å…¶å®Œæ•´è¾“å‡ºï¼Œå¯ä»¥ä½¿ç”¨ exec()ã€‚ å¦‚æœä½ éœ€è¦å¤„ç†å¤§é‡æ•°æ®æˆ–éœ€è¦ä¸å­è¿›ç¨‹è¿›è¡Œå®æ—¶é€šä¿¡ï¼Œåº”è¯¥ä½¿ç”¨ spawn()ã€‚ å¦‚æœä½ æ­£åœ¨åˆ›å»ºå¤šä¸ª Node.js å·¥ä½œè¿›ç¨‹ï¼Œå¹¶å¸Œæœ›é€šè¿‡ IPC è¿›è¡Œé€šä¿¡ï¼Œé‚£ä¹ˆ fork() æ˜¯æœ€ä½³é€‰æ‹©ã€‚ cluster æ¨¡å—cluster ä¸»è¦ç”¨äºå‚ç›´ï¼ˆä¸ºç°æœ‰æœºå™¨æ·»åŠ æ›´å¤šåŠŸèƒ½ï¼‰æ‰©å±• Nodejs Web æœåŠ¡å™¨ï¼Œæ„å»ºåœ¨ child_process æ¨¡å—ä¹‹ä¸Šã€‚ åœ¨ Http æœåŠ¡å™¨ä¸­ï¼Œcluster æ¨¡å—ä½¿ç”¨ child_process.fork() è‡ªåŠ¨ fork è¿›ç¨‹å¹¶å»ºç«‹ä¸»ä»æ¶æ„ï¼Œå…¶ä¸­çˆ¶è¿›ç¨‹ä»¥å¾ªç¯æ–¹å¼å°†ä¼ å…¥è¯·æ±‚åˆ†å‘ç»™å­è¿›ç¨‹ã€‚ ç†æƒ³æƒ…å†µä¸‹ï¼Œfork çš„è¿›ç¨‹æ•°åº”ç­‰äºè®¡ç®—æœºå…·æœ‰çš„ CPU æ ¸æ•°ã€‚ ä¸‹é¢ç¤ºä¾‹ä½¿ç”¨ cluster æ¨¡å—æ„å»ºä¸€ä¸ª Express æœåŠ¡å™¨ï¼š 123456789101112131415161718192021222324252627282930313233343536const cluster = require(&quot;cluster&quot;);const http = require(&quot;http&quot;);const cpuCount = require(&quot;os&quot;).cpus().length;// è¿”å›cpuçš„æ ¸æ•°if (cluster.isMaster) &#123; masterProcess();&#125; else &#123; childProcess();&#125;// çˆ¶è¿›ç¨‹function masterProcess() &#123; console.log(`Master process $&#123;process.pid&#125; is running`); // fork()æ›´å¤š workers for (let i = 0; i &lt; cpuCount; i++) &#123; console.log(`Forking process number $&#123;i&#125;...`); cluster.fork(); //creates new node js processes &#125; cluster.on(&quot;exit&quot;, (worker, code, signal) =&gt; &#123; console.log(`worker $&#123;worker.process.pid&#125; died`); cluster.fork(); //forks a new process if any process dies &#125;);&#125;// å­è¿›ç¨‹function childProcess() &#123; const express = require(&quot;express&quot;); const app = express(); // workers å¯ä»¥å…±äº« TCP connection app.get(&quot;/&quot;, (req, res) =&gt; &#123; res.send(`hello from server $&#123;process.pid&#125;`); &#125;); app.listen(5555, () =&gt; console.log(`server $&#123;process.pid&#125; listening on port 5555`) );&#125; å½“è¿è¡Œä¸Šé¢çš„ä»£ç æ—¶ï¼Œcluster.isMaster ç¬¬ä¸€æ¬¡ä¸º true å¹¶ä¸” masterProcess() å‡½æ•°è¢«æ‰§è¡Œã€‚masterProcess()å‡½æ•° fork()äº† 4 ä¸ª NodeJS è¿›ç¨‹ï¼ˆä¾èµ–äºè®¾å¤‡ CPU çš„æ ¸æ•°ï¼‰ï¼Œæ¯å½“ fork()å¦ä¸€ä¸ªè¿›ç¨‹æ—¶ï¼Œéƒ½ä¼šå†æ¬¡è¿è¡Œç›¸åŒçš„æ–‡ä»¶ï¼Œä½† cluster.isMaster å°†è¿”å› falseï¼Œå› ä¸ºè¯¥è¿›ç¨‹ç°åœ¨æ˜¯ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå› ä¸ºæ˜¯ forkï¼ˆï¼‰çš„ï¼Œå› æ­¤æ§åˆ¶è½¬åˆ° else æ¡ä»¶ã€‚ æœ€ç»ˆ childProcess() å‡½æ•°æ‰§è¡Œäº† 4 æ¬¡ï¼Œå¹¶åˆ›å»ºäº† 4 ä¸ª Express æœåŠ¡å™¨å®ä¾‹ï¼Œåç»­è¯·æ±‚ä»¥å¾ªç¯æ–¹å¼åˆ†å‘åˆ°å››å°æœåŠ¡å™¨ï¼Œä»è€Œå……åˆ†åˆ©ç”¨æœºå™¨çš„ CPUã€‚ Node js æ–‡æ¡£è¿˜æŒ‡å‡ºï¼Œæœ‰ä¸€äº›å†…ç½®çš„æ™ºèƒ½åŠŸèƒ½å¯ä»¥é¿å…å·¥ä½œè¿›ç¨‹è¿‡è½½ã€‚ Cluster æ¨¡å—æ˜¯å‚ç›´æ‰©å±•ç®€å• Nodejs æœåŠ¡å™¨çš„æœ€ç®€å•ã€æœ€å¿«çš„æ–¹æ³•ã€‚ ä½†æ˜¯ï¼Œä¸ºäº†å®ç°æ›´é«˜çº§å’Œå¼¹æ€§çš„æ‰©å±•ï¼Œå¯ä»¥ä½¿ç”¨ docker å®¹å™¨å’Œ Kubernetes ç­‰å·¥å…·ã€‚ worker threadsæœ¬è´¨ä¸Šï¼Œå·¥ä½œçº¿ç¨‹å’Œå­è¿›ç¨‹ä¹‹é—´çš„åŒºåˆ«å°±åƒçº¿ç¨‹å’Œè¿›ç¨‹ä¹‹é—´çš„åŒºåˆ«ä¸€æ ·ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œåˆ›å»ºçš„çº¿ç¨‹æ•°åº”ç­‰äº cpu æ ¸æ•°ã€‚ ä¸‹é¢æ¼”ç¤º worker_threads çš„ä½¿ç”¨ã€‚å…ˆåˆ›å»ºä¸€ä¸ªå•è¿›ç¨‹çš„æœåŠ¡å™¨ï¼š 1234567891011121314151617181920212223242526272829303132333435363738const express = require(&quot;express&quot;);const app = express();// æ±‚å’Œfunction sumOfPrimes(n: number): number &#123; var sum = 0; for (var i = 2; i &lt;= n; i++) &#123; for (var j = 2; j &lt;= i / 2; j++) &#123; if (i % j == 0) &#123; break; &#125; &#125; if (j &gt; i / 2) &#123; sum += i; &#125; &#125; return sum;&#125;app.get( &quot;/sumofprimes&quot;, ( &#123; query: &#123; number &#125; &#125;: any, res: &#123; json: (arg0: &#123; number: any; sum: number; timeTaken: string &#125;) =&gt; void; &#125; ) =&gt; &#123; const startTime = new Date().getTime(); const sum = sumOfPrimes(number as number); const endTime = new Date().getTime(); res.json(&#123; number: number, sum: sum, timeTaken: (endTime - startTime) / 1000 + &quot; seconds&quot;, &#125;); &#125;);app.listen(6868, () =&gt; console.log(&quot;listening on port 6868&quot;)); å½“æˆ‘ä»¬è¯·æ±‚ 100 ä¸‡çš„è´¨æ•°ä¹‹å’Œæ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°ä»¥ä¸‹ç»“æœï¼šæˆ‘ç”¨çš„ç”µè„‘æ˜¯ MacBookâ€™s M1ï¼Œä¹Ÿè¦è¶³è¶³é˜»å¡ 12 ç§’ æˆ‘ä»¬æŠŠä»–æ”¹é€ ä¸ºå·¥ä½œçº¿ç¨‹æ¨¡å¼ï¼šä¸»ç¨‹åºï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778import express from &quot;express&quot;;import &#123; Worker &#125; from &quot;worker_threads&quot;;const app = express();function runWorker(workerData) &#123; return new Promise((resolve, reject) =&gt; &#123; // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯workerçš„æ–‡ä»¶å const worker = new Worker(&quot;./cpuå¯†é›†å‹æ¼”ç¤º_worker_threads_è´¨æ•°åŠ æ€».js&quot;, &#123; workerData, &#125;); worker.on(&quot;message&quot;, resolve); // å½“æ•°æ®ä»workerçº¿ç¨‹è¿”å›çš„æ—¶å€™æ”¹Promiseä¸ºresolve worker.on(&quot;error&quot;, reject); worker.on(&quot;exit&quot;, (code) =&gt; &#123; if (code !== 0) &#123; reject(new Error(`Worker stopped with exit code $&#123;code&#125;`)); &#125; &#125;); &#125;);&#125;function divideWorkAndGetSum() &#123; // ä¸ºäº†ç®€å•èµ·è§ï¼Œå¯¹å€¼ 600000 è¿›è¡Œç¡¬ç¼–ç åˆ†æˆ4ç­‰ä»½ const start1 = 2; const end1 = 150000; const start2 = 150001; const end2 = 300000; const start3 = 300001; const end3 = 450000; const start4 = 450001; const end4 = 600000; const start5 = 600001; const end5 = 750000; const start6 = 750001; const end6 = 900000; const start7 = 900001; const end7 = 1000000; // ä¸ºæ¯ä¸€ä¸ªworkerå•ç‹¬åˆ†é…å†…å®¹ const worker1 = runWorker(&#123; start: start1, end: end1 &#125;); const worker2 = runWorker(&#123; start: start2, end: end2 &#125;); const worker3 = runWorker(&#123; start: start3, end: end3 &#125;); const worker4 = runWorker(&#123; start: start4, end: end4 &#125;); const worker5 = runWorker(&#123; start: start5, end: end5 &#125;); const worker6 = runWorker(&#123; start: start6, end: end6 &#125;); const worker7 = runWorker(&#123; start: start7, end: end7 &#125;); // è¦æ±‚æ‰€æœ‰éƒ½resolve return Promise.all([ worker1, worker2, worker3, worker4, worker5, worker6, worker7, ]);&#125;app.get(&quot;/sumofprimeswiththreads&quot;, async (req, res) =&gt; &#123; const startTime = new Date().getTime(); const sum = await divideWorkAndGetSum() .then( ( values //values is an array containing all the resolved values ) =&gt; values.reduce((accumulator, part) =&gt; accumulator + part.result, 0) //reduce is used to sum all the results from the workers ) .then((finalAnswer) =&gt; finalAnswer); const endTime = new Date().getTime(); res.json(&#123; number: 1000000, sum: sum, timeTaken: (endTime - startTime) / 1000 + &quot; seconds&quot;, &#125;);&#125;);app.listen(7777, () =&gt; console.log(&quot;listening on port 7777&quot;)); æ–‡ä»¶ cpuå¯†é›†å‹æ¼”ç¤º_worker_threads_è´¨æ•°åŠ æ€».js : 123456789101112131415161718192021222324import &#123; workerData, parentPort &#125; from &quot;worker_threads&quot;;// workerData å°†æ˜¯ multiThreadServer.js ä¸­ Worker æ„é€ å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°const start = workerData.start;const end = workerData.end;var sum = 0;for (var i = start; i &lt;= end; i++) &#123; for (var j = 2; j &lt;= i / 2; j++) &#123; if (i % j == 0) &#123; break; &#125; &#125; if (j &gt; i / 2) &#123; sum += i; &#125;&#125;parentPort.postMessage(&#123; // å°†ç»“æœæ¶ˆæ¯å‘é€å›çˆ¶è¿›ç¨‹ start: start, end: end, result: sum,&#125;); çœ‹ä¸€ä¸‹è¿è¡Œæ—¶é—´,åªæœ‰ 3 ç§’å¤š","tags":["Node"]},{"title":"Nginx ç®€ä»‹åŠé…ç½® (24-05-15)","path":"/2024/05/15/ã€2024-05-14ã€‘Nginxé…ç½®/","content":"ä»¥å‰å†™è¿‡ä¸€ç¯‡ç±»ä¼¼çš„åšæ–‡ï¼Œä¹‹å‰çš„æ–‡ç« ç°åœ¨çœ‹èµ·æ¥é€»è¾‘æœ‰ç‚¹æ··ä¹±ï¼Œå½“æ—¶ç”¨çš„æ˜¯é˜¿é‡Œäº‘çš„çº¢å¸½å‘è¡Œç‰ˆæœ¬ï¼Œç°åœ¨ç©ºé—´ä¸ç§Ÿäº†ï¼Œæˆ‘ç”¨ Mac ç”µè„‘åˆæŠ˜è…¾äº†ä¸€éï¼Œä¸ºäº†åŠ æ·±å°è±¡ï¼Œæˆ‘æŠŠè¿‡ç¨‹è®°å½•ä¸‹æ¥ã€‚ ç®€ä»‹Nginx æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ HTTP å’Œ reverse proxy æœåŠ¡å™¨ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒé‚®ä»¶ä»£ç†ã€‚ç”±ä¿„ç½—æ–¯ç¨‹åºå‘˜ Igor Sysoev åˆ›å»ºï¼Œç›®çš„ä¸ºäº†è§£å†³ C10k é—®é¢˜ï¼Œå³å¹¶å‘é—®é¢˜ã€‚åœ¨ 2004 å¹´ 8 æœˆ 1 æ—¥é¦–æ¬¡å‘å¸ƒã€‚2019 å¹´ 3 æœˆï¼ŒNginx å·²ç»è¢« F5 å…¬å¸æ”¶è´­ã€‚ Nginx æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ Web æœåŠ¡å™¨ï¼Œå¹¶ä¸”æ”¯æŒåå‘ä»£ç†ï¼Œè´Ÿè½½å‡è¡¡ï¼ŒHTTP ç¼“å­˜ï¼Œå›¾ç‰‡è½¬æ¢ï¼Œé™æ€å†…å®¹åŠ é€Ÿç­‰ã€‚åœ¨æœåŠ¡å™¨å¸‚åœºå æœ‰ç‡è¿„ä»Šä¸ºæ­¢æ˜¯æœ€é«˜çš„ã€‚ å®‰è£… Linux 12sudo apt updatesudo apt install nginx Mac OS 1brew install nginx Windows 12scoop install nginxchoco install nginx docker 1docker pull nginx å¯åŠ¨ Linuxï¼ŒMac OS 1nginx Windows åŒå‡» nginx.exe docker 1docker run -d -p 8080:8080 nginx æµè§ˆå™¨æ‰“å¼€ï¼šlocalhost:8080 éªŒè¯æ˜¯å¦å¯åŠ¨æˆåŠŸï¼š1ps -ef | grep nginx ç¬¬äºŒæ å°±æ˜¯ nginx è¿›ç¨‹çš„ PID 53807 (Master) å’Œ 53808 (Worker) Nginx çš„å·¥ä½œæ¨¡å¼æ˜¯ä¸»è¿›ç¨‹ Master - Worker æ¨¡å¼ï¼Œä¸»è¿›ç¨‹ä¸»è¦å¤åˆ¶è¯»å–å’ŒéªŒè¯é…ç½®æ–‡ä»¶ï¼Œè€Œ Worker å­è¿›ç¨‹è´Ÿè´£å¤„ç†è¯·æ±‚ã€‚ æŸ¥çœ‹ 8080 ç«¯å£å ç”¨æƒ…å†µï¼š 1lsof -i:8080 å¸¸ç”¨å‘½ä»¤ åœæ­¢ï¼Œé‡è½½åŠé‡æ–°æ‰“å¼€æ—¥å¿— 1nging -s &lt;signal&gt; ä¸Šé¢çš„&lt;signal&gt;å¯ä»¥æ˜¯ï¼š stopï¼šåœæ­¢ Nginx quitï¼šé€€å‡º Nginx reloadï¼šé‡è½½ Nginx é…ç½®æ–‡ä»¶ reopenï¼šé‡æ–°æ‰“å¼€ Nginx æ—¥å¿—æ–‡ä»¶ æŸ¥çœ‹ Nginx å„ç§é…ç½®å‚æ•° æŸ¥çœ‹æ‰€æœ‰å‚æ•°ï¼šnginx -Vï¼Œå†çœ‹ --conf-path å‚æ•°çš„å€¼ 123456(base) zyzy:~ $ nginx -Vnginx version: nginx/1.25.5built by clang 15.0.0 (clang-1500.3.9.4)built with OpenSSL 3.2.1 30 Jan 2024 (running with OpenSSL 3.3.0 9 Apr 2024)TLS SNI support enabledconfigure arguments: --prefix=/opt/homebrew/Cellar/nginx/1.25.5 --sbin-path=/opt/homebrew/Cellar/nginx/1.25.5/bin/nginx --with-cc-opt=&#x27;-I/opt/homebrew/opt/pcre2/include -I/opt/homebrew/opt/openssl@3/include&#x27; --with-ld-opt=&#x27;-L/opt/homebrew/opt/pcre2/lib -L/opt/homebrew/opt/openssl@3/lib&#x27; --conf-path=/opt/homebrew/etc/nginx/nginx.conf --pid-path=/opt/homebrew/var/run/nginx.pid --lock-path=/opt/homebrew/var/run/nginx.lock --http-client-body-temp-path=/opt/homebrew/var/run/nginx/client_body_temp --http-proxy-temp-path=/opt/homebrew/var/run/nginx/proxy_temp --http-fastcgi-temp-path=/opt/homebrew/var/run/nginx/fastcgi_temp --http-uwsgi-temp-path=/opt/homebrew/var/run/nginx/uwsgi_temp --http-scgi-temp-path=/opt/homebrew/var/run/nginx/scgi_temp --http-log-path=/opt/homebrew/var/log/nginx/access.log --error-log-path=/opt/homebrew/var/log/nginx/error.log --with-compat --with-debug --with-http_addition_module --with-http_auth_request_module --with-http_dav_module --with-http_degradation_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_realip_module --with-http_secure_link_module --with-http_slice_module --with-http_ssl_module --with-http_stub_status_module --with-http_sub_module --with-http_v2_module --with-http_v3_module --with-ipv6 --with-mail --with-mail_ssl_module --with-pcre --with-pcre-jit --with-stream --with-stream_realip_module --with-stream_ssl_module --with-stream_ssl_preread_module ä¹Ÿå¯ä»¥ç”¨ nginx -tæŸ¥çœ‹ 123(base) zyzy:~ $ nginx -tnginx: the configuration file /opt/homebrew/etc/nginx/nginx.conf syntax is oknginx: configuration file /opt/homebrew/etc/nginx/nginx.conf test is successful ä¸€èˆ¬æ¥è¯´ï¼ŒMac ç³»ç»Ÿè¯¥é…ç½®æ–‡ä»¶åœ¨ /opt/homebrew/etc/nginx/nginx.conf Linux ç³»ç»Ÿè¯¥é…ç½®æ–‡ä»¶åœ¨ /etc/nginx/conf æˆ– /usr/local/etc/nginx é…ç½®è¿™ä¸ªæ˜¯ Nginx çš„é»˜è®¤é…ç½®æ–‡ä»¶ï¼šé»˜è®¤å¾ˆå¤šæ“ä½œæ²¡æœ‰è§£å¼€ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118#user nobody;worker_processes 1;#error_log logs/error.log;#error_log logs/error.log notice;#error_log logs/error.log info;#pid logs/nginx.pid;events &#123; worker_connections 1024;&#125;http &#123; include mime.types; default_type application/octet-stream; #log_format main &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27; # &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27; # &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;; #access_log logs/access.log main; sendfile on; #tcp_nopush on; #keepalive_timeout 0; keepalive_timeout 65; #gzip on; server &#123; listen 8080; server_name localhost; #charset koi8-r; #access_log logs/host.access.log main; location / &#123; root html; index index.html index.htm; &#125; #error_page 404 /404.html; # redirect server error pages to the static page /50x.html # error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; # proxy the PHP scripts to Apache listening on 127.0.0.1:80 # #location ~ \\.php$ &#123; # proxy_pass http://127.0.0.1; #&#125; # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 # #location ~ \\.php$ &#123; # root html; # fastcgi_pass 127.0.0.1:9000; # fastcgi_index index.php; # fastcgi_param SCRIPT_FILENAME /scripts$fastcgi_script_name; # include fastcgi_params; #&#125; # deny access to .htaccess files, if Apache&#x27;s document root # concurs with nginx&#x27;s one # #location ~ /\\.ht &#123; # deny all; #&#125; &#125; # another virtual host using mix of IP-, name-, and port-based configuration # #server &#123; # listen 8000; # listen somename:8080; # server_name somename alias another.alias; # location / &#123; # root html; # index index.html index.htm; # &#125; #&#125; # HTTPS server # #server &#123; # listen 443 ssl; # server_name localhost; # ssl_certificate cert.pem; # ssl_certificate_key cert.key; # ssl_session_cache shared:SSL:1m; # ssl_session_timeout 5m; # ssl_ciphers HIGH:!aNULL:!MD5; # ssl_prefer_server_ciphers on; # location / &#123; # root html; # index index.html index.htm; # &#125; #&#125; include servers/*;&#125; åˆ«çœ‹è¿™ä¹ˆå¤šï¼Œå…¶å®å°± 3 éƒ¨åˆ†å†…å®¹ å…¨å±€å—ï¼šä¾‹å¦‚worker_processesé…ç½® Nginx çš„è¿›ç¨‹æ•°ï¼Œé»˜è®¤ä¸º 1; eventsï¼šäº‹ä»¶éƒ¨åˆ†ï¼Œé…ç½® Nginx çš„äº‹ä»¶å¤„ç†æ–¹å¼ï¼Œå¦‚ worker_processesã€worker_connections ç­‰ httpï¼šHTTP æ¨¡å—éƒ¨åˆ†ï¼Œé…ç½® Nginx çš„ HTTP æ¨¡å—ï¼Œå¦‚ serverã€location ç­‰ worker_processesæˆ‘ä»¬å¯ä»¥é…ç½®è¯¥å‚æ•°ä¸º autoï¼Œè¿™æ ·å°±èƒ½è‡ªåŠ¨åŒ¹é…ç”µè„‘åº”æœ‰çš„æ ¸å¿ƒæ•°ã€‚ è¿™é‡Œæˆ‘æ•…æ„æŠŠé…ç½®å†™é”™ï¼šworker_processes 10ï¼Œå°¾éƒ¨æ²¡åŠ ;ï¼Œè¿è¡Œ nginx -tï¼Œèƒ½å¸®æˆ‘ä»¬è‡ªå¸¦æ£€æŸ¥è¯¥æ–‡ä»¶é”™è¯¯ï¼š 123(base) zyzy:1.25.5 (master) $ nginx -tnginx: [emerg] directive &quot;worker_processes&quot; is not terminated by &quot;;&quot; in /opt/homebrew/etc/nginx/nginx.conf:12nginx: configuration file /opt/homebrew/etc/nginx/nginx.conf test failed æ¯æ¬¡ä¿®æ”¹å®Œæˆåï¼Œnginx -s reload é‡æ–°åŠ è½½ nginx.conf æ–‡ä»¶ æ”¹ä¸º auto åï¼Œè·‘ ps -ef | grep nginxï¼Œå‘ç° nginx è¿›ç¨‹æ•°å˜ä¸º 8 ä¸ªï¼Œä»£è¡¨æˆ‘ç”¨çš„ mac ç”µè„‘æœ‰ 8 æ ¸ï¼Œå¦‚ä¸‹å›¾ï¼š eventsworker_connectionsï¼šé…ç½® Nginx çš„æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º 1024multi_acceptï¼šæ˜¯å¦å…è®¸åŒæ—¶æ¥å—å¤šä¸ªè¿æ¥ï¼Œé»˜è®¤ä¸º offï¼Œè¡¨ç¤ºåªæ¥å—ä¸€ä¸ªè¿æ¥ï¼Œå¦‚æœä¸º onï¼Œåˆ™è¡¨ç¤ºå…è®¸åŒæ—¶æ¥å—å¤šä¸ªè¿æ¥ httpè¿™ä¸ªæ˜¯è¢«ä¿®æ”¹å¾—æœ€å¤šçš„æ¨¡å— include mime.typesï¼šåŒ…å« Nginx èƒ½å¤„ç†æ–‡ä»¶ç±»å‹ï¼Œé»˜è®¤ä¸ºè·¯å¾„ä¸ºï¼š /opt/homebrew/etc/nginx/mime.types serveråœ¨ http æ¨¡å—ä¸‹ï¼ŒåŒ…å«å¤šä¸ª server æ¨¡å—ï¼Œæ¯ä¸ª server æ¨¡å—ä»£è¡¨ä¸€ä¸ªè™šæ‹Ÿä¸»æœºã€‚ ä¿®æ”¹é»˜è®¤çš„ HTML é™æ€é¡µé¢éƒ¨ç½²ä¸€ä¸ªé™æ€ç«™ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ä»¥ä¸‹é…ç½®ä¿®æ”¹å¯¹åº”çš„ html æ–‡ä»¶ï¼š 1234location / &#123; root html; index index.html index.htm;&#125; location /ï¼šè¡¨ç¤ºåŒ¹é…æ‰€æœ‰è¯·æ±‚ï¼Œrootï¼šè¡¨ç¤ºé™æ€èµ„æºæ–‡ä»¶å­˜æ”¾çš„ç›®å½•ï¼Œindexï¼šè¡¨ç¤ºé»˜è®¤é¦–é¡µï¼Œé»˜è®¤ä¸º index.html é‚£å°±å»æ‰¾è¿™ä¸ª html æ–‡ä»¶å¤¹ï¼Œå¯ç”¨ nginx -V æ‰¾åˆ° --prefix=/opt/homebrew/Cellar/nginx/1.25.5å­—æ®µï¼Œèƒ½æ‰¾åˆ° Nginx çš„å®‰è£…è·¯å¾„ 1234567891011121314151617(base) zyzy:~ $ cd /opt/homebrew/Cellar/nginx/1.25.5(base) zyzy:1.25.5 (master) $ lltotal 680-rw-r--r-- 1 ziyouzhiyi admin 319K 4 16 22:37 CHANGES-rw-r--r-- 1 ziyouzhiyi admin 1.3K 5 14 10:49 INSTALL_RECEIPT.json-rw-r--r-- 1 ziyouzhiyi admin 1.4K 4 16 22:37 LICENSE-rw-r--r-- 1 ziyouzhiyi admin 49B 4 16 22:37 READMEdrwxr-xr-x 3 ziyouzhiyi admin 96B 5 14 10:49 bin-rw-r--r-- 1 ziyouzhiyi admin 685B 5 14 10:49 homebrew.mxcl.nginx.plist-rw-r--r-- 1 ziyouzhiyi admin 202B 5 14 10:49 homebrew.nginx.servicelrwxr-xr-x 1 ziyouzhiyi admin 16B 5 14 10:49 html -&gt; ../../../var/wwwdrwxr-xr-x 4 ziyouzhiyi admin 128B 4 16 22:37 share(base) zyzy:1.25.5 (master) $ ls -ld $(readlink html)drwxr-xr-x 4 ziyouzhiyi admin 128 2 15 00:03 ../../../var/www(base) zyzy:1.25.5 (master) $ cd html(base) zyzy:html (master) $ ls50x.html index.html å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ï¼Œhtml ä¸ä»…ä»…æ˜¯ä¸€ä¸ªè½¯é“¾æ¥ï¼Œä»–è¿˜æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ŒLinux å’Œ MacOS éƒ½å¯ä»¥å°†æ–‡ä»¶å¤¹ä½œä¸ºè½¯é“¾æ¥ï¼Œè¿™æ ·å¯ä»¥é¿å…ç§»åŠ¨æ–‡ä»¶å¤¹ã€‚ æˆ‘ä»¬æ”¹åŠ¨ index.htmlï¼Œç„¶å nginx -s reload é‡æ–°åŠ è½½é…ç½®ï¼Œå¯ä»¥çœ‹åˆ°æµè§ˆå™¨çš„é¡µé¢å·²ç»ä¿®æ”¹ï¼š 123(base) zyzy:1.25.5 (master) $ cd html(base) zyzy:html (master) $ ls50x.html index.html location / ä¸‹çš„ root æŒ‡å®š include servers/*;ï¼šè¡¨ç¤ºå°† servers ç›®å½•ä¸‹çš„æ‰€æœ‰é…ç½®æ–‡ä»¶åŒ…å«è¿›æ¥ åå‘ä»£ç†åŠè´Ÿè½½å‡è¡¡å†™ä¸€ä¸ªæœ€ç®€å•çš„ node http æœåŠ¡ index.js 123456789101112const http = require(&quot;http&quot;);const PORT = 3000;const server = http.createServer((req, res) =&gt; &#123; res.writeHead(200, &#123; &quot;Content-Type&quot;: &quot;text/html&quot; &#125;); res.write(`&lt;h1&gt;Node.js web server! Port: $&#123;PORT&#125;&lt;/h1&gt;`); res.end();&#125;);server.listen(PORT, () =&gt; &#123; console.log(`Server is running on port $&#123;PORT&#125;`);&#125;); æˆ‘ä»¬å°†å…¶å¤åˆ¶ 2 ä»½ï¼Œç«¯å£å·åˆ†åˆ«æ”¹ä¸º 3020 å’Œ 3030ï¼Œæ–‡ä»¶åæ”¹ä¸º index-3000.jsï¼Œindex-3020.jsï¼Œindex-3030.jsï¼Œåˆ†åˆ«è·‘èµ·æ¥ï¼Œé¡µé¢localhost:3000ã€localhost:3020ã€localhost:3030 éƒ½èƒ½æ‰“å¼€ã€‚ å†ä¿®æ”¹ nginx.confï¼Œæ·»åŠ åå‘ä»£ç†é…ç½®ï¼šhttp æ¨¡å—ä¸­æ·»åŠ  upstreamåå‘ä»£ç†å­—æ®µ, server æ¨¡å—ä¸­æ·»åŠ  proxy_passå­—æ®µï¼Œå¦‚ä¸‹ï¼š 12345678910111213141516http &#123; # å…¶ä»–é…ç½®ã€‚ã€‚ã€‚ upstream backend &#123; server 127.0.0.1:3000; server 127.0.0.1:3010; server 127.0.0.1:3020; &#125; server &#123; location /app &#123; # backendå­—æ®µå¯¹åº”ä¸Šé¢upstreamçš„backendå­—æ®µ proxy_pass http://backend; &#125; &#125;&#125; é‡è½½ nginx -s reloadï¼Œç„¶åè®¿é—® localhost:8080/appï¼Œå†ä¸æ–­åˆ·æ–°ï¼Œé¡µé¢æ˜¾ç¤ºå¦‚ä¸‹ï¼Œåå‘ä»£ç†æˆåŠŸï¼š è¯·æ±‚ç­–ç•¥ weight upstream å­—æ®µä¸‹çš„ ip åœ°å€ï¼Œå¯ä»¥æ·»åŠ æƒé‡ weightï¼Œå¦‚ï¼š 12345upstream backend &#123; server 127.0.0.1:3000 weight=3; server 127.0.0.1:3010; server 127.0.0.1:3020;&#125; è¿™æ ·ï¼Œæˆ‘ä»¬å¤šæ•°çš„è¯·æ±‚å°±ä¼šåˆ†é…åˆ°ç«¯å£ä¸º 3000 çš„æœåŠ¡å™¨ä¸Šï¼Œ3000 çš„è¯·æ±‚æ•°é‡å°±ä¼šæ˜¯å…¶ä½™ä¸¤ä¸ªçš„ 3 å€ã€‚ ip_hash 123456upstream backend &#123; ip_hash; server 127.0.0.1:3000; server 127.0.0.1:3010; server 127.0.0.1:3020;&#125; ip_hashï¼šæ ¹æ®å®¢æˆ·ç«¯çš„ IP åœ°å€è¿›è¡Œå“ˆå¸Œï¼ŒåŒä¸€ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚ä¼šåˆ†é…åˆ°åŒä¸€ä¸ªæœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·ä¸»è¦æ˜¯è§£å†³ session å‘½ä¸­çš„é—®é¢˜ã€‚ SSL é…ç½®HTTPS çš„å®‰å…¨å±‚æ­£æ•°ï¼Œå¯ä»¥åœ¨ä¸»æµçš„äº‘å¹³å°ç”³è¯·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±åˆ¶ä½œè¯ä¹¦ ç”Ÿæˆå¯†é’¥å’Œè¯ä¹¦123openssl genrsa -out private.key 2048openssl req -new -key private.key -out cert.csropenssl x509 -req -in cert.csr -out cacert.pem -signkey private.key -days 3650 æŒ‰ç…§ä»¥ä¸Šå‘½ä»¤ç”Ÿæˆäº† cacert.pem(è¯ä¹¦) å’Œ private.key(ç§é’¥) ä¸¤ä¸ªæ–‡ä»¶ã€‚å°†ä¸¤ä¸ªæ–‡ä»¶ç§»åŠ¨åˆ° /opt/homebrew/etc/nginx/ ç›®å½•ä¸‹ 1(base) zyzy:1.25.5 (master) $ mv cacert.pem private.key /opt/homebrew/etc/nginx/ é…ç½® nginx.conf å¦‚ä¸‹ï¼š12345678910111213141516171819server &#123; # sslè¯ä¹¦é»˜è®¤443ç«¯å£ï¼š listen 443 ssl; server_name localhost; # ä»¥ä¸‹å†™æ³•å›ºå®šï¼š # è¯ä¹¦æ–‡ä»¶åç§°ï¼š ssl_certificate /opt/homebrew/etc/nginx/cacert.pem; # ç§é’¥æ–‡ä»¶åç§°ï¼š ssl_certificate_key /opt/homebrew/etc/nginx/private.key; # ssléªŒè¯ï¼š ssl_session_timeout 5m; # ç¼“å­˜æœ‰æ•ˆæœŸ # å®‰å…¨é“¾æ¥å¯é€‰çš„åŠ å¯†åè®®ï¼š ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # åŠ å¯†å¥—ä»¶/åŠ å¯†ç®—æ³•ï¼Œå†™æ³•éµå¾ª opensslçš„æ ¼å¼ï¼š ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; # ä½¿ç”¨æœåŠ¡ç«¯çš„é¦–é€‰ç®—æ³•ï¼š ssl_prefer_server_ciphers on;&#125; å½“æˆ‘ä»¬è®¿é—® localhost:8080ï¼Œä¼šå‘ç° chrome æµè§ˆå™¨ä¼šæç¤ºæˆ‘ä»¬ä¸å®‰å…¨ï¼Œè¿™æ˜¯å› ä¸ºè¯ä¹¦æ˜¯æˆ‘ä»¬è‡ªå·±åˆ¶ä½œçš„ï¼Œå¹¶éæœºæ„é¢å‘ï¼Œæˆ‘ä»¬é€‰æ‹©ç»§ç»­è®¿é—®ï¼Œå¹¶åœ¨è¿™é‡Œå¯ä»¥ç‚¹å¼€æŸ¥çœ‹æˆ‘ä»¬åˆšåˆšè¾“å…¥çš„è¯ä¹¦ä¿¡æ¯ï¼š ç‚¹å‡»çœ‹åˆ°è¯ä¹¦ï¼š é…ç½®é‡å®šå‘å¯ä»¥å°† http çš„è®¿é—®é‡å®šå‘åˆ°æˆ‘ä»¬çš„ https ç«¯å£ä¸Š 12345server &#123; listen 8080; server_name localhost; return 301 https://$host$request_uri;&#125; å¦‚æœæœ‰é…ç½®åŸŸåï¼Œåˆ™æ”¹ä¸ºå¦‚ä¸‹ï¼š 12345server &#123; listen 8080; server_name zyzy.info; return 301 https://$server_name$request_uri;&#125; è™šæ‹Ÿä¸»æœºåœ¨ç½‘ç«™åˆæœŸï¼Œè®¿é—®é‡è¾ƒå°ï¼Œä¸€ä¸ªæœåŠ¡å™¨é…ç½®å¤šä¸ªæœåŠ¡å¯ä»¥èŠ‚çœèµ„æºï¼Œè¿™ç§å¤šæœåŠ¡å™¨é…ç½®ç§°ä¸ºè™šæ‹Ÿä¸»æœºï¼Œä¸‹é¢æˆ‘ä»¬æ¥å®ç° server ç‹¬ç«‹é…ç½®æˆ‘ä»¬å°† /opt/homebrew/etc/nginx/nginx.conf ä¸‹ä¸Šé¢é…ç½®å¥½çš„ serverå•ç‹¬å‰ªåˆ‡å‡ºæ¥ï¼Œæ–°å»ºä¸€ä¸ª localhost.conf æ–‡ä»¶ï¼Œæ”¾åˆ° /opt/homebrew/etc/nginx/server ä¸‹ï¼Œ é‡è½½ nginx -s reloadï¼Œæµè§ˆå™¨æ‰“å¼€å‘ç°ç½‘ç«™æ­£å¸¸è¿è¡Œï¼Œè¯´æ˜ server ç›®å½•å¯ä»¥å­˜æ”¾å¤šä¸ªè™šæ‹Ÿä¸»æœºçš„é…ç½®æ–‡ä»¶ã€‚ /nginx/serverä¸‹åˆ›å»ºå…¶ä»–æœåŠ¡åˆ›å»ºå‰ç«¯ SPA é¡µé¢ç»“åˆçš„ SPA é¡¹ç›®ï¼Œæˆ‘ä»¬ç”¨ vite ç”Ÿæˆä¸€ä¸ª react é¡¹ç›®ï¼Œ 1234npm create vite@latest demo-project -- --template reactcd vite_reactnpm installnpm run build è¿›å…¥ dist ç›®å½•ï¼Œå¤åˆ¶è·¯å¾„ï¼š 12(base) zyzy:dist $ pwd/Users/ziyouzhiyi/servers/demo-project/dist åˆ›å»ºserver æ¨¡å—æˆ‘ä»¬åœ¨ /opt/homebrew/etc/nginx/server ç›®å½•ä¸‹å†™ä¸€ä¸ª vite_react.conf é…ç½®æ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹ï¼šå°†ä¸Šé¢/Users/ziyouzhiyi/servers/demo-project/dist è·¯å¾„é…ç½®å¦‚ä¸‹ï¼š 123456789server &#123; listen 5173; server_name vite_react; location / &#123; root /Users/ziyouzhiyi/servers/demo-project/dist; index index.html index.htm; &#125;&#125; é‡è½½ nginx -s reload æ£€éªŒé…ç½®è®¿é—® localhost:5173ï¼Œé¡µé¢æ­£å¸¸æ˜¾ç¤ºï¼Œè¯´æ˜é…ç½®æˆåŠŸã€‚é¡µé¢è®¿é—®ï¼šhttp://localhost:5173/ï¼Œå¦‚ä¸‹ï¼š ä¸Šé¢çš„é¡µé¢è¿˜æ²¡é…ç½® sslï¼Œæˆ‘ä»¬æŠŠä»–æ”¹æˆ https è®¿é—®ï¼Œå°† localhost.confï¼Œçš„é…ç½®ç²˜è¿‡æ¥ï¼Œæ”¹åŠ¨å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223server &#123; listen 5173 ssl; server_name vite_react; # è¯ä¹¦æ–‡ä»¶åç§°ï¼š ssl_certificate /opt/homebrew/etc/nginx/cacert.pem; # ç§é’¥æ–‡ä»¶åç§°ï¼š ssl_certificate_key /opt/homebrew/etc/nginx/private.key; # ä»¥ä¸‹é…ç½®å›ºå®šï¼š # ssléªŒè¯ï¼š ssl_session_timeout 5m; # ç¼“å­˜æœ‰æ•ˆæœŸ # å®‰å…¨é“¾æ¥å¯é€‰çš„åŠ å¯†åè®®ï¼š ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # åŠ å¯†å¥—ä»¶/åŠ å¯†ç®—æ³•ï¼Œå†™æ³•éµå¾ª opensslçš„æ ¼å¼ï¼š ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE; # ä½¿ç”¨æœåŠ¡ç«¯çš„é¦–é€‰ç®—æ³•ï¼š ssl_prefer_server_ciphers on; location / &#123; root /Users/ziyouzhiyi/servers/demo-project/dist; index index.html index.htm; &#125;&#125;","tags":["Nginx"]},{"title":"Vue3 æ–°ç‰¹æ€§ä¸€è§ˆ","path":"/2024/05/04/ã€2024-05-04ã€‘Vue3 learn/","content":"æœ€è¿‘å­¦ä¹  Vue3, è¿™é‡Œåšä¸ªç®€å•çš„è®°å½•ï¼ŒVue3 åœ¨ Vue2 çš„å‡çº§ï¼Œè¯­æ³•å’Œ API éƒ½å‘ç”Ÿäº†å˜åŒ–ã€‚ä¸‹é¢å°±ä¸€äº›æ–°å¢çš„ APIï¼Œå†™ä¸€äº›ç®€å•çš„ demo è¿›è¡Œè®°å½•ã€‚ åˆ›å»ºé¡¹ç›®vue3 åˆ›å»ºé¡¹ç›®ï¼Œä½¿ç”¨ Vite è„šæ‰‹æ¶ã€‚æ”¾å¼ƒäº†åŸæ¥çš„ vue-cliã€‚ 12# è·Ÿç€cliçš„æç¤ºä¸€æ­¥æ­¥åˆ›å»ºå³å¯ï¼šnpm init vite@latest æˆ‘å°è¯•ç€åˆ é™¤ src ç›®å½•ï¼Œé‡æ–°æ–°å»ºä¸€ä¸ª src ç›®å½•ï¼Œè‡ªå·±å†™ä¸€ä¸ª src/main.ts å’Œ src/App.vueã€‚ ä¼šå‘ç° ts æ£€æŸ¥åœ¨ App.vue ä¸­æŠ¥é”™ã€‚è¿™æ—¶å› ä¸º ts çš„æ£€æŸ¥ä¸­ï¼Œä¸è®¤è¯†.vue æ–‡ä»¶ï¼Œéœ€è¦é…ç½® env.d.tsæ–‡ä»¶ã€‚cmd (Mac)/ctrl (Windows) + å·¦é”®ç‚¹å‡»ä¸‹é¢çš„ &quot;vite/client&quot; è·¯å¾„ 1/// &lt;reference types=&quot;vite/client&quot; /&gt; ä¼šè·³è½¬åˆ° vite/client æ–‡ä»¶ï¼Œæ·»åŠ ï¼š 12345declare module &quot;*.vue&quot; &#123; import &#123; ComponentOptions &#125; from &quot;vue&quot;; const componentOptions: ComponentOptions; export default componentOptions;&#125; å³å¯ Vue3 å…¥å£æ–‡ä»¶ä¸€äº›æ¦‚å¿µ Vite é¡¹ç›®ä¸­ï¼Œindex.html æ˜¯é¡¹ç›®çš„å…¥å£æ–‡ä»¶ï¼Œåœ¨é¡¹ç›®æœ€å¤–å±‚ã€‚ åŠ è½½ index.html åï¼ŒVite è§£æ &lt;script type=&quot;module&quot; src=&quot;xxx&quot;&gt;æŒ‡å›çš„ Javascript Vue3 ä¸­æ˜¯é€šè¿‡createAppå‡½æ•°åˆ›å»ºä¸€ä¸ªåº”ç”¨å®ä¾‹ã€‚ Options API å’Œ Composition APIVue2 å±äº Option API (é…ç½®é€‰é¡¹å¼ API)ï¼ŒVue3 å±äº Composition APIï¼ˆç»„åˆå¼ APIï¼‰ï¼Œæˆ‘æ„¿æ„ç§°ä»–ä¸ºåŠŸèƒ½æ€§ç»„åˆ APIã€‚ éšç€ Vue2 é‡Œçš„å„ä¸ªç»„ä»¶è¶Šæ¥è¶Šå¤æ‚ï¼Œé…ç½®å¼ API ç¼ºç‚¹éå¸¸æ˜æ˜¾ï¼Œæ‰€æœ‰çš„å€¼æ•£è½åœ¨è¯¸å¦‚ data(), methods(), computed(), watch()ç­‰ç­‰æ–¹æ³•ä¸­ï¼Œä¿®æ”¹ä¸€å¤„æœ‰å¯èƒ½è¦ä¿®æ”¹å¤šå¤„ã€‚ æ¯”èµ·åŸæ¥ Options APIï¼ˆä¾‹å¦‚ï¼šdata(),methods()ï¼‰ï¼Œsetupæœ‰ä¸¤ä¸ªç‰¹ç‚¹ï¼š ä¸€ä¸ª vue æ–‡ä»¶å¯ä»¥åŒæ—¶å…·å¤‡ data(), methods() ç­‰ Vue2 çš„åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥åŒæ—¶å…·å¤‡ setup()å†™æ³•çš„ Vue3 åŠŸèƒ½ã€‚ setup() å‡½æ•°ä¸­ï¼Œä¸èƒ½å†ä½¿ç”¨ thisã€‚è€Œä¸”setupæ˜¯æœ€æ—©çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚æ‰€ä»¥ data() å’Œ methods() å‡½æ•°ä¸­ï¼Œå¯ä»¥è®¿é—® setup() å‡½æ•°ä¸­å®šä¹‰çš„å˜é‡ã€‚ä½† setup() å‡½æ•°ä¸­ï¼Œä¸èƒ½è®¿é—® data() å’Œ methods() å‡½æ•°ä¸­å®šä¹‰çš„å˜é‡ã€‚ setup()è¿™ä¸ªæ˜¯ Vue3 è¿½èµ¶ React å‡½æ•°å¼ç¼–ç¨‹çš„æ–°æ¦‚å¿µï¼Œåœ¨ Vue2 é‡Œï¼Œsetupæ™®é€šçš„å†™æ³•ï¼Œä»–æ˜¯æ‰§è¡Œåœ¨ç”Ÿå‘½å‘¨æœŸé‡Œçš„ beforeCreate é˜¶æ®µä¹‹å‰çš„å‡½æ•°ï¼Œå› æ­¤ï¼ŒVue3 å°† setupå‡½æ•°æå‡åˆ°ä¸€ä¸ªæ–°çš„é«˜åº¦ã€‚ 12345&lt;script&gt; export default &#123; setup() &#123;&#125;, &#125;;&lt;/script&gt; è¯­æ³•ç³– &lt;script setup lang=&quot;ts&quot;&gt;é‰´äº setup()çš„ç‰¹æ®Šæ€§ï¼ŒVue3 å°†å…¶ç‹¬ç«‹ä¸ºä¸€ä¸ªè¯­æ³•ç³–çš„å†™æ³•ï¼Œå°†å…¶æ•´åˆè¿› &lt;script lang=&quot;ts&quot; setup&gt; é‡Œï¼Œä¸‹é¢æ˜¯ vue3 App.vue æ–‡ä»¶çš„ setup æ”¹æ³•ï¼š 12345678&lt;template&gt; &lt;ChildComp /&gt;&lt;/template&gt;&lt;script setup lang=&quot;ts&quot;&gt; // ç›´æ¥å¯¼å‡ºå­ç»„ä»¶å³å¯ï¼Œçœç•¥ export default import ChildComp from &quot;./components/WatchEffectDemo.vue&quot;;&lt;/script&gt; setupæ’ä»¶: VueSetupExtend å¢å¼º script æ ‡ç­¾ç”¨æ³•1npm i vite-plugin-vue-setup-extend -D vite.config.ts é…ç½®ï¼šplugins ä¸­æ·»åŠ  VueSetupExtend()ï¼Œå¦‚ï¼š 123456789101112131415import &#123; fileURLToPath, URL &#125; from &quot;node:url&quot;;import &#123; defineConfig &#125; from &quot;vite&quot;;import vue from &quot;@vitejs/plugin-vue&quot;;import VueSetupExtend from &quot;vite-plugin-vue-setup-extend&quot;;// https://vitejs.dev/config/export default defineConfig(&#123; plugins: [vue(), VueSetupExtend()], resolve: &#123; alias: &#123; &quot;@&quot;: fileURLToPath(new URL(&quot;./src&quot;, import.meta.url)), &#125;, &#125;,&#125;); ref å’Œ reactiveï¼Œå°†æ•°å˜ä¸ºå“åº”å¼è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼š 12345678910111213141516171819202122232425262728293031323334&lt;template&gt; &lt;div class=&quot;car&quot;&gt; &lt;h2&gt;&#123;&#123; car.brand &#125;&#125; -&gt; &#123;&#123; car.price &#125;&#125;å…ƒ&lt;/h2&gt; &lt;button @click=&quot;addPrice&quot;&gt;ä¿®æ”¹ä»·æ ¼+10ä¸‡&lt;/button&gt; &lt;button @click=&quot;minusPrice&quot;&gt;ä¿®æ”¹ä»·æ ¼-1ä¸‡&lt;/button&gt; &lt;button @click=&quot;changeCarByReactive&quot;&gt;ä¿®æ”¹æ•´è½¦by reactive&lt;/button&gt; &lt;/div&gt; &lt;div&gt; &lt;h2&gt;&#123;&#123; car2.brand &#125;&#125; -&gt; &#123;&#123; car2.price &#125;&#125;å…ƒ&lt;/h2&gt; &lt;button @click=&quot;changeCarByRef&quot;&gt;ä¿®æ”¹æ•´è½¦by ref&lt;/button&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup name=&quot;Car12&quot;&gt; import &#123; ref, reactive, toRefs &#125; from &quot;vue&quot;; let car = reactive(&#123; brand: &quot;Toyota&quot;, price: 200000 &#125;); // å¦‚æœè¦è§£æ„ï¼Œå¿…é¡»ç”¨toRefså¥—ä¸Šï¼Œå¦åˆ™é¡µé¢æ— æ³•å“åº” let &#123; price &#125; = toRefs(car); const addPrice = () =&gt; (price.value += 100000); // å¦‚æœåªä¿®æ”¹æŸä¸€ä¸ªå±æ€§ï¼Œç”¨.è¯­æ³•ä¿®æ”¹ const minusPrice = () =&gt; (car.price -= 10000); const changeCarByReactive = () =&gt; &#123; // å¦‚æœæ¶‰åŠæ•´ä¸ªå¯¹è±¡ä¿®æ”¹è¿‡ï¼Œå¿…é¡»ç”¨Object.assign Object.assign(car, &#123; brand: &quot;Audi&quot;, price: 300000 &#125;); &#125;; let car2 = ref(&#123; brand: &quot;Benz&quot;, price: 800000 &#125;); const changeCarByRef = () =&gt; &#123; // å¦‚æœæ”¹ç”¨refï¼Œå¿…é¡»ç”¨valueä¿®æ”¹ï¼Œè€Œä¸”.valueå°±æ˜¯å“åº”å¼ï¼Œé¡µé¢å¯ä»¥å®æ—¶å‘ˆç° car2.value = &#123; brand: &quot;Audi&quot;, price: 300000 &#125;; &#125;;&lt;/script&gt; ref å¯ä»¥åŒ…è£¹ä»»æ„æ•°æ®ç±»å‹ï¼Œä½œä¸ºå“åº”å¼æ•°æ®ï¼Œå¹¶å®æ—¶ä¿®æ”¹è§†å›¾çš„å€¼ è¢« ref åŒ…è£¹çš„æ•°æ®ï¼Œå¦‚æœè¦æ›´æ”¹é¡µé¢çš„å€¼ï¼Œå¿…é¡»ç”¨ .value ä¿®æ”¹ã€‚ä¾‹å¦‚ä¾‹å­ä¸­çš„ï¼šcar2.value = &#123; brand: &quot;Audi&quot;, price: 300000 &#125;; reactive åªèƒ½ç”¨æ¥åŒ…è£¹ä¸€ä¸ªå¯¹è±¡ï¼Œä½œä¸ºå“åº”å¼æ•°æ®ã€‚ è¢« reactive åŒ…è£¹çš„å¯¹è±¡ï¼Œå¦‚æœè¦æ•´ä½“ä¿®æ”¹ï¼Œå¿…é¡»ç”¨ Object.assign ä¿®æ”¹ã€‚ä¾‹å¦‚ä¾‹å­ä¸­çš„: Object.assign(car, &#123; brand: &quot;Audi&quot;, price: 300000 &#125;); å¦‚æœé‡åˆ°è§£æ„ï¼Œå¿…é¡»ç”¨toRefs åŒ…è£¹æ™®é€šå¯¹è±¡ï¼Œä½¿å…¶å˜ä¸ºå“åº”å¼å¯¹è±¡ï¼Œè¦ä¸é¡µé¢ä¸Šçš„å“åº”å¼æ•°æ®å°±ä¸ä¼šæ›´æ–°ã€‚ä¾‹å¦‚ä¾‹å­ä¸­çš„ï¼šlet &#123; price &#125; = toRefs(car); computed è®¡ç®—å±æ€§computed æ˜¯ä¸€ä¸ªè®¡ç®—å±æ€§ï¼Œå®ƒä¾èµ–å…¶ä»–æ•°æ®ï¼Œå½“ä¾èµ–çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè®¡ç®—å±æ€§ä¼šé‡æ–°è®¡ç®—ã€‚è¿™æ˜¯æˆ‘ä»¬åœ¨ Vue2 ä¸­ç»å¸¸ä½¿ç”¨çš„ã€‚ ä½†æ˜¯ Vue3 ä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨computedè‡ªå¸¦çš„ getter å’Œ setter æ¥å®ç°è®¡ç®—å±æ€§çš„è·å–å’Œä¿®æ”¹ã€‚ 1234567891011121314151617181920212223242526272829303132333435&lt;template&gt; &lt;div class=&quot;person&quot;&gt; å…¨åï¼š&lt;span&gt;è¿™ä¸ªæ˜¯è®¡ç®—å±æ€§è®¡ç®—å‡ºæ¥çš„å…¨åï¼š&#123;&#123; fullName &#125;&#125;&lt;/span&gt; &lt;button @click=&quot;changeFullName&quot;&gt;ç‚¹å‡»ä¿®æ”¹å§“åä¸ºLi si&lt;/button&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup name=&quot;Person&quot;&gt; import &#123; ref, computed &#125; from &quot;vue&quot;; let firstName = ref(&quot;zhang&quot;); let lastName = ref(&quot;san&quot;); // ä¼ ç»Ÿvue2ï¼Œè®¡ç®—å±æ€§æ˜¯åªè¯»å±æ€§ï¼Œé¡µé¢ä¸Šå¹¶ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼š // const fullName = computed( // () =&gt; // `$&#123;firstName.value.slice(0, 1).toUpperCase()&#125;$&#123;firstName.value.slice(1)&#125; - $&#123;lastName.value&#125;` // ) // vue3çš„fullNameè®¡ç®—å±æ€§ï¼Œå¯è¯»å¯å†™ï¼šç”¨setterï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹ const fullName = computed(&#123; get() &#123; return `$&#123;firstName.value .slice(0, 1) .toUpperCase()&#125;$&#123;firstName.value.slice(1)&#125; - $&#123;lastName.value&#125;`; &#125;, set(val) &#123; const [f, l] = val.split(&quot;-&quot;); firstName.value = f; lastName.value = l; &#125;, &#125;); const changeFullName = () =&gt; (fullName.value = &quot;li-si&quot;);&lt;/script&gt; watch ç›‘è§†watch æ˜¯ä¸€ä¸ªç›‘å¬å™¨ï¼Œå®ƒç›‘å¬æŸä¸ªæ•°æ®ï¼Œå½“æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°ã€‚watch ç›‘å¬çš„æ•°æ®å¯ä»¥æ˜¯ä¸€ä¸ªå“åº”å¼æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ™®é€šæ•°æ®ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455&lt;template&gt; &lt;div class=&quot;person&quot;&gt; &lt;h2&gt;å§“åï¼š&#123;&#123; person.name &#125;&#125;&lt;/h2&gt; &lt;h2&gt;æ±½è½¦ï¼š&#123;&#123; person.car.c1 &#125;&#125; &#123;&#123; person.car.c2 &#125;&#125;&lt;/h2&gt; &lt;button @click=&quot;changeName&quot;&gt;æ”¹å&lt;/button&gt; &lt;button @click=&quot;changeCar1&quot;&gt;æ”¹ç¬¬ä¸€å°ğŸš—&lt;/button&gt; &lt;button @click=&quot;changeCar2&quot;&gt;æ”¹ç¬¬äºŒå°ğŸš—&lt;/button&gt; &lt;button @click=&quot;changeCars&quot;&gt;æ”¹æ‰€æœ‰ğŸš—&lt;/button&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; reactive, watch &#125; from &quot;vue&quot;; let person = reactive(&#123; name: &quot;å¼ ä¸‰&quot;, car: &#123; c1: &quot;å¥”é©°&quot;, c2: &quot;å®é©¬&quot;, &#125;, &#125;); const changeName = () =&gt; (person.name += &quot;~&quot;); const changeCar1 = () =&gt; (person.car.c1 = &quot;audi&quot;); const changeCar2 = () =&gt; (person.car.c2 = &quot;Toyota&quot;); const changeCars = () =&gt; (person.car = &#123; c1: &quot;byd&quot;, c2: &quot;yy&quot; &#125;); // reactiveç›‘è§†å±æ€§æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»å†™ä¸ºå‡½æ•°è¿”å›ç±»å‹ï¼Œå¦åˆ™æŠ¥é”™ watch( () =&gt; person.name, (newValue, oldValue) =&gt; &#123; console.log(&quot;newValue&quot;, newValue); console.log(&quot;oldValue&quot;, oldValue); &#125; ); // ç›‘è§†çš„reactiveå¯¹è±¡å±æ€§ä¹Ÿæ˜¯objæ—¶ // å¦‚æœè¦ç›‘è§†é™¤è¯¥ watch( () =&gt; person.car, (newValue, oldValue) =&gt; &#123; console.log(&quot;newValue&quot;, newValue); console.log(&quot;oldValue&quot;, oldValue); &#125;, // åŠ ä¸Šdeepï¼štrueï¼Œå¯ä»¥ç›‘è§†ä»»æ„personå¯¹è±¡é‡Œçš„ç»†å¾®å˜åŒ– &#123; deep: true &#125; ); // ç›‘è§†å¤šä¸ªå±æ€§ watch([() =&gt; person.name, () =&gt; person.car.c1], (newValue, oldValue) =&gt; &#123; console.log(&quot;newValue&quot;, newValue); console.log(&quot;oldValue&quot;, oldValue); &#125;);&lt;/script&gt;&lt;style scoped&gt;&lt;/style&gt; å’Œ watch ç­‰ä»·çš„ï¼Œæœ‰å¦ä¸€ä¸ª api watchEffectï¼Œå®ƒæ›´æ™ºèƒ½ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°é‡Œå¯ä»¥å†™å¼‚æ­¥ä»£ç ï¼Œå½“å‡½æ•°æ‰§è¡Œæ—¶ï¼Œä¼šè‡ªåŠ¨æ”¶é›†ä¾èµ–ï¼Œå½“ä¾èµ–çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šé‡æ–°æ‰§è¡Œå‡½æ•°ã€‚ ä¸‹é¢å†™ä¸€ä¸ª demo å®ç°ï¼šä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç›‘æµ‹æ°´æ¸©å’Œæ°´ä½çš„ä¾‹å­ï¼Œå½“æ°´æ¸©è¾¾åˆ°æˆ–è¶…è¿‡ 60â„ƒï¼Œæˆ–è€…æ°´ä½è¾¾åˆ°æˆ–è¶…è¿‡ 80cm æ—¶ï¼Œç»™æœåŠ¡å™¨å‘è¯·æ±‚ã€‚è¿™é‡Œçš„è¯·æ±‚ç”¨äº† console.logï¼Œå®é™…åº”ç”¨ä¸­ï¼Œå¯ä»¥å‘é€è¯·æ±‚ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738&lt;template&gt; &lt;div&gt; &lt;h2&gt;å½“æ°´æ¸©è¾¾åˆ°æˆ–è¶…è¿‡60â„ƒï¼Œæˆ–è€…æ°´ä½è¾¾åˆ°æˆ–è¶…è¿‡80cmæ—¶ï¼Œç»™æœåŠ¡å™¨å‘è¯·æ±‚&lt;/h2&gt; &lt;h2&gt;æ°´æ¸©ï¼š&#123;&#123; temp &#125;&#125;&lt;/h2&gt; &lt;h2&gt;æ°´ä½ï¼š&#123;&#123; height &#125;&#125;&lt;/h2&gt; &lt;button @click=&quot;changeTemp&quot;&gt;æ°´æ¸©+10 â„ƒ&lt;/button&gt; &lt;button @click=&quot;changeHeight&quot;&gt;æ°´ä½+10 cm&lt;/button&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; ref, watch, watchEffect &#125; from &quot;vue&quot;; let temp = ref(10); let height = ref(0); const changeTemp = () =&gt; &#123; temp.value += 10; &#125;; const changeHeight = () =&gt; &#123; height.value += 10; &#125;; // watchå®ç°ï¼š watch([temp, height], (value) =&gt; &#123; let [newTemp, newHeight] = value; if (newTemp &gt;= 60 || newHeight &gt;= 80) &#123; console.log(&quot;ç»™æœåŠ¡å™¨å‘è¯·æ±‚&quot;); &#125; &#125;); // watchEffectå®ç°ï¼š // wathcEffectå¯ä»¥ä¸ç”¨å†™å‡½æ•°ï¼Œç›´æ¥å†™ä»£ç ï¼Œä¼šè‡ªåŠ¨æ”¶é›†ä¾èµ–ã€‚ watchEffect(() =&gt; &#123; if (temp.value &gt;= 60 || height.value &gt;= 80) &#123; console.log(&quot;ç»™æœåŠ¡å™¨å‘è¯·æ±‚&quot;); &#125; &#125;);&lt;/script&gt; defineExpose æš´éœ²å“åº”å¼æ•°æ® ref é™¤äº†å®šä¹‰ä¸€ä¸ªå¼•ç”¨ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç»™çœŸå® DOM å…ƒç´ æˆ–ç»„ä»¶å…ƒç´ æ‰“æ ‡è®°ï¼Œç„¶åé€šè¿‡ ref è·å–åˆ°è¯¥å…ƒç´ æˆ–è€…ç»„ä»¶å…ƒç´ å®ä¾‹ã€‚ å’Œ vue2 ä¸ä¸€æ ·ï¼Œvue3 çš„å¼•ç”¨å€¼ ref å¿…é¡»ç”¨ defineExpose æš´éœ²ç»™çˆ¶ç»„ä»¶ï¼Œçˆ¶ç»„ä»¶æ‰èƒ½è·å–åˆ°ä»–çš„å€¼ 123456789101112131415161718&lt;template&gt; &lt;div ref=&quot;x&quot;&gt;hello vue3&lt;/div&gt; &lt;button @click=&quot;showRef&quot;&gt;get ref DOM&lt;/button&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; ref, defineExpose &#125; from &quot;vue&quot;; // å’Œvue2ä¸ä¸€æ ·ï¼Œvue3çš„å¼•ç”¨å€¼refå¿…é¡»ç”¨defineExposeæš´éœ² let a = ref(&quot;1&quot;); defineExpose(&#123; a &#125;); // x å¿…é¡»ä¸ä¸Šé¢çš„ ref æ ‡ç­¾åå­—ä¸€è‡´ let x = ref(); const showRef = () =&gt; &#123; console.log(x.value); // &lt;div&gt;hello vue3&lt;/div&gt; &#125;;&lt;/script&gt; ref æ‰“åœ¨ç»„ä»¶æ ‡ç­¾ä¸Šï¼Œèƒ½æ‰“å°å‡ºç»„ä»¶å®ä¾‹ 12345678910111213&lt;template&gt; &lt;RefDemo ref=&quot;aa&quot; /&gt; &lt;button @click=&quot;showRef&quot;&gt;showRef&lt;/button&gt;&lt;/template&gt;&lt;script setup lang=&quot;ts&quot;&gt; import RefDemo from &quot;./components/RefDemo.vue&quot;; import &#123; ref &#125; from &quot;vue&quot;; let aa = ref(); const showRef = () =&gt; &#123; console.log(aa.value); // Proxy(Object)Â &#123;__v_skip: true&#125; &#125;;&lt;/script&gt; props, defineProps å’Œ withDefaultsä¸åºŸè¯ï¼Œç›´æ¥ä¸Š demoï¼Œå’Œ React ä¸åŒçš„æ˜¯ï¼Œå­ç»„ä»¶å¦‚æœè¦æ˜¾ç¤º Propsï¼Œéœ€è¦ç”¨definePropså®šä¹‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ çˆ¶ç»„ä»¶ï¼š 1234567891011121314&lt;template&gt; &lt;div class=&quot;app&quot;&gt; &lt;PropsDemo a=&quot;hehe&quot; :personsList=&quot;persons&quot; /&gt; &lt;/div&gt;&lt;/template&gt;&lt;script setup lang=&quot;ts&quot;&gt; import PropsDemo from &quot;./components/PropsDemo.vue&quot;; let persons = [ &#123; id: 1, name: &quot;å¼ ä¸‰&quot;, age: 18 &#125;, &#123; id: 2, name: &quot;æå››&quot;, age: 19 &#125;, ];&lt;/script&gt; å­ç»„ä»¶çš„å†™æ³•å°±æœ‰ç‚¹å¥‡è‘©ï¼Œå¦‚æœå®šä¹‰é»˜è®¤å€¼ï¼Œè¿˜è¦å†å¼•å…¥ä¸€ä¸ªwithDefaultsï¼Œä»–çš„å®šä¹‰æ˜¯æ¯” vue2 å•°å—¦çš„ã€‚ 12345678910111213141516171819202122232425262728&lt;template&gt; &lt;div&gt;&#123;&#123; a &#125;&#125;&lt;/div&gt; &lt;ul&gt; &lt;li :key=&quot;person.id&quot; v-for=&quot;person in personsList&quot;&gt; &#123;&#123; person.name &#125;&#125;: &#123;&#123; person.age &#125;&#125; &lt;/li&gt; &lt;/ul&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; defineProps, withDefaults &#125; from &quot;vue&quot;; import type &#123; Person &#125; from &quot;@/types&quot;; // å†™æ³•1ï¼šå¦‚æœä¸ç”¨tsçš„æ™®é€šå†™æ³• // const props1 = defineProps([&#x27;a&#x27;, &#x27;personsList&#x27;]) // console.log(props1) // // å†™æ³•2ï¼šç”¨ä¸ŠtsåŠwithDefaultsï¼Œå½“ç„¶ï¼ŒwithDefaultså¯ä»¥çœç•¥ä¸ç”¨ const props = withDefaults( defineProps&lt;&#123; a: string; personsList: Person[] &#125;&gt;(), &#123; a: &quot;xx&quot;, personsList: () =&gt; [&#123; id: &quot;kk&quot;, name: &quot;yy&quot;, age: 18 &#125;], &#125; ); console.log(props); // Proxy(Object) &#123;a: &#x27;hehe&#x27;, personsList: Array(2)&#125;&lt;/script&gt; ç”Ÿå‘½å‘¨æœŸVue2 çš„ç”Ÿå‘½å‘¨æœŸï¼šåˆ›å»ºé˜¶æ®µï¼šbeforeCreate createdæŒ‚è½½é˜¶æ®µï¼šbeforeMount mountedæ›´æ–°é˜¶æ®µï¼šbeforeUpdate updatedé”€æ¯€é˜¶æ®µï¼šbeforeDestroy destroyed Vue3 çš„ç”Ÿå‘½å‘¨æœŸï¼š åˆ›å»ºé˜¶æ®µï¼šsetupæŒ‚è½½é˜¶æ®µï¼šonBeforeMount onMountedæ›´æ–°é˜¶æ®µï¼šonBeforeUpdate onUpdatedé”€æ¯é˜¶æ®µï¼šonBeforeUnmount onUnmounted ç”±äº Vue3 æˆ‘ä»¬æŠŠ setup é˜¶æ®µå†™åœ¨ script æ ‡ç­¾é‡Œï¼Œæ‰€ä»¥ Vue3 çš„ç”Ÿå‘½å‘¨æœŸæ¯” Vue2 çš„å°‘äº† 2 ä¸ªï¼Œåˆ†åˆ«æ˜¯beforeCreateå’Œcreatedã€‚ 123456789101112131415&lt;!-- vue2çš„å†™æ³•ï¼š --&gt;&lt;script&gt; export default &#123; created() &#123; console.log(&quot;created&quot;); &#125;, &#125;;&lt;/script&gt;&lt;!-- Vue3çš„å†™æ³•ï¼š --&gt;&lt;script setup lang=&quot;ts&quot;&gt; onMounted(() =&gt; &#123; console.log(&quot;onMounted&quot;); &#125;);&lt;/script&gt; Custom Hooks æ¨¡å—åŒ–å°è£…è¿™ä¸ªæ¦‚å¿µå®Œå…¨æ˜¯æŠ„è¢­ React hooksï¼Œç”±äº Vue3 è®¾è®¡æˆäº†setup è¯­æ³•ï¼Œæ‰€ä»¥ä½¿å¾—å‡½æ•°å¼ç¼–ç¨‹ç§°ä¸ºå¯èƒ½ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ª demo 12345678910111213141516171819&lt;template&gt; &lt;div class=&quot;person&quot;&gt; &lt;img v-for=&quot;(image, idx) in dogImages&quot; :src=&quot;image&quot; :key=&quot;idx&quot; alt=&quot;dog&quot; /&gt; &lt;br /&gt; &lt;button @click=&quot;addNewDogImage&quot;&gt;æ·»åŠ ç‹—å›¾&lt;/button&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import useDogImages from &quot;@/hooks/useDogImages&quot;; const &#123; dogImages, addNewDogImage &#125; = useDogImages();&lt;/script&gt;&lt;style scoped&gt; img &#123; height: 150px; margin-right: 10px; &#125;&lt;/style&gt; åœ¨ useDogImages.ts æ–‡ä»¶é‡Œï¼Œå¯ä»¥å†™ä¸‹ 123456789101112131415161718192021import &#123; ref, reactive &#125; from &quot;vue&quot;;// æ·»åŠ ç‹—å›¾export default (url: string = &quot;https://dog.ceo/api/breeds/image/random&quot;) =&gt; &#123; // https://dog.ceo/api/breeds/image/random const defaultDogImage = &quot;https://images.dog.ceo/breeds/affenpinscher/n02110627_11811.jpg&quot;; const dogImages = reactive([defaultDogImage]); const addNewDogImage = async () =&gt; &#123; fetch(url) .then((res) =&gt; res.json()) .then((data) =&gt; dogImages.push(data.message)) .catch((err) =&gt; alert(err)); &#125;; return &#123; dogImages, addNewDogImage, &#125;;&#125;; Pinia çŠ¶æ€ç®¡ç†pinia æ˜¯ä¸€ä¸ªç¬¦åˆç›´è§‰çš„çŠ¶æ€ç®¡ç†åº“ï¼Œå’Œvuexä¸€æ ·ï¼Œéƒ½æ˜¯åŸºäºvue3çš„ï¼Œä½†æ˜¯piniaæ¯”vuexæ›´ç®€å•æ˜“ç”¨ï¼Œè€Œä¸”vuexçš„ä½œè€…å·²ç»æ¨èä½¿ç”¨piniaäº†ã€‚pinia çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨main.tsé‡Œå¼•å…¥createPiniaï¼Œç„¶åapp.use(createPinia())ï¼Œç„¶åå°±å¯ä»¥åœ¨setupå‡½æ•°é‡Œä½¿ç”¨defineStoreå®šä¹‰ä¸€ä¸ªçŠ¶æ€äº†ã€‚ 1npm i pinia createAppmain.ts å¼•å…¥ï¼š 123456789import &#123; createApp &#125; from &quot;vue&quot;;import App from &quot;./App.vue&quot;;import &#123; createPinia &#125; from &quot;pinia&quot;;// ä¸‹é¢è¿™ä¸ªé¡ºåºä¸èƒ½ä¹±ï¼Œå¿…é¡»æŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œå…ˆcreatePinia()ï¼Œå†app.use(pinia), å†æŒ‚è½½åˆ°appçš„æ ¹èŠ‚ç‚¹ä¸Šconst app = createApp(App);const pinia = createPinia();app.use(pinia);app.mount(&quot;#app&quot;); defineStore, state, actionsåˆ›å»ºä¸€ä¸ªstore/count.tsï¼š 12345678910111213141516171819import &#123; defineStore &#125; from &quot;pinia&quot;;const useCountStore = defineStore(&quot;count&quot;, &#123; actions: &#123; addToMaxTwenty(value: number) &#123; if (this.count &lt;= 20) &#123; this.count += value; &#125; &#125;, &#125;, state() &#123; return &#123; count: 0, by: &quot;X&quot;, &#125;; &#125;,&#125;);export default useCountStore; åœ¨åº”ç”¨ä¸­ä½¿ç”¨ï¼š 123456789101112131415161718192021222324252627282930313233343536373839&lt;template&gt; &lt;div class=&quot;talk&quot;&gt; &lt;div&gt; &lt;h1&gt;countï¼š&#123;&#123; countStore.count &#125;&#125;&lt;/h1&gt; &lt;h2&gt;countStoreçš„å…¶ä»–æ•°æ®: &#123;&#123; countStore.by &#125;&#125;&lt;/h2&gt; &lt;!-- v-model.number å¯ä»¥ç›´æ¥è½¬æ¢ä¸ºæ•°å­—ç±»å‹ --&gt; &lt;select v-model.number=&quot;n&quot;&gt; &lt;option value=&quot;1&quot; selected&gt;1&lt;/option&gt; &lt;option value=&quot;2&quot;&gt;2&lt;/option&gt; &lt;option value=&quot;3&quot;&gt;3&lt;/option&gt; &lt;/select&gt; &lt;button @click=&quot;plus&quot;&gt;+&lt;/button&gt; &lt;button @click=&quot;minus&quot;&gt;-&lt;/button&gt; &lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; ref, reactive &#125; from &quot;vue&quot;; import useCountStore from &quot;@/store/count&quot;; import useTalkStore from &quot;@/store/talks&quot;; const countStore = useCountStore(); const n = ref(1); const plus = () =&gt; &#123; // ç¬¬ä¸€ç§æ”¹æ³•ï¼špiniaç¬¦åˆç›´è§‰çš„çŠ¶æ€ç®¡ç†ï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹å…¶å€¼ï¼Œä¾‹å¦‚ï¼š // countStore.count += n.value // ç¬¬äºŒç§æ”¹æ³•ï¼š$patch // countStore.$patch(&#123; // count: 1, // by: &#x27;pinia&#x27; // &#125;) // ç¬¬ä¸‰ç§æ”¹æ³•ï¼šactionsï¼Œè¿™ç§æ–¹æ³•çš„å¥½å¤„æ˜¯å¯ä»¥åœ¨addToMaxTwentyé‡Œæ·»åŠ å¤æ‚é€»è¾‘ countStore.addToMaxTwenty(n.value); &#125;; const minus = () =&gt; (countStore.count -= n.value);&lt;/script&gt; defineStore ç¬¬äºŒä¸ªå‚æ•°æ”¹å†™ä¸ºç»„åˆå¼ APIä¸Šé¢çš„ talkStore çš„ä¾‹å­ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å†™çš„æ˜¯é…ç½®å¼çš„ APIï¼ˆOptionAPIï¼‰ï¼Œä½†æ˜¯ pinia ä¹Ÿæ”¯æŒç»„åˆå¼ APIï¼Œå¯ä»¥æ”¹ä¸ºï¼š 1234567891011121314151617181920212223242526272829import &#123; defineStore &#125; from &quot;pinia&quot;;import &#123; reactive &#125; from &quot;vue&quot;;type Talk = &#123; id: number; content: string;&#125;;const useTalkStore = defineStore(&quot;talks&quot;, () =&gt; &#123; const talkList = reactive&lt;Talk[]&gt;( JSON.parse(localStorage.getItem(&quot;talkList&quot;) as string) ?? [] ); const assertOneNewTalk = async () =&gt; &#123; try &#123; const response = await fetch( &quot;https://api.uomg.com/api/rand.qinghua?format=json&quot; ); if (!response.ok) throw new Error(&quot;Network response was not ok&quot;); const &#123; content &#125; = await response.json(); return talkList.push(&#123; id: talkList.length + 1, content &#125;); &#125; catch (err) &#123; console.error(err); &#125; &#125;; return &#123; talkList, assertOneNewTalk &#125;;&#125;);export default useTalkStore; storeToRefså¦‚æœæˆ‘ä»¬è¦çœç•¥ä¸Šé¢çš„å†™æ³• countStore.countï¼Œåœ¨ pinia ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ storeToRefs è§£æ„ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥çœç•¥ countStore.countï¼Œç›´æ¥ä½¿ç”¨ countã€‚è¿™é‡Œæœ€å¥½ä¸è¦ä½¿ç”¨ vue è‡ªå¸¦çš„ **toRefs**ï¼Œå› ä¸º toRefs ä¼šå°†æ‰€æœ‰å±æ€§éƒ½å˜æˆå“åº”å¼ï¼Œè€Œ storeToRefs åªä¼šå°† state ä¸­çš„å±æ€§å˜æˆå“åº”å¼ã€‚ TalkStore çš„ä¾‹å­ï¼š 1234567891011121314151617181920&lt;template&gt; &lt;div class=&quot;talk&quot;&gt; &lt;button @click=&quot;addNewTalk&quot;&gt;è·å–ä¸€å¥åœŸå‘³æƒ…è¯&lt;/button&gt; &lt;ul&gt; &lt;li v-for=&quot;talk in talkList&quot; :key=&quot;talk.id&quot;&gt;&#123;&#123; talk.content &#125;&#125;&lt;/li&gt; &lt;/ul&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; ref &#125; from &quot;vue&quot;; import &#123; storeToRefs &#125; from &quot;pinia&quot;; import useCountStore from &quot;@/store/count&quot;; import useTalkStore from &quot;@/store/talks&quot;; const talkStore = useTalkStore(); // ä¸èƒ½ç›´æ¥è§£æ„ï¼Œconst &#123; talkList &#125; = talkStoreï¼Œè¿™æ ·è§£æ„å‡ºæ¥çš„ talkList ä¸æ˜¯æ˜¯å“åº”å¼å¯¹è±¡æ•°æ®ï¼Œé¡µé¢ç”¨äº†ä¸ä¼šè§¦å‘æ›´æ–° const &#123; talkList &#125; = storeToRefs(talkStore); const addNewTalk = () =&gt; talkStore.assertOneNewTalk();&lt;/script&gt; store/talks æ–‡ä»¶é‡Œï¼Œå¯ä»¥ç›´æ¥è¯·æ±‚æ•°æ®ï¼š 1234567891011121314151617181920212223242526272829import &#123; defineStore &#125; from &quot;pinia&quot;;type Talk = &#123; id: number; content: string;&#125;;const useTalkStore = defineStore(&quot;talks&quot;, &#123; actions: &#123; async assertOneNewTalk() &#123; try &#123; const response = await fetch( &quot;https://api.uomg.com/api/rand.qinghua?format=json&quot; ); if (!response.ok) throw new Error(&quot;Network response was not ok&quot;); const &#123; content &#125; = await response.json(); return this.talkList.push(&#123; id: this.talkList.length + 1, content &#125;); &#125; catch (err) &#123; console.log(err); &#125; &#125;, &#125;, state() &#123; return &#123; talkList: [] as Talk[], &#125;; &#125;,&#125;);export default useTalkStore; getters å¤„ç†æ•°æ®æ¥ç€ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬åœ¨ defineStore å‡½æ•°ä¸­åŠ å…¥ï¼šgetters, å¦‚ï¼š 1234567891011121314151617181920212223242526import &#123; defineStore &#125; from &quot;pinia&quot;;const useCountStore = defineStore(&quot;count&quot;, &#123; actions: &#123; addToMaxTwenty(value: number) &#123; if (this.count &lt;= 20) &#123; this.count += value; &#125; &#125;, &#125;, state() &#123; return &#123; count: 0, by: &quot;X&quot;, &#125;; &#125;, // ä¸¤ç§å†™æ³•å‡å¯ getters: &#123; doubleCount: (state) =&gt; state.count * 2, square(): number &#123; return this.count ** 2; &#125;, &#125;,&#125;);export default useCountStore; è¿™æ ·å°±å¯ä»¥åœ¨ template é‡Œé¢ç›´æ¥ä½¿ç”¨ doubleCount å’Œ square äº†ã€‚ $subscribe store çš„è®¢é˜…æ¥ç€ä¸Šé¢TalkStoreçš„ä¾‹å­ï¼Œæ·»åŠ $subscribeï¼Œç›‘è§†æ•°æ®ï¼Œå¹¶å°†å…¶å­˜åœ¨æµè§ˆå™¨ï¼Œè¿›è¡Œç®€å•çš„æ•°æ®æŒä¹…åŒ–ï¼Œå¦‚ï¼š 123talkStore.$subscribe((_, state) =&gt; &#123; localStorage.setItem(&quot;talkList&quot;, JSON.stringify(state.talkList));&#125;); å†å°†stateé‡Œçš„talkList æ¢æˆåœ¨ localStorage é‡Œå–ï¼šå½“ç„¶ï¼Œå¿…é¡»åˆ¤æ–­ç¬¬ä¸€æ¬¡æ‰“å¼€é¡µé¢æ—¶ï¼ŒlocalStorage é‡Œæ²¡æœ‰æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦å†™ä¸€ä¸‹ç©ºå€¼åˆ¤æ–­ç¬¦ï¼š 123state: () =&gt; (&#123; talkList: JSON.parse(localStorage.getItem(&quot;talkList&quot;) as string) ?? [],&#125;); vue-router è·¯ç”±å®‰è£… 1npm i vue-router åˆ›å»ºè·¯ç”±åˆ›å»º src/router/index.tsï¼Œå½“ç„¶ï¼Œå‰æè¿˜å¿…é¡»åˆ›å»ºé¡µé¢çš„ç»„ä»¶å¦‚ Home.vue ç­‰ 3 ä¸ªï¼Œè¿™é‡Œä¸è¯¦ç»†ä»‹ç»ã€‚ 123456789101112131415161718192021222324252627282930import &#123; createRouter, createWebHistory &#125; from &quot;vue-router&quot;;import Home from &quot;@/views/Home.vue&quot;;import News from &quot;@/views/News.vue&quot;;import About from &quot;@/views/About.vue&quot;;const router = createRouter(&#123; // Provide the history routes to use. // æ¶ˆç­urlçš„#å· // ä½†history è·¯ç”±å¿…é¡»è¦æœåŠ¡å™¨é…åˆè®¾ç½® history: createWebHistory(), routes: [ &#123; path: &quot;/&quot;, name: &quot;Home&quot;, component: Home, &#125;, &#123; path: &quot;/news&quot;, name: &quot;News&quot;, component: News, &#125;, &#123; path: &quot;/about&quot;, name: &quot;About&quot;, component: About, &#125;, ],&#125;);export default router; history æ¨¡å¼ åœ¨ Nginxä¸Šé…ç½®å¦‚ä¸‹ï¼š 123456789101112server &#123; listen 80; server_name your-domain.com; root /path/to/your/webroot; index index.html; location / &#123; # å½“Nginxæ¥æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚æ—¶ï¼Œå®ƒä¼šé¦–å…ˆå°è¯•æŒ‰ç…§è¯·æ±‚çš„URIæä¾›æ–‡ä»¶ï¼ˆ$uriï¼‰ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå®ƒä¼šå°è¯•å°†è¯·æ±‚å®šå‘åˆ°URIå¯¹åº”çš„ç›®å½•ï¼ˆ$uri/ï¼‰ï¼Œå¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œé‚£ä¹ˆæœ€ç»ˆä¼šæä¾›/index.htmlæ–‡ä»¶ã€‚ try_files $uri $uri/ /index.html; &#125;&#125; åœ¨ main.ts ä¸­ï¼Œå¼•å…¥è·¯ç”±ï¼Œå¹¶æŒ‚è½½åˆ° app ä¸Šï¼š 1234567import &#123; createApp &#125; from &quot;vue&quot;;import App from &quot;./App.vue&quot;;import router from &quot;./router&quot;;const app = createApp(App);app.use(router);app.mount(&quot;#app&quot;); ä½¿ç”¨è·¯ç”±åœ¨è·¯ç”±é¡µé¢å¯ä»¥æ˜¾ç¤ºï¼š 12345678910111213141516171819202122232425262728&lt;template&gt; &lt;div class=&quot;router-demo&quot;&gt; &lt;h2 class=&quot;title&quot;&gt;Vue Router&lt;/h2&gt; &lt;div class=&quot;navigator&quot;&gt; &lt;RouterLink to=&quot;/&quot; active-class=&quot;active&quot;&gt;é¦–é¡µ&lt;/RouterLink&gt; &lt;RouterLink :to=&quot;&#123; name: &#x27;News&#x27; &#125;&quot; active-class=&quot;active&quot;&gt;æ–°é—»&lt;/RouterLink&gt; &lt;RouterLink :to=&quot;&#123; path: &#x27;/about&#x27; &#125;&quot; active-class=&quot;active&quot; &gt;å…³äº&lt;/RouterLink &gt; &lt;/div&gt; &lt;div class=&quot;content&quot;&gt; &lt;RouterView&gt;&lt;/RouterView&gt; &lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; RouterView, RouterLink &#125; from &quot;vue-router&quot;;&lt;/script&gt;&lt;style scoped&gt; /* a.active å¯¹åº”ä¸Šé¢çš„ active-classï¼Œ å…¶ä»–æ ·å¼çœç•¥ */ .navigator a.active &#123; background-color: rgb(76, 146, 199); font-weight: 900; text-shadow: 0 0 1px black; &#125;&lt;/style&gt; &lt;RouterView&gt;&lt;/RouterView&gt; ä¸ºå„ä¸ªè·¯ç”±ç»„ä»¶çš„å ä½ç¬¦ï¼Œ &lt;RouterLink to=&quot;/&quot; active-class=&quot;active&quot;/&gt; æ˜¯&lt;a/&gt; æ ‡ç­¾çš„äºŒæ¬¡å°è£… å±æ€§ to æœ‰ 2 ç§å†™æ³•ï¼Œå¯to=&quot;/&quot;, ä¹Ÿå¯ :to=&quot;&#123;path: &#39;/&#39;&#125;&quot; æˆ– :to=&quot;&#123;name: &#39;Home&#39;&#125;&quot;, è¿™é‡Œçš„ name å¯¹åº”è·¯ç”±æ–‡ä»¶ router/index.ts é‡Œå®šä¹‰çš„ name è·¯ç”±å¯¼èˆªåˆ°çš„é¡µé¢ï¼ŒæŒ‚è½½åˆ°é¡µé¢çš„æ ¹èŠ‚ç‚¹ä¸Šï¼Œåˆ‡æ¢æ—¶åˆ™å¸è½½è¯¥èŠ‚ç‚¹ï¼Œå¯ä»¥ç”¨åœ¨å…·ä½“é¡µé¢é‡Œç”¨ onMounted å’Œ onUnmounted æ¥ç›‘å¬ï¼ŒéªŒè¯è¿™ç‚¹ã€‚ å­è·¯ç”±åœ¨ä¸Šé¢æˆ‘ä»¬åˆ›å»ºçš„ router/index.ts æ–‡ä»¶é‡Œï¼Œç”¨ news é¡µé¢åˆ›å»ºäºŒçº§è·¯ç”±ï¼Œ åœ¨ /newsè·¯ç”±ä¸‹ï¼Œæ·»åŠ  children æ•°ç»„ï¼Œå¦‚ä¸‹ï¼š 12345678910111213141516import NewsDetail from &#x27;@/views/NewsDetail.vue&#x27;... &#123; path: &#x27;/news&#x27;, name: &#x27;News&#x27;, component: News, children: [ &#123; path: &#x27;newsDetail&#x27;, name: &#x27;NewsDetail&#x27;, component: NewsDetail &#125; ] &#125;... è·¯ç”±ä¼ å‚query ä¼ å‚è¿™ç§æ˜¯æ”¾åœ¨ url çš„åé¢ï¼Œå¦‚ï¼š/news?id=1&amp;title=xxx&amp;content=xxxï¼Œæ¯”è¾ƒå•°å—¦ï¼Œä¸å¤ªæ¨èã€‚æ”¹é€  views/News.vue æ–‡ä»¶ï¼Œæ·»åŠ  RouterLink ç»„ä»¶ï¼Œå¹¶æ·»åŠ  query å‚æ•°ï¼Œå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839&lt;template&gt; &lt;div class=&quot;news&quot;&gt; &lt;ul&gt; &lt;li v-for=&quot;news in newsList&quot; :key=&quot;news.id&quot;&gt; &lt;!-- 1. åˆ©ç”¨å­—ç¬¦ä¸²æ¨¡æ¿ï¼Œæ‹¼æ¥queryå‚æ•°ï¼Œå¤ªé•¿ï¼Œæ¯”è¾ƒæ¶å¿ƒ --&gt; &lt;!-- &lt;RouterLink :to=&quot;`/news/newsDetail?id=$&#123;news.id&#125;&amp;title=$&#123;news.title&#125;&amp;content=$&#123;news.content&#125;`&quot; &gt;&#123;&#123; news.title &#125;&#125;&lt;/RouterLink &gt; --&gt; &lt;!-- 2. ä»¥å¯¹è±¡æ‹¼æ¥queryå‚æ•° --&gt; &lt;RouterLink :to=&quot;&#123; path: &#x27;/news/newsDetail&#x27;, query: &#123; id: news.id, title: news.title, content: news.content &#125; &#125;&quot; &gt;&#123;&#123; news.title &#125;&#125; &lt;/RouterLink&gt; &lt;/li&gt; &lt;/ul&gt; &lt;div class=&quot;news-content&quot;&gt; &lt;RouterView&gt;&lt;/RouterView&gt; &lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; reactive &#125; from &quot;vue&quot;; import &#123; RouterView, RouterLink &#125; from &quot;vue-router&quot;; const newsList = reactive([ &#123; id: 1, title: &quot;1111111&quot;, content: &quot;aaaaaa&quot; &#125;, &#123; id: 2, title: &quot;2222222&quot;, content: &quot;bbbbbb&quot; &#125;, &#123; id: 3, title: &quot;3333333&quot;, content: &quot;cccccc&quot; &#125;, ]);&lt;/script&gt; åœ¨ views/NewsDetail.vue æ–‡ä»¶é‡Œï¼Œæ·»åŠ  props æ¥æ”¶ä¼ å‚ï¼Œå¦‚ä¸‹ï¼š 1234567891011121314&lt;template&gt; &lt;div&gt; &lt;div&gt;ç¼–å·ï¼š&#123;&#123; query.id &#125;&#125;&lt;/div&gt; &lt;div&gt;æ ‡é¢˜ï¼š&#123;&#123; query.title &#125;&#125;&lt;/div&gt; &lt;div&gt;å†…å®¹ï¼š&#123;&#123; query.content &#125;&#125;&lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; toRefs &#125; from &quot;vue&quot;; import &#123; useRoute &#125; from &quot;vue-router&quot;; const route = useRoute(); const &#123; query &#125; = toRefs(route);&lt;/script&gt; params ä¼ å‚è¿™ç§ä¼ å‚æ˜¯æ”¾åœ¨ url çš„åé¢ï¼Œå¦‚ï¼š/news/newsDetail/1ï¼Œå†™èµ·æ¥æ¯” query ä¼ å‚ç®€æ´äº› å…ˆæ”¹é€  router/index.ts æ–‡ä»¶ï¼Œæ·»åŠ  params å‚æ•°ï¼Œå¦‚ä¸‹ï¼š 123456789101112&#123; path: &#x27;/news&#x27;, name: &#x27;News&#x27;, component: News, children: [ &#123; path: &#x27;newsDetail/:id/:title/:content&#x27;, name: &#x27;NewsDetail&#x27;, component: NewsDetail &#125; ]&#125;, åœ¨views/News.vue æ–‡ä»¶ï¼Œæ”¹é€ å¦‚ä¸‹ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå†™æ³• 2 å¯¹è±¡é‡Œä¸èƒ½ç”¨ path,å¿…é¡»å†™è·¯ç”±é‡Œçš„ name å‚æ•° 1234567891011121314151617181920212223242526272829303132333435363738&lt;template&gt; &lt;div class=&quot;news&quot;&gt; &lt;ul&gt; &lt;li v-for=&quot;news in newsList&quot; :key=&quot;news.id&quot;&gt; &lt;!-- parmasä¼ å‚å†™æ³•1 --&gt; &lt;!-- &lt;RouterLink :to=&quot;`/news/newsDetail/$&#123;news.id&#125;/$&#123;news.title&#125;/$&#123;news.content&#125;`&quot;&gt;&#123;&#123; news.title &#125;&#125;&lt;/RouterLink&gt; --&gt; &lt;!-- parmasä¼ å‚å†™æ³•2 --&gt; &lt;RouterLink :to=&quot;&#123; name: &#x27;NewsDetail&#x27;, params: &#123; id: news.id, title: news.title, content: news.content &#125; &#125;&quot; &gt;&#123;&#123; news.title &#125;&#125; &lt;/RouterLink&gt; &lt;/li&gt; &lt;/ul&gt; &lt;div class=&quot;news-content&quot;&gt; &lt;RouterView&gt;&lt;/RouterView&gt; &lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; reactive &#125; from &quot;vue&quot;; import &#123; RouterView, RouterLink &#125; from &quot;vue-router&quot;; const newsList = reactive([ &#123; id: 1, title: &quot;1111111&quot;, content: &quot;aaaaaa&quot; &#125;, &#123; id: 2, title: &quot;2222222&quot;, content: &quot;bbbbbb&quot; &#125;, &#123; id: 3, title: &quot;3333333&quot;, content: &quot;cccccc&quot; &#125;, ]);&lt;/script&gt; NewsDetail.vue æ–‡ä»¶: 1234567891011121314&lt;template&gt; &lt;div&gt; &lt;div&gt;ç¼–å·ï¼š&#123;&#123; params.id &#125;&#125;&lt;/div&gt; &lt;div&gt;æ ‡é¢˜ï¼š&#123;&#123; params.title &#125;&#125;&lt;/div&gt; &lt;div&gt;å†…å®¹ï¼š&#123;&#123; params.content &#125;&#125;&lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; toRefs &#125; from &quot;vue&quot;; import &#123; useRoute &#125; from &quot;vue-router&quot;; const route = useRoute(); const &#123; params &#125; = toRefs(route);&lt;/script&gt; è·¯ç”±propså‚æ•°ä¸Šé¢æåˆ°çš„paramsä¼ å‚ï¼Œéƒ½å¯ä»¥é€šè¿‡ props å‚æ•°æ¥æ¥æ”¶ï¼Œæœ€æ¨èè¿™ç§å†™æ³•ï¼Œæ”¹å†™å¦‚ä¸‹ï¼š åœ¨ router/index.ts æ–‡ä»¶é‡Œï¼Œæ·»åŠ  props å‚æ•°ï¼Œå¦‚ä¸‹ï¼š 1234567891011121314151617181920&#123; path: &#x27;/news&#x27;, name: &#x27;News&#x27;, component: News, children: [ &#123; path: &#x27;newsDetail/:id/:title/:content&#x27;, name: &#x27;NewsDetail&#x27;, component: NewsDetail, props: true, // propså¯ä»¥å†™æˆå›è°ƒå‡½æ•°çš„å†™æ³•ï¼Œä½†æ²¡å¿…è¦ // props: (&#123; params: &#123; id, title, content &#125; &#125;) =&gt; (&#123; // id // title, // content // &#125;) &#125; ]&#125; views/News.vue æ–‡ä»¶ å’Œä¸Šé¢æåˆ°çš„ä¸€æ ·ï¼Œæ— éœ€æ”¹åŠ¨ï¼Œviews/NewsDetail.vue æ”¹é€ å¦‚ä¸‹ï¼š 1234567891011&lt;template&gt; &lt;div&gt; &lt;div&gt;ç¼–å·ï¼š&#123;&#123; id &#125;&#125;&lt;/div&gt; &lt;div&gt;æ ‡é¢˜ï¼š&#123;&#123; title &#125;&#125;&lt;/div&gt; &lt;div&gt;å†…å®¹ï¼š&#123;&#123; content &#125;&#125;&lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; defineProps([&quot;id&quot;, &quot;title&quot;, &quot;content&quot;]);&lt;/script&gt; replacereplace æ˜¯ä¸€ä¸ª&lt;RouterLink&gt;ç»„ä»¶çš„å±æ€§ï¼ŒåŠ ä¸Šåˆ™è¡¨ç¤ºä¸ç¼“å­˜è¯¥é¡µé¢ï¼Œä¸èƒ½ç‚¹å‡»æµè§ˆå™¨ä¸Šçš„åé€€æŒ‰é’®ï¼Œå¦‚ï¼š 1&lt;RouterLink replace to=&quot;/&quot; active-class=&quot;active&quot;&gt;é¦–é¡µ&lt;/RouterLink&gt; useRouter ç¼–ç¨‹å¼è·¯ç”±å¯¼èˆªä¸Šé¢æˆ‘ä»¬æåˆ°çš„ä¾‹å­éƒ½æ˜¯&lt;RouterLink&gt;ç»„ä»¶ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œè¿˜æœ‰ä¸€ç§ç¼–ç¨‹å¼è·¯ç”±å¯¼èˆªï¼Œä½¿ç”¨é¢‘ç‡è¿œå¤§äº&lt;RouterLink&gt;ç»„ä»¶ï¼Œä¾‹å¦‚æˆ‘ä»¬ç”¨ä¸Šé¢çš„ä¾‹å­ï¼Œåœ¨é¦–é¡µæœ‰ä¸€ä¸ª buttonï¼Œç‚¹å‡»å¯ä»¥è·³è½¬åˆ° news æ–°é—»é¡µé¢ï¼Œviews/Home.vueæ–‡ä»¶å¦‚ä¸‹ï¼š 1234567891011121314151617181920&lt;template&gt; &lt;div&gt;home page&lt;/div&gt; &lt;button @click=&quot;jumpToNews&quot;&gt;jump to news page&lt;/button&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; useRouter &#125; from &quot;vue-router&quot;; const navigateTo = useRouter(); const jumpToNews = () =&gt; &#123; // ç”¨pushï¼š // navigateTo.push(&#x27;/news&#x27;) // ä¹Ÿå¯è¿™ç§å†™æ³•ï¼š navigateTo.push(&#123; path: &quot;/news&quot;, &#125;); // ç”¨replaceï¼šä¸èƒ½åé€€ // navigateTo.replace(&#x27;/news&#x27;) &#125;;&lt;/script&gt; redirect é‡å®šå‘è¿™ä¸ªå¤ªç®€å•ï¼Œä¸èµ˜è¿°äº†ï¼Œç›´æ¥ä¸Šä»£ç router/index.tsï¼š 1234&#123; path: &quot;/&quot;, redirect: &quot;/home&quot;,&#125; ç»„ä»¶é—´é€šä¿¡ ICC inner-component communicationçˆ¶å­äº’ä¼ definedProps å’Œå›è°ƒå‡½æ•°çˆ¶å­ç»„ä»¶é—´é€šä¿¡ï¼Œdemo å¦‚ä¸‹ï¼š çˆ¶ç»„ä»¶ï¼š 12345678910111213141516171819202122&lt;template&gt; &lt;div class=&quot;parent&quot;&gt; &lt;h3&gt;parent&lt;/h3&gt; &lt;h4&gt;parent&#x27;s houseï¼š&#123;&#123; house &#125;&#125;&lt;/h4&gt; &lt;h4&gt;toy fr childï¼š&#123;&#123; toy &#125;&#125;&lt;/h4&gt; &lt;Child :house=&quot;house&quot; :sendToyToParent=&quot;getToyFromChild&quot; /&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import Child from &quot;./ChildComp.vue&quot;; import &#123; ref &#125; from &quot;vue&quot;; const house = ref(&quot;ğŸ &quot;); // å›è°ƒå‡½æ•°ï¼šåœ¨Childä¸Šå®šä¹‰çš„æ˜¯sendToyToParent const toy = ref(&quot;&quot;); const getToyFromChild = (value: string) =&gt; &#123; console.log(value); toy.value = value; &#125;;&lt;/script&gt; å­ç»„ä»¶ï¼š 123456789101112131415&lt;template&gt; &lt;div class=&quot;app&quot;&gt; house fr parentï¼š&#123;&#123; house &#125;&#125; &lt;div&gt;my toy: &#123;&#123; toy &#125;&#125;&lt;/div&gt; &lt;button @click=&quot;sendToyToParent(toy)&quot;&gt;send to parent&lt;/button&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; ref &#125; from &quot;vue&quot;; const toy = ref(&quot;ğŸ»&quot;); // ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯çˆ¶ç»„ä»¶ä¼ è¿‡æ¥çš„æ•°æ®ï¼Œç¬¬äºŒä¸ªæ˜¯çˆ¶ç»„ä»¶ä¼ è¿‡æ¥çš„å‡½æ•° defineProps([&quot;house&quot;, &quot;sendToyToParent&quot;]);&lt;/script&gt; v-model åŒç»‘ -&gt; ç»„ä»¶å°è£…è¯´å®è¯ï¼Œè¿™ä¸ªå±æ€§åœ¨é¡¹ç›®ä¸­æ˜¯ä¸å¸¸ç”¨çš„ç‰¹æ€§ï¼Œé¡¹ç›®ä¸­æˆ‘ä»¬å¤šç”¨ç¬¬ä¸‰æ–¹ç»„ä»¶åº“ï¼Œ è€Œ vue2 çš„v-modelå¿…é¡»å†™åœ¨åŸç”Ÿçš„ input æ¡†ä¸Šï¼Œ ä½† vue3 ä¸­çš„ v-modelï¼Œå¯ä»¥ç›´æ¥å†™åœ¨ç»„ä»¶æ ‡ç­¾ä¸Šï¼Œæœ‰äº†è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥ä½¿å…¶æ‹¥æœ‰æ›´å¤šçš„ç”¨æ³• é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ v-model åœ¨ vue2 ä¸­çš„å®ç°åŸç† 12345678910111213141516&lt;template&gt; &lt;div&gt;&#123;&#123; inputValue &#125;&#125;&lt;/div&gt; &lt;!-- v-model ç”¨åœ¨HTMLæ ‡ç­¾ä¸Š --&gt; &lt;input v-model=&quot;inputValue&quot; type=&quot;text&quot; /&gt; &lt;!-- åŸç†ï¼š --&gt; &lt;input :value=&quot;inputValue&quot; type=&quot;text&quot; @input=&quot;inputValue = ($event.target as HTMLInputElement).value&quot; /&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; ref &#125; from &quot;vue&quot;; const inputValue = ref(&quot;hello&quot;);&lt;/script&gt; åŸå§‹çš„ v-model æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå®é™…ä¸Šï¼Œæ˜¯å°† input æ¡†çš„ :value å’Œ @inputï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ªå¤š input çš„ç»„ä»¶ï¼Œå®ç°å’Œ vue2 çš„ v-model ä¸€æ ·çš„æ•ˆæœã€‚ è¢«å°è£…çš„å¤š input ç»„ä»¶ï¼š 12345678910111213141516171819202122232425&lt;template&gt; &lt;input type=&quot;text&quot; :value=&quot;uName&quot; @input=&quot;emit(&#x27;update:uName&#x27;, ($event.target as HTMLInputElement).value)&quot; /&gt; &lt;input type=&quot;password&quot; :value=&quot;pwd&quot; @input=&quot;emit(&#x27;update:pwd&#x27;, ($event.target as HTMLInputElement).value)&quot; /&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; defineProps([&quot;uName&quot;, &quot;pwd&quot;]); const emit = defineEmits([&quot;update:uName&quot;, &quot;update:pwd&quot;]);&lt;/script&gt;&lt;style scoped&gt; /* ç‰¹åˆ«ç‰›å‰çš„æ ·å¼ï¼š */ input &#123; background-color: #26b9b1; &#125;&lt;/style&gt; åœ¨é¡µé¢é‡Œä½¿ç”¨ï¼š 12345678910111213&lt;template&gt; &lt;h4&gt;&#123;&#123; userName &#125;&#125;&lt;/h4&gt; &lt;h4&gt;&#123;&#123; userPwd &#125;&#125;&lt;/h4&gt; &lt;Inputs v-model:uName=&quot;userName&quot; v-model:pwd=&quot;userPwd&quot; /&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; ref &#125; from &quot;vue&quot;; import Inputs from &quot;./FormInputs.vue&quot;; const userName = ref(&quot;hello&quot;); const userPwd = ref(&quot;123456&quot;);&lt;/script&gt; é€šè¿‡ä»¥ä¸Šçš„ä¾‹å­ï¼Œå¯ä»¥çœ‹å‡ºä»¥ä¸‹ç‰¹å¾ï¼š è¢«å°è£…çš„ç»„ä»¶ä¸­ï¼Œ:value å’Œ @input äº‹ä»¶ï¼Œå®ç°äº†ä½¿ç”¨ä¸­ &lt;Inputs v-model:uName=&quot;userName&quot; v-model:pwd=&quot;userPwd&quot; /&gt; çš„ v-model æ•ˆæœã€‚ v-model:uName=&quot;userName&quot; å¯ä»¥å–åˆ«åuNameï¼Œæˆ‘ä»¬åœ¨å°è£…çš„ç»„ä»¶é‡Œæå–æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶åˆ«å slotç›¸å½“äº react çš„ childrenï¼Œè‡ªå®šä¹‰ç»„ä»¶åŒæ ‡ç­¾ä¸­åŒ…çš„é‚£ä¸€å—å†…å®¹ åŒ¿åæ’æ§½ï¼šæ•°æ® çˆ¶-&gt;å­çˆ¶ç»„ä»¶ï¼š 123456789101112131415161718192021222324&lt;template&gt; &lt;div class=&quot;parent&quot;&gt; &lt;h3&gt;parent Comp&lt;/h3&gt; &lt;div class=&quot;content&quot;&gt; &lt;Category title=&quot;çƒ­é—¨æ¸¸æˆåˆ—è¡¨&quot;&gt; &lt;ul&gt; &lt;li v-for=&quot;game in ganmes&quot; :key=&quot;game.id&quot;&gt;&#123;&#123; game.name &#125;&#125;&lt;/li&gt; &lt;/ul&gt; &lt;/Category&gt; &lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import Category from &quot;./CategoryBoard.vue&quot;; import &#123; reactive &#125; from &quot;vue&quot;; const ganmes = reactive([ &#123; id: 1, name: &quot;è‹±é›„è”ç›Ÿ&quot; &#125;, &#123; id: 2, name: &quot;ç‹è€…è£è€€&quot; &#125;, &#123; id: 3, name: &quot;ç»åœ°æ±‚ç”Ÿ&quot; &#125;, &#123; id: 4, name: &quot;åŸç¥&quot; &#125;, ]);&lt;/script&gt; å­ç»„ä»¶ï¼šç›¸å½“äºç”¨ slot è¿›è¡Œå ä½ html çš„å†…å®¹ï¼š 1234567891011&lt;template&gt; &lt;div class=&quot;category&quot;&gt; &lt;h2&gt;&#123;&#123; title &#125;&#125;&lt;/h2&gt; &lt;!-- slot ç›¸å½“äºreact çš„ children --&gt; &lt;slot&gt;é»˜è®¤å†…å®¹&lt;/slot&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; defineProps([&quot;title&quot;]);&lt;/script&gt; å…·åæ’æ§½ï¼šæ•°æ® çˆ¶-&gt;å­çˆ¶ç»„ä»¶ï¼šå…¶ä¸­ #s1 #s2 æ˜¯æ’æ§½çš„åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œ#s1 å·æ˜¯v-slot:s1çš„ç¼©å†™ 1234567891011121314151617181920212223242526272829&lt;template&gt; &lt;div class=&quot;parent&quot;&gt; &lt;h3&gt;parent Comp&lt;/h3&gt; &lt;div class=&quot;content&quot;&gt; &lt;Category title=&quot;çƒ­é—¨æ¸¸æˆåˆ—è¡¨&quot;&gt; &lt;template #s1&gt; &lt;h2&gt;çƒ­é—¨æ¸¸æˆåˆ—è¡¨&lt;/h2&gt; &lt;/template&gt; &lt;template #s2&gt; &lt;div class=&quot;games&quot;&gt; &lt;div v-for=&quot;game in ganmes&quot; :key=&quot;game.id&quot;&gt;&#123;&#123; game.name &#125;&#125;&lt;/div&gt; &lt;/div&gt; &lt;/template&gt; &lt;/Category&gt; &lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import Category from &quot;./CategoryBoard.vue&quot;; import &#123; reactive &#125; from &quot;vue&quot;; const ganmes = reactive([ &#123; id: 1, name: &quot;è‹±é›„è”ç›Ÿ&quot; &#125;, &#123; id: 2, name: &quot;ç‹è€…è£è€€&quot; &#125;, &#123; id: 3, name: &quot;ç»åœ°æ±‚ç”Ÿ&quot; &#125;, &#123; id: 4, name: &quot;åŸç¥&quot; &#125;, ]);&lt;/script&gt; å­ç»„ä»¶ï¼šå¯ä»¥çœ‹åˆ°ï¼Œslot åˆ†ä¸º s1 å’Œ s2ï¼Œåˆ†åˆ«å¯¹åº”å­ç»„ä»¶ä¸­çš„ä¸Šä¸‹çš„ä¸¤ä¸ªæ’æ§½ 123456&lt;template&gt; &lt;div class=&quot;category&quot;&gt; &lt;slot name=&quot;s1&quot;&gt;é»˜è®¤å†…å®¹1&lt;/slot&gt; &lt;slot name=&quot;s2&quot;&gt;é»˜è®¤å†…å®¹2&lt;/slot&gt; &lt;/div&gt;&lt;/template&gt; ä½œç”¨åŸŸæ’æ§½ï¼šæ•°æ® å­-&gt;çˆ¶ç®€å•æ¥è¯´ï¼Œè¿™ä¸ªæ˜¯è¦è§£å†³æ•°æ®æ”¾åœ¨å­ç»„ä»¶å¤„ï¼Œå°†å­ç»„ä»¶æ•°æ®ä¼ é€’ç»™çˆ¶ç»„ä»¶è€Œè®¾è®¡çš„æ’æ§½ã€‚ çˆ¶ç»„ä»¶ï¼š 123456789101112131415&lt;template&gt; &lt;div class=&quot;game&quot;&gt; &lt;ScopedSlotChild&gt; &lt;template v-slot:game-slot=&quot;params&quot;&gt; &lt;ol&gt; &lt;li v-for=&quot;game in params.games&quot; :key=&quot;game.id&quot;&gt;&#123;&#123; game.name &#125;&#125;&lt;/li&gt; &lt;/ol&gt; &lt;/template&gt; &lt;/ScopedSlotChild&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import ScopedSlotChild from &quot;./ScopedSlotChild.vue&quot;;&lt;/script&gt; å­ç»„ä»¶ï¼š 12345678910111213141516&lt;template&gt; &lt;div class=&quot;game&quot;&gt; &lt;h2&gt;æ¸¸æˆåˆ—è¡¨&lt;/h2&gt; &lt;slot name=&quot;game-slot&quot; :games=&quot;games&quot;&gt;&lt;/slot&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; reactive &#125; from &quot;vue&quot;; const games = reactive([ &#123; id: 1, name: &quot;Dota 2&quot; &#125;, &#123; id: 2, name: &quot;Counter-Strike: Global Offensive&quot; &#125;, &#123; id: 3, name: &quot;League of Legends&quot; &#125;, ]);&lt;/script&gt; ä»¥ä¸Šæœ‰å‡ ä¸ªæ³¨æ„çš„ç‚¹ï¼š slot çš„ name å±æ€§ name=&quot;game-slot&quot;ï¼Œå¯ä»¥çœç•¥ï¼Œå½“ slot æ²¡æœ‰ name å±æ€§ï¼Œé‚£çˆ¶ç»„ä»¶ä¹Ÿä¸ç”¨èµ·åˆ«å slot çš„ name å±æ€§å¦‚æœå‡ºç°ï¼Œé‚£ä¹ˆåœ¨çˆ¶ç»„ä»¶çš„åˆ«åï¼Œä¾‹å¦‚ï¼šv-slot:game-slot=&quot;params&quot; çš„:game å¿…é¡»å’Œ slot çš„ name å±æ€§ä¸€è‡´ å½“ slot çš„ name å±æ€§å€¼ä¸º default æ—¶ï¼Œçˆ¶ç»„ä»¶çš„åˆ«åä¹Ÿå¯ä»¥çœç•¥ emit äº‹ä»¶è¿™ç§æ–¹æ¡ˆå…¶å®æˆ‘æ¯”è¾ƒåæ„Ÿï¼Œå› ä¸ºä¸Šé¢çš„å›è°ƒå‡½æ•°å®Œå…¨å¯ä»¥å–ä»£ä»–ï¼Œä½†æ—¢ç„¶æ¡†æ¶æä¾›äº†ï¼Œé‚£ä¹Ÿå¾—ä»‹ç»ä¸€ä¸‹ æ¥ç€ä¸Šé¢çš„ä¾‹å­ï¼Œç®€å•æ¥è¯´å°±æ˜¯åœ¨å­ç»„ä»¶ä¸­ å°†ç‚¹å‡»äº‹ä»¶åŠ ä¸Š emit api æ ¹æ® vue2 çš„æ–‡æ¡£ï¼Œå°†å‘½åç”±ä¸Šé¢çš„é©¼å³°æ³•ï¼Œæ”¹ä¸º kebab-case å‘½åæ³•åˆ™ï¼Œå³ç”¨ - è¿æ¥ 1234567&lt;button @click=&quot;emit(&#x27;send-toy-to-parent&#x27;, toy)&quot;&gt;send to parent&lt;/button&gt;&lt;script&gt; // ... const emit = defineEmits([&quot;send-toy-to-parent&quot;]);&lt;/script&gt; çˆ¶ç»„ä»¶ä¸­ï¼Œæ¥æ”¶å­ç»„ä»¶çš„ç‚¹å‡»äº‹ä»¶ï¼Œå¹¶åšç›¸åº”å¤„ç† å°†åŸæ¥çš„ :click æ”¹ä¸º vue2 çš„å†™æ³•ï¼š @send-toy-to-parentï¼Œå¦‚ä¸‹ï¼š 1&lt;Child :house=&quot;house&quot; @send-toy-to-parent=&quot;getToyFromChild&quot; /&gt; $ref -&gt; çˆ¶å­ï¼Œ $parent -&gt; å­çˆ¶å…ˆä¸Šä»£ç ï¼Œçˆ¶ç»„ä»¶ï¼š 12345678910111213141516171819202122232425&lt;template&gt; &lt;div class=&quot;parent&quot;&gt; &lt;h3&gt;parent comp&lt;/h3&gt; &lt;h4&gt;house: &#123;&#123; house &#125;&#125;&lt;/h4&gt; &lt;button @click=&quot;getAllChildrenBooks($refs)&quot;&gt;+ Children 3 books&lt;/button&gt; &lt;Child1Comp ref=&quot;child1&quot; /&gt; &lt;Child2Comp ref=&quot;child2&quot; /&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; ref &#125; from &quot;vue&quot;; import Child1Comp from &quot;./Child1Comp.vue&quot;; import Child2Comp from &quot;./Child2Comp.vue&quot;; const house = ref(4); const getAllChildrenBooks = (refs: &#123; [x: string]: any &#125;) =&gt; &#123; for (let key in refs) &#123; refs[key].books += 3; &#125; &#125;; defineExpose(&#123; house &#125;);&lt;/script&gt; å­ç»„ä»¶ï¼š 12345678910111213141516171819&lt;template&gt; &lt;div class=&quot;child&quot;&gt; &lt;h3&gt;Child 1 Comp&lt;/h3&gt; &lt;h4&gt;books: &#123;&#123; books &#125;&#125;&lt;/h4&gt; &lt;button @click=&quot;minusHouse($parent)&quot;&gt;take one house&lt;/button&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; ref &#125; from &quot;vue&quot;; const books = ref(3); defineExpose(&#123; books &#125;); const minusHouse = (parent: any) =&gt; &#123; if (parent.house &lt;= 0) return; parent.house--; &#125;;&lt;/script&gt; å¯ä»¥çœ‹å‡ºè¿™ä¸ªå±æ€§å¾—é…åˆ defineExpose() ä½¿ç”¨ï¼Œä¸”å¿…é¡»æ˜¯çˆ¶å­ç»„ä»¶ åœ¨å„è‡ªç»„ä»¶é‡Œï¼Œé€šè¿‡å›è°ƒå‡½æ•° $parent è·å–çˆ¶ç»„ä»¶ï¼Œé€šè¿‡ $refs è·å–å­ç»„ä»¶ è¿™ç§å†™æ³•ï¼Œå…è®¸åœ¨çˆ¶ç»„ä»¶è·å–å¤šä¸ªå­ç»„ä»¶çš„å˜é‡å€¼æ•°æ® éš”ä»£\\è·¨ä»£ä¼ å€¼$attrParentComp.vue 1234567891011121314151617181920&lt;template&gt; &lt;div class=&quot;parent&quot;&gt; &lt;h1&gt;Parent Comp&lt;/h1&gt; &lt;h2&gt;a: &#123;&#123; a &#125;&#125;&lt;/h2&gt; &lt;h2&gt;b: &#123;&#123; b &#125;&#125;&lt;/h2&gt; &lt;ChildComp :a=&quot;a&quot; :b=&quot;b&quot; v-bind=&quot;&#123; x: 100 &#125;&quot; :updateA=&quot;updateA&quot; /&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import ChildComp from &quot;./ChildComp.vue&quot;; import &#123; ref &#125; from &quot;vue&quot;; const a = ref(1); const b = ref(2); const updateA = (val: number) =&gt; &#123; a.value += val; &#125;;&lt;/script&gt; ChildComp.vueä¸­é—´çš„ç»„ä»¶ï¼Œä»…å†™ä¸€ä¸ªå±æ€§å°±å¤Ÿäº† v-bind=&quot;$attrs&quot; 12345678910&lt;template&gt; &lt;div class=&quot;child&quot;&gt; &lt;h1&gt;Child Comp&lt;/h1&gt; &lt;GrandChildComp v-bind=&quot;$attrs&quot; /&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import GrandChildComp from &quot;./GrandChildComp.vue&quot;;&lt;/script&gt; GrandChildComp.vueæœ€åº•å±‚çš„ç»„ä»¶ç›´æ¥æ¥æ”¶ 1234567891011121314&lt;template&gt; &lt;div class=&quot;grandChild&quot;&gt; &lt;h1&gt;Grand Child Comp&lt;/h1&gt; &lt;h2&gt;props from Parent:&lt;/h2&gt; &lt;h3&gt;&#123;&#123; a &#125;&#125;&lt;/h3&gt; &lt;h3&gt;&#123;&#123; b &#125;&#125;&lt;/h3&gt; &lt;h3&gt;&#123;&#123; x &#125;&#125;&lt;/h3&gt; &lt;button @click=&quot;updateA(3)&quot;&gt;cb to parent updateA&lt;/button&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; defineProps([&quot;a&quot;, &quot;b&quot;, &quot;x&quot;, &quot;updateA&quot;]);&lt;/script&gt; ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œä¸­é—´çš„å±‚çº§å¦‚æœåªå†™ v-bind=&quot;$attrs&quot; å°±å¯ä»¥æ— é™å±‚çº§çš„ä¼ å‚ï¼Œè€Œä»æœ€åº•å±‚çš„å­ç»„ä»¶å¼€å§‹ï¼Œå¦‚æœè¦å›ä¼ åˆ°æœ€é¡¶å±‚ï¼Œä¹Ÿåªéœ€å†™å›è°ƒå‡½æ•°å³å¯ provide + injectè¿™ä¸ªæ¯”èµ·ä¸Šä¸€ä¸ªæ›´ç®€å•ï¼Œä¸Šä¸€ä¸ªä¸­é—´ç»„ä»¶è¿˜éœ€è¦å†™ä¸€ä¸ª v-bind=&quot;$attrs&quot;å±æ€§ï¼Œè€Œè¿™ç§æ–¹æ³•ä¸­é—´ç»„ä»¶ä¸ç”¨æ·»åŠ ä»»ä½•å±æ€§ ç¥–å…ˆç»„ä»¶ç”¨ provide æ³¨å…¥æ•°æ®ï¼Œåä»£ç»„ä»¶ç”¨ inject è·å–æ•°æ® ç¥–å…ˆç»„ä»¶ï¼š 1234567891011121314151617181920212223242526&lt;template&gt; &lt;div class=&quot;parent&quot;&gt; &lt;h1&gt;Parent Comp&lt;/h1&gt; &lt;h2&gt;house: &#123;&#123; house &#125;&#125; ä¸‡å…ƒ&lt;/h2&gt; &lt;h2&gt;car: &#123;&#123; car.price &#125;&#125; ä¸‡å…ƒ&lt;/h2&gt; &lt;ChildComp /&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import ChildComp from &quot;./ChildComp.vue&quot;; import &#123; ref, reactive, provide &#125; from &quot;vue&quot;; const house = ref(800); const car = reactive(&#123; brand: &quot;Benz&quot;, price: 80, &#125;); const updateHousePrice = (value: number) =&gt; &#123; house.value -= value; &#125;; provide(&quot;houseContext&quot;, &#123; house, updateHousePrice &#125;); provide(&quot;car&quot;, car);&lt;/script&gt; æœ€åº•å±‚çš„å­™å­ç»„ä»¶ï¼š 1234567891011121314151617181920&lt;template&gt; &lt;div class=&quot;grandgrandChild&quot;&gt; &lt;h1&gt;Grand Grand Child Comp&lt;/h1&gt; &lt;h2&gt;house &amp; car from parent:&lt;/h2&gt; &lt;h3&gt;house: &#123;&#123; house &#125;&#125; ä¸‡å…ƒ&lt;/h3&gt; &lt;h3&gt;car: ä¸€è¾†&#123;&#123; y.brand &#125;&#125;è½¦ï¼Œä»·å€¼&#123;&#123; y.price &#125;&#125; ä¸‡å…ƒ&lt;/h3&gt; &lt;button @click=&quot;updateHousePrice(1)&quot;&gt;ä¿®æ”¹houseä»·å€¼&lt;/button&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; inject &#125; from &quot;vue&quot;; // ç›´æ¥è§£æ„å‡ºå›è°ƒå‡½æ•°updateHousePrice const &#123; house, updateHousePrice &#125; = inject(&quot;houseContext&quot;, &#123; house: 0, updateHousePrice: (num: number) =&gt; &#123;&#125;, &#125;); const y = inject(&quot;car&quot;, &#123; brand: &quot;BMW&quot;, price: 60 &#125;);&lt;/script&gt; ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼š provide çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å®šä¹‰æ‰€ä¼ çš„å€¼çš„åå­—ï¼Œç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯å•ä¸€å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤æ‚çš„å¯¹è±¡ inject çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å®šä¹‰æ‰€ä¼ çš„å€¼çš„åå­—ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯é»˜è®¤å€¼ï¼Œå¦‚æœä¼ å€¼å¤±è´¥ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ provide å’Œ inject æ˜¯ vue3 çš„æ–°ç‰¹æ€§ï¼Œåœ¨ vue2 ä¸­ï¼Œå¯ä»¥é€šè¿‡ $parent å’Œ $children æ¥å®ç° ä»»æ„ç»„ä»¶äº’ä¼ mittè¿™æ˜¯ä¸€ä¸ªç‹¬ç«‹å‹ç¼©ååªæœ‰å‡ ç™¾å­—èŠ‚çš„åº“ mittï¼Œnode ç¯å¢ƒä¸‹å‡å¯ç”¨ï¼Œä¸ä»…ä»…å±€é™äº vue 1npm install mitt åˆ›å»º utils/emitter.ts æ–‡ä»¶ 12345678import mitt, &#123; type Emitter &#125; from &quot;mitt&quot;;type Events = &#123; [key: string]: string;&#125;;const emitter: Emitter&lt;Events&gt; = mitt();export default emitter; ç»„ä»¶ 1 1234567891011121314&lt;template&gt; &lt;div class=&quot;comp1&quot;&gt; &lt;h2&gt;ç»„ä»¶1&lt;/h2&gt; &lt;h3&gt;æˆ‘çš„ç©å…·ï¼š&#123;&#123; toyCar &#125;&#125;&lt;/h3&gt; &lt;button @click=&quot;emitter.emit(&#x27;send-to-comp2&#x27;, toyCar)&quot;&gt;å‘é€ç»™ç»„ä»¶2&lt;/button&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; ref &#125; from &quot;vue&quot;; import emitter from &quot;@/utils/emitter&quot;; const toyCar = ref(&quot;ğŸš™&quot;);&lt;/script&gt; ç»„ä»¶ 2 12345678910111213141516171819&lt;template&gt; &lt;div class=&quot;comp2&quot;&gt; &lt;div&gt;my toy: &#123;&#123; toyCarFrComp1 &#125;&#125;&lt;/div&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; ref, onUnmounted &#125; from &quot;vue&quot;; import emitter from &quot;@/utils/emitter&quot;; const toyCarFrComp1 = ref(&quot;&quot;); emitter.on(&quot;send-to-comp2&quot;, (value: string) =&gt; &#123; toyCarFrComp1.value = value; &#125;); onUnmounted(() =&gt; &#123; emitter.off(&quot;send-to-comp2&quot;); &#125;);&lt;/script&gt; å‘é€æ•°æ®æ–¹ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ emitter é‡Œè°ƒç”¨äº† .emit() æ–¹æ³•ï¼Œ.emit() æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº‹ä»¶åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯äº‹ä»¶æºå¸¦çš„æ•°æ®ã€‚ æ¥å—æ•°æ®æ–¹ï¼Œå¯ä»¥çœ‹åˆ°ä¸Šé¢çš„ emitter é‡Œè°ƒç”¨äº† .on() æ–¹æ³•ï¼Œ.on() æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº‹ä»¶åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯äº‹ä»¶ç›‘å¬å‡½æ•°ã€‚èµ‹å€¼ç»™é¡µé¢å¯¹åº”çš„å˜é‡å onUnmounted çš„ä½œç”¨æ˜¯åœ¨ç»„ä»¶å¸è½½æ—¶ï¼Œä¹Ÿå¸è½½æ‰ç›‘å¬äº‹ä»¶ï¼Œé¿å…å†…å­˜ç•™å­˜ Piniaè¿™ç§åœ¨ä¸Šé¢å•ç‹¬æ‹å‡ºæ¥çš„è®²äº†ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œç›´æ¥çœ‹ä¸Šé¢çš„ä¾‹å­ customRef è‡ªå®šä¹‰å“åº”å¼è¿™æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ apiï¼Œä¾‹å¦‚å®ç°é˜²æŠ–ï¼Œæˆ‘ä»¬ç”¨æ™®é€š ref æ—¶åŠ ä¸ŠåŒå‘æ•°æ®ç»‘å®šæ—¶ï¼Œinput æ¡†è¾“å…¥å®æ—¶å˜åŒ–éƒ½ä¼šå®æ—¶æ¸²æŸ“ï¼Œå¦‚æœé¡µé¢ä¿¡æ¯è¿‡å¤šï¼Œé‚£ä¹ˆä¼šå½±å“æ€§èƒ½ï¼Œæ‰€ä»¥éœ€è¦ç”¨åˆ° customRefå®ç°é˜²æŠ–åŠŸèƒ½ï¼š æˆ‘ä»¬æŠŠä»–å†™ä¸ºä¸€ä¸ªé’©å­å‡½æ•°ï¼š 123456789101112131415161718192021222324import &#123; customRef &#125; from &quot;vue&quot;;const useDelayInput = (initVal: string = &quot;&quot;, delay: number = 500) =&gt; &#123; const msg = customRef((track, trigger) =&gt; &#123; return &#123; // msg è¢«è¯»å–æ—¶è°ƒç”¨ï¼š get() &#123; track(); // return initVal; &#125;, // msg è¢«ä¿®æ”¹æ—¶è°ƒç”¨ï¼š set(value) &#123; clearTimeout(delay); delay = setTimeout(() =&gt; &#123; initVal = value; trigger(); &#125;, delay); &#125;, &#125;; &#125;); return msg;&#125;;export default useDelayInput; ä½¿ç”¨ï¼š 1234567891011&lt;template&gt; &lt;div class=&quot;app&quot;&gt; &lt;h2&gt;&#123;&#123; msg &#125;&#125;&lt;/h2&gt; &lt;input type=&quot;text&quot; v-model=&quot;msg&quot; /&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import useDelayInput from &quot;../hooks/useDelayInput&quot;; const msg = useDelayInput(&quot;customRef&quot;, 800);&lt;/script&gt; ä»é’©å­å‡½æ•°å¯ä»¥å‡ºï¼š customRef é‡Œæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡é‡Œæœ‰ get å’Œ set æ–¹æ³•ï¼Œget æ–¹æ³•æ˜¯è¯»å–æ•°æ®ï¼Œset æ–¹æ³•æ˜¯ä¿®æ”¹æ•°æ® track å’Œ trigger æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œtrack æ˜¯è¯»å–æ•°æ®æ—¶è°ƒç”¨ï¼Œtrigger æ˜¯ä¿®æ”¹æ•°æ®æ—¶è°ƒç”¨ track çš„ä½œç”¨æ˜¯å‘Šè¯‰ vue è¿½è¸ªä¾èµ–ï¼Œtrigger æ˜¯å‘Šè¯‰ vue è§¦å‘ä¾èµ– shallowRef å’Œ shallowReactiveè¿™ 2 ä¸ª api æ—¨åœ¨å¯¹ä»˜é‚£äº›æ¯”è¾ƒå¤§çš„ Objectï¼Œåªç›‘å¬ç¬¬ä¸€å±‚ï¼Œå±‚æ¬¡æ¯”è¾ƒæ·±çš„æ•°æ®ä¸ä¼šè¢«ç›‘å¬åˆ° shallowRef ä¸¾ä¾‹ï¼š 1234567891011121314151617&lt;script lang=&quot;ts&quot; setup&gt; import &#123; shallowRef, shallowReactive &#125; from &quot;vue&quot;; // å½“ä¿®æ”¹ä»¥ä¸‹æ•°æ®æ—¶ï¼š const toy = shallowRef(&#123; toy: &quot;ğŸš—&quot;, &#125;); const change = () =&gt; &#123; // âŒ æ— æ•ˆä¿®æ”¹ï¼šshallowRef åªç›‘å¬ç¬¬ä¸€å±‚ï¼Œåªä¼šç›‘å¬åˆ° toy.value // toy.value.toy = &quot;ğŸš™&quot;; // âœ… ä¿®æ”¹æˆåŠŸ toy.value = &#123; toy: &quot;ğŸš™&quot;, &#125;; &#125;;&lt;/script&gt; shallowRef ä¸¾ä¾‹ï¼š 123456789101112131415&lt;script lang=&quot;ts&quot; setup&gt; import &#123; shallowReactive &#125; from &quot;vue&quot;; const nations = shallowRef(&#123; China: &quot;CN&quot;, &#125;); const changenations = () =&gt; &#123; // âŒæ— æ•ˆä¿®æ”¹ï¼š // nations.value.China = &#x27;ä¸­å›½&#x27; // âœ… ä¿®æ”¹æˆåŠŸ nations.value = &#123; China: &quot;ä¸­å›½&quot;, &#125;; &#125;;&lt;/script&gt; shallowReactive ä¸¾ä¾‹ï¼š 1234567891011&lt;script lang=&quot;ts&quot; setup&gt; const toys = shallowReactive(&#123; car: &quot;ğŸš—&quot;, animals: &#123; dog: &quot;ğŸ­&quot;, cat: &quot;ğŸ±&quot; &#125;, &#125;); // âœ… ä¿®æ”¹æˆåŠŸ: ä½äºå¯¹è±¡ç¬¬ä¸€å±‚ï¼š const changeToyCar = () =&gt; (toys.car = &quot;ğŸš™&quot;); // âŒ æ— æ•ˆä¿®æ”¹ï¼šä½äºå¯¹è±¡æ›´æ·±çš„å±‚æ¬¡ï¼š const changeAnimals = () =&gt; (toys.animals.dog = &quot;ğŸ¶&quot;);&lt;/script&gt; ä½†å½“æˆ‘æŠŠä¸Šé¢ const changeToyCar = () =&gt; (toys.car = &quot;ğŸš™&quot;); å‡½æ•°æ”¹ä¸ºï¼š 12345678&lt;script lang=&quot;ts&quot; setup&gt; // âœ… ä¿®æ”¹æˆåŠŸ: // â—ï¸ä½†ä¸æ¨èï¼Œå› ä¸ºå¯¹è±¡ä¼šè§¦å‘ä¸¤æ¬¡ä¿®æ”¹ï¼š const changeToyCar = () =&gt; &#123; toys.car = &quot;ğŸš™&quot;; toys.animals.dog = &quot;ğŸ¶&quot;; &#125;;&lt;/script&gt; ç¡®ä¸¤ä¸ªéƒ½æˆåŠŸäº†ï¼Œtoys.animals.dogï¼Œå°½ç®¡è¿™ä¸ªå±æ€§ä¸æ˜¯å“åº”å¼çš„ï¼Œä½†å› ä¸ºä¹‹å‰å¯¹ toys.car çš„ä¿®æ”¹å·²ç»è§¦å‘äº†æ›´æ–°ï¼Œæ‰€ä»¥ä»»ä½•ä¾èµ–äº toys çš„è§†å›¾éƒ½ä¼šé‡æ–°æ¸²æŸ“ï¼Œè¿™æ—¶ä½ ä¼šçœ‹åˆ° toys.animals.dog çš„æ–°å€¼ã€‚æ‰€ä»¥ä¸æ¨èè¿™ç§å†™æ³•ï¼Œä»–ä¸shallowRefçš„åŸæ„èƒŒé“è€Œé©°ï¼Œç›´æ¥ç”¨ refå³å¯ã€‚ readOnly å’Œ shallowReadOnlyå¯¹è±¡æ•´ä½“åªè¯»å’Œæµ…å±‚åªè¯»ï¼Œåªé’ˆå¯¹äº reactive åŒ…è£¹çš„å¯¹è±¡å±æ€§ï¼Œçœ‹ä¸‹é¢çš„ä¾‹å­ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142&lt;template&gt; &lt;div&gt; &lt;p&gt;Deep Readonly Car: &#123;&#123; deepReadonlyCar &#125;&#125;&lt;/p&gt; &lt;p&gt;Shallow Readonly Car: &#123;&#123; shallowReadonlyCar &#125;&#125;&lt;/p&gt; &lt;p&gt; Nested Property in Shallow Readonly: &#123;&#123; shallowReadonlyCar.details.color &#125;&#125; &lt;/p&gt; &lt;button @click=&quot;tryToModify&quot;&gt;Try to Modify&lt;/button&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; readonly, shallowReadonly, reactive &#125; from &quot;vue&quot;; // åˆ›å»ºä¸€ä¸ªå“åº”å¼å¯¹è±¡ const car = reactive(&#123; model: &quot;Tesla Model 3&quot;, details: &#123; color: &quot;Red&quot;, year: 2023, &#125;, &#125;); // ä½¿ç”¨ readonly åˆ›å»ºä¸€ä¸ªæ·±å±‚åªè¯»çš„å“åº”å¼å¯¹è±¡ const deepReadonlyCar = readonly(car); // ä½¿ç”¨ shallowReadonly åˆ›å»ºä¸€ä¸ªæµ…å±‚åªè¯»çš„å“åº”å¼å¯¹è±¡ const shallowReadonlyCar = shallowReadonly(car); // å°è¯•ä¿®æ”¹å¯¹è±¡çš„å‡½æ•° const tryToModify = () =&gt; &#123; // âŒ è¿™ä¸ªå¯¹è±¡åªè¯»ï¼Œæ‰€ä»¥æ§åˆ¶å°ä¼šå‘å‡ºè­¦å‘Š warn ä¸èƒ½ä¿®æ”¹ deepReadonlyCar.model = &quot;Tesla Model S&quot;; // âŒ æµ…å±‚åªè¯»å¯¹è±¡ï¼Œä¾ç„¶ä¸èƒ½ä¿®æ”¹ shallowReadonlyCar.model = &quot;Tesla Model X&quot;; // è¿™å°†ä¸ä¼šç”Ÿæ•ˆï¼Œå¹¶ä¸”æ§åˆ¶å°ä¼šç»™å‡ºè­¦å‘Š // âœ… æˆåŠŸï¼ŒshallowReadonlyCar çš„åµŒå¥—å¯¹è±¡å±æ€§ï¼Œå› ä¸º shallowReadonly æ˜¯æµ…å±‚çš„ shallowReadonlyCar.details.color = &quot;Blue&quot;; // è¿™å°†ç”Ÿæ•ˆï¼Œä½†ä¿®æ”¹ä¸ä¼šè§¦å‘å“åº”å¼æ›´æ–° &#125;;&lt;/script&gt; toRaw å’Œ markRawtoRaw : è¿™æ˜¯ä¸€ä¸ªå¯ä»¥ç”¨äºä¸´æ—¶è¯»å–è€Œä¸å¼•èµ·ä»£ç†è®¿é—®/è·Ÿè¸ªå¼€é”€ï¼Œæˆ–æ˜¯å†™å…¥è€Œä¸è§¦å‘æ›´æ”¹çš„ç‰¹è¾£æ–¹æ³•ã€‚ä¸å»ºè®®ä¿å­˜å¯¹åŸå§‹å¯¹è±¡çš„æŒä¹…å¼•ç”¨ï¼Œè¯·è¿˜æ…ä½¿ç”¨ã€‚toRaw ä½•æ—¶ä½¿ç”¨ï¼Ÿâ€”-åœ¨éœ²è¦å°†å“åº”å¼å¯¹è±¡ä¼ é€’ç»™é Vue çš„åº“æˆ–å¤–éƒ¨ç³»ç»Ÿæ—¶ï¼Œä½¿ç”¨ toRaw å¯ä»¥ç¡®ä¿å®ƒä»¬æ”¶åˆ°çš„æ˜¯æ™®é€šå¯¹è±¡ markRaw æ ‡è®°ä¸€ä¸ªå¯¹è±¡ï¼Œä½¿å…¶æ°¸è¿œä¸ä¼šå˜æˆå“åº”å¼çš„ ä¾‹å­ï¼š 123456789101112131415161718192021222324252627282930&lt;template&gt; &lt;div&gt; &lt;p&gt;Raw Value: &#123;&#123; rawValue.foo &#125;&#125;&lt;/p&gt; &lt;p&gt;Marked Raw Value: &#123;&#123; markedRawValue.foo &#125;&#125;&lt;/p&gt; &lt;button @click=&quot;modifyToRaw&quot;&gt;Modify to Raw&lt;/button&gt; &lt;button @click=&quot;modifyMarkRaw&quot;&gt;Modify Marked Raw&lt;/button&gt; &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt; import &#123; reactive, toRaw, markRaw &#125; from &quot;vue&quot;; const reactiveValue = reactive(&#123; foo: &quot;Reactive Foo&quot; &#125;); // ä½¿ç”¨ toRaw è·å–å“åº”å¼å¯¹è±¡çš„åŸå§‹å¯¹è±¡ const rawValue = toRaw(reactiveValue); const originalObject = &#123; foo: &quot;Marked Raw Foo&quot; &#125;; const markedRawValue = markRaw(originalObject); const modifyToRaw = () =&gt; &#123; // ä¿®æ”¹åŸå§‹å¯¹è±¡çš„å±æ€§ï¼Œä¸ä¼šè§¦å‘è§†å›¾æ›´æ–°ï¼Œå› ä¸ºå®ƒä¸æ˜¯å“åº”å¼çš„ rawValue.foo = &quot;Modified Raw Foo&quot;; &#125;; const modifyMarkRaw = () =&gt; &#123; // ä¿®æ”¹è¢«æ ‡è®°ä¸ºåŸå§‹çš„å¯¹è±¡ï¼ŒåŒæ ·ä¸ä¼šè§¦å‘è§†å›¾æ›´æ–° markedRawValue.foo = &quot;Modified Marked Raw Foo&quot;; &#125;;&lt;/script&gt; Teleportè¿™ä¸ªç±»ä¼¼ React çš„ createPortal åŠŸèƒ½ã€‚æˆ‘ä»¬çœ‹çœ‹ React å®˜ç½‘çš„ç¤ºä¾‹ä»£ç ï¼š 1234&lt;div&gt; &lt;SomeComponent /&gt; &#123;createPortal(children, domNode, key?)&#125;&lt;/div&gt; å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¤šæŠŠå¼¹æ¡†ä»åº•å±‚ä¼ é€åˆ° &lt;body&gt; ä¸Šï¼Œè€Œä¸æ˜¯æŸå±‚çš„å­ç»„ä»¶ä¸Šã€‚ 123456789101112131415161718&lt;template&gt; &lt;div&gt; &lt;button @click=&quot;showModal = true&quot;&gt;pop out modal&lt;/button&gt; &lt;teleport to=&quot;body&quot;&gt; &lt;div v-if=&quot;showModal&quot; class=&quot;modal&quot;&gt; &lt;h2&gt;title&lt;/h2&gt; &lt;p&gt;this is a modal create by teleport&lt;/p&gt; &lt;button @click=&quot;showModal = false&quot;&gt;close&lt;/button&gt; &lt;/div&gt; &lt;/teleport&gt; &lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; import &#123; ref &#125; from &quot;vue&quot;; const showModal = ref(false);&lt;/script&gt; suspence å¼‚æ­¥ç»„ä»¶å‚è€ƒäº† React 18 çš„ suspence ç»„ä»¶ï¼Œsuspenceä¹Ÿæ˜¯ Vue3 çš„æ–°ç‰¹æ€§ï¼Œç”¨äºå®ç°ç»„ä»¶çš„æ‡’åŠ è½½ã€‚ ä½¿ç”¨ä¾‹å­å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223&lt;template&gt; &lt;div&gt; &lt;h1&gt;Vue 3 Suspense Example&lt;/h1&gt; &lt;Suspense&gt; &lt;template #default&gt; &lt;!-- &lt;AsyncComponent /&gt; --&gt; &lt;FetchComp /&gt; &lt;/template&gt; &lt;template #fallback&gt; &lt;h1&gt;Loading...&lt;/h1&gt; &lt;/template&gt; &lt;/Suspense&gt; &lt;FetchComp /&gt; &lt;/div&gt;&lt;/template&gt;&lt;script setup lang=&quot;ts&quot;&gt; import &#123; defineAsyncComponent, Suspense &#125; from &quot;vue&quot;; import FetchComp from &quot;./FetchComp.vue&quot;; // import()å®šä¹‰ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶ const AsyncComponent = defineAsyncComponent(() =&gt; import(&quot;./AsyncComp.vue&quot;));&lt;/script&gt; FetchComp.vue 1234567891011&lt;template&gt; &lt;h2&gt;fetch comp&lt;/h2&gt; &lt;div class=&quot;chlid&quot;&gt;&#123;&#123; content &#125;&#125;&lt;/div&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt; const request = await fetch( &quot;https://api.uomg.com/api/rand.qinghua?format=json&quot; ); const &#123; content &#125; = await request.json();&lt;/script&gt; å…¨å±€ apiVue3 åœ¨ main.ts ä¸­ï¼Œå¯ä»¥ç”¨å…¨å±€ api æ³¨å†Œå…¨å±€ç»„ä»¶ï¼Œ app.component(name, component) æ³¨å†Œå…¨å±€ç»„ä»¶ app.directive(name, directive) æ³¨å†Œå…¨å±€æŒ‡ä»¤ app.provide(key, value) æ³¨å†Œå…¨å±€ provide/inject app.config.globalProperties.$foo = &#39;bar&#39; æ³¨å†Œå…¨å±€å±æ€§ app.unmount(element) å¸è½½åº”ç”¨ app.use(plugin) å®‰è£…æ’ä»¶ ä¾‹å­ï¼š 1234567891011121314151617181920212223242526272829import &#123; createApp &#125; from &quot;vue&quot;;import App from &quot;./App.vue&quot;;import &#123; createPinia &#125; from &quot;pinia&quot;;import router from &quot;./router&quot;;import Hello from &quot;./GlobalHello.vue&quot;;const app = createApp(App);const pinia = createPinia();app.use(pinia);app.use(router);app.mount(&quot;#app&quot;);// å®šä¹‰å…¨å±€ç»„ä»¶ï¼šapp.component(&quot;globalHello&quot;, Hello);// å®šä¹‰å…¨å±€å˜é‡ï¼šapp.config.globalProperties.globalVariable = 999;// å®˜æ–¹å»ºè®® type å£°æ˜ï¼šdeclare module &quot;vue&quot; &#123; interface ComponentCustomProperties &#123; globalVariable: number; &#125;&#125;// è‡ªå®šä¹‰æŒ‡ä»¤ï¼šapp.directive(&quot;focus&quot;, (ele) =&gt; &#123; ele.style.color = &quot;red&quot;; ele.style.backgoundColor = &quot;green&quot;;&#125;); åœ¨ä»»æ„ä¸€ä¸ª src ä¸‹çš„ç»„ä»¶ä¸­ä½¿ç”¨ï¼Œä¸”ä¸éœ€è¦ import 1234567&lt;template&gt; &lt;GlobalHello /&gt; &lt;div&gt;&#123;&#123; globalNumber &#125;&#125;&lt;/div&gt; &lt;input v-focus /&gt;&lt;/template&gt;&lt;script lang=&quot;ts&quot; setup&gt;&lt;/script&gt; æ•ˆæœå¦‚ä¸‹å›¾ï¼š éå…¼å®¹æ€§æ”¹å˜å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ é‡ç‚¹å…³æ³¨è¿™äº›æ¯”è¾ƒå¸¸ç”¨çš„ï¼š è¿‡æ¸¡ç±»å v-enter ä¿®æ”¹ä¸º v-enter-fromã€è¿‡æ¸¡ç±»å v-leave ä¿®æ”¹ä¸º v-leave-fromã€‚ keyCode ä½œä¸º v-on ä¿®é¥°ç¬¦çš„æ”¯æŒ v-model æŒ‡ä»¤åœ¨ç»„ä»¶ä¸Šçš„ä½¿ç”¨å·²ç»è¢«é‡æ–°è®¾è®¡ï¼Œæ›¿æ¢æ‰äº† y-bind.sync v-if å’Œ v-for åœ¨åŒä¸€ä¸ªå…ƒç´ èº«ä¸Šä½¿ç”¨æ—¶çš„ä¼˜å…ˆçº§å‘ç”Ÿäº†å˜åŒ–ã€‚v-if ä¼˜å…ˆçº§ &gt; v-for ä¼˜å…ˆçº§ ç§»é™¤äº† $onã€$off å’Œ $once å®ä¾‹æ–¹æ³•ã€‚ ç§»é™¤äº†è¿‡æ»¤å™¨ filter ç§»é™¤äº† $children å®ä¾‹ propert","tags":["Vue"]},{"title":"Nodeé¢è¯•é¢˜åŠåŸç†æ€»ç»“","path":"/2024/04/29/ã€2024-04-29ã€‘Node é¢è¯•é¢˜/","content":"æœ€è¿‘é¢è¯•äº†ä¸€äº› Nodejs çš„å·¥ä½œï¼Œæ€»ç»“äº†ä¸€äº› Node åŸç†ã€‚è¿™é‡Œåˆ†äº«ä¸€ä¸‹ã€‚ 0. Node æ˜¯ä»€ä¹ˆï¼Ÿä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå¼€æºçš„ï¼ŒåŸºäº V8 å¼•æ“çš„ï¼Œéé˜»å¡å¼å¼‚æ­¥ I/O çš„ JavaScript è¿è¡Œç¯å¢ƒã€‚ å›ç­”ç‚¹ï¼šéé˜»å¡ I/O (å›è°ƒå‡½æ•°) + äº‹ä»¶é˜Ÿåˆ— ä¼˜ç‚¹ï¼š é«˜å¹¶å‘åœºæ™¯ IO å¯†é›†å‹åº”ç”¨ ï¼ˆå†…å­˜è¯»å–ï¼‰ ç¼ºç‚¹ï¼š ä¸é€‚åˆ CPU å¯†é›†å‹åº”ç”¨ï¼Œåªåœ¨å•æ ¸ CPU ä¸Šè¿è¡Œ ä»£ç æœ‰é—®é¢˜ï¼Œæ•´ä¸ªç³»ç»Ÿä¼šå‘ç”Ÿå´©æºƒ 1. Node çš„åº”ç”¨åœºæ™¯ åå°ç®¡ç†ç³»ç»Ÿï¼Œå®æ—¶äº¤äº’ï¼Œé«˜å¹¶å‘ canvas ç»˜å›¾ï¼Œè”ç½‘ web æ¸¸æˆï¼Œå®æ—¶äº¤äº’ï¼Œé«˜å¹¶å‘ webSocket, èŠå¤©å®¤ åˆ©ç”¨ dbï¼Œæ­å»º json api å•é¡µé¢æµè§ˆå™¨åº”ç”¨åŠåˆ›å»ºæœåŠ¡ 2. Node çš„å…¨å±€å¯¹è±¡å…¨å±€å¯¹è±¡æ˜¯æŒ‡åœ¨ä»»ä½•æ¨¡å—ä¸­éƒ½å¯ä»¥ç›´æ¥è®¿é—®åˆ°çš„å¯¹è±¡ï¼Œè€Œä¸éœ€è¦é€šè¿‡ require æˆ–å…¶ä»–æ–¹å¼è¿›è¡Œå¯¼å…¥ã€‚ globalæœ€åŸºç¡€çš„å…¨å±€å¯¹è±¡ï¼Œç±»ä¼¼äºæµè§ˆå™¨ç¯å¢ƒä¸­çš„ window å¯¹è±¡ã€‚åœ¨ Node.js ä¸­ï¼Œæ‰€æœ‰å…¨å±€å˜é‡ï¼ˆé™¤äº† global æœ¬èº«ä»¥å¤–ï¼‰éƒ½æ˜¯ global å¯¹è±¡çš„å±æ€§ã€‚ processè¿™æ˜¯ä¸€ä¸ªæä¾›äº†ä¸å½“å‰ Node.js è¿›ç¨‹äº’åŠ¨æ¥å£çš„å…¨å±€å¯¹è±¡ã€‚é€šè¿‡ process å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°å½“å‰è¿›ç¨‹çš„ä¿¡æ¯ï¼Œå¦‚ PIDï¼ˆè¿›ç¨‹ IDï¼‰ã€è¿è¡Œç¯å¢ƒç­‰ã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæä¾›äº†ä¸€äº›æ–¹æ³•ï¼Œå¦‚ process.exit()ç”¨äºé€€å‡ºå½“å‰è¿›ç¨‹ã€‚ consoleBufferåœ¨ Node.js ä¸­ï¼ŒBuffer ç±»æ˜¯ä¸€ä¸ªå…¨å±€å¯ç”¨çš„ç±»å‹ï¼Œç”¨äºå¤„ç†äºŒè¿›åˆ¶æ•°æ®ã€‚å®ƒå¯ä»¥ç”¨äºåœ¨ TCP æµã€æ–‡ä»¶ç³»ç»Ÿæ“ä½œã€ä»¥åŠå…¶ä»–ä¸Šä¸‹æ–‡ä¸­ä¸å…«ä½å­—èŠ‚æµè¿›è¡Œäº¤äº’ã€‚ setTimeout/setInterval/clearTimeout/clearIntervalè¿™äº›å…¨å±€å‡½æ•°ç”¨äºå¤„ç†å®šæ—¶å™¨ã€‚ä¾‹å¦‚ï¼ŒsetTimeout()å‡½æ•°ç”¨äºåœ¨æŒ‡å®šçš„æ¯«ç§’æ•°åæ‰§è¡Œä¸€ä¸ªå‡½æ•°ï¼Œè€Œ setInterval()å‡½æ•°åˆ™ç”¨äºå®šæœŸæ‰§è¡Œä¸€ä¸ªå‡½æ•°ã€‚ filenameè¿™æ˜¯ä¸€ä¸ªåŒ…å«å½“å‰æ­£åœ¨æ‰§è¡Œçš„è„šæœ¬çš„æ–‡ä»¶åçš„å…¨å±€å˜é‡ã€‚å®ƒè¿”å›çš„æ˜¯æ–‡ä»¶æ‰€åœ¨ä½ç½®çš„ç»å¯¹è·¯å¾„ã€‚ dirnameè¿™æ˜¯ä¸€ä¸ªåŒ…å«å½“å‰æ‰§è¡Œè„šæœ¬æ‰€åœ¨ç›®å½•çš„å…¨å±€å˜é‡ã€‚å®ƒè¿”å›çš„æ˜¯ç›®å½•çš„ç»å¯¹è·¯å¾„ã€‚ 3. æ¨¡å—åŠ è½½æœºåˆ¶ require()require åŠ è½½æ¨¡å—çš„æœºåˆ¶ CommonJS è§„èŒƒï¼šrequire æ˜¯åŸºäº CommonJS è§„èŒƒçš„æ¨¡å—åŠ è½½æ–¹å¼ï¼Œä¸»è¦åœ¨ Node.js ç¯å¢ƒä¸­ä½¿ç”¨ã€‚ åŠ¨æ€åŠ è½½ï¼šrequire å¯ä»¥åœ¨ä»£ç çš„ä»»ä½•åœ°æ–¹è¿›è¡Œè°ƒç”¨ï¼Œå…è®¸åŠ¨æ€åœ°åŠ è½½å’Œæ‰§è¡Œæ¨¡å—ã€‚ åŒæ­¥åŠ è½½ï¼šrequire æ˜¯åŒæ­¥çš„ï¼Œæ„å‘³ç€åœ¨æ¨¡å—åŠ è½½å®Œæˆä¹‹å‰ï¼Œä»£ç æ‰§è¡Œä¼šæš‚åœã€‚ ç¼“å­˜æœºåˆ¶ï¼šå½“ä½¿ç”¨ require åŠ è½½ä¸€ä¸ªæ¨¡å—æ—¶ï¼ŒNode.js ä¼šç¼“å­˜è¯¥æ¨¡å—ã€‚å¦‚æœå†æ¬¡å°è¯•åŠ è½½åŒä¸€ä¸ªæ¨¡å—ï¼ŒNode.js ä¼šç›´æ¥ä»ç¼“å­˜ä¸­å–å‡ºï¼Œè€Œä¸ä¼šé‡æ–°æ‰§è¡Œæ¨¡å—çš„ä»£ç ã€‚ å¯¼å‡ºæ–¹å¼ï¼šä½¿ç”¨ module.exports æˆ– exports æ¥å¯¼å‡ºæ¨¡å—æˆå‘˜ã€‚ import æ¨¡å—åŠ è½½æœºåˆ¶ ES6 (ECMAScript 2015) è§„èŒƒï¼šimport æ˜¯åŸºäº ES6 æ¨¡å—çš„åŠ è½½æ–¹å¼ï¼Œæ—¨åœ¨æä¾›é™æ€çš„æ¨¡å—ç»“æ„ã€‚ é™æ€åŠ è½½ï¼šimport è¯­å¥å¿…é¡»ä½äºæ–‡ä»¶çš„é¡¶éƒ¨ï¼Œä¸èƒ½åœ¨ä»£ç å—å†…ï¼ˆå¦‚ if è¯­å¥æˆ–å‡½æ•°å†…ï¼‰ä½¿ç”¨ã€‚ å¼‚æ­¥ä¸åŒæ­¥ï¼šè™½ç„¶ import ä¸»è¦æ˜¯åŒæ­¥çš„ï¼Œä½† ES6 ä¹Ÿå¼•å…¥äº†åŠ¨æ€ import() å‡½æ•°ï¼Œå®ƒè¿”å›ä¸€ä¸ª Promiseï¼Œå…è®¸å¼‚æ­¥åŠ è½½æ¨¡å—ã€‚ ä¸ç¼“å­˜ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼‰ï¼šä¸ require ä¸åŒï¼Œæ¯æ¬¡ä½¿ç”¨ import åŠ è½½æ¨¡å—æ—¶ï¼Œéƒ½ä¼šé‡æ–°æ‰§è¡Œæ¨¡å—çš„ä»£ç ï¼ˆé™¤éä½¿ç”¨äº†ç‰¹å®šçš„ç¼“å­˜ç­–ç•¥æˆ–æ‰“åŒ…å·¥å…·è¿›è¡Œäº†ä¼˜åŒ–ï¼‰ã€‚ å¯¼å‡ºæ–¹å¼ï¼šä½¿ç”¨ export å…³é”®å­—æ¥å¯¼å‡ºæ¨¡å—æˆå‘˜ã€‚ 4. åŸºç¡€æ¨¡å—åŸºäºäº‹ä»¶å¤„ç†ï¼Œnode å†…ç½®äº†ä¸åŒçš„æ¨¡å—ï¼Œå¦‚ fsã€httpã€pathã€osã€utilã€eventsã€stream ç­‰ã€‚ä¸‹é¢ï¼Œå¯¹ç›¸åº”çš„åŸºç¡€æ¨¡å—è¿›è¡Œä¸¾ä¾‹ï¼š fs æ–‡ä»¶è¯»å–å’Œå†™å…¥1234567891011121314const fs = require(&quot;fs&quot;);// è¯»å–æ–‡ä»¶å¼‚æ­¥ï¼šfs.readFile(&quot;example.txt&quot;, &quot;utf8&quot;, (err, data) =&gt; &#123; if (err) throw err; console.log(data);&#125;);// å†™å…¥æ–‡ä»¶const content = &quot;Hello, Node.js!&quot;;fs.writeFile(&quot;output.txt&quot;, content, (err) =&gt; &#123; if (err) throw err; console.log(&quot;The file has been saved!&quot;);&#125;); path æ–‡ä»¶è·¯å¾„å¤„ç†1234567const path = require(&quot;path&quot;);const fullPath = path.resolve(&quot;/foo/bar&quot;, &quot;./baz&quot;);console.log(fullPath); // è¾“å‡º: /foo/bar/bazconst extname = path.extname(&quot;index.html&quot;);console.log(extname); // è¾“å‡º: .html events äº‹ä»¶æ¨¡å—å¤„ç†12345678const EventEmitter = require(&quot;events&quot;);const emitter = new EventEmitter();emitter.on(&quot;myEvent&quot;, (arg1, arg2) =&gt; &#123; console.log(`Event triggered with $&#123;arg1&#125; and $&#123;arg2&#125;`);&#125;);emitter.emit(&quot;myEvent&quot;, &quot;Hello&quot;, &quot;World&quot;); // è¾“å‡º: Event triggered with Hello and World http HTTP è¯·æ±‚å’Œå“åº”1234567891011const http = require(&quot;http&quot;);const server = http.createServer((req, res) =&gt; &#123; res.writeHead(200, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;); res.end(&quot;Hello, World! &quot;);&#125;);const port = 3000;server.listen(port, () =&gt; &#123; console.log(`Server running at http://localhost:$&#123;port&#125;/`);&#125;); url å¤„ç†123456789const url = require(&quot;url&quot;);const myURL = new URL(&quot;https://example.com/path?name=value#hash&quot;);console.log(myURL.protocol); // è¾“å‡º: https:console.log(myURL.hostname); // è¾“å‡º: example.comconsole.log(myURL.pathname); // è¾“å‡º: /pathconsole.log(myURL.search); // è¾“å‡º: ?name=valueconsole.log(myURL.hash); // è¾“å‡º: #hash querystring å¤„ç†è¿™ä¸ªæ¨¡å—é…åˆä¸Šé¢çš„ url ä½¿ç”¨ 12345678const querystring = require(&quot;querystring&quot;);const params = querystring.parse(&quot;name=John&amp;age=30&quot;);console.log(params.name); // è¾“å‡º: Johnconsole.log(params.age); // è¾“å‡º: 30const stringified = querystring.stringify(&#123; name: &quot;Jane&quot;, age: 25 &#125;);console.log(stringified); // è¾“å‡º: name=Jane&amp;age=25 events äº‹ä»¶å¤„ç†12345678const EventEmitter = require(&quot;events&quot;);const emitter = new EventEmitter();emitter.on(&quot;myEvent&quot;, (arg1, arg2) =&gt; &#123; console.log(`Event triggered with $&#123;arg1&#125; and $&#123;arg2&#125;`);&#125;);emitter.emit(&quot;myEvent&quot;, &quot;Hello&quot;, &quot;World&quot;); // è¾“å‡º: Event triggered with Hello and World os æ“ä½œç³»ç»Ÿæ¨¡å—1234const os = require(&quot;os&quot;);console.log(os.homedir()); // è¾“å‡ºç”¨æˆ·çš„ä¸»ç›®å½•è·¯å¾„console.log(os.totalmem()); // è¾“å‡ºç³»ç»Ÿçš„æ€»å†…å­˜ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰ 5. Node æœ‰å“ªäº›ç½‘ç»œæ¨¡å—ä»¥ demo ä»£ç æ¥è¯´æ˜é—®é¢˜ï¼š http æ¨¡å—1234567891011const http = require(&quot;http&quot;);const server = http.createServer((req, res) =&gt; &#123; res.writeHead(200, &#123; &quot;Content-Type&quot;: &quot;text/plain&quot; &#125;); res.end(&quot;Hello, World! &quot;);&#125;);const PORT = process.env.PORT || 3000;server.listen(PORT, () =&gt; &#123; console.log(`Server is running on port $&#123;PORT&#125;`);&#125;); https æ¨¡å—12345678910111213141516171819const https = require(&quot;https&quot;);const fs = require(&quot;fs&quot;);// éœ€è¦SSLè¯ä¹¦çš„é…ç½®ï¼šconst options = &#123; key: fs.readFileSync(&quot;path/to/private.key&quot;), cert: fs.readFileSync(&quot;path/to/certificate.pem&quot;), ca: fs.readFileSync(&quot;path/to/ca.pem&quot;),&#125;;const server = https.createServer(options, (req, res) =&gt; &#123; res.writeHead(200); res.end(&quot;Hello, Secure World! &quot;);&#125;);const PORT = process.env.PORT || 443;server.listen(PORT, () =&gt; &#123; console.log(`Secure server is running on port $&#123;PORT&#125;`);&#125;); net æ¨¡å—TCP æ¨¡å—å¯ä»¥ç”¨æ¥åˆ›å»º TCP æœåŠ¡å™¨ã€‚æ¯”èµ· HTTP åº•å±‚ 1234567891011121314151617const net = require(&quot;net&quot;);const server = net.createServer((socket) =&gt; &#123; socket.write(&quot;Welcome to the TCP server! &quot;); socket.on(&quot;data&quot;, (data) =&gt; &#123; console.log(`Received from client: $&#123;data.toString()&#125;`); socket.write(`Server received: $&#123;data.toString()&#125;`); &#125;); socket.on(&quot;end&quot;, () =&gt; &#123; console.log(&quot;Client connection ended.&quot;); &#125;);&#125;);const PORT = process.env.PORT || 12345;server.listen(PORT, () =&gt; &#123; console.log(`TCP server is listening on port $&#123;PORT&#125;`);&#125;); 6. Node å¤„ç†é«˜å¹¶å‘ä»»åŠ¡çš„åŸç†éé˜»å¡ I/Oï¼šNode.js ä¸­çš„ I/O æ“ä½œï¼ˆå¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œé€šä¿¡ç­‰ï¼‰æ˜¯éé˜»å¡çš„ï¼Œè¿™æ„å‘³ç€å½“ä¸€ä¸ª I/O æ“ä½œè¢«å‘èµ·æ—¶ï¼ŒNode.js ä¸ä¼šç­‰å¾…è¿™ä¸ªæ“ä½œå®Œæˆï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç ã€‚å½“ I/O æ“ä½œå®Œæˆæ—¶ï¼Œä¼šé€šè¿‡å›è°ƒå‡½æ•°æˆ–è€… Promise çš„æ–¹å¼é€šçŸ¥ Node.jsï¼Œä»è€Œè¿›è¡Œåç»­å¤„ç†ã€‚è¿™ç§æ–¹å¼é¿å…äº†çº¿ç¨‹é˜»å¡ï¼Œä½¿å¾— Node.js å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚ã€‚ äº‹ä»¶é©±åŠ¨ï¼šNode.js é‡‡ç”¨äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œé€šè¿‡ç›‘å¬äº‹ä»¶æ¥å¤„ç†å„ç§ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œå½“ä¸€ä¸ª HTTP è¯·æ±‚åˆ°è¾¾æ—¶ï¼ŒNode.js ä¼šè§¦å‘ä¸€ä¸ª â€˜requestâ€™ äº‹ä»¶ï¼Œå¹¶å°†è¯·æ±‚å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™äº‹ä»¶å¤„ç†å‡½æ•°ã€‚è¿™ç§æ¨¡å‹ä½¿å¾— Node.js å¯ä»¥è½»æ¾åœ°å¤„ç†å¤§é‡å¹¶å‘çš„ç½‘ç»œè¿æ¥ã€‚ å¼‚æ­¥ç¼–ç¨‹ï¼šNode.js é¼“åŠ±ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼ï¼Œé€šè¿‡å›è°ƒå‡½æ•°ã€Promiseã€async/await ç­‰æŠ€æœ¯æ¥å¤„ç†å¼‚æ­¥æ“ä½œã€‚è¿™ä½¿å¾— Node.js èƒ½å¤Ÿåœ¨å¤„ç†ä¸€ä¸ªè¯·æ±‚çš„åŒæ—¶ï¼Œç»§ç»­æ¥æ”¶å’Œå¤„ç†å…¶ä»–è¯·æ±‚ï¼Œä»è€Œå®ç°é«˜å¹¶å‘ã€‚ å•çº¿ç¨‹çš„ä¼˜åŠ¿ï¼šè™½ç„¶ Node.js æ˜¯å•çº¿ç¨‹çš„ï¼Œä½†è¿™æ„å‘³ç€å®ƒä¸éœ€è¦åƒå¤šçº¿ç¨‹ç¯å¢ƒé‚£æ ·å¤„ç†å¤æ‚çš„çº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œä»è€Œé™ä½äº†ç¼–ç¨‹çš„å¤æ‚æ€§ã€‚æ­¤å¤–ï¼Œå•çº¿ç¨‹æ¨¡å‹ä¹Ÿä½¿å¾— Node.js åœ¨å¤„ç†å¤§é‡å¹¶å‘è¿æ¥æ—¶å…·æœ‰è¾ƒä½çš„å†…å­˜å ç”¨å’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚ åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨ï¼šå°½ç®¡ Node.js æœ¬èº«æ˜¯å•çº¿ç¨‹çš„ï¼Œä½†ä½ å¯ä»¥é€šè¿‡åˆ›å»ºå¤šä¸ª Node.js è¿›ç¨‹æ¥åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ Node.js çš„ cluster æ¨¡å—å¯ä»¥åˆ›å»ºå¤šä¸ªå·¥ä½œè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹è¿è¡Œåœ¨ä¸åŒçš„ CPU æ ¸å¿ƒä¸Šï¼Œä»è€Œå®ç°å¹¶è¡Œå¤„ç†ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ PM2 ç­‰å·¥å…·æ¥ç®¡ç†å’Œè´Ÿè½½å‡è¡¡å¤šä¸ª Node.js è¿›ç¨‹ã€‚ çº¿ç¨‹æ± å¤„ç† CPU å¯†é›†å‹ä»»åŠ¡ï¼šå¯¹äº CPU å¯†é›†å‹ä»»åŠ¡ï¼ˆå¦‚å¤§é‡çš„æ•°å­¦è®¡ç®—æˆ–æ•°æ®å¤„ç†ï¼‰ï¼ŒNode.js çš„å•çº¿ç¨‹æ¨¡å‹å¯èƒ½ä¸æ˜¯æœ€é«˜æ•ˆçš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ Node.js çš„ worker_threads æ¨¡å—æˆ–å…¶ä»–ç¬¬ä¸‰æ–¹çº¿ç¨‹æ± åº“ï¼ˆå¦‚å‰é¢æåˆ°çš„ node-worker-threads-poolï¼‰æ¥åˆ›å»ºå¤šçº¿ç¨‹ç¯å¢ƒï¼Œä»è€Œæé«˜ CPU å¯†é›†å‹ä»»åŠ¡çš„å¤„ç†èƒ½åŠ›ã€‚ 7. Node çš„å¤šçº¿ç¨‹å¤„ç†æ¨¡å—Node.js æœ¬èº«æ˜¯å•çº¿ç¨‹çš„ï¼Œé€šè¿‡äº‹ä»¶å¾ªç¯å’Œéé˜»å¡ I/O æ“ä½œå®ç°äº†é«˜å¹¶å‘ã€‚ç„¶è€Œï¼Œæœ‰äº› CPU å¯†é›†å‹ä»»åŠ¡å¯èƒ½ä¼šé˜»å¡äº‹ä»¶å¾ªç¯ï¼Œè¿™æ—¶å€™å¯ä»¥è€ƒè™‘ä½¿ç”¨çº¿ç¨‹æ± æ¥å¤„ç†è¿™äº›ä»»åŠ¡ã€‚ åœ¨ Node.js ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ worker_threads æ¨¡å—æ¥åˆ›å»ºå¤šçº¿ç¨‹ï¼Œä½†è¿™ä¸ªæ¨¡å—ç›¸å¯¹åº•å±‚ï¼Œç›´æ¥ä½¿ç”¨å¯èƒ½ä¼šæ¯”è¾ƒå¤æ‚ã€‚ä¸ºäº†ç®€åŒ–çº¿ç¨‹æ± çš„ä½¿ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œæ¯”å¦‚ fast-pool æˆ– node-worker-threads-poolã€‚ 1npm install node-worker-threads-pool ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ node-worker-threads-pool åº“åˆ›å»ºçº¿ç¨‹æ± çš„ç®€å•ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132const &#123; WorkerPool &#125; = require(&quot;node-worker-threads-pool&quot;);// åˆ›å»ºä¸€ä¸ªå…·æœ‰4ä¸ªå·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹æ± const pool = new WorkerPool(&#123; max: 4 &#125;);// å®šä¹‰ä¸€ä¸ªè¦åœ¨å·¥ä½œçº¿ç¨‹ä¸­æ‰§è¡Œçš„ä»»åŠ¡const task = (n) =&gt; &#123; let sum = 0; for (let i = 0; i &lt; n; i++) &#123; sum += i; &#125; return sum;&#125;;// å°†ä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± æ‰§è¡Œï¼Œå¹¶å¤„ç†è¿”å›çš„ç»“æœpool .exec(task, [100000000]) .then((result) =&gt; &#123; console.log(&quot;Result:&quot;, result); &#125;) .catch((err) =&gt; &#123; console.error(&quot;Error:&quot;, err); &#125;);// å½“ä¸å†éœ€è¦çº¿ç¨‹æ± æ—¶ï¼Œåº”è¯¥å…³é—­å®ƒ// æ³¨æ„ï¼šåœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸ä¼šåœ¨åº”ç”¨ç¨‹åºç»ˆæ­¢æ—¶å…³é—­çº¿ç¨‹æ± ã€‚// è¿™é‡Œä¸ºäº†ç¤ºä¾‹ç®€å•ï¼Œç›´æ¥åœ¨åé¢å…³é—­äº†ã€‚setTimeout(() =&gt; &#123; pool.terminate().then(() =&gt; &#123; console.log(&quot;Worker pool terminated&quot;); &#125;);&#125;, 5000); // ç­‰å¾…5ç§’åå…³é—­çº¿ç¨‹æ±  8. I/O æ¨¡å‹çš„åˆ†ç±»Node é‡Œç»å¸¸æåˆ°éé˜»å¡ I/O, é‚£ä¹ˆå¯¹äº I/O æ¨¡å‹ï¼Œä¹Ÿæ˜¯æœ‰å¤šé‡åˆ†ç±»ã€‚åœ¨ç”µè„‘ä¸­ï¼ŒIO æ˜¯å¤„ç†è¾“å…¥è¾“å‡ºæ“ä½œçš„ä¸åŒæ–¹å¼ã€‚è¿™äº›æ¨¡å‹ä¸»è¦å…³æ³¨äºå¦‚ä½•æœ‰æ•ˆåœ°ç®¡ç†æ•°æ®çš„è¯»å†™ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¶‰åŠç£ç›˜ã€ç½‘ç»œæˆ–å…¶ä»–å¤–éƒ¨è®¾å¤‡æ—¶ã€‚ é˜»å¡åœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œå½“ç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºæ‰§è¡Œä¸€ä¸ªç³»ç»Ÿè°ƒç”¨è¿›è¡Œ IO æ“ä½œæ—¶ï¼Œå¦‚æœè¯¥æ“ä½œä¸èƒ½ç«‹å³å®Œæˆï¼Œé‚£ä¹ˆåº”ç”¨ç¨‹åºä¼šè¢«é˜»å¡ï¼Œç›´åˆ°è¯¥ IO æ“ä½œå®Œæˆä¸ºæ­¢ã€‚åœ¨æ­¤æœŸé—´ï¼Œåº”ç”¨ç¨‹åºæ— æ³•æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚ éé˜»å¡ä¸é˜»å¡ IO ç›¸åï¼Œéé˜»å¡ IO æ¨¡å‹ä¸­çš„ç³»ç»Ÿè°ƒç”¨ä¼šç«‹å³è¿”å›ï¼Œæ— è®º IO æ“ä½œæ˜¯å¦å®Œæˆã€‚å¦‚æœæ•°æ®è¿˜æœªå‡†å¤‡å¥½ï¼Œç³»ç»Ÿè°ƒç”¨ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯æˆ–è€…è¡¨ç¤ºæ•°æ®æœªå‡†å¤‡å¥½çš„çŠ¶æ€ã€‚è¿™æ ·ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œè€Œä¸ä¼šè¢«é˜»å¡ã€‚ å¤šè·¯å¤ç”¨è¿™ç§æ¨¡å‹å…è®¸åº”ç”¨ç¨‹åºåŒæ—¶ç›‘æ§å¤šä¸ª IO é€šé“ï¼Œä¾‹å¦‚å¤šä¸ªç½‘ç»œè¿æ¥æˆ–æ–‡ä»¶æè¿°ç¬¦ã€‚é€šè¿‡ä½¿ç”¨ selectã€poll æˆ– epoll ç­‰ç³»ç»Ÿè°ƒç”¨ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ç­‰å¾…å¤šä¸ª IO äº‹ä»¶ï¼Œè€Œæ— éœ€ä¸ºæ¯ä¸ªé€šé“éƒ½ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹æˆ–è¿›ç¨‹ã€‚å½“æŸä¸ªé€šé“å‡†å¤‡å¥½è¿›è¡Œ IO æ“ä½œæ—¶ï¼Œåº”ç”¨ç¨‹åºä¼šæ”¶åˆ°é€šçŸ¥å¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚ å¼‚æ­¥åœ¨è¿™ç§æ¨¡å‹ä¸­ï¼Œå½“åº”ç”¨ç¨‹åºå‘èµ·ä¸€ä¸ª IO æ“ä½œåï¼Œå®ƒä¸éœ€è¦ç­‰å¾…è¯¥æ“ä½œçš„å®Œæˆã€‚ç›¸åï¼Œå½“æ•°æ®å‡†å¤‡å¥½æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šé€šè¿‡æŸç§æœºåˆ¶ï¼ˆå¦‚å›è°ƒå‡½æ•°ã€äº‹ä»¶æˆ–ä¿¡å·ï¼‰é€šçŸ¥åº”ç”¨ç¨‹åºã€‚è¿™ç§æ¨¡å‹å…è®¸åº”ç”¨ç¨‹åºç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œè€Œä¸éœ€è¦è½®è¯¢æˆ–ç­‰å¾… IO æ“ä½œçš„å®Œæˆã€‚ 9. Node çš„äº‹ä»¶å¾ªç¯æœºåˆ¶Node.js çš„äº‹ä»¶å¾ªç¯æ˜¯åŸºäº libuv è·¨å¹³å°çš„å¼‚æ­¥ I/O åº“ï¼ˆmulti-platform async IOï¼‰å®ç°çš„ã€‚è¿™ä¸ªåº“å…³è”åˆ°ä¸€ä¸ªEVENT_QUEUEå…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„äº‹ä»¶é˜Ÿåˆ—ï¼Œå¹¶ä¸”è¯¥äº‹ä»¶å¾ªç¯è´Ÿè´£å¤„ç†æ‰€æœ‰äº‹ä»¶EVENT_LOOPï¼ŒåŒ…æ‹¬å®šæ—¶å™¨ã€æ–‡ä»¶ç³»ç»Ÿæ“ä½œç­‰ã€‚ timers é˜¶æ®µï¼šæ­¤é˜¶æ®µæ‰§è¡Œå®šæ—¶å™¨ï¼ˆsetTimeout/setIntervalï¼‰çš„å›è°ƒå‡½æ•°ã€‚ I/O callbacks é˜¶æ®µï¼šæ‰§è¡Œé™¤äº†å®šæ—¶å™¨å’Œ setImmediate çš„å›è°ƒå¤–çš„ I/O å›è°ƒã€‚ idle å’Œ prepare é˜¶æ®µï¼šè¿™ä¸¤ä¸ªé˜¶æ®µä¸»è¦ä¸ºç³»ç»Ÿå†…éƒ¨ä½¿ç”¨ï¼Œå¯ä»¥è®¤ä¸ºæ˜¯é—²ç½®æ—¶é—´ã€‚ poll é˜¶æ®µï¼šè½®è¯¢å¯ç”¨çš„ I/O äº‹ä»¶ï¼Œæ‰§è¡Œä¸ I/O ç›¸å…³çš„å›è°ƒï¼ˆå‡ ä¹æ‰€æœ‰æƒ…å†µä¸‹ï¼Œé™¤äº†å…³é—­çš„å›è°ƒå‡½æ•°ï¼Œç”±è®¡æ—¶å™¨å’Œ setImmediate è°ƒåº¦çš„å›è°ƒå‡½æ•°ï¼‰ã€‚ check é˜¶æ®µï¼šåœ¨æ­¤é˜¶æ®µæ‰§è¡Œ setImmediate çš„å›è°ƒå‡½æ•°ã€‚ close callbacks é˜¶æ®µï¼šæ‰§è¡Œå…³é—­çš„å›è°ƒå‡½æ•°ï¼Œå¦‚ socket.on(â€˜closeâ€™, â€¦)ã€‚ å¾®ä»»åŠ¡ï¼šåŒ…æ‹¬process.nextTick()å’Œå…¶ä»–å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼ˆä¾‹å¦‚ Promise çš„å›è°ƒå‡½æ•°ï¼‰ã€‚ å®ä»»åŠ¡ï¼štimer queueï¼šsetTimeout/setIntervalpoll queue: IOcheck queue: setImmediateclose queue: socket.on(â€˜endâ€™) process orders: nextTick micro task queue other micro task queue timer queue poll queue check queue close queue here is the demo code: 1234567891011121314151617181920212223242526272829303132const fs = require(&quot;fs&quot;);console.log(&quot;Start&quot;);// å¼‚æ­¥æ–‡ä»¶ç³»ç»Ÿæ“ä½œfs.readFile(__filename, &quot;utf8&quot;, (err, data) =&gt; &#123; if (err) throw err; console.log(&quot;File read complete:&quot;, data.length);&#125;);// ä½¿ç”¨setTimeoutæ¥å»¶è¿Ÿæ‰§è¡Œä¸€ä¸ªå‡½æ•°setTimeout(() =&gt; &#123; console.log(&quot;Timeout callback executed!&quot;);&#125;, 0); // è®¾ç½®ä¸º0æ¯«ç§’å¹¶ä¸æ„å‘³ç€ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯å°†å…¶æ”¾å…¥äº‹ä»¶é˜Ÿåˆ—ç­‰å¾…æ‰§è¡Œ// ä½¿ç”¨setImmediateæ¥åœ¨å½“å‰äº‹ä»¶å¾ªç¯ä¹‹åæ‰§è¡Œä¸€ä¸ªå‡½æ•°setImmediate(() =&gt; &#123; console.log(&quot;setImmediate callback executed!&quot;);&#125;);// ä½¿ç”¨process.nextTickåœ¨å½“å‰æ“ä½œå®Œæˆåç«‹å³æ‰§è¡Œä¸€ä¸ªå‡½æ•°process.nextTick(() =&gt; &#123; console.log(&quot;Next tick callback executed!&quot;);&#125;);console.log(&quot;Scheduled all callbacks&quot;);// Start// Scheduled all callbacks// Next tick callback executed!// setImmediate callback executed!// Timeout callback executed!// File read complete: 1036 å†ä¸€ä¸ª demo 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849async function async1() &#123; console.log(&quot;async1 start&quot;); await async2(); console.log(&quot;async1 end&quot;);&#125;async function async2() &#123; console.log(&quot;async2&quot;);&#125;console.log(&quot;start&quot;);setTimeout(function () &#123; console.log(&quot;setTimeout1&quot;);&#125;, 0); // setTimeout é˜Ÿåˆ—setTimeout(function () &#123; console.log(&quot;setTimeout2&quot;);&#125;, 200); // check é˜Ÿåˆ—setImmediate(() =&gt; console.log(&quot;setImmediate&quot;));process.nextTick(() =&gt; console.log(&quot;nextTick1&quot;));async1();process.nextTick(() =&gt; console.log(&quot;nextTick2&quot;));new Promise((resolve) =&gt; &#123; console.log(&quot;promise1&quot;); resolve(&quot;&quot;); console.log(&quot;promise2&quot;);&#125;).then(() =&gt; &#123; console.log(&quot;promise3&quot;);&#125;);console.log(&quot;script end&quot;);// start// async1 start// async2// promise1// promise2// script end// nextTick1// nextTick2// async1 end// promise3// setTimeout1// setImmediate// setTimeout2 10. Node çš„å…¨å±€å¼‚å¸¸å¤„ç†process å¯¹è±¡æ¥æ•è·å…¨å±€å¼‚å¸¸ã€‚process å¯¹è±¡æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæä¾›äº†ä¸å½“å‰ Node.js è¿›ç¨‹äº’åŠ¨çš„æ¥å£ã€‚æœ€ä½³å®è·µæ˜¯å°½é‡é¿å…ä¾èµ–å…¨å±€å¼‚å¸¸å¤„ç†ï¼Œè€Œæ˜¯åœ¨ä»£ç ä¸­å°½å¯èƒ½æ˜ç¡®åœ°ä½¿ç”¨ try-catch è¯­å¥å’Œ Promise çš„é”™è¯¯å¤„ç†æœºåˆ¶æ¥æ•è·å’Œå¤„ç†è¿™äº›å¼‚å¸¸ã€‚åœ¨ process é‡Œï¼Œå¯ä»¥ç›‘å¬ä»¥ä¸‹äº‹ä»¶æ¥æ•è·å…¨å±€å¼‚å¸¸ï¼š uncaughtExceptiona. è¿™ç§å¼‚å¸¸é€šå¸¸æŒ‡çš„æ˜¯åœ¨åŒæ­¥ä»£ç ä¸­æœªè¢« try-catch è¯­å¥æ•è·çš„é”™è¯¯ï¼Œæˆ–è€…åœ¨å¼‚æ­¥å›è°ƒä¸­æœªè¢«æ­£ç¡®å¤„ç†çš„é”™è¯¯ã€‚b. å¸¸è§çš„ JavaScript é”™è¯¯ç±»å‹ï¼Œå¦‚ ReferenceErrorï¼ŒSyntaxError ç­‰c. è¿˜åŒ…æ‹¬ç³»ç»Ÿçº§é”™è¯¯ï¼Œå¦‚å°è¯•æ‰“å¼€ä¸å­˜åœ¨çš„æ–‡ä»¶æ—¶æŠ›å‡ºçš„é”™è¯¯ã€‚ 123456process.on(&quot;uncaughtException&quot;, (err) =&gt; &#123; console.error(&quot;æ•è·åˆ°æœªå¤„ç†çš„å¼‚å¸¸ï¼š&quot;, err); // åœ¨è¿™é‡Œä½ å¯ä»¥è®°å½•å¼‚å¸¸ä¿¡æ¯ï¼Œæˆ–è€…æ‰§è¡Œå…¶ä»–å¿…è¦çš„æ“ä½œ&#125;);throw new Error(&quot;è¿™æ˜¯ä¸€ä¸ªæœªæ•è·çš„å¼‚å¸¸&quot;); unhandledRejectionè¿™ç§å¼‚å¸¸ç‰¹æŒ‡ä¸ Promise ç›¸å…³çš„é”™è¯¯ã€‚å½“ä¸€ä¸ª Promise è¢«æ‹’ç»ï¼ˆrejectedï¼‰ï¼Œä¸”æ²¡æœ‰æä¾› .catch() å¤„ç†ç¨‹åºæˆ–åœ¨ async function ä¸­æ²¡æœ‰ä½¿ç”¨ tryâ€¦catch è¯­å¥æ¥æ•è·é”™è¯¯æ—¶ï¼Œå°±ä¼šè§¦å‘ unhandledRejection äº‹ä»¶ã€‚ 1234567process.on(&quot;unhandledRejection&quot;, (reason, promise) =&gt; &#123; console.error(&quot;æ•è·åˆ°æœªå¤„ç†çš„ Promise æ‹’ç»ï¼š&quot;, reason); // åœ¨è¿™é‡Œä½ å¯ä»¥è®°å½•å¼‚å¸¸ä¿¡æ¯ï¼Œæˆ–è€…æ‰§è¡Œå…¶ä»–å¿…è¦çš„æ“ä½œ&#125;);// æŠ›å‡ºä¸€ä¸ªæœªå¤„ç†çš„ Promise æ‹’ç»æ¥æµ‹è¯•å…¨å±€å¼‚å¸¸æ•è·Promise.reject(new Error(&quot;è¿™æ˜¯ä¸€ä¸ªæœªå¤„ç†çš„ Promise æ‹’ç»&quot;)); 11. Node å¤šæ ¸å¤„ç†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¼€å¯å¤šæ ¸å¤„ç†å¹¶ä¸æ˜¯ä¸ºäº†è§£å†³é«˜å¹¶å‘é—®é¢˜ï¼Œè€Œä¸»è¦æ˜¯ä¸ºäº†å……åˆ†åˆ©ç”¨å¤šæ ¸ CPU çš„æ€§èƒ½ï¼Œæé«˜åº”ç”¨ç¨‹åºçš„å¤„ç†èƒ½åŠ›å’Œå“åº”é€Ÿåº¦ã€‚ cluster æ¨¡å—demo ä»£ç ï¼š 1234567891011121314151617181920212223242526272829const cluster = require(&quot;cluster&quot;);const os = require(&quot;os&quot;);const http = require(&quot;http&quot;);if (cluster.isMaster) &#123; // è·å–CPUæ ¸å¿ƒæ•° const cpuCount = os.cpus().length; console.log(`ä¸»è¿›ç¨‹ $&#123;process.pid&#125; æ­£åœ¨è¿è¡Œ`); // æ ¹æ®CPUæ ¸å¿ƒæ•°åˆ›å»ºç›¸åº”æ•°é‡çš„å·¥ä½œè¿›ç¨‹ for (let i = 0; i &lt; cpuCount; i++) &#123; cluster.fork(); &#125; cluster.on(&quot;exit&quot;, (worker, code, signal) =&gt; &#123; console.log(`å·¥ä½œè¿›ç¨‹ $&#123;worker.process.pid&#125; å·²é€€å‡º`); &#125;);&#125; else &#123; // å·¥ä½œè¿›ç¨‹ä¸­è¿è¡Œçš„ä»£ç  http .createServer((req, res) =&gt; &#123; res.writeHead(200); res.end(&quot;ä½ å¥½ï¼Œè¿™ä¸ªå“åº”æ¥è‡ªè¿›ç¨‹ &quot; + process.pid); &#125;) .listen(8000); console.log(`å·¥ä½œè¿›ç¨‹ $&#123;process.pid&#125; å·²å¯åŠ¨`);&#125; child_process æ¨¡å—childScript.js æ–‡ä»¶: 1234567//process.on(&quot;message&quot;, (message) =&gt; &#123; console.log(&quot;Received message in child:&quot;, message); // å¤„ç†æ¶ˆæ¯åå‘é€å›ä¸»è¿›ç¨‹ process.send(&#123; response: &quot;Message received&quot; &#125;);&#125;); ä¸»è¿›ç¨‹æ–‡ä»¶ï¼š 1234567891011121314151617const &#123; fork &#125; = require(&quot;child_process&quot;);// åˆ›å»ºå­è¿›ç¨‹const child = fork(&quot;./childScript.js&quot;);// å‘é€æ¶ˆæ¯ç»™å­è¿›ç¨‹child.send(&#123; hello: &quot;world&quot; &#125;);// ç›‘å¬æ¥è‡ªå­è¿›ç¨‹çš„æ¶ˆæ¯child.on(&quot;message&quot;, (message) =&gt; &#123; console.log(&quot;Received message from child:&quot;, message);&#125;);// ç›‘å¬å­è¿›ç¨‹çš„é€€å‡ºäº‹ä»¶child.on(&quot;exit&quot;, (code, signal) =&gt; &#123; console.log(`Child process exited with code $&#123;code&#125; and signal $&#123;signal&#125;`);&#125;); ç¬¬ä¸‰æ–¹æ¨¡å— workerpoolçº¿ç¨‹æ± ï¼ˆThread Poolï¼‰æ˜¯ä¸€ç§å¤šçº¿ç¨‹å¤„ç†å½¢å¼ï¼Œå®ƒåŒ…å«äº†ä¸€å®šæ•°é‡çš„çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹éƒ½æ˜¯å¤„äºç­‰å¾…çŠ¶æ€ï¼Œå‡†å¤‡æ¥æ”¶ä»»åŠ¡å¹¶æ‰§è¡Œã€‚çº¿ç¨‹æ± çš„ä¸»è¦ç›®çš„æ˜¯å¤ç”¨çº¿ç¨‹ï¼Œä»¥å‡å°‘åœ¨çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯ä¸Šçš„å¼€é”€ï¼Œå¹¶æé«˜ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡å’Œå“åº”é€Ÿåº¦ã€‚ 1npm install workerpool 12345678910111213141516171819202122const WorkerPool = require(&quot;workerpool&quot;);const pool = new WorkerPool();// å®šä¹‰ä¸€ä¸ªå°†åœ¨å·¥ä½œçº¿ç¨‹ä¸­æ‰§è¡Œçš„å‡½æ•°pool .exec(&quot;fibonacci&quot;, [&quot;10&quot;], &#123; fibonacci: function (n) &#123; if (n &lt;= 1) return n; return fibonacci(n - 1) + fibonacci(n - 2); &#125;, &#125;) .then((result) =&gt; &#123; console.log(&quot;Fibonacci result:&quot;, result); &#125;) .catch((err) =&gt; &#123; console.error(err); &#125;) .finally(() =&gt; &#123; pool.terminate(); // ç»ˆæ­¢æ‰€æœ‰å·¥ä½œçº¿ç¨‹ &#125;);// æ³¨æ„ï¼šåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè®¡ç®— Fibonacci æ•°åˆ—çš„æ›´æœ‰æ•ˆæ–¹æ³•æ˜¯ä½¿ç”¨åŠ¨æ€è§„åˆ’æ¥é¿å…é‡å¤è®¡ç®—ã€‚ 12. Node å¦‚ä½•å¤„ç†ç›‘å¬å†…å­˜çš„ä½¿ç”¨æƒ…å†µprocess.memoryUsage() å®šæœŸç›‘å¬ï¼š12345678910111213const &#123; performance: any &#125; = require(&quot;perf_hooks&quot;);function monitorMemoryUsage() &#123; const memoryUsage = process.memoryUsage(); const now = performance.now(); console.log( `Time: $&#123;now.toFixed(3)&#125;ms - RSS: $&#123;(memoryUsage.rss / 1024 / 1024).toFixed( 2 )&#125; MB` );&#125;setInterval(monitorMemoryUsage, 1000); // æ¯ç§’ç›‘æ§ä¸€æ¬¡ perf_hooks æ¨¡å—ï¼š12345678910111213const &#123; performance &#125; = require(&quot;perf_hooks&quot;);function monitorMemoryUsage() &#123; const memoryUsage = process.memoryUsage(); const now = performance.now(); console.log( `Time: $&#123;now.toFixed(3)&#125;ms - RSS: $&#123;(memoryUsage.rss / 1024 / 1024).toFixed( 2 )&#125; MB` );&#125;setInterval(monitorMemoryUsage, 1000); // æ¯ç§’ç›‘æ§ä¸€æ¬¡ 13. Node çš„åƒåœ¾å›æ”¶æœºåˆ¶Node.js çš„åƒåœ¾å›æ”¶æœºåˆ¶ä¸»è¦åŸºäº V8 å¼•æ“å®ç°ï¼Œè€Œ V8 å¼•æ“çš„åƒåœ¾å›æ”¶æœºåˆ¶åˆä¸»è¦åŸºäºåˆ†ä»£å¼åƒåœ¾å›æ”¶ç­–ç•¥ã€‚è¿™ç§ç­–ç•¥æ ¹æ®å¯¹è±¡çš„å­˜æ´»æ—¶é—´å°†å†…å­˜åˆ†ä¸ºä¸åŒçš„â€œä»£â€ï¼Œä¸»è¦é’ˆå¯¹æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰å’Œè€ç”Ÿä»£ï¼ˆOld Generationï¼‰è¿›è¡Œä¸åŒçš„åƒåœ¾å›æ”¶å¤„ç†ã€‚ æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰: æ–°ç”Ÿä»£æ˜¯å†…å­˜ç®¡ç†ä¸­çš„ä¸€å—åŒºåŸŸï¼Œä¸“é—¨ç”¨äºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚ æ–°ç”Ÿä»£å†…éƒ¨é€šå¸¸é‡‡ç”¨å¤åˆ¶(Copying)ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå¦‚ Scavenge ç®—æ³•ï¼Œè¯¥ç®—æ³•å°†æ–°ç”Ÿä»£å†…å­˜ä¸€åˆ†ä¸ºäºŒï¼ŒåŒ…æ‹¬ From ç©ºé—´å’Œ To ç©ºé—´ã€‚ å½“ From ç©ºé—´å¿«æ»¡æ—¶ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šéå†æ‰€æœ‰å¯¹è±¡ï¼Œå°†æ´»è·ƒå¯¹è±¡ä» From ç©ºé—´å¤åˆ¶åˆ° To ç©ºé—´ï¼Œç„¶åäº¤æ¢ From å’Œ To çš„è§’è‰²ï¼Œå‡†å¤‡ä¸‹ä¸€è½®çš„åƒåœ¾å›æ”¶ã€‚ å¦‚æœä¸€ä¸ªå¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­ç»å†äº†å¤šæ¬¡åƒåœ¾å›æ”¶ä»ç„¶å­˜æ´»ï¼Œå®ƒå°†è¢«è®¤ä¸ºæ˜¯â€œé•¿å¯¿â€å¯¹è±¡ï¼Œå¹¶è¢«æ™‹å‡åˆ°è€ç”Ÿä»£ä¸­ã€‚ è€ç”Ÿä»£ï¼ˆOld Generationï¼‰: è€ç”Ÿä»£æ˜¯å†…å­˜å †ä¸­çš„å¦ä¸€å—åŒºåŸŸï¼Œç”¨äºå­˜å‚¨é‚£äº›åœ¨å¤šæ¬¡æ–°ç”Ÿä»£åƒåœ¾å›æ”¶åä»ç„¶å­˜æ´»çš„å¯¹è±¡ï¼Œå³ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ã€‚ è€ç”Ÿä»£å†…çš„åƒåœ¾å›æ”¶ç›¸å¯¹ä¸é‚£ä¹ˆé¢‘ç¹ï¼Œå¹¶ä¸”é‡‡ç”¨äº†ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œå¦‚æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰ç®—æ³•ã€‚ åœ¨æ ‡è®°-æ¸…é™¤ç®—æ³•ä¸­ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šä»æ‰§è¡Œæ ˆå’Œå…¨å±€å¯¹è±¡ä¸Šæ‰¾åˆ°æ‰€æœ‰èƒ½è®¿é—®åˆ°çš„å¯¹è±¡ï¼Œå°†å®ƒä»¬æ ‡è®°ä¸ºæ´»è·ƒå¯¹è±¡ã€‚æ ‡è®°å®Œæˆåï¼Œè¿›å…¥æ¸…é™¤é˜¶æ®µï¼Œå°†æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡æ¸…é™¤ï¼Œé‡Šæ”¾å…¶å ç”¨çš„å†…å­˜ç©ºé—´ã€‚ 14. v8 å¼•æ“çš„å†…å­˜æ³„éœ²è¿™ä¸ªé—®é¢˜å’Œæµè§ˆå™¨ç«¯ JS çš„å†…å­˜æ³„éœ²ä¸€æ ·ï¼Œéƒ½æ˜¯ç”±äºå¯¹è±¡æ²¡æœ‰è¢«å›æ”¶å¯¼è‡´çš„ã€‚ä¸‹é¢ä¸¾ä¾‹ä¸€äº› demo ä»£ç è¯´æ˜ï¼š å®šæ—¶å™¨è®¾ç½®åè¦åŠæ—¶é‡Šæ”¾ï¼š 12345678910function leakyTimer() &#123; const timerId = setInterval(() =&gt; &#123; console.log(&quot;This runs every second.&quot;); &#125;, 1000); // æ¸…é™¤ï¼š clearInterval(timerId);&#125;leakyTimer(); é—­åŒ… 12345678910111213function createLeakyClosure() &#123; let largeArray = new Array(1000000).fill(&quot;data&quot;); return function leakyFunction() &#123; console.log(&quot;This closure keeps the largeArray alive.&quot;); // ä½¿ç”¨å®Œåç›´æ¥é‡Šæ”¾ largeArray = null; &#125;;&#125;const leakyClosure = createLeakyClosure();// æˆ–è€…è¿™é‡Œé‡Šæ”¾ï¼š// leakyClosure = null; å¾ªç¯å¼•ç”¨ 123456789function createCircularReference() &#123; const objectA = &#123; name: &quot;Object A&quot; &#125;; const objectB = &#123; name: &quot;Object B&quot;, referenceToA: objectA &#125;; objectA.referenceToB = objectB; // åˆ›å»ºå¾ªç¯å¼•ç”¨ // å³ä½¿æ²¡æœ‰å…¶ä»–ä»£ç å¼•ç”¨è¿™ä¸¤ä¸ªå¯¹è±¡ï¼Œç”±äºå®ƒä»¬ä¹‹é—´å­˜åœ¨å¾ªç¯å¼•ç”¨ï¼Œåƒåœ¾å›æ”¶å™¨å¯èƒ½æ— æ³•æ­£ç¡®é‡Šæ”¾å®ƒä»¬&#125;createCircularReference(); ç§»é™¤ DOM èŠ‚ç‚¹çš„ç›‘å¬å‡½æ•° 12345678910111213const leakyButton = document.createElement(&quot;button&quot;);leakyButton.textContent = &quot;Click me&quot;;document.body.appendChild(leakyButton);function eventHandler() &#123; console.log(&quot;Button clicked!&quot;);&#125;// æ·»åŠ äº‹ä»¶ç›‘å¬å™¨leakyButton.addEventListener(&quot;click&quot;, eventHandler);leakyButton.removeEventListener(&quot;click&quot;, eventHandler);document.body.removeChild(leakyButton); å…¨å±€å¯¹è±¡æœªé‡Šæ”¾ 12// å…¨å±€å¯¹è±¡æ˜¯æŒ‡ä¸ç”¨const æˆ– let å£°æ˜çš„å˜é‡ï¼Œè€Œåˆä¸é‡Šæ”¾ä»–globalLargeObject = new Array(1000000).fill(&quot;unused data&quot;);","tags":["Nodejs"]},{"title":"Learn Nextjs with TodoList Demo Project","path":"/2024/02/29/ã€2024-02-29ã€‘Learn Nextjs with TodoList Demo Project/","content":"nextjs is a nodejs library that is a framework for building modern web apps from backend and frontend. Here I will share my experience of learning nextjs by coding a todo list demo project. Here is my project repository create a nextjs projectWe may create a floder for our project: 123mkdir nextjs-demo-todo-listcd todoList-demo-by-nextjsnpx create-next-app@latest . install dependenciesFor our simple demo project, we need to install prisma, that is a open-source ORM for nodejs. 1npm install prisma and we just use prisma to generate a sqlite database file: 1npx prisma init --datasouce-provider sqlite create the ORM model and migrate the db schemain prisma/schema.prisma file, we may updated as below: 1234567model Todo &#123; id String @id @default(uuid()) title String complete Boolean createAt DateTime @default(now()) updateAt DateTime @updatedAt&#125; run the migrate command: 1npx prisma migrate dev --name init we may see the prisma/migrations floder, and see the sql file. 12345678-- CreateTableCREATE TABLE &quot;Todo&quot; ( &quot;id&quot; TEXT NOT NULL PRIMARY KEY, &quot;title&quot; TEXT NOT NULL, &quot;complete&quot; BOOLEAN NOT NULL, &quot;createAt&quot; DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP, &quot;updateAt&quot; DATETIME NOT NULL); init the db seed datawe may refer to this prisma official tutorial to generate db seed data. 123touch prisma/seed.ts# using ts-node to run seed.ts file:npm i -D ts-node seed.ts: 1234567891011121314151617181920212223import &#123; PrismaClient &#125; from &quot;@prisma/client&quot;;const prisma = new PrismaClient();async function main() &#123; // generate the first todo data: await prisma.todo.create(&#123; data: &#123; title: &quot;Hello World&quot;, complete: false, &#125;, &#125;);&#125;main() .then(async () =&gt; &#123; await prisma.$disconnect(); &#125;) .catch(async (e) =&gt; &#123; console.error(e); await prisma.$disconnect(); process.exit(1); &#125;); in our projectâ€™s script, we may adding the config in tsconfig.json file: 12345&quot;ts-node&quot;: &#123; &quot;compilerOptions&quot;: &#123; &quot;module&quot;: &quot;CommonJS&quot; &#125;&#125; and then run the seed script: 1npx ts-node ./prisma/seed.ts startup the prisma UI pagethe prisma UI page is a web page that can help us to manage the db schema and data. we may run the command. itâ€™s very easy to use. 1npx prisma studio it can be accessed by http://localhost:5555 create the db instance filewe may create a src/db.ts file to init the db instance:the boliplate code is from this prisma official tutorial : 12345678910111213import &#123; PrismaClient &#125; from &quot;@prisma/client&quot;;const prismaClientSingleton = () =&gt; &#123; return new PrismaClient(&#123; log: [&quot;query&quot;] &#125;);&#125;;declare global &#123; var prisma: undefined | ReturnType&lt;typeof prismaClientSingleton&gt;;&#125;export const prisma = globalThis.prisma ?? prismaClientSingleton();if (process.env.NODE_ENV !== &quot;production&quot;) globalThis.prisma = prisma; update the frontend pagesfor the homepage, we may update the src/page.tsx file: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263import &#123; prisma &#125; from &quot;@/db&quot;;import Link from &quot;next/link&quot;;import TodoItem from &quot;./components/TodoItem&quot;;import &#123; redirect &#125; from &quot;next/navigation&quot;;const getTodos = () =&gt; prisma.todo.findMany();// &quot;use server&quot; field might be the nextjs way to handle the server side logic.const toggleItem = async (id: string, complete: boolean) =&gt; &#123; &quot;use server&quot;; await prisma.todo.update(&#123; where: &#123; id, &#125;, data: &#123; complete, &#125;, &#125;);&#125;;const deleteItem = async (id: string) =&gt; &#123; &quot;use server&quot;; await prisma.todo.delete(&#123; where: &#123; id, &#125;, &#125;); // here refresh the page again, we may see that the item deleted. redirect(&quot;/&quot;);&#125;;const Home = async () =&gt; &#123; // fetching the data from the db: const todos = await getTodos(); return ( &lt;&gt; &lt;header className=&quot;flex justify-between items-center mb-4&quot;&gt; &lt;h1 className=&quot;text-2xl&quot;&gt;Todo List&lt;/h1&gt; &lt;Link href=&quot;/new&quot; className=&quot;border border-slate-300 text-slate-300 px-2 py-1 rounded hover:bg-slate-700 focus-within:bg-slate-700 ouline-none&quot; &gt; New &lt;/Link&gt; &lt;/header&gt; &lt;ul className=&quot;pl-4&quot;&gt; &#123;todos.map((&#123; id, complete, title &#125;) =&gt; ( &lt;TodoItem key=&#123;id&#125; id=&#123;id&#125; title=&#123;title&#125; complete=&#123;complete&#125; toggleItem=&#123;toggleItem&#125; deleteItem=&#123;deleteItem&#125; /&gt; ))&#125; &lt;/ul&gt; &lt;/&gt; );&#125;;export default Home; nextjs rounteras above code, we may see that nextjs provide the Link component to handle the rounter logic: when we clik the Link, just like the &lt;a/&gt; label, just to the new page: 123import Link from &quot;next/link&quot;;&lt;Link href=&quot;/new&quot;&gt;New&lt;/Link&gt;; we may code the filesrc/new/page.tsx file: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152import &#123; redirect &#125; from &quot;next/navigation&quot;;import Link from &quot;next/link&quot;;import &#123; prisma &#125; from &quot;@/db&quot;;const createTodo = async (data: FormData) =&gt; &#123; &quot;use server&quot;; const title = data.get(&quot;title&quot;)?.valueOf(); if (typeof title !== &quot;string&quot; || title.length === 0) throw new Error(&quot;Invalid title&quot;); await prisma?.todo.create(&#123; data: &#123; title, complete: false, &#125;, &#125;); redirect(&quot;/&quot;);&#125;;const Page = () =&gt; &#123; return ( &lt;&gt; &lt;header className=&quot;flex justify-between items-center mb-4&quot;&gt; &lt;h1 className=&quot;text-2xl&quot;&gt;New&lt;/h1&gt; &lt;/header&gt; &lt;form action=&#123;createTodo&#125; className=&quot;flex gap-2 flex-col&quot;&gt; &lt;input type=&quot;text&quot; name=&quot;title&quot; className=&quot;border border-slate-300 bg-transparent rounded px-2 py-1 outline-none focus-within:border-slate-100&quot; /&gt; &lt;div className=&quot;flex gap-1 justify-end&quot;&gt; &lt;Link href=&quot;..&quot; className=&quot;border border-slate-300 text-slate-300 px-2 py-1 rounded hover:bg-slate-700 focus-within:bg-slate-700 ouline-none&quot; &gt; Cancel &lt;/Link&gt; &lt;button type=&quot;submit&quot; className=&quot;border border-slate-300 text-slate-300 px-2 py-1 rounded hover:bg-slate-700 focus-within:bg-slate-700 ouline-none&quot; &gt; Create &lt;/button&gt; &lt;/div&gt; &lt;/form&gt; &lt;/&gt; );&#125;;export default Page; TodoItem componentfor the TodoItem component, we may update the src/components/TodoItem.tsx file: 1234567891011121314151617181920212223242526272829303132333435363738394041&quot;use client&quot;;// TodoItem function is the server side function, so we must mark &quot;use client&quot; field for this componenttype TodoItemProps = &#123; id: string, title: string, complete: boolean, toggleItem: (id: string, complete: boolean) =&gt; void, deleteItem: (id: string) =&gt; void,&#125;;const TodoItem = (&#123; id, title, complete, toggleItem, deleteItem,&#125;: TodoItemProps) =&gt; &#123; return ( &lt;li className=&quot;flex gap-1 items-center&quot;&gt; &#123;/* here using the call back function toggleItem to pass the id and value: */&#125; &lt;input id=&#123;id&#125; type=&quot;checkbox&quot; className=&quot;cursor-pointer peer&quot; defaultChecked=&#123;complete&#125; onChange=&#123;(e) =&gt; toggleItem(id, e.target.checked)&#125; /&gt; &lt;label htmlFor=&#123;id&#125; className=&quot;peer-checked:line-through&quot;&gt; &#123;title&#125; &lt;/label&gt; &lt;div className=&quot;cursor-pointer rounded-full&quot; onClick=&#123;() =&gt; deleteItem(id)&#125; &gt; âŒ &lt;/div&gt; &lt;/li&gt; );&#125;;export default TodoItem;","tags":["nextjs","prisma","sqlite"]},{"title":"åˆ›å»ºå¹¶å‘å¸ƒçš„npm uiåº“(npm packages)","path":"/2024/02/17/ã€2024-02-17ã€‘åˆ›å»ºè‡ªå·±çš„npm packageæ­¥éª¤/","content":"è¿™é‡Œåˆ†åˆ«ä»‹ç»ä¸¤ç§æ–¹æ³•åˆ›å»ºè‡ªå·±çš„ npm packageï¼Œåˆ†åˆ«æ˜¯æœ€æµè¡Œçš„ä¸¤ä¸ªæ¡†æ¶ vite å’Œ reactã€‚ ç”¨ vite åˆ›å»º npm åº“é¦–å…ˆï¼Œç¡®ä¿ä½ å·²ç»å®‰è£…äº† vite , vite 5+ çš„ç‰ˆæœ¬ç›´æ¥ç”¨ä»¥ä¸‹å‘½ä»¤å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼š 1npm init vite VueButtonYy è¿è¡Œåä¼šåœ¨å‘½ä»¤è¡Œé‡Œé€‰æ‹©ä¸€ä¸ªæ¨¡æ¿ï¼Œé€‰æ‹© vue å³å¯ã€‚ åˆ›å»ºä¸€ä¸ª vue çš„ç»„ä»¶ï¼šåˆ›å»ºæ–‡ä»¶å¤¹é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œæˆ‘ä»¬å°†åŸæ¥çš„ src æ–‡ä»¶å¤¹åˆ é™¤ï¼Œç„¶åæ–°å»ºä¸€ä¸ª src æ–‡ä»¶å¤¹ï¼Œç„¶ååœ¨ src æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ª index.js æ–‡ä»¶å’Œä¸€ä¸ª components æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 1234/src |__index.js |__/components |__VueButtonYy.vue åˆ›å»ºç»„ä»¶å…¶ä¸­ VueButtonYy.vue æ–‡ä»¶å°±æ˜¯ä¸€ä¸ªç®€å•çš„ vue ç»„ä»¶ã€‚æˆ‘è¿™é‡Œéšä¾¿å†™äº†ä¸€ä¸ª button ç»„ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011121314&lt;template&gt; &lt;button class&#x3D;&quot;vue-button-yy&quot;&gt; &lt;slot &#x2F;&gt; &lt;&#x2F;button&gt;&lt;&#x2F;template&gt;&lt;style scoped&gt;.vue-button-yy &#123; background: #43b883; color: white; outline: none; border: none;&#125;&lt;&#x2F;style&gt; ç¼–å†™ vite é…ç½®æ–‡ä»¶vite çš„åŠŸèƒ½å¼ºå¤§ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ vite.config.js æ¥å®ç°ä¸€äº›åŠŸèƒ½ï¼Œæ¯”å¦‚æ‰“åŒ…æˆä¸€ä¸ª npm packageã€‚è¿™é‡Œæˆ‘ç”¨ vite.config.jsï¼Œé…ç½®æ–‡ä»¶ vite.config.js ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021import &#123; defineConfig &#125; from &quot;vite&quot;;import vue from &quot;@vitejs/plugin-vue&quot;;import &#123; resolve &#125; from &quot;path&quot;;export default defineConfig(&#123; build: &#123; lib: &#123; entry: resolve(__dirname, &quot;src/index.js&quot;), name: &quot;VueButtonYy&quot;, // è¾“å‡ºæ–‡ä»¶çš„æ ¼å¼åï¼šrollupæ˜¯ç”¨ umdå’Œesè¿›è¡ŒåŒºåˆ†çš„ï¼š fileName: (format) =&gt; `vue-button-yy.$&#123;format&#125;.js`, &#125;, rollupOptions: &#123; external: [&quot;vue&quot;], globals: &#123; vue: &quot;Vue&quot;, &#125;, &#125;, &#125;, plugins: [vue()],&#125;); è¿™é‡Œéœ€è¦æ³¨æ„ fileName å‚æ•°ï¼Œç”¨æ¥æŒ‡å®šè¾“å‡ºæ–‡ä»¶çš„æ ¼å¼åï¼Œè¿™é‡Œæˆ‘ç”¨çš„æ˜¯ vue-button-yy.$&#123;format&#125;.jsï¼Œè¿™æ ·æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶åå°±æ˜¯ vue-button-yy.cjs.js å’Œ vue-button-yy.esm.jsã€‚ vite æ˜¯ç”¨ rollup æ‰“åŒ…çš„ï¼Œæ‰€ä»¥éœ€è¦é…ç½® rollupOptionsï¼Œé…ç½® rollupOptions çš„ external å‚æ•°ï¼Œå°† vue çš„åŒ…å vue æ·»åŠ åˆ° external ä¸­ï¼Œè¿™æ ·æ‰“åŒ…çš„æ—¶å€™ï¼Œvue çš„åŒ…ä¸ä¼šæ‰“åŒ…è¿›å»ï¼Œå‡ºæ¥çš„æ–‡ä»¶ä¼šæ›´å°ã€‚ ç¼–å†™å…¥å£æ–‡ä»¶ index.js12345678910111213import VueButtonYy from &quot;./components/VueButtonYy.vue&quot;;// å…·åå¯¼å‡ºï¼šexport &#123; VueButtonYy &#125;;// é»˜è®¤å¯¼å‡ºï¼šexport default &#123; install: (app) =&gt; &#123; app.component(&quot;VueButtonYy&quot;, VueButtonYy); // å¦‚æœ‰å¤šä¸ªæ’ä»¶ï¼š // app.component(&#x27;Xxxx&#x27;, xxxx); &#125;,&#125;; ç¼–å†™ package.json æ–‡ä»¶1234567891011121314151617181920212223242526&#123; &quot;name&quot;: &quot;vue-button-yy&quot;, &quot;version&quot;: &quot;1.0.0&quot;, &quot;files&quot;: [&quot;dist&quot;], &quot;main&quot;: &quot;./dist/vue-button-yy.umd.js&quot;, &quot;module&quot;: &quot;./dist/vue-button-yy.es.js&quot;, &quot;exports&quot;: &#123; &quot;.&quot;: &#123; &quot;import&quot;: &quot;./dist/vue-button-yy.es.js&quot;, &quot;require&quot;: &quot;./dist/vue-button-yy.umd.js&quot; &#125;, &quot;./dist/style.css&quot;: &quot;./dist/style.css&quot; &#125;, &quot;scripts&quot;: &#123; &quot;dev&quot;: &quot;vite&quot;, &quot;build&quot;: &quot;vite build&quot;, &quot;preview&quot;: &quot;vite preview&quot; &#125;, &quot;dependencies&quot;: &#123; &quot;vue&quot;: &quot;^3.4.15&quot; &#125;, &quot;devDependencies&quot;: &#123; &quot;@vitejs/plugin-vue&quot;: &quot;^5.0.3&quot;, &quot;vite&quot;: &quot;^5.1.0&quot; &#125;&#125; name: è¿™é‡Œæˆ‘ç”¨çš„æ˜¯ vue-button-yyï¼Œè¿™ä¸ªå°±æ˜¯ä½ åˆ›å»ºçš„ npm åŒ…çš„åç§°ï¼Œè¿™ä¸ªåç§°åœ¨ npm ä¸Šä¸èƒ½é‡å¤ï¼Œæ‰€ä»¥è¦è‡ªå·±å–ä¸€ä¸ªã€‚ version: è¿™é‡Œæˆ‘ç”¨çš„æ˜¯ 1.0.0ï¼Œè¿™ä¸ªå°±æ˜¯ä½ åˆ›å»ºçš„ npm åŒ…çš„ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å‘å¸ƒä¸€ä¸ªç‰ˆæœ¬ï¼Œéƒ½éœ€è¦åœ¨è¿™é‡Œä¿®æ”¹ç‰ˆæœ¬å·ï¼Œç„¶ååœ¨å‘½ä»¤è¡Œé‡Œè¾“å…¥ npm publishï¼Œå‘å¸ƒä¸€ä¸ªæ–°ç‰ˆæœ¬ã€‚ files: è¿™é‡Œæˆ‘ç”¨çš„æ˜¯ distï¼Œè¿™ä¸ªå°±æ˜¯æ‰“åŒ…åçš„æ–‡ä»¶å¤¹åç§°ï¼Œæ‰“åŒ…åçš„æ–‡ä»¶ä¼šæ”¾åœ¨ dist æ–‡ä»¶å¤¹ä¸‹ã€‚ main: è¿™é‡Œæˆ‘ç”¨çš„æ˜¯ ./dist/vue-button-yy.umd.jsï¼Œè¿™ä¸ªå°±æ˜¯æ‰“åŒ…åçš„å…¥å£æ–‡ä»¶ï¼Œæ‰“åŒ…åçš„å…¥å£æ–‡ä»¶ä¼šæ”¾åœ¨ dist æ–‡ä»¶å¤¹ä¸‹ã€‚vite ç”¨çš„æ˜¯ rollup.js æ‰“åŒ…ï¼Œrollup é»˜è®¤çš„æ ¼å¼ä¸º umd (require å¯¼å…¥) å’Œ es ï¼ˆimport å¯¼å…¥ï¼‰ ä¸¤ç§æ–‡ä»¶åæ ¼å¼ï¼Œå†™åœ¨ packge.json é‡Œåšä¸€ä¸ªè¯´æ˜ï¼Œç”¨çš„æ—¶å€™ä¼šæ ¹æ® main å’Œ module çš„æ–‡ä»¶åè¿›è¡Œè‡ªåŠ¨é€‰æ‹©ã€‚ æœ¬åœ°æµ‹è¯•åœ¨ä¸€ä¸ªåŒ…ç¼–å†™å®Œæˆåï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°è¿›è¡Œæµ‹è¯•ï¼Œåœ¨åŒ…æ–‡ä»¶å¤¹çš„æ ¹ç›®å½•ä¸‹è·‘å‘½ä»¤ 1npm link ç”Ÿæˆä¸€ä¸ªæœ¬åœ°å…¨å±€è½¯é“¾æ¥ï¼Œå†å»å¦å¤–ä¸€ä¸ª vue çš„ç°æˆé¡¹ç›®é‡Œï¼Œé€šè¿‡ 1npm link vue-button-yy è¿›è¡Œå¼•ç”¨å³å¯ã€‚ æ¯”å¦‚æˆ‘åœ¨å¦ä¸€ä¸ªé¡¹ç›®é‡Œè·‘äº† npm link vue-button-yyï¼Œå¯ä»¥çœ‹åˆ°è¯¥é¡¹ç›®çš„ package.json æ–‡ä»¶é‡Œæ·»åŠ äº† vue-button-yy çš„ä¾èµ–å¦‚ä¸‹ï¼Œè¿™æ˜¯ä¸€ç§æœ¬åœ°å¼•ç”¨çš„æ–¹å¼ 123&quot;dependencies&quot;: &#123; &quot;vue-button-yy&quot;: &quot;file:../vueDemoComp&quot;&#125;, ç„¶ååœ¨ main.js é‡Œå¼•ç”¨äº† vue-button-yy çš„ç»„ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567import VueButtonYy from &quot;vue-button-yy&quot;;import &quot;vue-button-yy/dist/style.css&quot;;const app = createApp(App);app.use(VueButtonYy);app.mount(&quot;#app&quot;); åœ¨ App.vue é‡Œå¼•ç”¨äº† vue-button-yy çš„ç»„ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š 1234567891011&lt;script setup&gt;&lt;/script&gt;&lt;template&gt; &lt;vue-button-yy&gt; hello world &lt;/vue-button-yy&gt;&lt;/template&gt;&lt;style scoped&gt;&lt;/style&gt; å‘å¸ƒä½ çš„ npm åŒ…12npm loginnpm publish --access=public åˆ›å»ºä¸€ä¸ª react çš„ npm packageä¸Šé¢çš„æ­¥éª¤ï¼Œå·²ç»ç”¨äº†ä¸€æ¬¡ vite ä½œä¸ºæ‰“åŒ…å·¥å…·ï¼Œè¿™é‡Œæˆ‘ç›´æ¥ç”¨ rollup ä½œä¸ºæ‰“åŒ…å·¥å…·ï¼Œå³ viteçš„åº•å±‚æ‰“åŒ…å·¥å…·ï¼Œåˆ›å»ºä¸€ä¸ª react çš„ npm packageï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹å®‰è£…ä¾èµ–123456789101112mkdir yuwing-react-ui &amp;&amp; cd yuwing-react-uinpm init -y# å®‰è£… react åŠ tsï¼šnpm i -D @types/react typescript react# ç”Ÿæˆtsconfig.json æ–‡ä»¶ï¼Œé…ç½®tsæ£€æŸ¥è§„åˆ™npx tsc --init# rollup æ‰€éœ€çš„ä¾èµ–ï¼šnpm i -D rollup @rollup/plugin-node-resolve @rollup/plugin-typescript @rollup/plugin-commonjs rollup-plugin-dts tsconfig.json æ–‡ä»¶ï¼Œé…ç½® ts æ£€æŸ¥è§„åˆ™ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839&#123; &quot;compilerOptions&quot;: &#123; /* Language and Environment */ &quot;target&quot;: &quot;ESNext&quot;, &quot;jsx&quot;: &quot;react-jsx&quot;, /* Modules */ &quot;module&quot;: &quot;ESNext&quot; /* Specify what module code is generated. */, &quot;moduleResolution&quot;: &quot;Node&quot; /* Specify how TypeScript looks up a file from a given module specifier. */, /* JavaScript Support */ &quot;allowJs&quot;: false /* Allow JavaScript files to be a part of your program. Use the &#x27;checkJS&#x27; option to get errors from these files. */, &quot;maxNodeModuleJsDepth&quot;: 1 /* Specify the maximum folder depth used for checking JavaScript files from &#x27;node_modules&#x27;. Only applicable with &#x27;allowJs&#x27;. */, /* Emit */ &quot;declaration&quot;: true /* Generate .d.ts files from TypeScript and JavaScript files in your project. å°†æ‰€æœ‰å†™åœ¨æºç çš„typesæ–‡ä»¶ç”Ÿæˆåˆ°typesæ–‡ä»¶å¤¹ä¸‹ */, &quot;emitDeclarationOnly&quot;: true /* Only output d.ts files and not JavaScript files. */, &quot;sourceMap&quot;: true /* Create source map files for emitted JavaScript files. */, &quot;outDir&quot;: &quot;dist&quot; /* Specify an output folder for all emitted files. */, &quot;declarationDir&quot;: &quot;types&quot; /* Specify the output directory for generated declaration files. */, /* Interop Constraints */ &quot;allowSyntheticDefaultImports&quot;: true /* Allow &#x27;import x from y&#x27; when a module doesn&#x27;t have a default export. */, &quot;esModuleInterop&quot;: true /* Emit additional JavaScript to ease support for importing CommonJS modules. This enables &#x27;allowSyntheticDefaultImports&#x27; for type compatibility. */, &quot;forceConsistentCasingInFileNames&quot;: true /* Ensure that casing is correct in imports. */, /* Type Checking */ &quot;strict&quot;: true /* Enable all strict type-checking options. */, &quot;noUnusedLocals&quot;: true /* Enable error reporting when local variables aren&#x27;t read. */, &quot;noUnusedParameters&quot;: true /* Raise an error when a function parameter isn&#x27;t read. */, &quot;noImplicitReturns&quot;: true /* Enable error reporting for codepaths that do not explicitly return in a function. */, &quot;noFallthroughCasesInSwitch&quot;: true /* Enable error reporting for fallthrough cases in switch statements. */, &quot;noUncheckedIndexedAccess&quot;: true /* Add &#x27;undefined&#x27; to a type when accessed using an index. */, &quot;allowUnreachableCode&quot;: true /* Disable error reporting for unreachable code. */, /* Completeness */ &quot;skipLibCheck&quot;: true /* Skip type checking all .d.ts files. */ &#125;&#125; åˆ›å»º rollup.config.mjs æ–‡ä»¶ï¼Œé…ç½® rollup æ‰“åŒ…è§„åˆ™ï¼Œä»£ç å¦‚ä¸‹ï¼š 12# è¿™é‡Œç”¨ mjs æ‰©å±•åï¼Œå› ä¸ºæˆ‘ä»¬æ–‡ä»¶é‡Œç”¨åˆ° import è¯­å¥ï¼Œä¸å†ç”¨require()touch rollup.config.mjs 1234567891011121314151617181920212223242526272829303132333435363738394041import commonjs from &quot;@rollup/plugin-commonjs&quot;;import resolve from &quot;@rollup/plugin-node-resolve&quot;;import typescript from &quot;@rollup/plugin-typescript&quot;;import dts from &quot;rollup-plugin-dts&quot;;import packageJson from &quot;./package.json&quot; assert &#123; type: &quot;json&quot; &#125;;export default [ &#123; input: &quot;src/index.ts&quot;, output: [ &#123; file: packageJson.main, format: &quot;cjs&quot;, sourcemap: true, &#125;, &#123; file: packageJson.module, format: &quot;esm&quot;, sourcemap: true, &#125;, ], external: [&quot;@types/node&quot;], plugins: [ resolve(), commonjs(), typescript(&#123; tsconfig: &quot;./tsconfig.json&quot;, &#125;), ], &#125;, &#123; input: &quot;dist/esm/types/index.d.ts&quot;, output: [ &#123; file: &quot;dist/index.d.ts&quot;, format: &quot;esm&quot;, &#125;, ], plugins: [dts()], &#125;,]; package.json æ–‡ä»¶ï¼Œé…ç½®æ‰“åŒ…è§„åˆ™ï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627&#123; &quot;name&quot;: &quot;@yuwing/react-ui&quot;, &quot;version&quot;: &quot;0.0.1&quot;, &quot;description&quot;: &quot;simple react compoent library&quot;, &quot;main&quot;: &quot;dist/cjs/index.js&quot;, &quot;module&quot;: &quot;dist/esm/index.js&quot;, &quot;type&quot;: &quot;module&quot;, &quot;types&quot;: &quot;dist/index.d.ts&quot;, &quot;files&quot;: [&quot;dist&quot;], &quot;scripts&quot;: &#123; &quot;dev&quot;: &quot;rollup -c --watch&quot;, &quot;build&quot;: &quot;rollup -c&quot; &#125;, &quot;keywords&quot;: [&quot;react&quot;, &quot;react-ui&quot;, &quot;react-component&quot;], &quot;author&quot;: &quot;Yu Yi (Kyle Yu)&quot;, &quot;license&quot;: &quot;MIT&quot;, &quot;devDependencies&quot;: &#123; &quot;@rollup/plugin-commonjs&quot;: &quot;^25.0.7&quot;, &quot;@rollup/plugin-node-resolve&quot;: &quot;^15.2.3&quot;, &quot;@rollup/plugin-typescript&quot;: &quot;^11.1.6&quot;, &quot;@types/react&quot;: &quot;^18.2.58&quot;, &quot;react&quot;: &quot;^18.2.0&quot;, &quot;rollup&quot;: &quot;^4.12.0&quot;, &quot;rollup-plugin-dts&quot;: &quot;^6.1.0&quot;, &quot;typescript&quot;: &quot;^5.3.3&quot; &#125;&#125; å‘å¸ƒè‡ªå·±çš„åŒ…è¿™ä¸€æ­¥å’Œä¸Šé¢çš„ vue å‘å¸ƒä¸€æ ·ï¼Œä¸è¿‡å¤šè¯´ï¼Œè¿™é‡Œå°±ä¸å†™äº†ã€‚ å€¼å¾—æ³¨æ„ï¼Œpackage.json æ–‡ä»¶ä¸­å¯ä»¥åŠ å…¥ &quot;repository&quot; å­—æ®µï¼Œç”¨æ¥é…ç½®å‘å¸ƒåŒ…çš„é…ç½®ï¼Œå¯ä»¥åœ¨ä¸Šä¼ åˆ° GitHub åï¼Œç›´æ¥å‘å¸ƒåˆ° npm ä»“åº“ï¼š 123&#123; &quot;repository&quot;: &quot;https://github.com/ys558/yuwing-react-ui.git&quot;&#125; æˆ‘ä»¬å¯ä»¥åœ¨ GitHub ä¸Šé…ç½®ï¼Œç„¶åå°† package çš„å‹ç¼©æ–‡ä»¶å‘å¸ƒåœ¨ GitHub ä¸Šï¼Œå¿…é¡»å…ˆå» GitHub ä¸Šåˆ›å»ºä¸€ä¸ª tokenç‚¹å‡»å³ä¸Šè§’çš„å¤´åƒï¼Œé€‰æ‹© Settings -&gt; Developer Settings -&gt; Personal access tokens -&gt; Generate new token (classic) -&gt; Select scopes -&gt; repo -&gt; Generate token -&gt; Copy the token -&gt; æŠŠç”Ÿæˆçš„ token ç²˜è´´åˆ°ä½ çš„.npmrc æ–‡ä»¶é‡Œï¼Œé»˜è®¤æ–‡ä»¶è·¯å¾„æ˜¯ ~/.npmrcï¼Œå¹¶æ·»åŠ ä»¥ä¸‹å­—æ®µï¼š 123registry=https://registry.npmjs.org/@YOUR_GITHUB_USERNAME:registry=https://npm.pkg.github.com///npm.pkg.github.com/:_authToken=&lt;YOUR_GITHUB_TOKEN&gt; è‡³æ­¤ï¼Œæˆ‘ä»¬ react ç»„ä»¶åº“çš„åŸºæœ¬æµç¨‹å·²å®Œæˆã€‚","tags":["react","npm","vite","rollup","storybook","npm packag"]},{"title":"TSå‡ ä¸ªç½•è§ç‰¹æ€§çš„åº”ç”¨","path":"/2023/12/16/ã€2023-12-16ã€‘TSå‡ ä¸ªç½•è§ç‰¹æ€§çš„åº”ç”¨/","content":"æœ¬æ–‡åˆ—ä¸¾äº† ts çš„å‡ ç§ä¸å¸¸è§ç”¨æ³•ï¼Œåˆ†åˆ«æ˜¯ï¼š å‡½æ•°é‡è½½ æ¥å£ç»§æ‰¿ ç±»çš„å†…å®¹ å±æ€§å…³é”®å­— å­˜å‚¨å™¨ getter setter extends vs implements æ³›å‹ç±» å‡½æ•°é‡è½½ ( Function Overloading )è¿™ç§å…¶å®å¯ä»¥ç”¨å¯é€‰å‚æ•° + æˆ–è€…ç±»å‹æ›¿ä»£ï¼Œä½†å¦‚æœæŠŠæ‰€æœ‰å‡½æ•°è¿”å›ç±»å‹éƒ½åˆ—å‡ºï¼Œä¼šæ¸…æ™°ç‚¹ï¼š 1234567891011121314151617181920212223242526272829303132// Overloading:interface Circle &#123; radius: number;&#125;interface Rectangle &#123; width: number; height: number;&#125;// è¿™é‡Œå®šä¹‰ä¸åŒçš„å‡½æ•°å…¥å‚åŠè¿”å›ç±»å‹function calculateArea(shape: Circle): number;function calculateArea(shape: Rectangle): number;function calculateArea(shape: any) &#123;\tif ((&lt;Circle&gt;shape).radius !== undefined) &#123; return Math.PI * (&lt;Circle&gt;shape).radius ** 2;\t&#125; else if ( (&lt;Rectangle&gt;shape).width !== undefined &amp;&amp; (&lt;Rectangle&gt;shape).height !== undefined\t) &#123; return (&lt;Rectangle&gt;shape).width * (&lt;Rectangle&gt;shape).height;\t&#125; else &#123; throw new Error(&#x27;Unsupported shape type&#x27;);\t&#125;&#125;const circleArea = calculateArea(&#123; radius: 5 &#125;);console.log(circleArea); // Output: 78.53981633974483const rectangleArea = calculateArea(&#123; width: 10, height: 5 &#125;);console.log(rectangleArea); // Output: 50 æ¥å£ç»§æ‰¿ ( Interface Extend )12345678910111213141516171819interface Parent1 &#123; p1: string; p2: number;&#125;interface Parent2 &#123; p3: boolean;&#125;interface Child extends Parent1, Parent2 &#123; p4: string | number;&#125;const o: Child = &#123; p1: &quot;&quot;, p2: 0, p3: false, p4: &quot;&quot;,&#125;; ç±» ï¼ˆ Class ï¼‰å®šä¹‰å±æ€§åœ¨tsé‡Œï¼Œæ‰€æœ‰å±æ€§éœ€è¦åœ¨ constructor ä¹‹å‰è§„å®šå…¶å±æ€§ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹ï¼š 1234567891011121314151617class Article &#123; // è§„å®šå±æ€§ç±»å‹ï¼š title: string; content: string; // è¿™é‡Œæœ‰å±æ€§ aï¼Œ å¦‚æœåœ¨.tsconfigé‡Œï¼Œè®¾ç½®äº†&quot;strict&quot;: true, é‚£ä¹ˆä¸è®¾ç½® a ä¸ºå¯é€‰å±æ€§åˆ™ä¼šæŠ¥é”™ã€‚ a?: string; // tsconfigä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæ²¡æœ‰åˆå§‹åŒ–çš„å±æ€§ï¼Œå¿…é¡»è®¾ç½®å±æ€§ä¸ºå¯é€‰æˆ–ç»™å®šé»˜è®¤å€¼ï¼š b = &#x27;&#x27;; constructor(title: string, content: string) &#123; this.title = title; this.content = content; &#125;&#125;const a = new Article(&#x27;é¢˜ç›®&#x27;, &#x27;å†…å®¹&#x27;); publicï¼Œprivate, protected, static, readonly å…³é”®å­—1234567891011121314151617181920class Artical &#123; public title?: string; // private åªèƒ½åœ¨ å½“å‰ç±»å†…éƒ¨ è¿›è¡Œè®¿é—® private content?: string; // protected åªèƒ½åœ¨ å½“å‰ç±»å†…éƒ¨ æˆ– å…¶å­ç±»å†…éƒ¨ è¿›è¡Œè®¿é—®ï¼š protected innerData?: string; // static è®¾ç½®ç»™ç±»æœ¬èº«ï¼Œè€Œä¸æ˜¯è®¾ç½®ç»™ç±»å®ä¾‹ï¼Œè®¿é—®æ—¶åº”è¯¥ï¼š // Artical.author static author: string = &#x27;Jone&#x27;; // åªè¯»å±æ€§, ä¸èƒ½è¢«ä¿®æ”¹ï¼š readonly version?: string; // å¤šä¸ªä¿®é¥°ç¬¦è¿ç”¨ï¼š protected static readonly c: string = &#x27;&#x27; constructor(title: string, content: string) &#123; this.title = title; this.content = content; &#125;&#125; getter setter å’Œç§æœ‰å€¼ ç§æœ‰å±æ€§ï¼Œä¸æƒ³è¢«å¤–éƒ¨è®¿é—®ï¼Œå‘½åä¸€èˆ¬ç”¨ä¸‹åˆ’çº¿åŒºåˆ† ä¸€èˆ¬ä¸€ä¸ªç§æœ‰å€¼ï¼Œå¯¹åº”ä¸€ä¸ª getter, setter å­˜å‚¨å™¨ 1234567891011121314151617class User &#123; private _password: string = &#x27;&#x27;; get password(): string &#123; return &#x27;*&#x27; &#125; set password(newPassword: string) &#123; this._password = newPassword &#125;&#125;const u = new User();// ç›´æ¥è®¿é—®å­˜å‚¨å™¨getterï¼š â­•ï¸console.log(u.password);// âŒï¼š// console.log(u._password); æŠ½è±¡ç±» abstract vs å®ç°æ¥å£implements interface abstract ç”¨äºç»™å­ç±»ç»§æ‰¿ç”¨ï¼Œä¸å•ç‹¬åšå®ä¾‹åŒ– implements å’Œ abstract çš„åŒºåˆ«æ˜¯ï¼Œimplements å¯ä»¥å®ç°å¤šä¸ªæ¥å£ interface, è€Œ extends åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±» 123456789101112131415161718192021222324252627282930abstract class Animal &#123; abstract name: string; abstract voice(): void;&#125;// åªèƒ½ extends ä¸€ä¸ªçˆ¶ç±»ï¼šclass Cat extends Animal &#123; name: string = &#x27;Cat&#x27;; voice(): void &#123; console.log(&#x27;miao&#x27;) &#125;&#125;const c1 = new Cat();interface AnimalName &#123; name: string;&#125;interface AnimalVoice &#123; voice(): void;&#125;class Dog implements AnimalName, AnimalVoice &#123; name: string = &#x27;Dog&#x27;; voice() &#123; console.log(&#x27;wang&#x27;) &#125;&#125;const d1 = new Dog(); å½“ç„¶ï¼Œä»–ä»¬è¿˜èƒ½åŒæ—¶ä½¿ç”¨ï¼Œä½† extends å¿…é¡»ç”¨åœ¨ implements ä¹‹å‰ï¼š 123456class Dog extends Animal implements AnimalName, AnimalVoice &#123; name: string = &#x27;Dog&#x27;; voice() &#123; console.log(&#x27;wang&#x27;) &#125;&#125; æ³›å‹ç±»æ³›å‹é™¤äº†åº”ç”¨åœ¨å‡½æ•°ï¼Œè¿˜å¯ä»¥æ”¾åœ¨ç±»é‡Œåº”ç”¨ï¼š 12345678910111213141516class TestGenric&lt;T&gt; &#123; value: T; constructor(value: T) &#123; this.value = value; &#125; processValue (input: T): T &#123; return input &#125;&#125;const s = new TestGenric&lt;string&gt;(&#x27;string&#x27;);s.processValue(&#x27;string&#x27;);const n = new TestGenric&lt;number&gt;(123);n.processValue(123);","tags":["ts"]},{"title":"bunä¹‹åˆå°è¯•","path":"/2023/12/09/ã€2023-12-09ã€‘Bunçš„åˆå°è¯•/","content":"æœ¬ç¯‡æ˜¯ Bun 1.0 æ¨å‡ºåçš„åˆå°è¯•ã€‚Bun æ˜¯ä¸€ä¸ªé›†åˆæ‰€æœ‰ js åŸºç¡€å·¥å…·çš„è¿è¡Œæ—¶ï¼Œä»¥è¿„ä»Šä¸ºæ­¢æœ€å¿«çš„ js è¿è¡Œæ—¶è€Œè‘—ç§° åƒ Node ä¸€æ ·ï¼ŒBunæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶(runtime), è€Œéä»€ä¹ˆæ–°çš„è¯­è¨€ã€‚æ„Ÿè§‰ deno çš„åœ°ä½æœ‰ç‚¹å°´å°¬äº†ã€‚å¤§å®¶è¢«ä»–çš„å®£ä¼ çš„é€Ÿåº¦æ‰€æŠ˜æœã€‚ å®‰è£…å®˜ç½‘æ¨èçš„æ˜¯è¿è¡Œ 1curl -fsSL https://bun.sh/install | bash ä½†é‰´äºå›½å†…æœ‰å¢™çš„åŸå› ï¼Œbun ç°åœ¨æœ‰ npm åŒ…äº†ï¼Œæ‰€ä»¥æˆ‘æ›´æ¨èå¦ä¸€ç§å®‰è£…æ–¹æ³•ï¼Œæ›´å¿«æ›´ç›´æ¥ï¼š 1npm i -g bun ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸï¼š 12(base) âœ ~ bun -v1.0.12 å¯ç”¨é¡¹ç›®åˆå§‹åŒ–ï¼š123mkdir bun-learncd bun-learnbun init å¯ä»¥çœ‹åˆ° package.json æ–‡ä»¶è¢« bun.lockb æ–‡ä»¶æ›¿ä»£ï¼Œæ¯”èµ·åŸæ¥çš„ json æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å†™èµ·æ¥æœ‰ç‚¹ç±»ä¼¼ymlçš„è¯­æ³•ï¼Œç”¨äº†ç¼©è¿›å’Œæ¢è¡Œï¼Œä¸ç”¨èŠ±æ‹¬å· ç›´æ¥ç”Ÿæˆäº† tsconfig.json æ–‡ä»¶, bun åŸç”Ÿæ”¯æŒäº† ts è·‘å•ä¸ªæ–‡ä»¶ï¼Œå’Œ node ç”¨æ³•ç±»ä¼¼ï¼Œå½“ç„¶runå¯ä»¥çœç•¥ï¼š 1bun run index.ts ç®€å•çš„æœåŠ¡æˆ‘ä»¬åœ¨ index.ts é‡Œå†™ä¸Šï¼š 12345678const server = Bun.serve(&#123; port: 5678, fetch(req) &#123; return new Response(&quot;hello Bun!&quot;); &#125;,&#125;);console.log(`listening on port $&#123;server.port&#125;`); ç»ˆç«¯è·‘ index.ts , æµè§ˆå™¨å¯ä»¥çœ‹åˆ° hello Bun! çš„å­—æ ·ã€‚å½“ç„¶ï¼Œç›´æ¥è·‘çš„è¯æˆ‘ä»¬æ”¹ index.ts è¦é‡å¯é¡¹ç›®ï¼Œå¯ä»¥åŠ ä¸Š --watch å‚æ•°ï¼š 1bun --watch index.ts è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œåˆ›å»ºä¸€ä¸ª env æ–‡ä»¶touch .envï¼Œå°†é…ç½®å†™åœ¨è¯¥æ–‡ä»¶é‡Œï¼Œ 1PORT &#x3D; 8889 index.ts æ–‡ä»¶é‡Œ port å‚æ•°æ”¹ï¼š 12--- port: 5678,+++ port: Bun.env.PORT || 5678, å¯ä»¥è§åˆ°ï¼Œä»¥å‰ç”¨nodeæ—¶ï¼Œæˆ‘ä»¬é¡»å®‰è£… process åŒ…ï¼Œå¹¶ä¸”å¼•å…¥ï¼Œæ‰èƒ½ç”¨ process.env.PORTçš„ï¼Œç°åœ¨ç›´æ¥ç”¨Bunï¼Œè¯¾ä»¶Bun æŠŠå¾ˆå¤šç¬¬ä¸‰æ–¹åº“ï¼Œå¦‚ process ä¹Ÿé›†æˆäº†, æ— éœ€äºŒæ¬¡ä¸‹è½½ã€‚ å¤„ç†è·¯ç”±æŠŠ fecth å‡½æ•°æ”¹å†™å¦‚ä¸‹ï¼š 123456fetch (req) &#123; const url = new URL(req.url); const &#123; pathname &#125; = url; if (pathname === &#x27;/&#x27;) return new Response(&#x27;home page!&#x27;) if (pathname === &#x27;/blog&#x27;) return new Response(&#x27;blog!&#x27;) return new Response(&quot;404&quot;)&#125; bunxç±»ä¼¼ npx çš„ä½¿ç”¨ï¼Œç›´æ¥è¿è¡ŒäºŒè¿›åˆ¶ç ï¼Œæ— é¡»ä¸‹è½½å®‰è£…åŒ…ï¼Œä»–è‡ªå¸¦äº†ä¸ª cowsayå‘½ä»¤ï¼Œå¯ä»¥ä½“éªŒ bunxçš„ç”¨æ³•ï¼Œå‘½ä»¤è¡Œè¿è¡Œ bunx cowsay Hell Bun 123456789(base) âœ bun-learn bunx cowsay Hello Bun ___________&lt; Hello Bun &gt; ----------- \\ ^__^ \\ (oo)\\_______ (__)\\ )\\/\\ ||----w | || || å‰ç«¯è„šæ‰‹æ¶react å®˜æ–¹è„šæ‰‹æ¶ï¼Œåœ¨ Bun ä¸­ä½¿ç”¨å¦‚ä¸‹ï¼š 123bun create react-app &lt;yourAppName&gt;# orbunx create-react-app &lt;yourAppName&gt; vite çš„è„šæ‰‹æ¶ï¼š 123bun create vite &lt;yourAppName&gt; --template vue# orbunx create-vite &lt;yourAppName&gt; --template vue æ¨¡å—åŒ–å¼•å…¥bun ç›´æ¥æ”¯æŒ es module å’Œ commonjs ä¸¤ç§æ¨¡å—å¼•å…¥ï¼Œä¹Ÿä¸ç”¨åœ¨ package.json é‡Œåšå‡ºå…¶ä»–é…ç½®ï¼Œè§£å†³äº†å›°æ‰°äº† node å¤šå¹´çš„æ¨¡å—å¼•å…¥é—®é¢˜ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ demoï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ module.ts 1touch module.ts ä»¥ä¸‹æˆ‘ä»¬ç”¨ path æ¨¡å—ä¸¾ä¾‹ï¼š 1234567import path from &quot;path&quot;;// const path = require(&#x27;path&#x27;); // commonjs also okconst filepath = path.join(&quot;foo&quot;, &quot;bar&quot;, &quot;img.png&quot;);const filename = path.basename(filepath);console.log(filename); è·‘äº†åæ§åˆ¶å°å¯çœ‹åˆ°ï¼š 12(base) âœ bun-learn bun module.tsimg.png ä¸€äº›å¸¸ç”¨æ¨¡å—åœ¨ Bun ä¸­çš„ä½¿ç”¨file æ¨¡å—Bun.write() å†™å…¥æ–‡ä»¶ï¼š1touch file-demo.ts å†™ä¸‹ï¼š 12const data = &quot;I love Bun!&quot;;await Bun.write(&quot;file-demo.txt&quot;, data); ä»ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡ºï¼ŒBun å’Œ deno ä¸€æ ·ï¼Œæ”¯æŒé¡¶å±‚çš„ awaitè¯­æ³•ï¼Œæ— é¡»åƒ node ä¸€æ ·åŒ…è£…åœ¨ async å‡½æ•°é‡Œä½¿ç”¨ await Bun.write() æ¥å£å¯å†™å…¥æ–‡ä»¶ è·‘ bun file-demo.ts å¯ä»¥çœ‹åˆ°å½“å‰ç›®å½•ä¸‹ç”Ÿæˆäº† file-demo.txt æ–‡ä»¶ï¼Œå¹¶åœ¨æ–‡ä»¶é‡Œå†™ä¸‹äº† data çš„å†…å®¹ã€‚ await Bun.file().text() è¯»å–æ–‡ä»¶åœ¨ä¸Šé¢çš„ä»£ç åŠ ä¸Šï¼š 123const file = Bun.file(&quot;file-demo.txt&quot;);console.log(&quot;file-demo contentï¼š&quot;, await file.text()); æ§åˆ¶å°è¾“å‡º 12(base) âœ bun-learn bun file-demo.tsfile-demo contentï¼š I love Bun! è¿™é‡Œå€¼å¾—æ³¨æ„ï¼ŒBun.file().text() æ˜¯å¼‚æ­¥æ¥å£ï¼Œè¿”å›çš„æ˜¯ Promise å¯¹è±¡ï¼Œæ‰€ä»¥å¿…é¡»ç”¨ä¸Š await å…³é”®å­—æ‰èƒ½æ˜¾ç¤ºå‡ºå†…å®¹ å…¶ä»–å‡ ä¸ª file çš„æ¥å£ï¼š 123console.log(await file.stream());console.log(await file.arrayBuffer());console.log(&quot;file size:&quot;, file.size); æµ‹è¯•æ¨¡å—bun é›†æˆäº† jest çš„æµ‹è¯•æ¨¡å—ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®é‡Œç›´æ¥åˆ›å»ºæµ‹è¯•æ–‡ä»¶ï¼š 1touch index.test.ts 1234567891011import &#123; describe, expect, test, beforeAll &#125; from &quot;bun:test&quot;;beforeAll(() =&gt; &#123; console.log(&quot;å‘µå‘µ&quot;);&#125;);describe(&quot;math&quot;, () =&gt; &#123; test(&quot;addition&quot;, () =&gt; &#123; expect(2 + 1).toBe(3); &#125;);&#125;); å¯ä»¥çœ‹å‡ºï¼Œæ‰€æœ‰çš„ jest æ¨¡å—éƒ½é›†æˆåœ¨ &quot;bun:test&quot; åŸç”ŸåŒ…é‡Œï¼Œæ§åˆ¶å°è·‘çš„ç»“æœï¼š 1234567891011(base) âœ bun-learn bun testbun test v1.0.12 (85c99751)index.test.ts:å‘µå‘µâœ“ math &gt; addition [0.19ms] 1 pass 0 fail 1 expect() callsRan 1 tests across 1 files. [11.00ms] bundle æ‰“åŒ…æˆ‘ä»¬æ¥è¯•è¯•ç”¨ Bun è¿›è¡Œæ™®é€šçš„ bundle æ‰“åŒ…åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä»¥ä¸‹æ–‡ä»¶å¤¹å’Œæ–‡ä»¶ï¼š 123---src |__ githubApi.ts |__ index.ts githubApi.tsæ–‡ä»¶ å‰ç«¯ js ä»£ç æ‰“åŒ…ï¼Œæ‰€ä»¥æš‚æ—¶ä¸ç”¨é¡¶å±‚ await è¯­æ³•ï¼š 12345678import axios from &quot;axios&quot;;const fetchUser = async (user) =&gt; &#123; const res = await axios.get(`https://api.github.com/users/$&#123;user&#125;`); return res.data;&#125;;export default fetchUser; index.tsæ–‡ä»¶ 123456import fetchUser from &quot;./githubApi&quot;;(async () =&gt; &#123; const userData = await fetchUser(&quot;ys558&quot;); document.querySelector(&quot;h1&quot;).innerHTML = JSON.stringify(userData);&#125;)(); åœ¨å‘½ä»¤è¡Œé‡Œè¿è¡Œï¼š 1bun build ./src/index.ts --outfile=./dist/bundle.js å¯ä»¥çœ‹åˆ°distæ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆäº† bundle.js å°†è¯¥æ–‡ä»¶æ”¾å…¥ HTML çš„ script æ ‡ç­¾é‡Œåˆ™å¯ä½¿ç”¨ å¦‚æœå¼€å‘æ—¶ï¼Œå¯ä»¥åœ¨ bun build çš„å‘½ä»¤åŠ ä¸Š --watch, åˆ™å¯ä»¥çƒ­åŠ è½½æ¨¡å¼ 1bun build ./src/index.ts --outfile=./dist/bundle.js --watch react åœ¨é¡¹ç›®ä¸­çš„åº”ç”¨åœ¨æˆ‘ä»¬åŸæ¥çš„é¡¹ç›®é‡Œæ·»åŠ  react å’Œ react-dom 1bun i react react-dom src ä¸‹åˆ›å»º index.tsx , å†™ä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨ï¼š 1234567891011121314151617import React from &quot;react&quot;;import &#123; createRoot &#125; from &quot;react-dom&quot;;const root = createRoot(document.getElementById(&quot;root&quot;));const App = () =&gt; &#123; const [count, setCount] = React.useState(0); return ( &lt;div&gt; &lt;h1&gt;Count: &#123;count&#125;&lt;/h1&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;+&lt;/button&gt; &lt;button onClick=&#123;() =&gt; setCount(count - 1)&#125;&gt;-&lt;/button&gt; &lt;/div&gt; );&#125;;root.render(&lt;App /&gt;); åœ¨ dist ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªæ ¹ç›®å½• index.html, åŠ ä¸Šä¸€ä¸‹ä¸¤è¡Œï¼š 12&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;&lt;script src=&quot;./bun.js&quot;&gt;&lt;/script&gt; bash ä¸‹è¿è¡Œ: 1bun build ./src/index.tsx --outfile=./dist/budle.js --watch æ‰“å¼€ index.html å°±å¯ä»¥çœ‹åˆ°è¯¥è®¡æ•°å™¨","tags":["bun"]},{"title":"react-18æ–°ç‰¹æ€§","path":"/2023/10/29/ã€2023-10-29ã€‘react-18æ–°ç‰¹æ€§/","content":"React 18 æ–°ç‰¹æ€§ å¹¶å‘æ¨¡å¼ï¼ˆConcurrent Modeï¼‰ï¼šè¿™ç§æ–°çš„æ¸²æŸ“æ¨¡å¼å…è®¸åœ¨æµè§ˆå™¨ä¸‹ä¸€å¸§ç©ºé—²æ—¶è¿›è¡Œæ›´æ–°ï¼Œå…è®¸å¤šä¸ªä»»åŠ¡åŒæ—¶è¿›è¡Œï¼Œæé«˜äº†æ¸²æŸ“æ€§èƒ½ã€‚ä½“ç°åœ¨ä»£ç ä¸Šå°±æ˜¯ Suspense ç»„ä»¶çš„åº”ç”¨ï¼š 12345678910111213import React, &#123; Suspense &#125; from &#x27;react&#x27;; const loadingComponent = () =&gt; &#123; return &lt;div&gt;Loading...&lt;/div&gt;; &#125;; const App = () =&gt; &#123; return ( &lt;Suspense fallback=&#123;loadingComponent()&#125;&gt; &lt;AsyncComponent /&gt; &lt;/Suspense&gt; ); &#125;; æ–°çš„æ›´æ–°è°ƒåº¦å™¨ï¼ˆUpdate Schedulerï¼‰ï¼šè¿™ä¸ªæ–°çš„æ›´æ–°è°ƒåº¦å™¨å¯ä»¥æ›´ç»†ç²’åº¦åœ°è°ƒåº¦æ›´æ–°ï¼Œä»¥ä¼˜åŒ–æ›´æ–°ä¼˜å…ˆçº§å’Œæ—¶é—´åˆ†ç‰‡ã€‚ React 18å¼•å…¥äº†ä¸€ä¸ªæ–°çš„æ›´æ–°è°ƒåº¦å™¨ï¼Œå®ƒå¯ä»¥æ›´ç»†ç²’åº¦åœ°è°ƒåº¦æ›´æ–°ã€‚è¿™ä¸ªæ–°çš„è°ƒåº¦å™¨å…è®¸Reactæ ¹æ®ä»»åŠ¡çš„ä¼˜å…ˆçº§å’Œæ—¶é—´åˆ†ç‰‡æ¥å®‰æ’æ›´æ–°ã€‚è¿™æ„å‘³ç€Reactå¯ä»¥æ ¹æ®åº”ç”¨ç¨‹åºçš„çŠ¶æ€å’Œç”¨æˆ·äº¤äº’æ¥ä¼˜åŒ–æ›´æ–°é¡ºåºï¼Œä»è€Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ–°çš„æ›´æ–°è°ƒåº¦å™¨ï¼š 12345678910111213141516171819202122import React, &#123; useState &#125; from &#x27;react&#x27;; const Timer = () =&gt; &#123; const [time, setTime] = useState(Date.now()); const [count, setCount] = useState(0); useEffect(() =&gt; &#123; const timer = setTimeout(() =&gt; &#123; setTime(Date.now()); setCount(0); &#125;, 1000); return () =&gt; clearTimeout(timer); &#125;, []); return ( &lt;div&gt; &lt;p&gt;Current time: &#123;time&#125;&lt;/p&gt; &lt;p&gt;Count: &#123;count&#125;&lt;/p&gt; &lt;button onClick=&#123;() =&gt; setCount(count + 1)&#125;&gt;Increment&lt;/button&gt; &lt;/div&gt; ); &#125;; åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†useStateå’ŒuseEffectæ¥ç®¡ç†çŠ¶æ€å’Œæ‰§è¡Œå‰¯ä½œç”¨ã€‚åœ¨æ¯ä¸€ç§’é’Ÿæ›´æ–°æ—¶é—´æˆ³ï¼Œå¹¶åœ¨æ¯æ¬¡ç‚¹å‡»æŒ‰é’®æ—¶å¢åŠ è®¡æ•°å™¨çš„å€¼ã€‚ç”±äºæ–°çš„æ›´æ–°è°ƒåº¦å™¨çš„å¼•å…¥ï¼ŒReactå¯ä»¥æ ¹æ®ä¼˜å…ˆçº§å’Œæ—¶é—´åˆ†ç‰‡æ¥å®‰æ’æ›´æ–°ï¼Œä»è€Œæä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚ æ–°çš„æ¸²æŸ“APIï¼šReact 18å¼•å…¥äº†æ–°çš„æ¸²æŸ“APIï¼ŒåŒ…æ‹¬createRoot()å‡½æ•°å’ŒConcurrent Modeä¸‹çš„æ–°çš„æ¸²æŸ“å‡½æ•°ã€‚æ”¯æŒSSR for Suspenseï¼šReact 18ç°åœ¨æ”¯æŒæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼ˆSSRï¼‰å’ŒSuspenseçš„é›†æˆï¼Œä»¥æ”¹å–„é¦–å±åŠ è½½æ—¶é—´å’Œç”¨æˆ·ä½“éªŒã€‚ createRoot api æ›´æ–°å‰åå¯¹æ¯”ï¼šç”¨ createRoot æ›¿æ¢ renderã€‚è¿™æ · 12345678910// Beforeimport &#123; render &#125; from &#x27;react-dom&#x27;;const container = document.getElementById(&#x27;app&#x27;);render(&lt;App tab=&quot;home&quot; /&gt;, container);// Afterimport &#123; createRoot &#125; from &#x27;react-dom/client&#x27;;const container = document.getElementById(&#x27;app&#x27;);const root = createRoot(container); // createRoot(container!) if you use TypeScriptroot.render(&lt;App tab=&quot;home&quot; /&gt;); è‡ªåŠ¨æ‰¹å¤„ç†ï¼ˆAutomatic Batchingï¼‰ï¼šåœ¨React 18ä¸­ï¼Œå½“setStateè¢«è°ƒç”¨åï¼Œå¹¶ä¸ä¼šç«‹å³è§¦å‘é‡æ–°æ¸²æŸ“ã€‚Reactä¼šæ‰§è¡Œå…¨éƒ¨äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œç„¶åè§¦å‘ä¸€ä¸ªå•ç‹¬çš„re-renderï¼Œåˆå¹¶æ‰€æœ‰çš„æ›´æ–°ã€‚è¿™æ ·å¯ä»¥å‡å°‘ç¨‹åºæ•°æ®çŠ¶æ€å­˜åœ¨ä¸­é—´å€¼å¯¼è‡´çš„ä¸ç¨³å®šæ€§ï¼Œä¹Ÿå¯ä»¥æé«˜æ¸²æŸ“æ€§èƒ½ã€‚ ä»£ç çš„ä½“ç°ä¹ŸåŒæ ·æ˜¯ Suspence ç»„ä»¶ï¼š 1234567891011121314151617181920212223import React, &#123; Suspense &#125; from &#x27;react&#x27;; const loadingComponent = () =&gt; &#123; return &lt;div&gt;Loading...&lt;/div&gt;; &#125;; const App = () =&gt; &#123; return ( &lt;Suspense fallback=&#123;loadingComponent()&#125;&gt; &#123;async () =&gt; &#123; // åœ¨è¿™é‡Œæ‰§è¡Œä¸€äº›å¼‚æ­¥æ“ä½œï¼Œä¾‹å¦‚æ•°æ®è·å–ç­‰ã€‚ const data = await fetchData(); // å‡è®¾fetchDataæ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œè¿”å›ä¸€äº›æ•°æ®ã€‚ return ( &lt;div&gt; &#123;data.map((item) =&gt; ( &lt;div key=&#123;item.id&#125;&gt;&#123;item.name&#125;&lt;/div&gt; ))&#125; &lt;/div&gt; ); &#125;&#125; &lt;/Suspense&gt; ); &#125;;","tags":["react","react Suspense"]},{"title":"Rustå­¦ä¹ ç¬”è®°ï¼ˆ5ï¼‰â€”â€” æšä¸¾ enum","path":"/2023/10/08/ã€2023-10-08ã€‘Rustå­¦ä¹ ç¬”è®°ï¼ˆ5ï¼‰â€”â€” æšä¸¾ enum/","content":"æœ¬æ–‡çš„å‚è€ƒä»£ç åœ¨è¿™é‡Œ æšä¸¾ enumåŸºæœ¬æ¦‚å¿µæšä¸¾ä¸ºæ‚¨æä¾›äº†ä¸€ç§è¡¨ç¤ºæŸä¸ªå€¼æ˜¯ä¸€ç»„å¯èƒ½çš„å€¼ä¹‹ä¸€çš„æ–¹æ³•ã€‚ ä¸‹é¢çš„ä»£ç å®šä¹‰äº†æšä¸¾ enum ç±»å‹ï¼ŒIpAddrKind v4å’Œv6 ç»‘å®šæšä¸¾å€¼æ—¶ï¼Œé¡»ç”¨ :: ç»‘å®š 123456789101112131415161718#[derive(Debug)]enum IpAddrKind &#123; v4,\tv6&#125;fn main() &#123;\t// åˆ›å»ºå˜ä½“å®ä¾‹, ç”¨ :: ç»‘å®šå€¼\tlet four = IpAddrKind::v4;\tlet six = IpAddrKind::v6;\troute(four); // ip_kind -&gt; v4\troute(six); // ip_kind -&gt; v6&#125;fn route(ip_kind: IpAddrKind) &#123;\tprintln!(&quot;ip_kind -&gt; &#123;:?&#125;&quot;, ip_kind); &#125; æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸Šä¸€èŠ‚æåˆ°çš„ struct ç»“æ„ä½“ï¼Œå¯¹ipçš„å®é™…åœ°å€ç”¨å­—ç¬¦ä¸²è¿›è¡Œå­˜å‚¨ï¼š 123456789101112131415161718192021222324252627282930#[derive(Debug)]enum IpAddrKind &#123; v4,\tv6&#125;#[derive(Debug)]struct IpAddr &#123;\tkind: IpAddrKind,\taddress: String&#125;fn main() &#123;\tlet home = IpAddr &#123; kind: IpAddrKind::v4, address: String::from(&quot;127.0.0.1&quot;),\t&#125;;\tlet loopback = IpAddr &#123; kind: IpAddrKind::v6, address: String::from(&quot;::1&quot;),\t&#125;;\troute(home); // ip_kind -&gt; IpAddr &#123; kind: v4, address: &quot;127.0.0.1&quot; &#125;\troute(loopback); // ip_kind -&gt; IpAddr &#123; kind: v6, address: &quot;::1&quot; &#125;&#125;fn route(ip_kind: IpAddr) &#123;\tprintln!(&quot;ip_kind -&gt; &#123;:?&#125;&quot;, ip_kind);&#125; enum å¯ç‹¬è‡ªå®šä¹‰æ¯ä¸ªæˆå‘˜çš„æ•°æ®ç±»å‹ä½†ä¸Šé¢çš„ä»£ç å¯ä»¥è®© enum ç›´æ¥å­˜å‚¨ç±»å‹ä¸º String, çœå»æ›´å¤šä»£ç ï¼Œå¯ä»¥æ”¹å†™å¦‚ä¸‹ï¼š 12345678910111213#[derive(Debug)]enum IpAddrKind &#123; v4(String),\tv6(String)&#125;fn main() &#123;\tlet home = IpAddrKind::v4(String::from(&quot;127.0.0.1&quot;));\tlet loopback = IpAddrKind::v6(String::from(&quot;::1&quot;));\tprintln!(&quot;home &#123;:?&#125;&quot;, home); // home v4(&quot;127.0.0.1&quot;)\tprintln!(&quot;loopback &#123;:?&#125;&quot;, loopback); // loopback v6(&quot;::1&quot;)&#125; ç”šè‡³å¯ä»¥å†ç»†åŒ–, åšåˆ°ç»“æ„ä½“æ— æ³•å®Œæˆçš„ä»»åŠ¡ï¼Œä¾‹å¦‚ipv4ä¸€èˆ¬æ˜¯4ä¸ª8 bitçš„ æ•°å€¼ï¼Œå®šä¹‰ç±»å‹æ—¶å¯å’Œipv6åŒºåˆ†å¼€æ¥ï¼š 12345678910111213#[derive(Debug)]enum IpAddrKind &#123; v4(u8, u8, u8, u8),\tv6(String)&#125;fn main() &#123;\tlet home = IpAddrKind::v4(String::from(127, 0, 0, 1));\tlet loopback = IpAddrKind::v6(String::from(&quot;::1&quot;));\tprintln!(&quot;home &#123;:?&#125;&quot;, home); // home v4(&quot;127.0.0.1&quot;)\tprintln!(&quot;loopback &#123;:?&#125;&quot;, loopback); // loopback v6(&quot;::1&quot;)&#125; å…¶å®æˆ‘ä»¬åœ¨æ ‡å‡†åº“é‡Œï¼Œå¯ä»¥çœ‹åˆ°ä¸€ä¸ªä¸“é—¨å®šä¹‰ipçš„ç»“æ„ä½“ï¼Œå¯ä»¥ç”¨æ¥è¿™æ ·è¡¨è¾¾enumï¼š 123456789101112struct Ipv4Addr &#123;\t// --snip--&#125;struct Ipv6Addr &#123;\t// --snip--&#125;enum IpAddr &#123;\tV4(Ipv4Addr),\tV6(Ipv6Addr),&#125; rust é‡Œæ²¡æœ‰ null å€¼æ¦‚å¿µï¼Œnull çš„é—®é¢˜åœ¨äºï¼Œå¦‚æœæ‚¨å°è¯•å°†ç©ºå€¼ç”¨ä½œéç©ºå€¼ï¼Œåˆ™ä¼šæ”¶åˆ°æŸç§é”™è¯¯ã€‚æ‰€ä»¥ç”¨ Noneä»£æ›¿ï¼Œå³æ— å€¼ã€‚ä»–åœ¨æ ‡å‡†åº“çš„å®šä¹‰å¦‚ä¸‹ï¼š 1234enum Option&lt;T&gt; &#123; None, Some(T),&#125;","tags":["rust","enum"]},{"title":"Rustå­¦ä¹ ç¬”è®°ï¼ˆ4ï¼‰â€”â€” ç»“æ„ä½“ struct","path":"/2023/10/02/ã€2023-10-02ã€‘Rustå­¦ä¹ ç¬”è®°ï¼ˆ4ï¼‰â€”â€” ç»“æ„ä½“ struct/","content":"æœ¬æ–‡çš„å‚è€ƒä»£ç åœ¨è¿™é‡Œ å®šä¹‰åŠå®ä¾‹åŒ–ç»“æ„ Structstruct å…³é”®å­—ï¼Œä¸­æ–‡å¯ä»¥ç†è§£ä¸ºç»“æ„ä½“, æ˜¯ä¸€ç§è‡ªå®šä¹‰æ•°æ®ç±»å‹ã€‚ 123456789101112131415struct User &#123; username: String, active: bool, email: String, sign_in_count: u64&#125;fn main() &#123; let mut user1 = User &#123; username: String::from(&quot;user1&quot;), email: String::from(&quot;user1@mail.com&quot;), active: true, sign_in_count: 1 &#125;;&#125; æ”¹å˜å®ä¾‹ä¸­çš„å€¼ï¼Œå¯ä»¥ç›´æ¥ç”¨ç‚¹ . è¿›è¡Œè®¿é—®åŠèµ‹å€¼ï¼Œå¦‚ï¼š 123456let name = user1.username;user1.username = String::from(&quot;John123&quot;);println!( &quot;username before: &#123;&#125;, username after: &#123;&#125;&quot;, name, user1.username); // username before: user1, username after: John123 Field Init ç®€å†™ç”¨å‡½æ•°ç”Ÿæˆå®ä¾‹ï¼šå°è£…ä¸€ä¸ªå‡½æ•°ç”¨äºç”Ÿæˆ User å¯¹è±¡ï¼Œå†ç”Ÿæˆä¸€ä¸ª user2çš„å®ä¾‹ å½“ç”Ÿæˆ user3 æ—¶ï¼Œå¦‚æœå…¶ä»–å±æ€§ä¸æƒ³åˆ—å‡ºï¼Œå¯ä»¥ç›´æ¥ç”¨ .. çš„è¯­æ³•æ‹¿å– user2 ä¸­çš„å‚æ•°ç›´æ¥ä½¿ç”¨ï¼š 1234567891011121314151617181920212223fn main() &#123; let user2 = build_user( String::from(&quot;kyle@mail.com&quot;), String::from(&quot;kyle123&quot;) ); println!(&quot;user2.username =&gt; &#123;&#125;, user3.email after =&gt; &#123;&#125;&quot;, user2.username, user2.email); // user2.username =&gt; kyle123, user3.email after =&gt; kyle@mail.com let user3 = User &#123; email: String::from(&quot;james@mail.com&quot;), username: String::from(&quot;james234&quot;), ..user2 &#125;; println!(&quot;user3.username &#123;&#125;, user3.email &#123;&#125;&quot;, user3.username, user3.email); // user3.username james234, user3.email james@mail.com&#125;fn build_user(email: String, username: String) -&gt; User &#123; User &#123; email, username, active: true, sign_in_count: 1 &#125;&#125; tuple struct ä½¿ç”¨å…ƒç»„ç»“æ„åˆ›å»ºä¸åŒç±»å‹123// tuple structstruct Color(i32, i32, i32);struct Point(i32, i32, i32); ä»¥ä¸‹çš„ä»£ç æ˜¯ä¸€ä¸ªæ™®é€šçš„è®¡ç®—é•¿æ–¹å½¢é¢ç§¯çš„å‡½æ•°ï¼š 12345678910fn main() &#123; let width1 = 30; let height1 = 50; println!(&quot;area of the reactangle is &#123;&#125;&quot;, area(width1, height1)); // area of the reactangle is 1500&#125;fn area(width: u32, height: u32) -&gt; u32 &#123; width * height&#125; å°†å…¶ä¼ å‚æ”¹ä¸ºå…ƒç»„ï¼Œåˆ™å¯ä»¥æ”¹å†™æˆï¼š 12345678fn main() &#123; let rect = (30, 50); println!(&quot;area of the reactangle is &#123;&#125;&quot;, area_by_tuple(rect)); // area of the reactangle is 1500&#125;fn area_by_tuple(dimensions: (u32, u32)) -&gt; u32 &#123; dimensions.0 * dimensions.1&#125; å°†å…ƒç»„çš„éƒ¨åˆ†æç‚¼æˆ struct, æ”¹å†™æˆï¼š 1234567891011121314151617struct Rectangle &#123; width: u32, height: u32&#125;fn main() &#123; let rect1 = Rectangle &#123; width: 30, height: 50 &#125;; println!(&quot;rect1 &#123;:?&#125;&quot;, rect1); // rect1 Rectangle &#123; width: 30, height: 50 &#125; println!(&quot;the area of the reactangle is &#123;&#125;&quot;, area_by_struct(&amp;rect1)); // the area of the reactangle is 1500&#125;fn area_by_struct(rectangle: &amp;Rectangle) -&gt; u32 &#123; rectangle.width * rectangle.height&#125; tipsï¼šåœ¨æˆ‘ä»¬å®šä¹‰äº† let rect1 åæˆ‘ä»¬æ˜¯æ— æ³•ç›´æ¥æ‰“å°å‡ºæ¥çš„ï¼Œä¼šæŠ¥é”™ï¼Œè¿™æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ struct Rectangle ä¸ŠåŠ ä¸€ä¸ªä¿®é¥°ç¬¦ #[derive(Debug)]ï¼Œè€Œä¸”æ‰“å°é‡Œçš„{}ä¹Ÿéœ€è¦åŠ ä¸Šï¼Œæ‰èƒ½æ­£ç¡®æ‰“å°å‡º rect1ï¼Œå¦‚ï¼š 123456789101112131415161718#[derive(Debug)]struct Rectangle &#123; width: u32, height: u32&#125;fn main() &#123; let rect1 = Rectangle &#123; width: 30, height: 50 &#125;; println!(&quot;rect1 &#123;:?&#125;&quot;, rect1); // rect1 Rectangle &#123; width: 30, height: 50 &#125; println!(&quot;rect1 &#123;:#?&#125;&quot;, rect1); // rect1 Rectangle &#123; // width: 30, // height: 50, // &#125;&#125; ä»¥ä¸Šæ¶‰åŠåˆ° trait ç‰¹å¾çš„æ¦‚å¿µï¼Œæˆ‘ä»¬åé¢çš„ç« èŠ‚ä¼šè®²åˆ° æ–¹æ³• Method Syntaxå®šä¹‰æ–¹æ³•ä¸Šé¢çš„ struct ç”±äºæœ‰å›ºå®šçš„å…¬å¼ï¼Œå³width*height æˆ‘ä»¬å¯ä»¥æŠŠä»–ç®€åŒ–ä¸º impl, å°†areaçš„è®¡ç®—å…¬å¼å®šä¹‰åœ¨å…¶å†…éƒ¨ï¼Œå°‘å†™äº†ä¸€ä¸ªå‡½æ•° 1234567891011121314151617181920212223242526272829303132333435#[derive(Debug)]struct Rectangle &#123; width: u32, height: u32&#125;impl Rectangle &#123; fn area_by_impl(&amp;self) -&gt; u32 &#123; self.width * self.height &#125; fn can_hold(&amp;self, other: &amp;Rectangle) -&gt; bool &#123; self.width &gt; other.width &amp;&amp; self.height &gt; other.height &#125;&#125;fn main() &#123; let rect2 = Rectangle &#123; width: 33, height: 55 &#125;; println!(&quot;the area of the reactangle is &#123;&#125;&quot;, rect2.area_by_impl()); // the area of the reactangle is 1815 let rect3 = Rectangle &#123; width: 22, height: 33 &#125;; let rect4 = Rectangle &#123; width: 66, height: 77 &#125;; println!(&quot;rect2 can hold rect3 &#123;&#125;&quot;, rect2.can_hold(&amp;rect3)); // rect2 can hold rect3 true println!(&quot;rect2 can hold rect4 &#123;&#125;&quot;, rect2.can_hold(&amp;rect4)); // rect2 can hold rect4 false &#125; å…³è”å‡½æ•°å°½ç®¡å®˜æ–¹æ–‡æ¡£æœ‰å¾ˆå¤šè§£é‡Šï¼Œä½†ç®€å•æ¥è¯´å°±æ˜¯ impl èƒ½ç›´æ¥åƒæ™®é€šå‡½æ•°ä¸€æ ·ä¼ å…¥å‚æ•°ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ 1234567891011121314impl Rectangle &#123; fn square(size: u32) -&gt; Self &#123; Self &#123; width: size, height: size &#125; &#125;&#125;fn main() &#123; let rect5 = Rectangle::square(22); println!(&quot;rect5 &#123;:?&#125;&quot;, rect5); // rect5 Rectangle &#123; width: 22, height: 22 &#125;&#125; éœ€è¦æ³¨æ„ï¼Œå…³è”å‡½æ•°éœ€è¦ç”¨ :: è¿›è¡Œå‡½æ•°ä¼ å€¼ï¼Œè€Œä¸æ˜¯ç‚¹ã€‚","tags":["rust","struct"]},{"title":"Rustå­¦ä¹ ç¬”è®°ï¼ˆ3ï¼‰â€”â€” æ ¸å¿ƒæ¦‚å¿µï¼šæ‰€æœ‰æƒ","path":"/2023/10/01/ã€2023-10-01ã€‘Rustå­¦ä¹ ç¬”è®°ï¼ˆ3ï¼‰â€”â€” æ ¸å¿ƒæ¦‚å¿µï¼šæ‰€æœ‰æƒ/","content":"æœ¬æ–‡çš„å‚è€ƒä»£ç åœ¨è¿™é‡Œ æ‰€æœ‰æƒï¼ˆOwnershipï¼‰Rustçš„æ‰€æœ‰æƒï¼ˆOwnershipï¼‰æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒå¸®åŠ©Ruståœ¨æ²¡æœ‰åƒåœ¾å›æ”¶æœºåˆ¶çš„æƒ…å†µä¸‹è¿›è¡Œå†…å­˜ç®¡ç†ã€‚åœ¨Rustä¸­ï¼Œæ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„å˜é‡ï¼Œè¿™ä¸ªå˜é‡è¢«ç§°ä¸ºè¯¥å€¼çš„æ‰€æœ‰è€…ï¼ˆownerï¼‰ã€‚ ä»¥ä¸‹æ˜¯å…³äºRustæ‰€æœ‰æƒçš„ä¸€äº›å…³é”®è§„åˆ™ï¼š ä¸€ä¸ªå€¼åœ¨ä»»ä½•æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…ã€‚ å½“å€¼çš„æ‰€æœ‰è€…è¶…å‡ºå…¶ä½œç”¨åŸŸæ—¶ï¼Œè¯¥å€¼å°†è¢«é”€æ¯ã€‚ è¿™æ„å‘³ç€Ruståœ¨è¿è¡Œæ—¶å†…å­˜ç®¡ç†æ–¹é¢ä¸è®¸å¤šå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸åŒã€‚åœ¨æŸäº›è¯­è¨€ä¸­ï¼ˆå¦‚Cï¼‰ï¼Œå¼€å‘äººå‘˜éœ€è¦æ˜¾å¼åœ°åˆ†é…ï¼ˆallocateï¼‰å’Œå›æ”¶ï¼ˆdeallocateï¼‰å†…å­˜ã€‚è€Œåœ¨å…¶ä»–å…·æœ‰åƒåœ¾å›æ”¶åŠŸèƒ½çš„è¯­è¨€ï¼ˆå¦‚Javaï¼‰ä¸­ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šåœ¨ç¨‹åºè¿è¡Œæ—¶ä¸æ–­å¯»æ‰¾ä¸å†ä½¿ç”¨çš„å†…å­˜ã€‚ä½†Rustçš„æ‰€æœ‰æƒç³»ç»Ÿå…è®¸å®ƒæ— éœ€è¿™äº›é¢å¤–çš„æœºåˆ¶å°±èƒ½ä¿è¯å†…å­˜å®‰å…¨ã€‚ åƒåœ¾å›æ”¶å™¨ï¼šåœ¨å…¶ä»–ä¸€äº›å…·æœ‰åƒåœ¾å›æ”¶æœºåˆ¶çš„è¯­è¨€ä¸­ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç¨‹åºè¿è¡Œé€Ÿåº¦æ›´å¿«ä½†æ€§èƒ½è¡¨ç°æ›´åŠ ä¸å¯é¢„æµ‹ã€‚æ­¤å¤–ï¼Œå¤§å‹ç¨‹åºä¼šæ›´å¤§ï¼Œæ‰‹åŠ¨ç®¡ç†å†…å­˜å¯èƒ½ä¼šå¢åŠ é”™è¯¯å¤„ç†å’Œç®¡ç†çš„æˆæœ¬ã€‚ç„¶è€Œï¼ŒRustæ²¡æœ‰ä½¿ç”¨åƒåœ¾å›æ”¶å™¨ï¼Œå› æ­¤ä¸ä¼šå‡ºç°è¿™äº›é—®é¢˜ã€‚ å†…å­˜æ§åˆ¶ï¼šä½¿ç”¨Rustå¯ä»¥æ›´å¥½åœ°æ§åˆ¶å†…å­˜çš„ä½¿ç”¨ï¼Œä»è€Œé¿å…å†…å­˜æ³„æ¼æˆ–å†…å­˜æº¢å‡ºç­‰é—®é¢˜ã€‚æ­¤å¤–ï¼Œç”±äºæ²¡æœ‰åƒåœ¾å›æ”¶å™¨ï¼Œå†™å…¥æ—¶é—´ä¼šæ›´å¿«ï¼Œä½†å¤§å‹ç¨‹åºçš„å¤§å°å¯èƒ½ä¼šå¯¼è‡´æ›´é«˜çš„è¿è¡Œæ—¶å»¶è¿Ÿã€‚ æ‰€æœ‰æƒæ¨¡å‹ï¼šRustæ‹¥æœ‰æ‰€æœ‰æƒæ¨¡å‹ï¼Œè¿™æœ‰åŠ©äºå‡å°‘å†…å­˜é”™è¯¯å¹¶æé«˜ä»£ç çš„å¯é æ€§ã€‚ç„¶è€Œï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´å­¦ä¹ æ›²çº¿å˜å¾—æ›´åŠ é™¡å³­ï¼Œå› ä¸ºéœ€è¦æ›´å¤šåœ°äº†è§£å†…å­˜ç®¡ç†å’Œå†…å­˜åˆ†é…ç­–ç•¥ã€‚ å†…å­˜ç®¡ç†ï¼šRustå…·æœ‰æ›´å¥½çš„å†…å­˜ç®¡ç†èƒ½åŠ›ï¼Œè¿™æœ‰åŠ©äºä¼˜åŒ–æ€§èƒ½ã€‚ç„¶è€Œï¼Œè¿™ä¹Ÿä¼šå¢åŠ é”™è¯¯å¤„ç†å’Œç»´æŠ¤æˆæœ¬ã€‚ å­¦ä¹ æ›²çº¿ï¼šç”±äºRustçš„å†…å­˜ç®¡ç†å’Œå†…å­˜æ§åˆ¶çš„å¤æ‚æ€§ï¼Œéœ€è¦æ›´å¤šçš„å­¦ä¹ å’Œç»ƒä¹ æ‰èƒ½æŒæ¡å®ƒä»¬ã€‚ æ‰€æœ‰æƒä»£ç ç¤ºä¾‹ï¼š 123456789101112fn main() &#123; // ------ æ‰€æœ‰æƒè§„åˆ™ -------- // 1. æ¯ä¸ªå€¼åœ¨Rustä¸­éƒ½æœ‰ä¸€ä¸ªè¢«ç§°ä¸ºå…¶æ‰€æœ‰è€…çš„å˜é‡ã€‚ // 2. åœ¨ä»»ä½•æ—¶å€™ï¼Œä¸€ä¸ªå€¼åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…ã€‚ // 3. å½“æ‰€æœ‰è€…è¶…å‡ºå…¶ä½œç”¨åŸŸæ—¶ï¼Œè¯¥å€¼å°†è¢«ä¸¢å¼ƒï¼ˆdropï¼‰ã€‚ &#123; // s è¿˜æœªè¢«å£°æ˜ã€‚ let s: &amp;str = &quot;hello&quot;; // s è¢«å®šä¹‰ï¼Œå¼€å§‹ç”Ÿæ•ˆ println!(&quot;x value is &#123;&#125;&quot;, x); // å½“åŒ…å«&#x27;s&#x27;çš„ä½œç”¨åŸŸç»“æŸæ—¶ï¼ˆå³å¤§æ‹¬å· &#x27;&#123;&#125;&#x27; ç»“æŸæ—¶ï¼‰ï¼Œ&#x27;s&#x27;å°†ä¸å†æœ‰æ•ˆã€‚å› ä¸ºåœ¨è¿™ä¸ªæ—¶åˆ»ï¼Œ&#x27;s&#x27;çš„æ‰€æœ‰è€…å·²ç»è¶…å‡ºäº†å…¶ä½œç”¨åŸŸï¼Œæ‰€ä»¥Rustä¼šå®‰å…¨åœ°åˆ é™¤&#x27;s&#x27;æ‰€å¼•ç”¨çš„å†…å­˜ä¸­çš„æ•°æ®ã€‚ &#125;&#125; ç§»åŠ¨ï¼ˆMoveï¼‰æ“ä½œçš„æ•°æ®äº¤äº’Rustçš„ç§»åŠ¨ï¼ˆMoveï¼‰æ¦‚å¿µï¼Œç±»ä¼¼åˆ«çš„è¯­è¨€é‡Œçš„å¤åˆ¶ï¼ˆcopyï¼‰ï¼Œå…¶åŸç†åœ¨å¼•ç”¨å€¼å¤åˆ¶ä¸Šæœ‰ç€æœ¬è´¨åŒºåˆ«ï¼Œè¿™ä¹Ÿæ˜¯Rustè¯­è¨€ç‹¬ç‰¹çš„åœ°æ–¹ã€‚ åŸå§‹å€¼å¤åˆ¶è¿™ç§å’Œå…¶ä»–è¯­è¨€çš„copyåŒºåˆ«ä¸å¤§ 1234// åŸå§‹å€¼çš„å¤åˆ¶// å°†å€¼ç»‘å®š5åˆ°xï¼›ç„¶åå¤åˆ¶ ä¸­çš„å€¼xå¹¶å°†å…¶ç»‘å®šåˆ°ylet x = 5;let y = x; // copy å¼•ç”¨å€¼å¤åˆ¶å…ˆçœ‹ä¸€æ®µrustä»£ç ï¼š 12let s1 = String::from(&quot;hello&quot;);let s2 = s1; // ç§»åŠ¨ï¼ˆMoveï¼‰ï¼Œè€Œéæµ…æ‹·è´ï¼ˆshallow copyï¼‰ å¦‚æœæŒ‰ç…§å…¶ä»–è¯­è¨€çš„copyæ“ä½œ s1è¢«åˆ›å»ºåï¼Œå…¶æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡å­˜åœ¨äºæ ˆï¼ˆStackï¼‰ä¸­ï¼Œå…¶å€¼â€helloâ€å­˜åœ¨äºå †ï¼ˆHeapï¼‰ä¸­ã€‚ s2å¤åˆ¶s1ï¼Œs2åˆ›é€ å‡ºä¸€å—æ–°çš„æ ˆï¼ˆStackï¼‰ï¼Œå­˜å‚¨å…¶æŒ‡é’ˆã€é•¿åº¦å’Œå®¹é‡ç­‰å±æ€§ï¼Œä½†å…±ç”¨å †ä¸­çš„â€helloâ€ å€¼ã€‚ rust å¯¹ä»¥ä¸Šçš„æ“ä½œåšäº†ä¼˜åŒ–ï¼Œæ­£å¦‚å‰é¢æ‰€è¯´çš„ï¼Œå½“s2è¢«ç»‘å®šäº†s1çš„å †ï¼ˆHeapï¼‰å¼•ç”¨å€¼åï¼Œs1å·²è¶…å‡ºèŒƒå›´ï¼ˆscopeï¼‰ï¼Œrustè®¤ä¸ºs1çš„å€¼ä¸å†æœ‰æ•ˆï¼Œç›´æ¥ä¸¢å¼ƒï¼ˆdropï¼‰äº†ï¼Œç¤ºä¾‹å›¾ï¼š 1234let s1 = String::from(&quot;hello&quot;);let s2 = s1;println!(&quot;&#123;&#125;, world!&quot;, s1); // æŠ¥é”™âŒ ä»¥ä¸Šçš„printä¼šæŠ¥é”™å¦‚ä¸‹ï¼šå› ä¸ºs1çš„å€¼å·²ç»ç§»åŠ¨ï¼ˆMoveï¼‰åˆ°s2 12345678910111213141516171819202122$ cargo run Compiling ownership v0.1.0 (file:///projects/ownership)error[E0382]: borrow of moved value: `s1` --&gt; src/main.rs:5:28 |2 | let s1 = String::from(&quot;hello&quot;); | -- move occurs because `s1` has type `String`, which does not implement the `Copy` trait3 | let s2 = s1; | -- value moved here4 |5 | println!(&quot;&#123;&#125;, world!&quot;, s1); | ^^ value borrowed here after move | = note: this error originates in the macro `$crate::format_args_nl` which comes from the expansion of the macro `println` (in Nightly builds, run with -Z macro-backtrace for more info)help: consider cloning the value if the performance cost is acceptable |3 | let s2 = s1.clone(); | ++++++++For more information about this error, try `rustc --explain E0382`.error: could not compile `ownership` due to previous error æŒ‰ç…§ä»¥ä¸Šçš„æŠ¥é”™ï¼Œå¦‚æœè¿˜éœ€è¦ç”¨åˆ°s1, rustä¹Ÿä¿ç•™äº†copyæ“ä½œï¼Œæˆ‘ä»¬å¿…é¡»ç”¨.clone()è¿›è¡Œæ‹·è´ï¼Œä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š 1234let s1 = String::from(&quot;hello&quot;);--- let s2 = s1;+++ let s2 = s1.clone();println!(&quot;&#123;&#125;&quot;, s1); // hello Move åœ¨å‡½æ•°ä¸­çš„åº”ç”¨1234567891011fn main() &#123; let s3: String = String::from(&quot;xxxxx&quot;);\ttakes_ownership(s3);\t// println!(&quot;s3 &#123;&#125;&quot;, s3); // æŠ¥é”™âŒ&#125;fn takes_ownership(some_str: String) &#123; println!(&quot;some_str &#123;&#125;&quot;, some_str); // å˜é‡ some_str çš„ä½œç”¨åŸŸmoveåˆ°è¿™é‡Œä¸ºæ­¢&#125; ä¸Šè¿°ä»£ç ä¸­ï¼Œ å› s3å€¼å·²ç»move åˆ°å‡½æ•°takes_ownership(s3);é‡Œï¼Œå…¶å€¼å·²ç»ä¸å­˜åœ¨s3ä¸Šï¼Œè€Œè·³åˆ°äº†å‡½æ•°é‡Œ å‡½æ•°é‡Œçš„ some_str ä¼ è¿›æ¥åï¼Œè¢«é™åˆ¶åœ¨å‡½æ•°çš„ä½œç”¨åŸŸé‡Œåè¢«é”€æ¯ï¼ˆdropï¼‰ æ‰€ä»¥ println!(&quot;s3 &#123;&#125;&quot;, s3); åˆ™ä¼šæŠ¥é”™ï¼Œå› ä¸º s3çš„å€¼å·²è¢«é”€æ¯åœ¨å‡½æ•° takes_ownershipçš„ä½œç”¨åŸŸé‡Œ è€ŒåŸå§‹å€¼åˆ™æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼š 123456789fn main() &#123;\tlet x = 5;\tmakes_copy(x);\tprintln!(&quot;x -&gt; &#123;&#125;&quot;, x); // x -&gt; 5&#125;fn makes_copy(some_int: i32) &#123;\tprintln!(&quot;some_int &#123;&#125;&quot;, some_int); &#125; å›åˆ°å¼•ç”¨å€¼çš„ç§»åŠ¨ï¼ˆmoveï¼‰çš„é—®é¢˜ï¼Œå¦‚æœè¦é¿å…moveåå¸¦æ¥çš„å½±å“ï¼Œåˆ™é¡»å°†å¼•ç”¨å€¼ç›´æ¥æ”¾å‡½æ•°é‡Œä½œä¸ºè¿”å›å€¼å³å¯ï¼Œå¦‚ï¼š 123456789fn main() &#123;\t// å¼•ç”¨å€¼æ”¹ä¸ºå¯ç”¨çŠ¶æ€ï¼Œå°†å¼•ç”¨å€¼æ”¾å‡½æ•°é‡Œä½œä¸ºè¿”å›å€¼å³å¯ï¼š\tlet s4 = gives_overship();\tprintln!(&quot;s4 &#123;&#125;&quot;, s4); // s4 hello&#125;fn gives_overship() -&gt; String &#123;\tString::from(&quot;hello&quot;)&#125; æˆ–å¦‚ä¸‹ï¼Œå˜é‡ ss2 ä¼ å…¥å‡½æ•° takes_and_gives_back åï¼Œä»è¦ä½¿ç”¨ ss2ï¼Œåˆ™é¡»å†å†™ä¸€ä¸ªå‡½æ•° takes_and_gives_back å°†å…¶å€¼å›° 12345678910111213fn main() &#123;\tlet ss1 = gives_overship();\tlet ss2 = String::from(&quot;ss2 pass in string&quot;);\tprintln!(&quot;ss1 = &#123;&#125;, takes_and_gives_back = &#123;&#125;&quot;, ss1, takes_and_gives_back(ss2)); // ss1 = hello, ss3 = ss2 pass in string&#125;fn gives_overship() -&gt; String &#123;\tString::from(&quot;hello&quot;)&#125;fn takes_and_gives_back(a_string: String) -&gt; String &#123;\ta_string&#125; &amp; å¼•ç”¨åŠå€Ÿç”¨ (References and Borrowing)rust å…è®¸ä½¿ç”¨ è¿”å›å…ƒç»„çš„è§£æ„ ä¾‹å¦‚ä»¥ä¸‹ä¾‹å­ï¼Œx1ä¼ å…¥äº†å‡½æ•° calculate_str_length(x1) é‡Œï¼Œå·²ç»è¢«ç§»åŠ¨äº†ï¼Œ åœ¨å¤–é¢å¦‚æœè¦å†è·å–x1ï¼Œåˆ™éœ€è¿”å›å…¶åŸå€¼å¹¶å°†å…¶è§£æ„å‡ºæ¥ï¼Œä½†è¿™æ ·è¿”å›å€¼å°±å¤æ‚äº†ï¼Œä¼ å…¥çš„åŒæ—¶è¿˜éœ€è¿”å›ä»– 12345678910fn main() &#123;\tlet x1 = String::from(&quot;kkkkkk&quot;);\tlet (y, len) = calculate_str_length(x1);\tprintln!(&quot;the length of &#123;&#125; is &#123;&#125;&quot;, y, len);&#125;fn calculate_str_length(s: String) -&gt; (String, usize) &#123;\tlet length = s.len();\t(s, length)&#125; å¦‚æœä¼ è¿›çš„å‡½æ•°çš„å€¼ x1 è¦åœ¨å¤–é¢è·å–ï¼Œä½†åˆä¸éœ€è¦å°†å…¶ä¼ å›ä½œä¸ºè¿”å›å€¼ï¼Œå°±éœ€è¦ç”¨åˆ°å¼•ç”¨ï¼š 1234567891011fn main() &#123;\tlet str1 = String::from(&quot;uuuuuuuuu&quot;);\tlet length = str_length(&amp;str1);\tprintln!(&quot;the length of &#123;&#125; is &#123;&#125;&quot;, str1, length); // the length of uuuuuuuuu is 9&#125;fn str_length(s: &amp;String) -&gt; usize &#123;\t// s.push_str(&quot;ooops&quot;); // err âŒ\tlet length = s.len();\tlength&#125; ä¸Šé¢çš„ä»£ç ä¸­ï¼Œè°ƒç”¨str1æ—¶ï¼ŒåŠ å…¥äº† &amp; ç¬¦å·ï¼Œå³å¼•ç”¨ å‡½æ•°é‡Œçš„å¼•ç”¨å˜é‡ä¼šè‡ªè¡Œå¯»æ‰¾å€¼ï¼Œè€Œä¸æ˜¯è·å–ä»–çš„æ‰€æœ‰æƒï¼Œä»è€Œè®©è¿›å…¥å‡½æ•°çš„å˜é‡ï¼Œåœ¨åç»­èƒ½è¢«ç»§ç»­ä½¿ç”¨ã€‚ åŒæ ·çš„ï¼Œå€Ÿç”¨çš„å˜é‡ s åˆ™ä¸èƒ½è¿›è¡Œå…¶ä»–æ“ä½œï¼Œå› ä¸ºä»…ä»…æ˜¯å€Ÿç”¨ã€‚ å¯å˜å¼•ç”¨ï¼ˆMutable Referencesï¼‰ä¸Šé¢ä»£ç è§£å†³çš„åŠæ³•å°±æ˜¯å°† str1 å®šä¹‰ä¸ºå¯è¿­ä»£æ“ä½œ mutï¼Œä»¥ä¸‹æ˜¯ä¿®æ”¹åçš„ä»£ç ï¼š 1234567891011fn main() &#123;\tlet mut str1 = String::from(&quot;uuuuuuuuu&quot;);\tlet length = str_length(&amp;mut str1);\tprintln!(&quot;the length of &#123;&#125; is &#123;&#125;&quot;, str1, length); // the length of uuuuuuuuuooops is 14&#125;fn str_length(s: &amp;mut String) -&gt; usize &#123;\ts.push_str(&quot;ooops&quot;);\tlet length = s.len();\tlength&#125; è€Œå¼•ç”¨æœ‰ä¸¥æ ¼çš„é™åˆ¶, ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š 12345let mut str2 = String::from(&quot;kkkkkkkk&quot;);let r1 = &amp;str2;let r2 = &amp;str2;// let r3: = &amp;mut str2; // é”™è¯¯ âŒprintln!(&quot;&#123;&#125;, &#123;&#125;&quot;, r1, r2); ä¸Šé¢å®šä¹‰çš„ r3 ä¼šæŠ¥é”™ï¼Œæ˜¯å› ä¸ºï¼š r3 å‰å®šä¹‰çš„ r1 å’Œ r2 å·²å®šä¹‰ä¸ºé mutå˜é‡ï¼Œä»–ä»¬è¿˜æœªè¢«ä½¿ç”¨ è¦è§£å†³ä»¥ä¸ŠæŠ¥é”™ï¼Œåˆ™é¡»å°†å…¶ç§»åŠ¨åˆ° print ä¹‹åå³å¯ï¼Œå›  r1, r2 å®šä¹‰åå·²è¢«ä½¿ç”¨è¿‡ ä¿®æ”¹åï¼š 123456let mut str2 = String::from(&quot;kkkkkkkk&quot;);let r1 = &amp;str2;let r2 = &amp;str2;println!(&quot;&#123;&#125;, &#123;&#125;&quot;, r1, r2); let r3 = &amp;mut str2; // æ­£ç¡® r1, r2å®šä¹‰åå·²è¢«ä½¿ç”¨è¿‡ï¼Œout of scopeprintln!(&quot;r3 &#123;&#125;&quot;, r3); // r3 kkkkkkkk æ‚¬ç©ºå¼•ç”¨ï¼ˆDangling Referencesï¼‰åœ¨å‡½æ•°å†…éƒ¨ï¼Œå¼•ç”¨å€¼ä¸èƒ½ä½œä¸ºè¿”å›å€¼ï¼è¿™æ˜¯å› ä¸ºå¼•ç”¨å€¼ s å·²è¶…å‡ºèŒƒå›´, s å€¼å·²è¢«ä¸¢å¼ƒï¼Œä»¥ä¸‹æ˜¯é”™è¯¯âŒä»£ç ç¤ºèŒƒï¼š 1234567fn dangle() -&gt; &amp;String &#123; // dangle returns a reference to a String\tlet s = String::from(&quot;hello&quot;); // s is a new String\t&amp;s // we return a reference to the String, s&#125; // Here, s goes out of scope, and is dropped. Its memory goes away.// Danger! âŒ å­—ç¬¦ä¸²åˆ‡ç‰‡ç±»å‹ï¼ˆThe Slice Typeï¼‰Rust çš„åˆ‡ç‰‡æ˜¯ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„å½¢å¼ï¼Œè¿™é‡Œæˆ‘ä»¬å•ç‹¬è®¨è®ºã€‚ä»¥ä¸‹æ˜¯å®˜æ–¹æ–‡æ¡£å¯¹åˆ‡ç‰‡æ‰€æœ‰æƒçš„æ€»ç»“ï¼š Slices let you reference a contiguous sequence of elements in a collection rather than the whole collection. A slice is a kind of reference, so it does not have ownership. åˆ‡ç‰‡å…è®¸æ‚¨å¼•ç”¨é›†åˆä¸­è¿ç»­çš„å…ƒç´ åºåˆ—ï¼Œè€Œä¸æ˜¯æ•´ä¸ªé›†åˆã€‚åˆ‡ç‰‡æ˜¯ä¸€ç§å¼•ç”¨ï¼Œå› æ­¤å®ƒæ²¡æœ‰æ‰€æœ‰æƒã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªåˆ‡ç‰‡çš„ä¾‹å­ï¼Œ 12345let str3: String = String::from(&quot;hello world&quot;);let hello3: &amp;str = &amp;str3[..5];let world3: &amp;str = &amp;str3[6..];println!(&quot;str3 ç¬¬ä¸€ä¸ªè¯ &#123;&#125;&quot;, hello); // str3 ç¬¬ä¸€ä¸ªè¯ hello ä¸Šé¢çš„è€Œåˆ‡ç‰‡æœ‰ç€ä¸€ä¸ªç‰¹æ®Šçš„ç±»å‹ &amp;str, åŒæ ·çš„ï¼Œå®šä¹‰å­—ç¬¦ä¸²æ—¶ï¼Œä¹Ÿå¯å°†å…¶å®šä¹‰ä¸º &amp;strï¼Œå°±åƒä¸‹é¢çš„ä¾‹å­ï¼š 1234567let str4: &amp;str = &quot;hello rust&quot;;let hello4: &amp;str = &amp;str4[..5];let rust4: &amp;str = &amp;str4[6..];let hello_rust = &amp;str[..];println!(&quot;str4 ç¬¬ä¸€ä¸ªè¯ &#123;&#125;&quot;, hello4); // str4 ç¬¬ä¸€ä¸ªè¯ helloprintln!(&quot;str4 ç¬¬äºŒä¸ªè¯ &#123;&#125;&quot;, rust4); // str4 ç¬¬äºŒä¸ªè¯ rustprintln!(&quot;æ•´ä¸ªè¯ &#123;&#125;&quot;, hello_rust); // æ•´ä¸ªè¯ hello rust å°è£…å¯»æ‰¾ç¬¬ä¸€ä¸ªè¯çš„å‡½æ•°ï¼š 12345678910111213141516171819fn main() &#123;\tlet str3: String = String::from(&quot;hello world&quot;);\tlet word = first_word(&amp;str3);\tprintln!(&quot;word -&gt; &#123;&#125;&quot;, word);&#125;fn first_word (s: &amp;str) -&gt; &amp;str &#123;\tlet bytes = s.as_bytes();\tfor (i, &amp;item) in bytes.iter().enumerate() &#123; if item == b&#x27; &#x27; &#123; // å¦‚æœè¯¥å¥å­æœ‰ç©ºæ ¼ï¼Œåˆ™è¿”å›ç¬¬ä¸€ä¸ªå…ƒç´  return &amp;s[0..i]; &#125;\t&#125;\t// å¦‚æœæ²¡æœ‰ç©ºæ ¼åˆ™è¿”å›æ•´ä¸ªå¥å­\t&amp;s[..]&#125; å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬ä¼ å…¥å’Œè¿”å›çš„ç±»å‹å‡ä¸º &amp;str","tags":["rust","ownership"]},{"title":"Rustå­¦ä¹ ç¬”è®°ï¼ˆ2ï¼‰â€”â€” ç¼–ç¨‹åŸºç¡€æ¦‚å¿µ, å˜é‡ã€æ•°æ®ç±»å‹ã€æµç¨‹æ§åˆ¶","path":"/2023/09/30/ã€2023-09-30ã€‘Rustå­¦ä¹ ç¬”è®°ï¼ˆ2ï¼‰â€”â€” ç¼–ç¨‹åŸºç¡€æ¦‚å¿µ, å˜é‡ã€æ•°æ®ç±»å‹ã€æµç¨‹æ§åˆ¶/","content":"æœ¬æ–‡çš„å…·ä½“ä»£ç åœ¨è¿™é‡Œ ç¼–ç¨‹åŸºç¡€æ¦‚å¿µåœ¨ Rust ä¸­çš„ä½“ç°å˜é‡ å®šä¹‰å˜é‡åï¼Œå¦‚æœèµ‹å€¼åè¦æ”¹å˜ï¼Œå¿…é¡»åŠ ä¸Š mut å…³é”®å­—ï¼Œå¦åˆ™åˆ™ä¸èƒ½æ”¹å˜å…¶å€¼ã€‚åŒæ ·çš„ï¼Œå®šä¹‰äº† const ä¹‹åçš„å¸¸é‡ï¼Œåˆ™ä¸èƒ½åŠ ä¸Š mut æ•°å­—è¾ƒå¤§æ—¶ï¼Œå¯ä»¥ç”¨ä¸‹åˆ’çº¿æ›¿ä»£åƒåˆ†å·åˆ†éš”æ•°å­— 12345678// variables and constancelet mut x:i32 = 5;println!(&quot;x value is &#123;&#125;&quot;, x);x = 6;println!(&quot;x value is changed: &#123;&#125;&quot;, x);const COUNT: u32 = 1_000_000;println!(&quot;COUNT value is &#123;&#125;&quot;, COUNT); å˜é‡é®è”½(variable shadowing)ï¼ŒåŒä¸€ä¸ªä½œç”¨åŸŸå†…ï¼Œå…è®¸å¯¹åŒä¸€å˜é‡åè¿›è¡ŒäºŒæ¬¡å®šä¹‰ è¿™æ ·åšçš„å¥½å¤„æ˜¯æ–¹ä¾¿ï¼Œåå¤„æ˜¯åæœŸä»£ç é‡å¤§ä¼šä½¿å¾—ä»£ç éš¾ä»¥ç»´æŠ¤ï¼Œæ‰€ä»¥ä½¿ç”¨æ—¶åº”è°¨æ… 12345// variable shadowing:let y: u32 = 7;println!(&quot;y value is &#123;&#125;&quot;, y);let y: &amp;str = &quot;eight&quot;;println!(&quot;y value is changed: &#123;&#125;&quot;, y); æ•°æ®ç±»å‹Intergersåˆ†ä¸ºæœ‰ç¬¦å·ï¼ˆiï¼‰å’Œæ— ç¬¦å·ï¼ˆuï¼‰ï¼š Length Signed Unsigned 8-bit i8 u8 16-bit i16 u16 32-bit i32 u32 64-bit i64 u64 128-bit i128 u128 arch isize usize å…¶å–å€¼èŒƒå›´åˆ†åˆ«æ˜¯ï¼š2çš„8ã€16ã€32ã€64ã€128æ¬¡æ–¹ Signedçš„æ•°ç”±äºæœ‰è´Ÿæ•°çš„å–å€¼èŒƒå›´ï¼Œæ‰€ä»¥æ¯” Unsigned å–å€¼èŒƒå›´å‡åŠ Type Range i8 -128~127 u8 0~255 i16 -32768~32767 u16 0~65535 i32 -2147483648~2147483647 u32 0~4294967295 i64 -9223372036854775808~9223372036854775807 u64 0~18446744073709551615 i128 -170141183460469231731687303715884105728~170141183460469231731687303715884105727 u128 0~340282366920938463463374607431768211455 è¿›åˆ¶ï¼š| Number literals | Example || :â€“: | :â€“: || Decimal | 98_222 || Hex | 0xff || Octal | 0o77 || Binary | 0b1111_0000 || Byte (u8 only) | bâ€™Aâ€™ | Floating12let x1 = 2.45; // f64println!(&quot;&#123;&#125;&quot;, x1); Boolean12let t = false;println!(&quot;&#123;&#125;&quot;, t); Charactor (å­—ç¬¦å‹)123456let ch = &#x27;z&#x27;;println!(&quot;char z: &#123;&#125;&quot;, ch); // char z: zlet z_char: char = &#x27;â„¤&#x27;; // with explicit type annotationprintln!(&quot;char z: &#123;&#125;&quot;, z_char); // char z: â„¤let heart_eyed_cat = &#x27;ğŸ˜»&#x27;;println!(&quot;heart_eyed_cat: &#123;&#125;&quot;, heart_eyed_cat); // heart_eyed_cat: ğŸ˜» tuple ï¼ˆå…ƒç»„ï¼‰1let tup0 = (11,22); 123456789// å¯å¯¹å…ƒç»„é‡Œçš„æ¯ä¸ªå…ƒç´ å•ç‹¬å®šä¹‰ï¼šlet tup1: (&amp;str, i32, f32) = (&quot;let&#x27;s get Rusty!&quot;, 1_000_000, 0.45);// è§£æ„ï¼šlet (channel, sub_count, float_num) = tup;println!(&quot;&#123;&#125; &#123;&#125; &#123;&#125;&quot;, channel, sub_count, float_num); // let&#x27;s get Rusty! 1000000 0.45// ç´¢å¼•ï¼šlet sub_count: i32 = tup.1;println!(&quot;sub_count: &#123;&#125;&quot;, sub_count); Array1234let arr = [1, 2, 3, 4, 5];// å®šä¹‰ç±»å‹ï¼š[æ•°æ®ç±»å‹ï¼Œæ•°ç»„é•¿åº¦]let arr1: [i32; 5] = [1, 2, 3, 4, 5]; Funtion å®šä¹‰ä¸è°ƒç”¨ï¼š 1234567fn main() &#123; my_function(12, 34);&#125;fn my_function (x: i32, y: i32) -&gt; i32 &#123; println!(&quot;my function: &#123;&#125;, y: &#123;&#125;&quot;, x, y);&#125; å‡½æ•°è¿”å›å€¼ï¼Œå¯çœ return å…³é”®å­—ï¼Œä¸”è¿”å›çš„è¯­å¥æˆ–å˜é‡æ— éœ€åŠ  ; å‡½æ•°å¦‚æœ‰è¿”å›å€¼ï¼Œåˆ™é¡»ç”¨ -&gt; å®šä¹‰è¿”å›å€¼ç±»å‹ 12345678fn main() &#123; let result = my_function(12, 34);\tprintln!(&quot;result: &#123;&#125;&quot;, result);&#125;fn my_function (x: i32, y: i32) -&gt; i32 &#123;\tx + y&#125; Control Flowif-else if-elseåˆ†æ”¯çš„æ¡ä»¶æ— éœ€å¥—æ‹¬å· ()12345678let number: i32 = 5;if number &lt; 10 &#123; println!(&quot;1 true&quot;);&#125;else if number &lt; 22 &#123; println!(&quot;2 true&quot;);&#125;else&#123; println!(&quot;false&quot;);&#125; if-else æ¡ä»¶å¯å†™åœ¨ä¸€è¡Œï¼š12let condition: bool = true;let num:i32 = if condition &#123; 1 &#125; else &#123; 2 &#125;; while12345678let mut n = 3;while n != 0 &#123; println!(&quot;&#123;&#125;!&quot;, n); n -= 1;&#125;// 3!// 2!// 1! loopå’Œwhileå¾ªç¯æœ‰ç‚¹ç±»ä¼¼ï¼š 12345678910111213loop &#123; println!(&quot;again!&quot;); break&#125;let mut counter = 0;let loop_result = loop &#123; counter += 1; if counter == 10 &#123; break counter; &#125;&#125;; println!(&quot;loop_result: &#123;&#125;&quot;, counter); // loop_result: 10 for1234567let arr_for = [11,22,33,44,55];for item in arr_for.iter() &#123; println!(&quot;the arr value is: &#123;&#125;&quot;, item);&#125;// the arr value is: 11// the arr value is: 22// the arr value is: 33 ç±»ä¼¼ python çš„ range å’Œ scalaçš„ Range ï¼Œåœ¨rusté‡Œä½¿ç”¨.. è¡¨ç¤ºæ•°å€¼èŒƒå›´ï¼š .. çš„å–å€¼èŒƒå›´åŒ…æ‹¬å¼€å§‹å€¼ï¼Œä¸åŒ…æ‹¬ç»ˆæ­¢å€¼ï¼š123456for value in 1..4 &#123; println!(&quot;&#123;&#125;!!&quot;, value);&#125;// 1!!// 2!!// 3!!","tags":["rust","cargo"]},{"title":"Rustå­¦ä¹ ç¬”è®°ï¼ˆ1ï¼‰â€”â€” å®‰è£…ã€cargoã€crate","path":"/2023/09/30/ã€2023-09-30ã€‘Rustå­¦ä¹ ç¬”è®°ï¼ˆ1ï¼‰â€”â€” å®‰è£…ã€cargoã€crate/","content":"å¾ˆä¹…æ²¡æœ‰æ›´æ–°åšå®¢äº†ï¼Œæœ€è¿‘è‡ªå­¦ rust, è¿™é‡Œè®°å½•ä¸€ä¸‹ã€‚æœ¬æ–‡å‚è€ƒäº†Rust Bookå†™çš„ Rust è¯­è¨€åˆæ¢å®‰è£…è§æ–‡æ¡£ï¼Œååˆ†ç®€å•ï¼Œè¿™é‡Œä¸èµ˜è¿° hello worldtouch main.rs åˆ›å»ºæ–‡ä»¶ï¼Œå¹¶å†™ä¸‹ï¼š 123fn main() &#123; println!(&quot;Hello world&quot;);&#125; rustæ˜¯éœ€è¦é™æ€ç¼–è¯‘çš„è¯­è¨€ï¼Œæ‰€ä»¥å…ˆæ‰§è¡Œ rustc main.rs ç¼–è¯‘ä¸ºäºŒè¿›åˆ¶ç åå†æ‰§è¡Œï¼Œå¯çœ‹åˆ°æ§åˆ¶å°æ‰“å° hello world: 12345# mac./main# windows.\\main.exe cargo çš„ä½¿ç”¨rustc åªèƒ½è¯•ç”¨åœ¨ä¸€äº›æ¯”è¾ƒç®€å•çš„ç¨‹åºï¼Œå¤æ‚çš„ç¨‹åºéœ€ç”¨åˆ°rustè‡ªå¸¦çš„é¡¹ç›®ç®¡ç†å·¥å…· cargoï¼Œæœ¬ä»“åº“ä½¿ç”¨è®²çš„æ¯ä¸ªç« èŠ‚å‡ç”¨ä¸€ä¸ªé¡¹ç›®çš„æ–¹å¼, æ¯ä¸ªé¡¹ç›®å‡èƒ½ç‹¬ç«‹è·‘èµ·, ä¸‹é¢æ˜¯å‡ ä¸ªå¸¸ç”¨å‘½ä»¤ï¼š 123456789101112131415# æ–°å»ºé¡¹ç›®ï¼šcargo new &lt;ProjectName&gt;# ç¼–è¯‘æ„å»ºé¡¹ç›®ï¼Œæ„å»ºå®Œæˆçš„é¡¹ç›®ä¼šæ”¾åœ¨ target/debug ç›®å½•cd &lt;ProjectName&gt;cargo build # ä¸ºå‘å¸ƒçš„ç¼–è¯‘ï¼Œé¡»åŠ ä¸Š --releaseï¼Œä¼šå¯¹ç¼–è¯‘çš„ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œæ„å»ºå®Œçš„é¡¹ç›®ä¼šæ”¾åœ¨ target/release ç›®å½•cargo build --release# ç¼–è¯‘æ„å»ºå¹¶è¿è¡Œé¡¹ç›®ï¼šcargo run# æ£€æŸ¥æ˜¯å¦èƒ½é€šè¿‡ç¼–è¯‘ï¼šæ•ˆç‡æ¯” cargo build å¿«å¾ˆå¤šcargo check æ³¨é‡Š1234// å•è¡Œæ³¨é‡Š/*å¤šè¡Œæ³¨é‡Š*/ å˜é‡123456789101112131415fn main() &#123; let x = 88; // æŠ¥é”™ï¼š // x = 99; // å¦‚è¦ä½¿å…¶å¯å˜ï¼Œåˆ™åº”åŠ ä¸Š mut å…³é”®å­—ï¼Œimmutableç¼©å†™ï¼š let mut y = 99; y = 100; println!(&quot;x is &#123;&#125;, y is &#123;&#125;&quot;, x, y) // å®šä¹‰ä¸€ä¸ªç©ºå­—ç¬¦ä¸², // ä¸­é—´ä¸¤ä¸ªå†’å·:è¡¨æ˜Stringçš„å…³è”å‡½æ•°ï¼Œé’ˆå¯¹ç±»å‹æœ¬èº«è€Œå®ç°çš„ï¼Œè€Œéé’ˆå¯¹å­—ç¬¦ä¸²æŸç‰¹å®šå®ä¾‹å®ç°çš„ let mut guess = String::new();&#125; crate åº“çš„ä½¿ç”¨ rustçš„åº“å« crate, éœ€è¦ç”¨çš„libåŒ…å¯åœ¨ crate å®˜ç½‘ é‡Œæ‰¾åˆ°ã€‚è¿™æ¬¡æˆ‘ä»¬ç”¨éšæœºç”Ÿæˆæ•°å­—çš„åº“, åœ¨é¡¹ç›®ç›®å½•é‡Œæ·»åŠ ï¼š 12345...# å‰é¢çš„ ^ è¡¨ç¤ºä»»ä½•ä¸0.8.4å…¼å®¹çš„ç‰ˆæœ¬å‡å¯ä»¥ä¸‹è½½[dependencies]rand = &quot;^0.3.23&quot; æ·»åŠ å®Œæˆåï¼Œè¿”å›ç»ˆç«¯ï¼Œè¾“å…¥ cargo check æˆ– cargo buildï¼Œåˆ™å¯ä»¥ä¸‹è½½è¯¥libåŒ…, å¦‚ï¼š 1234567891011ziyouzhiyi@zyzy: ~/Documents/code/rust-learn/test-project main âš¡$ cargo check [11:57:13]Updating crates.io indexDownloaded rand v0.4.6Downloaded rand v0.3.23Downloaded 2 crates (87.7 KB) in 1.38sCompiling libc v0.2.126Checking rand v0.4.6Checking rand v0.3.23Checking test-project v0.1.0 (/Users/ziyouzhiyi/Documents/code/rust-learn/test-project)Finished dev [unoptimized + debuginfo] target(s) in 5.74s Cargo.lock æ–‡ä»¶ï¼šå½“ç¬¬ä¸€æ¬¡å®‰è£…libåŒ…æˆåŠŸåï¼Œä¼šå°†è¯¥åŒ… rand v0.3.23 æ‰€ä¾èµ–åŒ…æ‰€æœ‰libåŒ…ç‰ˆæœ¬å·æ”¾å…¥ Cargo.lock æ–‡ä»¶ä¸­ï¼Œä»¥åæ¯æ¬¡é‡æ–°æ„å»ºï¼Œå‡ä¼šæŒ‰ç…§é‡Œé¢åˆ—ä¸¾çš„ç‰ˆæœ¬è¿›è¡Œå®‰è£…ï¼Œé™¤éè‡ªå·±æ‰‹åŠ¨è¿›è¡Œ rand v0.8.4 ç‰ˆæœ¬å‡çº§ã€‚ cargo update å‘½ä»¤ï¼šå¦‚è¦æ›´æ–°bç‰ˆæœ¬ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œé¡»æ‰‹åŠ¨åœ¨ toml æ–‡ä»¶é‡Œé‡æ–°å†™ä¸Šç‰ˆæœ¬å·å†æ‰§è¡Œupdateå‘½ä»¤ï¼Œæ­¤æ—¶ï¼Œcargo ä¼šå¿½ç•¥ Cargo.lock æ–‡ä»¶ç›´æ¥æ›´æ–°","tags":["rust","cargo"]},{"title":"ã€2022-05-15ã€‘typescriptæ³›å‹çš„åº”ç”¨","path":"/2022/05/15/ã€2022-05-15ã€‘typescriptæ³›å‹çš„åº”ç”¨/","content":"æœ¬æ–‡ä»‹ç»æ³›å‹ä¸€äº›åŸºç¡€ç”¨æ³•ã€‚ æ³›å‹æ•°ç»„é‡Œæ³›å‹çš„è¿ç”¨å¦‚ä¸‹ä»£ç ï¼Œå¦‚æœä¼ å…¥çš„æ•°å€¼ä¸ºstringï¼Œåˆ™é¡»æŠŠnumberæ”¹ä¸ºany, ä½†è¿™æ ·ä¸€æ¥å°±å¤±å»äº†ç±»å‹æ£€æŸ¥çš„æ„ä¹‰ã€‚æ­¤æ—¶æ³›å‹ï¼ˆgenericsï¼‰æ’ä¸Šç”¨åœº 123456const last = (arr: Array&lt;number&gt;) =&gt; &#123; return arr[arr.length - 1]&#125;const l = last([1,2,3,4])const l1 = last([&#x27;1&#x27;, 2]) // é”™è¯¯ last å‡½æ•°é¡»æ”¹ä¸º 123456789101112const last = &lt;T&gt;(arr: Array&lt;T&gt;): T =&gt; &#123; return arr[arr.length - 1]&#125;// orconst last = &lt;T&gt;(arr: T[]): T =&gt; &#123; return arr[arr.length - 1]&#125;// è°ƒç”¨çš„åœ°æ–¹ç±»å‹æ£€éªŒä¹Ÿå¯å†™ä¸Šï¼Œå½“ç„¶ä¸å†™ä¹Ÿè¡Œï¼šconst l = last([1,2,3,4])const l1 = last&lt;string | number&gt;([&#x27;1&#x27;, 2]) // é”™è¯¯ å½“ç„¶ï¼Œä¹Ÿå¯å®šä¹‰äºå¤šä¸ªå‚æ•° 12345678const makeArr = &lt;X, Y&gt;(x: X, y: Y): [X, Y] =&gt; &#123; return [x, y]&#125;const v = makeArr(5, 6)const v1 = makeArr(&#x27;a&#x27;,&#x27;b&#x27;)// è°ƒç”¨æ—¶ä¹Ÿå†™ä¸Šç±»å‹ï¼Œä¹Ÿå¯çœç•¥const v2 = makeArr&lt;string, number&gt;(&#x27;a&#x27;, 5) ä»¥ä¸Šä»£ç è¿˜æœ‰éªšæ“ä½œå†™æ³•ï¼š 123456789// ç±»ä¼¼es6çš„é»˜è®¤å€¼å†™æ³•ï¼šYæ³›å‹æŒ‡å®šäº†æ³›å‹é»˜è®¤å€¼ï¼Œconst makeArr = &lt;X, Y = number&gt;(x: X, y: Y): [X, Y] =&gt; &#123; return [x, y]&#125;// è°ƒç”¨æ—¶çš„ç¬¬äºŒä¸ªæ³›å‹å¯çœç•¥ï¼šconst v3 = makeArr&lt;string | null&gt;(null, 5)// å½“ç„¶ï¼Œå’Œes6çš„é»˜è®¤å€¼è¯­æ³•ä¸€æ ·ï¼Œè™½æŒ‡å®šäº†é»˜è®¤å€¼ä¸ºnumberï¼Œä½†è¦ä¼ å…¥stringä¹Ÿä¸€æ ·å¯ä»¥ï¼Œè¿™æ—¶åˆ™ä¸èƒ½å†æŒ‡å®šç±»å‹ï¼Œå¦åˆ™æŠ¥é”™ï¼šconst v4 = makeArr(null, &#x27;5&#x27;) å¯¹è±¡é‡Œæ³›å‹çš„åº”ç”¨å¦‚ä¸‹ï¼ŒæŒ‡å®šäº†{}çš„ä¸¤ä¸ªå±æ€§ï¼Œå¦‚æœæœ‰å¤šä¸ªå±æ€§ä¸€èµ·ä¼ å…¥ï¼Œåˆ™ä¼šæŠ¥é”™ï¼š 12345678const fullName = (obj: &#123; firstName: string, lastName: string&#125;) =&gt; &#123; return &#123; ...obj, fullName: obj.firstName + &#x27; &#x27; + obj.lastName &#125;&#125;const v4 = fullName(&#123; firstName: &#x27;bob&#x27;, lastName: &#x27;junior&#x27;, age: 15&#125;) æ­¤æ—¶å¯ä»¥ç”¨æ³›å‹çš„ extends å…³é”®å­—ï¼Œæ‰©å±•äº†åŸæœ‰objï¼Œæ”¹å†™å¦‚ä¸‹ï¼š 1234567const fullName = &lt;T extends &#123; firstName: string, lastName: string &#125;&gt; (obj: T): T =&gt; &#123; return &#123; ...obj, fullName: obj.firstName + &#x27; &#x27; + obj.lastName &#125;&#125; æ¥å£ä¸­æ³›å‹çš„åº”ç”¨å¦‚ä¸‹ä¾‹å­ï¼Œå¯åœ¨ interface é‡Œç›´æ¥ä¼ å…¥ä¸€ä¸ªæ³›å‹ Tï¼Œå®šä¹‰æ—¶åˆ©ç”¨ type ç±»å‹å®šä¹‰ä¼ å…¥ç±»å‹ 12345678interface Tab&lt;T&gt; &#123; id: string position: number date: T&#125;type NumberTab = Tab&lt;number&gt;type StringTab = Tab&lt;string&gt;","tags":["type script"]},{"title":"umijs-qiankunå¾®å‰ç«¯å®è·µ","path":"/2022/03/27/ã€2022-03-27ã€‘umijs-qiankunå¾®å‰ç«¯å®è·µ/","content":"umijsæ¨å‡ºçš„å¾®å‰ç«¯æ¡†æ¶qiankunï¼Œæ˜¯å›½å†…æ¯”è¾ƒæµè¡Œçš„å¾®å‰ç«¯æ–¹æ¡ˆï¼Œå…¶å®˜æ–¹æ–‡æ¡£æœ‰é…ç½®çš„æ–¹æ³•ï¼Œä½†æ˜¯è¯´çš„æ¯”è¾ƒæ¨¡ç³Šï¼Œè¿™é‡Œäº²è‡ªå®è·µä¸€ä¸‹ åˆ›å»ºé¡¹ç›®å¾®å‰ç«¯åˆ†ä½ä¸»åº”ç”¨å’Œè‹¥å¹²ä¸ªå¾®åº”ç”¨ï¼Œåˆ†åˆ«ç‹¬ç«‹è¿è¡Œã€‚æ‰€ä»¥åˆ†åˆ«åˆ›å»ºä»¥ä¸‹ç›®å½•è§£æ„ï¼š 1234&lt;project root&gt; |__main |__app1 |__app2 æ ¹æ®umijsæ–‡æ¡£ï¼Œåˆ†åˆ«åœ¨æ¯ä¸ªé¡¹ç›®é‡Œç”Ÿæˆå¯¹åº”çš„umijsé¡¹ç›®ï¼Œå¹¶éƒ½å®‰è£…umijsä¹¾å¤æ’ä»¶ @umijs/plugin-qiankun 1234npm i yarn tyarn -gtyarn create @umijs/umi-apptyarn add @umijs/plugin-qiankuntyarn ä¿®æ”¹.umircé…ç½®è¿™ä¸ªæ˜¯æ–‡æ¡£æ²¡è¯´æ¸…æ¥šçš„åœ°æ–¹ï¼Œæ‰€æœ‰umijsçš„é…ç½®ï¼Œå‡è¦åœ¨.umircé‡Œä¿®æ”¹ï¼Œåœ¨mainé¡¹ç›®æ·»åŠ ä»¥ä¸‹é…ç½®ï¼š 12345678910111213141516171819202122232425262728293031 routes: [ &#123; path: &#x27;/&#x27;, component: &#x27;@/pages/index&#x27;, routes: [ &#123; path: &#x27;/app1&#x27;, microApp: &#x27;app1&#x27;, &#125;, &#123; path: &#x27;/app2&#x27;, microApp: &#x27;app2&#x27;, &#125;, ], &#125;,],qiankun: &#123; master: &#123; // æ³¨å†Œå­åº”ç”¨ä¿¡æ¯ apps: [ &#123; name: &#x27;app1&#x27;, // å”¯ä¸€ id entry: &#x27;//localhost:7701&#x27;, // html entry &#125;, &#123; name: &#x27;app2&#x27;, // å”¯ä¸€ id entry: &#x27;//localhost:7702&#x27;, // html entry &#125;, ], &#125;,&#125;, åœ¨ app1 å’Œ app2 çš„ .umirc åˆ†åˆ«å†™ï¼š 123qiankun: &#123; slave: &#123;&#125;,&#125;, åœ¨ app1 å’Œ app2 çš„ package.json åˆ†åˆ«æŒ‡å®šappåå­—ï¼Œå¦åˆ™qiankunæ’ä»¶è®¤ä¸å‡ºæ¥ï¼š 12345// app1 package.json &quot;name&quot;: &quot;app1&quot;// app2 package.json &quot;name&quot;: &quot;app2&quot; è¿™é‡Œæ³¨æ„ï¼Œå¾®æœåŠ¡è¦è·‘åœ¨ä¸åŒç«¯å£ï¼Œæ ¹æ®åœ¨.envæ–‡ä»¶ä¸­å®šä¹‰ï¼Œæˆ‘ä»¬å¯åœ¨ main app1 app2 ä¸‹åˆ†åˆ«åˆ›å»º .env æ–‡ä»¶å¹¶å†™ä¸‹ç«¯å£å·ï¼Œå¦‚ï¼š 12345678# mainPORT=7700# app1PORT=7701# app2PORT=7702 è¿™æ ·ï¼Œå½“æ¯ä¸ªé¡¹ç›®å„è‡ªè·‘çš„æ—¶å€™ï¼Œå°±èƒ½æŒ‰è¦æ±‚è·‘åœ¨æŒ‡å®šçš„ç«¯å£å· å­é¡¹ç›®é…ç½® app.ts æ–‡ä»¶è¿™ä¸ªæ˜¯å…³é”®ä¸€æ­¥ï¼Œæ¯ä¸ªå­é¡¹ç›®éƒ½è¦é…ç½®å¯¹åº”çš„å­é¡¹ç›®ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œå¦åˆ™æŠ¥é”™ï¼š 12345678910111213141516171819202122232425262728293031// app1/src/app.tsexport const qiankun = &#123; // åº”ç”¨åŠ è½½ä¹‹å‰ async bootstrap(props: any) &#123; console.log(&#x27;app1 bootstrap&#x27;, props); &#125;, // åº”ç”¨ render ä¹‹å‰è§¦å‘ async mount(props: any) &#123; console.log(&#x27;app1 mount&#x27;, props); &#125;, // åº”ç”¨å¸è½½ä¹‹åè§¦å‘ async unmount(props: any) &#123; console.log(&#x27;app1 unmount&#x27;, props); &#125;,&#125;;// app2/src/app.tsexport const qiankun = &#123; // åº”ç”¨åŠ è½½ä¹‹å‰ async bootstrap(props: any) &#123; console.log(&#x27;app2 bootstrap&#x27;, props); &#125;, // åº”ç”¨ render ä¹‹å‰è§¦å‘ async mount(props: any) &#123; console.log(&#x27;app2 mount&#x27;, props); &#125;, // åº”ç”¨å¸è½½ä¹‹åè§¦å‘ async unmount(props: any) &#123; console.log(&#x27;app2 unmount&#x27;, props); &#125;,&#125;; æ›´æ”¹ç•Œé¢èµ°åˆ°è¿™ä¸€æ­¥, app1 å’Œ app2 å‡ä¼šé…ç½®åˆ°ä¸»åº”ç”¨ main çš„props.childrené‡Œäº†ï¼Œæˆ‘ä»¬å°†ä¸»åº”ç”¨ç•Œé¢æ›´æ”¹å¦‚ä¸‹ï¼š 12345678910111213&#x2F;&#x2F; main&#x2F;src&#x2F;pages&#x2F;index.tsximport styles from &#39;.&#x2F;index.less&#39;;export default function IndexPage(props) &#123; console.log(&#39;props-----&gt;&#39;, props.children.props.children); return ( &lt;div&gt; &lt;h1 className&#x3D;&#123;styles.title&#125;&gt;Main App&lt;&#x2F;h1&gt; &lt;div&gt;&#123;props.children&#125;&lt;&#x2F;div&gt; &lt;&#x2F;div&gt; );&#125; æœ€ç»ˆæ•ˆæœå¦‚ä¸‹ï¼Œé€šè¿‡/app1 å¯è¾¾ app1 åº”ç”¨ï¼Œ/app2å¯è¾¾ app2 åº”ç”¨ï¼š","tags":["umijs","qiankun"]},{"title":"ç”¨esbuildåˆ›å»ºè‡ªå·±çš„jsç±»åº“npmåŒ…","path":"/2022/03/20/ã€2022-03-20ã€‘ç”¨esbuildåˆ›å»ºè‡ªå·±çš„jsç±»åº“npmåŒ…/","content":"å¾ˆä¹…æ²¡æœ‰æ›´æ–°, è¿™æ¬¡è¶ç€å‘¨æœ«æœ‰ç©º, èµ¶ç´§æŠŠå·¥ä½œä¸­ç¢°åˆ°çš„é—®é¢˜è¿›è¡Œä¸€æ¬¡æ€»ç»“. å¹¶è®°å½•ä¸‹æ¥.æœ€è¿‘ç¢°åˆ°éœ€è¦åˆ›å»ºnpmåŒ…çš„éœ€æ±‚, è¿™é‡ŒæŠŠä»–å½¢æˆæ–‡æ¡£è®°å½•ä¸‹æ¥. å‰ç«¯çš„å˜åŒ–å®åœ¨æ˜¯å¿«, 1å¹´å¤šå‰ä»æ˜¯babelçš„å¤©ä¸‹, ç°åœ¨æ€å‡ºä¸ª esbuild , babelç”¨jsç¼–å†™, è€Œ esbuildç”¨æ›´å¿«çš„goè¯­éŸ³ç¼–å†™, ä»–ä¿©åœ¨webpackä¸­å‡æœ‰å¯¹åº”çš„æ’ä»¶å…³äºæ–°çš„æ‰“åŒ…å·¥å…· esbuild, ä»–æ”¯æŒæœ€åŸç”Ÿçš„es moduleè¯­æ³•.åœ¨æˆ‘çš„è¿™ç¯‡æ–‡ç« é‡Œå·²æœ‰å°†å…¶é…ç½®äºCRAçƒ­æ›´æ–°çš„æ“ä½œ, å¤§å®¶å¯ä»¥åšå‚è€ƒ.å†™è¿™ç¯‡æ–‡ç« çš„ç›®çš„åœ¨äºç»“åˆesbuildå®˜ç½‘, èµ°ä¸€éè‡ªå·±çš„é…ç½®çš„è¿‡ç¨‹, é¡ºä¾¿æŠŠwebpackçš„é…ç½®è¿›ä¸€ä¸‹å¯¹æ¯”. æœ€åŸºç¡€çš„webpackåŠesbuildé…ç½® ä»æœ€åŸºç¡€çš„é…ç½®å¼€å§‹, yarn init ç”Ÿæˆ package.json æ–‡ä»¶, å¹¶å®‰è£… yarn add esbuild webpack webpack-cli ä¸¤ä¸ªå·¥å…·. å°†åŒ…åæ”¹ä¸ºmylib, åŠ ä¸Š script , é…ç½® &quot;type&quot;: &quot;module&quot;ä¸ºå¯ä»¥ç”¨esmè¯­æ³• 1234567891011121314151617&#123; &quot;name&quot;: &quot;mylib&quot;, &quot;version&quot;: &quot;1.0.0&quot;, &quot;description&quot;: &quot;&quot;, &quot;main&quot;: &quot;index.js&quot;, &quot;author&quot;: &quot;ys558&quot;, &quot;scripts&quot;: &#123; &quot;wp-build&quot;: &quot;webpack --mode=production&quot;, &quot;es-build&quot;: &quot;esbuild --bundle src/index.js --outfile=dist/myLib.esbuild.bundle.js --minify&quot; &#125;, &quot;devDependencies&quot;: &#123; &quot;esbuild&quot;: &quot;^0.14.27&quot;, &quot;webpack&quot;: &quot;^5.70.0&quot;, &quot;webpack-cli&quot;: &quot;^4.9.2&quot; &#125;, &quot;type&quot;: &quot;module&quot;&#125; æ–°å»º scr/index.js å’Œ src/moduleA.js, éšä¾¿å†™ä¸‹ä¸€äº›ä¸œè¥¿, ç”¨ä¸Šesmè¯­æ³•: 123// src/moduleA.jsconst moduleA = &#x27;module A&#x27;export default moduleA 1234567891011121314151617181920// src/index.jsimport moduleA from &quot;./moduleA.js&quot;;const valueA = &quot;function A&quot;, valueB = &quot;function B&quot;;export function functionA() &#123; return valueA;&#125;class ClassA &#123; constructor(param)&#123; this.param = param; &#125;&#125;const A = new ClassA(&#x27;a&#x27;);console.log(functionA())console.log(moduleA)console.log(&#x27;param of classA&#x27;, A.param) åˆ†åˆ«è·‘ yarn run wp-build å’Œ yarn run es-build, å¯çœ‹åˆ°æ‰“åŒ…å‡ºæ¥distçš„ä¸¤ä¸ªæ–‡ä»¶, 123dist |__main.js |__myLib.esbuild.bundle.js æ— è®ºwebpackè¿˜æ˜¯esbuild, å‡é»˜è®¤ç”Ÿæˆdist/main.js . æ‰€ä»¥ä¸¤ä¸ªå‘½ä»¤åˆ†åˆ«è¿è¡Œ, ä¼šè¦†ç›–æ‰åŸæ¥çš„dist/main.jsæ–‡ä»¶ myLib.esbuild.bundle.js æ–‡ä»¶ç”±æˆ‘ä»¬æŒ‡å®šçš„es scriptç”Ÿæˆçš„, è€Œwebpackçš„é…ç½®æ˜¯è¦å†™åœ¨ webpack.config.js é‡Œå»é…ç½®. é…ç½® webpack.config.js æ–‡ä»¶å¦‚ä¸‹: 1234567891011121314151617181920// path å’Œ url å‡å±äºnodeçš„å†…ç½®æ¨¡å—, å‡æ˜¯ commonJS æ¨¡å—, æ‰€ä»¥ è¿™é‡Œé‡Œä¸æ”¯æŒç›´æ¥è§£æ„å¯¼å…¥: // import &#123; fileURLToPath &#125; from &#x27;url&#x27;; &lt;-- é”™è¯¯// åªèƒ½å†™æˆä»¥ä¸‹å½¢å¼: å…ˆæ•´ä½“å¯¼å…¥å†è§£æ„:import url from &#x27;url&#x27;;import path from &#x27;path&#x27;;const &#123; fileURLToPath &#125; = urlconst &#123; dirname &#125; = pathconst __filename = fileURLToPath(import.meta.url);const __dirname = dirname(__filename);const webpackConfig = &#123; entry: &#x27;./src/index.js&#x27;, output: &#123; path: path.resolve(__dirname, &#x27;dist&#x27;), filename: &#x27;myLib.webpack.bundle.js&#x27;, &#125;,&#125;;export default webpackConfig å†è·‘ yarn run wp-build å¯å‘ç°æ‰“åŒ…å‡ºäº†ä¸¤ä¸ªæ–‡ä»¶: 123dist |__myLib.webpack.bundle.js |__myLib.esbuild.bundle.js","tags":["esbuild","webpack"]},{"title":"Mono Repo ç®€ä»‹åŠå®ç°æ–¹æ³•","path":"/2021/11/09/ã€2021-11-09ã€‘MonoRepoç®€ä»‹åŠå®ç°æ–¹æ³•/","content":"æœ¬æ–‡ä»‹ç»ç§æœ‰ä»“åº“åŒ…çš„ç®¡ç†æ¨¡å¼ mono repo mono repoçš„å¥½å¤„mono repoçš„å¥½å¤„æ¥æºäºè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ç”¨è‡ªå·±ç›´ç™½ç‚¹çš„è¯æ€»ç»“äº†ä»¥ä¸‹å‡ ç‚¹ï¼š å¤šä¸ªå†…éƒ¨æ¨¡å—å¯ä»¥é›†ä¸­ç®¡ç† åªéœ€åœ¨æ ¹ç›®å½•å®‰è£… node_modules å³å¯ï¼Œæ— é¡»æ‰€æœ‰æ¨¡å—éƒ½å®‰è£… ä¾‹å¦‚ï¼Œä¸€ä¸ªæœ‰å¤šç«¯çš„é¡¹ç›®ï¼Œè€Œä¸”æ¯ä¸ªç«¯éƒ½é¥®ç”¨äº†å…±æœ‰çš„æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ‰€æœ‰é¡¹ç›®æˆ–åŒ…æ”¾åˆ°ä¸€ä¸ªpackagesä¸­é›†ä¸­ç®¡ç† ä¾‹å¦‚æˆ‘ä»¬å¹³æ—¶ç†Ÿæ‚‰çš„reactï¼Œbabelç­‰åº“çš„æºç ï¼Œéƒ½æ˜¯é‡‡ç”¨mono repoè¿›è¡Œä»“åº“ç®¡ç†ã€‚ æˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸¤ä¸ªåº“ï¼Œyarn workspace å’Œ lernaï¼Œ ä»¥ä¸‹çš„é¡¹ç›®ç¤ºä¾‹é‡Œï¼Œå‰è€…ç”¨äºä¾èµ–ç®¡ç†ï¼Œåè€…ç”¨äºå¤„ç†å‘å¸ƒé—®é¢˜ï¼Œåœ¨ç‰ˆæœ¬å‘å¸ƒè¿™å—ï¼Œä½¿ç”¨lernaæ›´æ–¹ä¾¿ï¼Œå¯ç”¨äºæ›¿ä»£ä¸€éƒ¨åˆ†çš„gitçš„åŠŸèƒ½ã€‚ å½“ç„¶ lerna ä¹Ÿå¯ä»¥ç›´æ¥æ›¿ä»£ yarn workspace çš„åŠŸèƒ½ã€‚ yarn workspace ç®¡ç†ä¾èµ–123mkdir common servercd common &amp;&amp; yarn init -y &amp;&amp; touch index.jscd ../server/ &amp;&amp; yarn init -y &amp;&amp; touch index.js package.json é…ç½® workspacespackage.jsonï¼Œå°† common, server ä¸¤ä¸ªæ–‡ä»¶å¤¹è§†ä¸ºä¸¤ä¸ªpackageåŒ… 1234&#123; &quot;private&quot;: true, &quot;workspaces&quot;: [ &quot;packages/*&quot; ]&#125; å»ºä¸€ä¸ªç®€å•çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 1234567root |__package.json |__packages |__common |__package.json |__server |__package.json å‡è®¾åœ¨commonåŒ…é‡Œå®‰è£…reactå’Œreact-domï¼Œåˆ™ç›´æ¥æ‰§è¡Œï¼š 1yarn workspace common add react react-dom --dev yarn workspace çš„å…·ä½“ç”¨æ³•ï¼Œå¯ä»¥çœ‹å®˜æ–¹æ–‡æ¡£ è‡ªå·±å†™çš„åŒ…è¦ç›¸äº’å¼•ç”¨çš„æ–¹æ³•æˆ‘ä»¬æŠŠä¸Šé¢çš„ç›®å½•ç»“æ„ common åŒ…å’Œ server å„è‡ªæ·»åŠ index.jsï¼Œå¦‚ä¸‹ï¼š 123456789root |__package.json |__packages |__common |__index.js |__package.json |__server |__index.js |__package.json packages\\common\\index.js é‡Œå†™ç‚¹ç®€å•çš„ä¸œè¥¿ï¼š 1module.exports = () =&gt; console.log(&#x27;hello fr common&#x27;) packages\\server\\index.js 12// è¿™é‡Œçš„ &quot;common&quot; å¯¹åº” common\\package.json é‡Œçš„ &quot;name&quot;ï¼Œå³ç›´æ¥å¼•ç”¨commonä½œä¸ºä¾èµ–åŒ…const commonFn = require(&quot;@mono-repo-by-yarn-lerna/common&quot;); common\\package.json é‡Œï¼Œç¤¾åŒºé‡Œçš„ä¹ æƒ¯æ€§åšæ³•æ˜¯åŠ ä¸Šå‰ç¼€@é¡¹ç›®åç§°/ï¼Œå¦‚ï¼š 123456789&#123; &quot;name&quot;: &quot;@mono-repo-by-yarn-lerna/common&quot;, &quot;version&quot;: &quot;1.0.0&quot;, &quot;main&quot;: &quot;index.js&quot;, &quot;license&quot;: &quot;MIT&quot;, &quot;dependencies&quot;: &#123; &quot;@mono-repo-by-yarn-lerna/common&quot;: &quot;1.0.0&quot; &#125;&#125; server\\package.json è¿è¡Œ yarn installï¼Œä¼šçœ‹åˆ°ä»¥ä¸‹ï¼Œè¯æ˜åœ¨serveræ–‡ä»¶å¤¹æˆåŠŸå®‰è£…commonæ–‡ä»¶å¤¹ä½œä¸ºä¾èµ– 12345678$ yarnyarn install v1.22.10[1/4] Resolving packages...[2/4] Fetching packages...[3/4] Linking dependencies...[4/4] Building fresh packages...success Saved lockfile.Done in 0.16s. è¿”å›æ ¹ç›®å½•è¿è¡Œ ls node_modules/ å¯ä»¥çœ‹åˆ°å¤šäº† â€˜@mono-repo-by-yarn-lernaâ€™ / ä¸ºé¡¹ç›®çš„ä¸œè¥¿ 12$ ls node_modules/&#x27;@mono-repo-by-yarn-lerna&#x27;/ è¿è¡Œ node server/index.js å¯ä»¥çœ‹åˆ°è¿è¡Œçš„ç»“æœï¼š 12$ node packages/server/index.js hello fr common å¦‚æœæ­¤æ—¶æˆ‘ä»¬å†åœ¨ server æ–‡ä»¶å¤¹é‡Œæ·»åŠ å…¶ä»–æ¨¡å—ï¼Œä¾‹å¦‚ babelï¼Œè¿è¡Œ yarn add babelï¼Œ ä¼šå‘ç° server æ–‡ä»¶å¤¹é‡Œçš„ node_modules åªæ”¾äº† babel çš„ä¸€äº›æ‰§è¡Œæ–‡ä»¶ï¼Œå…¶ä½™ babel çš„æ ¸å¿ƒæ–‡ä»¶å…¨éƒ¨è¢«ç§»åŠ¨åˆ°æ ¹ç›®å½•é‡Œçš„ node_modulesï¼Œä»¥æ­¤è¾¾åˆ°é›†ä¸­ç®¡ç†ä¾èµ–çš„ç›®çš„ Lerna A tool for managing JavaScript projects with multiple packages. Lerna æ˜¯å¸Œè…Šç¥è¯é‡Œä¸€å¤šå¤´æ€ªç‰©ï¼Œä¼°è®¡ä½œè€…æƒ³ä»–å¤šå¤´å¤„ç†å¤šä¸ªåŒ… åœ¨æˆ‘ä»¬ä¸Šé¢é¡¹ç›®çš„åŸºç¡€ä¸Šï¼Œæ ¹ç›®å½•æ·»åŠ lernaï¼Œyarn add -D -W lernaï¼Œ-Wè¡¨ç¤ºè·Ÿåœ¨æœ¬é¡¹ç›®çš„ workspace é‡Œç›´æ¥å®‰è£…ï¼Œå³æ ¹ç›®å½• npx lerna init packages\\common\\package.json å’Œ packages\\server\\package.json å‡åŠ ä¸Štestå‘½ä»¤ 123&quot;scripts&quot;: &#123; &quot;test&quot;: &quot;echo testing server with version: $npm_package_version&quot;&#125; 12345678&#123; &quot;packages&quot;: [ &quot;packages/*&quot; ], &quot;version&quot;: &quot;0.0.0&quot;, + &quot;npmClient&quot;: &quot;yarn&quot;, + &quot;useWorkspaces&quot;: true&#125; å¦‚æœè¦æ‰§è¡Œå•ä¸ª package.json é‡Œçš„å‘½ä»¤ï¼Œåˆ™éœ€åŠ ä¸Š --scope=@åŒ…åï¼Œå¦‚ 123&quot;scripts&quot;: &#123; &quot;test&quot;: &quot;lerna run test --scope=@mono-repo-by-yarn-lerna/common&quot;&#125; å¦‚æŒ‡å®šå¤šä¸ªæ¨¡å—ï¼Œåªéœ€æ”¾åœ¨&#123;&#125;é‡Œï¼Œå¦‚ï¼š 123&quot;scripts&quot;: &#123; &quot;test-since&quot;: &quot;lerna run test --scope=&#123;@mono-repo-by-yarn-lerna/common,@mono-repo-by-yarn-lerna/server&#125;&quot;&#125; lerna version å‘å¸ƒç‰ˆæœ¬æ¥ä¸Šé¢ï¼Œç”¨ new-version å‘½ä»¤è¿›è¡Œå‘ç‰ˆï¼Œæ‰§è¡Œçš„æ˜¯ lerna versionã€‚åé¢çš„å‚æ•° convential commits æ˜¯ä¸€ä¸ªç”¨äºä¼˜åŒ– git commit å†…å®¹çš„åº“ï¼Œå¯ä»¥æ·»åŠ commitsæ ‡é¢˜æ­£æ–‡æ³¨è„šä»€ä¹ˆçš„ï¼ŒæŒºæœ‰è¶£ï¼Œvs code é‡Œä¹Ÿæœ‰åŒåçš„æ’ä»¶ test è„šæœ¬åŠ ä¸Š --since å‚æ•°å¯ä»¥çœ‹åˆ°æäº¤ç‰ˆæœ¬çš„å†å²ï¼š 123&quot;scripts&quot;: &#123; &quot;test&quot;: &quot;lerna run test --since&quot;&#125;","tags":["mono repo","yarn","lerna","conventional commit"]},{"title":"esbuilç”¨äºcreate-react-appé¡¹ç›®çš„çƒ­æ›´æ–°å¼€å‘","path":"/2021/10/28/ã€2021-10-28ã€‘ç”¨esbuilåˆ›å»ºReacté¡¹ç›®/","content":"webpack ç”¨äºå¤§å‹é¡¹ç›®ä¸­ï¼Œç‰¹åˆ«æ˜¯å¼€å‘æ—¶å€™çš„çƒ­æ›´æ–°ï¼Œé€Ÿåº¦å¤ªæ…¢ï¼ŒåŸå› æ˜¯webpack é‡‡ç”¨äº†æ•´ä¸ªé¡¹ç›®æ‰€æœ‰æ–‡ä»¶ä¸€èµ·æ‰“åŒ…çš„æ–¹æ¡ˆã€‚ è‡ªä» vite æ¨å‡ºä»¥æ¥ï¼Œæ‰“åŒ…è¿™å—åšåˆ°äº†æ€§èƒ½ä¸Šçš„è¶…è¶Šã€‚vite çš„åŸç†æ˜¯åœ¨SPAé¡¹ç›®ä¸­ï¼ŒåŸºäºå…¥å£æ–‡ä»¶æ‰“åŒ…çš„ï¼Œç”±äºåªæ‰“åŒ…ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥é€Ÿåº¦å°±ä¸Šæ¥äº†ã€‚ è€Œæ— è®ºæ˜¯ vite å’Œ webpack å‡æ˜¯åŸºäº esbuild å¼€å‘çš„ã€‚æ‰€ä»¥ç ”ç©¶ä¸€ä¸‹ esbuild çš„é…ç½®æ˜¯æ¯”è¾ƒæœ‰ä»·å€¼çš„ã€‚ æœ¬é¡¹ç›®æ˜¯åŸºäº create-react-app åˆ›å»ºé¡¹ç›®ï¼Œå†ç”¨ es-build ä½œä¸ºå¼€å‘çƒ­æ›´æ–°æ‰“åŒ…ã€‚ ä¸æ”¹åŠ¨CRAç”Ÿæˆçš„åŸºç¡€ç»“æ„ä¸‹çš„æ”¹åŠ¨ç”¨ create-react-app ç”Ÿæˆé¡¹ç›®åï¼Œç„¶åå¯¹åŸæ¥çš„é¡¹ç›®ä½œäº†å¦‚ä¸‹æ”¹åŠ¨ï¼š ç”Ÿæˆ devBuild.js æ–‡ä»¶ï¼Œè¿›è¡Œå¦‚ä¸‹æ”¹åŠ¨ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273import browserSync from &quot;browser-sync&quot;;import chalk from &quot;chalk&quot;;import commandLineArgs from &quot;command-line-args&quot;;import del from &quot;del&quot;;import esbuild from &quot;esbuild&quot;;import getPort from &quot;get-port&quot;;import svgrPlugin from &quot;esbuild-plugin-svgr&quot;;// åˆ›å»ºæœåŠ¡å™¨ã€‚const bs = browserSync.create();// è§£æ„ç¯å¢ƒå˜é‡const &#123; dev &#125; = commandLineArgs(&#123; name: &quot;dev&quot;, type: Boolean &#125;);// åˆ é™¤æ–‡ä»¶å¤¹ public ä¸­çš„æ‰“åŒ…æ–‡ä»¶å¤¹del.sync(&quot;./public/dist&quot;);// å¼€å§‹ esbuild æ‰“åŒ…(async () =&gt; &#123; const buildResult = await esbuild .build(&#123; format: &quot;esm&quot;, // è®¾ç½®ç”Ÿæˆçš„ JavaScript æ–‡ä»¶çš„è¾“å‡ºæ ¼å¼ã€‚ target: &quot;es2017&quot;, // ç¼–è¯‘è½¬åŒ–ç‰ˆæœ¬ entryPoints: [&quot;./src/index.jsx&quot;], // æ‰“åŒ…å…¥å£ outdir: &quot;./public/dist&quot;, // è¾“å‡ºç›®å½• chunkNames: &quot;chunks/[name].[hash]&quot;, // æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶å incremental: dev, // å› ä¸ºæˆ‘ä»¬ç›‘å¬æ–‡ä»¶çš„æ”¹å˜é‡æ–°æ‰“åŒ…ï¼Œè€Œä¸”æˆ‘ä»¬è¦å¼€å‘ç¯å¢ƒä½¿ç”¨esbuild æ‰€ä»¥ dev ä¸º true loader: &#123; // æ­¤é€‰é¡¹æ›´æ”¹ç»™å®šè¾“å…¥æ–‡ä»¶çš„è§£é‡Šæ–¹å¼ã€‚ &quot;.svg&quot;: &quot;text&quot;, &quot;.png&quot;: &quot;dataurl&quot;, &#125;, bundle: true, // æ†ç»‘æ–‡ä»¶æ„å‘³ç€å°†ä»»ä½•å¯¼å…¥çš„ä¾èµ–é¡¹å†…è”åˆ°æ–‡ä»¶æœ¬èº«ä¸­ã€‚ splitting: true, // ä»£ç æ‹†åˆ†ç›®å‰ä»…é€‚ç”¨äºesmè¾“å‡ºæ ¼å¼ã€‚ plugins: [svgrPlugin()], inject: [&quot;./public/react-shim.js&quot;], // å°† React ä½œä¸ºå…¨å±€å˜é‡å¯¼å…¥esbuild &#125;) .catch((err) =&gt; &#123; console.error(chalk.red(err)); process.exit(1); &#125;); console.log(chalk.green(&quot;The build has finished! ğŸ“¦ &quot;)); // è·å–å¯ä»¥ä½¿ç”¨çš„ç«¯å£å· const port = await getPort(&#123; port: getPort.makeRange(4000, 4999), &#125;); console.log( chalk.cyan( `Launching the Shoelace dev server at http://localhost:$&#123;port&#125;! ğŸ¥¾ ` ) ); // æœåŠ¡å™¨åˆå§‹åŒ– bs.init(&#123; startPath: &quot;/&quot;, // åˆå§‹è·¯å¾„ port, // ç«¯å£å· logLevel: &quot;silent&quot;, // æ—¥å¿—çº§åˆ« logFileChanges: true, // æ—¥å¿—æ–‡ä»¶æ›´æ”¹ notify: true, // æµè§ˆå™¨ä¸­çš„å°å¼¹å‡ºé€šçŸ¥ single: true, // æä¾›å•ç‹¬çš„ index.html server: &#123; baseDir: &quot;public&quot;, // åŸºç¡€æ–‡ä»¶å¤¹ index: &quot;index.html&quot;, // è®¾ç½®æœåŠ¡å™¨çš„å…¥å£æ–‡ä»¶ &#125;, files: &quot;src/&quot;, // ç›‘å¬ src ä¸‹çš„æ–‡ä»¶ &#125;); // ç›‘å¬ src æ–‡ä»¶å¤¹ä¸‹çš„æ›´æ”¹ bs.watch([&quot;src/&quot;]).on(&quot;change&quot;, async (filename) =&gt; &#123; console.log(`Source file changed - $&#123;filename&#125;`); // é‡æ–°æ‰“åŒ… buildResult.rebuild(); &#125;);&#125;)(); ä¾èµ–å®‰è£…ï¼š æ ¸å¿ƒ: esbuild,esbuild-plugin-svgrç”¨äºåˆ›å»ºæœåŠ¡æ¸²æŸ“æ‰“åŒ…æ–‡ä»¶ï¼š browser-syncè§£æå‘½ä»¤è¡Œå‚æ•°: command-line-argsæ‰“åŒ…æ–‡ä»¶åˆ é™¤ï¼šdelè·å–å½“å‰å¯ç”¨ç«¯å£ï¼šget-portç¾åŒ–ï¼šchalk package.json çš„ script å¢åŠ äº† dev å‘½ä»¤ï¼Œä¸ºè·‘ devBuild.js æ–‡ä»¶ package.json å¢åŠ äº† &#123;&quot;type&quot;: &quot;module&quot;&#125; è®© node å¯ä»¥ç¼–è¯‘ esm è¯­æ³• å°† public/index.html æ–‡ä»¶å¢åŠ å¦‚ä¸‹ï¼š 123456...&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;./dist/index.css&quot; /&gt;...&lt;script type=&quot;module&quot;&gt; import &#x27;./dist/index.js&#x27;&lt;/script&gt; å¢åŠ  public/react-shim.js æ–‡ä»¶ï¼Œå¹¶åœ¨ devBuild.jså†™å…¥ç›¸åº”é…ç½®ï¼Œåœ¨srcä¸­å°±ä¸ç”¨åˆ°å¤„å¼•å…¥Reactäº†ï¼š 12import * as React from &#x27;react&#x27;export &#123; React &#125; æºç åœ¨è¿™é‡Œ","tags":["React","esbuild","webpack"]},{"title":"Webæ€§èƒ½ä¼˜åŒ–ï¼ˆæœ€åæ›´æ–°æ—¶é—´ï¼š2021-10-26ï¼‰","path":"/2021/10/26/ã€2021-05-30ã€‘Webæ€§èƒ½ä¼˜åŒ–ï¼ˆæŒç»­æ›´æ–°ï¼‰/","content":"æœ¬æ–‡æ ¹æ®è¿™ç¯‡æ–‡ç« ï¼šBest Practices for Speeding Up Your Web Siteï¼Œè¢«ç§°ä½œâ€é›…è™35æ¡å†›è§„â€ï¼Œè™½é‡Œé¢æœ‰çš„ä¸œè¥¿è™½è¯´ä¹Ÿå·²ç»è¿‡æ—¶ï¼Œä½†å¯ä»¥ç”±æ­¤çª¥æ¢å‰ç«¯å‘å±•çš„å†ç¨‹ï¼Œä¸€äº›è¿‡æ—¶çš„å»ºè®®ä¼šç•¥å»è§£é‡Šã€‚ ä¸€é“é¢è¯•é¢˜å¼•å‘çš„å‰ç«¯æ€§èƒ½ä¼˜åŒ–æ€è€ƒç›¸ä¿¡å¤§å®¶éƒ½ç¢°è¿‡è¿™é“ç»å…¸é¢è¯•é¢˜ï¼šåœ¨æµè§ˆå™¨è¾“å…¥urlåˆ°çœ‹åˆ°é¡µé¢çš„å±•ç¤ºï¼Œè¿™ä¸­é—´å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ æ€»ä½“ç­”æ¡ˆæ˜¯è¿™æ ·ï¼š æµè§ˆå™¨è¾“å…¥åŸŸåï¼ˆDomainï¼‰ â€”â€”&gt; DNSæœåŠ¡å™¨è§£ææˆIPåœ°å€ ï¼ˆå¦‚ï¼š12.220.12.123ï¼‰ é€šè¿‡å±€åŸŸç½‘ â€”â€”&gt; äº¤æ¢æœº â€”â€”&gt; è·¯ç”±å™¨ â€”â€”&gt; ä¸»å¹²ç½‘ â€”â€”&gt; æœåŠ¡ç«¯ å»ºç«‹TCPè¿æ¥ æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚ï¼ŒæŸ¥åº“ï¼Œè¯»æ–‡ä»¶ç­‰ï¼Œ æ‹¼æ¥å¥½responseï¼Œå³è¿”å›çš„HTTPå“åº” æµè§ˆå™¨æ”¶åˆ°é¦–å±htmlé¡µé¢ï¼Œå¼€å§‹æ¸²æŸ“ è§£æ html ä¸º DOM-tree è§£æ CSS ä¸º CSS-tree DOM-tree + CSS-tree ç”Ÿæˆ render-tree ç»˜å›¾ æ ¹æ®é¡µé¢èŠ‚ç‚¹çš„æ”¹å˜ï¼Œæ ·å¼çš„æ”¹å˜ç­‰ï¼Œå‘ç”Ÿé‡ç»˜ä¸å›æµ æ‰€è°“çš„æ€§èƒ½ä¼˜åŒ–ï¼Œå°±æ˜¯ä¸Šé¢çš„æ­¥éª¤åŠ åœ¨ä¸€èµ·ï¼Œæ—¶é—´å°½å¯èƒ½çŸ­ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªè¿‡ç¨‹ç§3ç‚¹å…³é”®çš„ä¼˜åŒ–å› ç´ ï¼š å‡å°‘httpè¯·æ±‚ï¼Œç¼©å°httpè¯·æ±‚å¤§å° å‡å°‘é™æ€æ–‡ä»¶å¤§å° å‡å°‘æ¸²æŸ“ å¤§æ¦‚ä¼˜åŒ–ç‚¹ï¼Œå®é™…å·¥ä½œç§è¿˜è¦ç»“åˆåœºæ™¯æ‰èƒ½åšå‡ºä¼˜åŒ–ï¼š DNS é€šè¿‡ç¼“å­˜å‡å°‘DNSæŸ¥è¯¢æ—¶é—´ ç½‘ç»œè¯·æ±‚è¿‡ç¨‹èµ°æœ€è¿‘çš„ç½‘ç»œç¯å¢ƒ ç›¸åŒé™æ€èµ„æºæ˜¯å¦å¯ç¼“å­˜ å‡å°httpè¯·æ±‚å¤§å° å‡å°‘httpè¯·æ±‚ æœåŠ¡çš„æ¸²æŸ“ ç½‘é¡µæ€§èƒ½æ£€æµ‹å·¥å…·é¦–å…ˆåº”æ˜ç¡®æ£€æµ‹ç½‘é¡µæ‰€éœ€çš„å·¥å…·ï¼Œè¿™é‡Œåˆ—ä¸¾äº†3ç§æ–¹æ³•ï¼š è°·æ­Œæ¨å‡ºçš„æ€§èƒ½æ£€æµ‹ç½‘ç«™web.devä»ä¸‰ä¸ªæŒ‡æ ‡å¯¹ç½‘ç«™æ€§èƒ½è¿›è¡Œè¯„ä¼° Largest Contentful Paint (LCP) ï¼šæœ€å¤§å†…å®¹ç»˜åˆ¶ï¼Œæµ‹é‡åŠ è½½æ€§èƒ½ã€‚ä¸ºäº†æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼ŒLCP åº”åœ¨é¡µé¢é¦–æ¬¡å¼€å§‹åŠ è½½åçš„2.5 ç§’å†…å‘ç”Ÿã€‚ First Input Delay (FID) ï¼šé¦–æ¬¡è¾“å…¥å»¶è¿Ÿï¼Œæµ‹é‡äº¤äº’æ€§ã€‚ä¸ºäº†æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œé¡µé¢çš„ FID åº”ä¸º100 æ¯«ç§’æˆ–æ›´çŸ­ã€‚ Cumulative Layout Shift (CLS) ï¼šç´¯ç§¯å¸ƒå±€åç§»ï¼Œæµ‹é‡è§†è§‰ç¨³å®šæ€§ã€‚ä¸ºäº†æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œé¡µé¢çš„ CLS åº”ä¿æŒåœ¨ 0.1. æˆ–æ›´å°‘ã€‚ è¯¥ç½‘ç«™å¯ä»¥è¾“å…¥ç½‘å€åè¿›è¡Œæµ‹è¯•ï¼Œç»™å‡ºä¸€ä»½è¯¦ç»†çš„ lighthouse æŠ¥å‘Š Navigator.sendBeacon() åŸ‹ç‚¹ä¼ è¾“æ•°æ®ç»™æœåŠ¡å™¨è®°å½•æ—¶é—´ä¾æ®googleä»¥ä¸Š3åŸåˆ™ï¼Œå¯ä»¥åœ¨å‰ç«¯è¿›è¡ŒåŸ‹ç‚¹ï¼Œè¿›è¡Œç»Ÿè®¡ 12345678910import &#123; getCLS, getFID, getLCP &#125; from &#x27;web-vitals&#x27;function sendToAnalytics(metric) &#123; const body = JSON.stringify(metric); navigator.sendBeacon(&#x27;/analytics&#x27;, body))&#125;getCLS(sendToAnalytics);getFID(sendToAnalytics);getLCP(sendToAnalytics); window.performanceæ‰“å¼€ä»»æ„ç½‘é¡µï¼Œæ§åˆ¶å°è¾“å…¥ä»¥ä¸‹ä»£ç ï¼Œå¯ä»¥çœ‹åˆ° window.performance æ‰€è·å–åˆ°çš„ä¸œè¥¿ï¼Œæˆ‘ä»¬ä¸»è¦çœ‹ä»–çš„timingå±æ€§ï¼Œç”¨å¼€å§‹æ—¶é—´å‡å»ç»“æŸæ—¶é—´å¾—å‡ºå„ç§èµ„æºåŠ è½½çš„æ—¶é—´ã€‚ä»¥ä¸‹çš„æ•°å€¼éƒ½ç®—æ˜¯æ¯”è¾ƒç²—ç•¥çš„æ•°å€¼ 12345678const t = window.performance.timing;console.log(&#123; &quot;DNS&quot;: t.domainLookupEnd - t.domainLookupStart, &quot;TCP&quot;: t.connectEnd - t.connectStart, &quot;è·å¾—é¦–å­—èŠ‚è€—è´¹æ—¶é—´ï¼ŒTTFB&quot;: t.responseStart - t.navigationStart, &quot;domReadyæ—¶é—´&quot;: t.domContentLoadedEventStart - t.navigationStart, &quot;DOMèµ„æºä¸‹è½½&quot;: t.responseEnd - t.responseStart&#125;) ç¬¬ä¸€å­—èŠ‚å“åº”æ—¶é—´ï¼ˆTTFBï¼‰= ä»å‘é€è¯·æ±‚åˆ°WEBæœåŠ¡å™¨çš„æ—¶é—´ + WEBæœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶ç”Ÿæˆå“åº”èŠ±è´¹çš„æ—¶é—´ + WEBæœåŠ¡å™¨ç”Ÿæˆå“åº”åˆ°æµè§ˆå™¨èŠ±è´¹çš„æ—¶é—´ ç¬¬ä¸€å­—èŠ‚å“åº”æ—¶é—´ï¼ˆTTFBï¼‰è¦è€ƒè™‘çš„é—®é¢˜ï¼šæ­¥éª¤1ï¼šä»å‘é€è¯·æ±‚åˆ°WEBæœåŠ¡å™¨çš„æ—¶ï¼Œå³å‘ç«™ç‚¹åœ°å€æäº¤é¦–æ¬¡è¯·æ±‚ DNS å“åº”æ—¶é—´ï¼ˆç»ˆç«¯ç”¨æˆ·ä¾§è§£æ DNS è¯·æ±‚æœ‰å¤šå—ï¼‰ ç½‘ç«™æœåŠ¡å™¨åˆ°ç»ˆç«¯ç”¨æˆ·çš„è·ç¦»ï¼Œè¶ŠçŸ­è¶Šå¥½ ç½‘ç»œç¨³å®šæ€§ æ­¥éª¤2ï¼šWEBæœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶ç”Ÿæˆå“åº”èŠ±è´¹çš„æ—¶é—´ï¼Œå³ç”± web æœåŠ¡å™¨è§£ææœ¬æ¬¡è¯·æ±‚ ç‰©ç†ç¡¬ä»¶å“åº”æ—¶é—´Â ï¼ˆweb æœåŠ¡å™¨è§£æè¯·æ±‚æœ‰å¤šå¿«ï¼‰ æ—¢æœ‰çš„æœåŠ¡å™¨æ“ä½œè´Ÿè½½ æ•°æ®ä¸­å¿ƒä»»ä½•ç½‘ç»œç›¸å…³çš„å»¶è¿Ÿ æ­¥éª¤3ï¼šWEBæœåŠ¡å™¨ç”Ÿæˆå“åº”åˆ°æµè§ˆå™¨èŠ±è´¹çš„æ—¶é—´ï¼Œ å³å‘å®¢æˆ·ç«¯å‘é€é¦–ä¸ªå“åº”çš„æ—¶é—´ ç»ˆç«¯ç”¨æˆ·çš„ç½‘é€Ÿ è¿æ¥ç¨³å®šæ€§ Chromeè‡ªå¸¦çš„performanceæ£€æµ‹å·¥å…·è‡ªåŠ¨åŒ–æ£€æµ‹åˆ©å™¨â€”â€” lighthouse â€”â€” è‡ªåŠ¨ç”Ÿæˆç½‘é¡µæ€§èƒ½æŠ¥å‘Šï¼Œå¹¶æœ‰ä¼˜åŒ–å»ºè®®ç¬¦åˆè°·æ­Œçš„ PWA æ ‡å‡†çš„æ£€æµ‹ï¼Œå…³äºPWAçš„æ¦‚å¿µï¼Œç‚¹å‡»è¿™é‡Œ æ–¹æ³•ä¸€ï¼Œç›´æ¥å®‰è£… npm åº“ 1npm i -g lighthouse ä½¿ç”¨èµ·æ¥è¶…çº§ç®€å• 1lighthouse &lt;éœ€è¦æµ‹è¯•çš„ç½‘é¡µé“¾æ¥&gt; æ–¹æ³•äºŒï¼Œæµè§ˆå™¨ä¹Ÿè‡ªå¸¦ lighthouse åŠŸèƒ½ï¼Œä»¥ä¸‹æ˜¯ Edge æµè§ˆå™¨ æµè§ˆå™¨çš„é‡ç»˜ä¸å›æµèµ„æºåˆå¹¶ä¸å‹ç¼©ï¼šç°ä»£åŒ–çš„å‰ç«¯è·‘ä¸æ‰èµ„æºå‹ç¼©è¿™ä¸€æ­¥ï¼Œå¹³æ—¶å·¥ç¨‹åŒ–ç”¨çš„ webpack å°±æ˜¯ä¸€æ¬¾å‹ç¼©å·¥å…· HTMLå‹ç¼©åŸç†ï¼šå°†HTMLé‡Œçš„ç©ºæ ¼ï¼Œæ¢è¡Œç¬¦ï¼Œåˆ¶è¡¨ç¬¦ç­‰å»æ‰ æ–¹æ³•ï¼š nodeä½œä¸ºæ„å»ºå·¥å…·ï¼Œæä¾›äº† html-minifier å·¥å…·ï¼Œwebpackçš„ HTMLMinifierWebpackPlugin ä¸­å†…ç½®äº†è¯¥æ„å»ºå·¥å…· åç«¯æ¨¡æ¿å¼•æ“æ¸²æŸ“å‹ç¼©ï¼Œå¦‚ejsæ¨¡æ¿ï¼Œexpress çš„ renderFile() CSSå‹ç¼©åŸç†ï¼š é™¤äº†åƒHTMLä¸€æ ·åˆ é™¤ç©ºæ ¼ï¼Œæ¢è¡Œç¬¦ç­‰ä¹‹å¤– åˆ é™¤æ— æ•ˆä»£ç  cssè¯­ä¹‰åˆå¹¶ æ–¹æ³•ï¼š html-minifier å¯ä»¥å¯¹htmlä¸­çš„å†…è”cssæ ·å¼è¿›è¡Œå‹ç¼©ï¼Œéœ€é…ç½®å…¶ä¸­çš„é€‰é¡¹ clean-css å¯¹ css çš„å‹ç¼© Webpack çš„ CssMinimizerWebpackPlugin JSå‹ç¼©ä¸æ··ä¹±åŸç†ï¼š åˆ é™¤æ— æ•ˆå­—ç¬¦ åˆ é™¤æ³¨é‡Š ä»£ç è¯­ä¹‰åŒ–çš„ç¼©å‡å’Œä¼˜åŒ– ä»£ç ä¿æŠ¤ æ–¹æ³•ï¼š html-minifier å¯ä»¥å¯¹htmlä¸­çš„jsè¿›è¡Œå‹ç¼©ï¼Œéœ€é…ç½®å…¶ä¸­çš„é€‰é¡¹ uglifyjs3 JSæ–‡ä»¶åˆå¹¶å¦‚æœä¸åˆå¹¶è¯·æ±‚ä¼šæœ‰ä»¥ä¸‹å½±å“ ä½†åˆå¹¶è¯·æ±‚ä¹Ÿä¸æ˜¯ä¸‡èƒ½çš„ï¼Œå…¶ç¼ºç‚¹ä½“ç°åœ¨ï¼š é¦–å±æ¸²æŸ“çš„é—®é¢˜ç°åœ¨çš„å‰ç«¯éƒ½ç”¨ç±»ä¼¼reactæˆ–è€…vueç­‰å‰ç«¯æ¡†æ¶ï¼Œå¦‚æœä½¿ç”¨vueæˆ–è€…reactæ²¡æœ‰è¿›è¡ŒæœåŠ¡ç«¯æ¸²æŸ“çš„æ“ä½œï¼Œè€Œä¸”æœåŠ¡ç«¯åˆå¹¶è¯·æ±‚çš„JSæ–‡ä»¶åˆæ¯”è¾ƒå¤§ï¼Œé‚£ä¹ˆè¯·æ±‚å›æ¥çš„JSåŠ è½½å®Œæˆåï¼Œæ‰ä¼šæ‰§è¡Œreactæˆ–vueçš„æ¡†æ¶ä»£ç åœ¨å®¢æˆ·ç«¯åŠ è½½æ¸²æŸ“ï¼Œé‚£ä¹ˆé¦–å±ç™½å±çš„æ—¶é—´å°±ä¼šæ¯”è¾ƒä¹… ç¼“å­˜å¤±æ•ˆçš„é—®é¢˜ç°åœ¨çš„æ‰“åŒ…ç”¨webpackéƒ½ä¼šåŠ ä¸Šmd5æˆ³ï¼Œç”¨äºæ ‡è¯†å•ä¸ªjsæ–‡ä»¶æ˜¯å¦å‘ç”Ÿæ”¹å˜ï¼Œå¦‚æœJSåˆå¹¶äº†ï¼Œå°±ä¼šä½¿åŸå…ˆçš„md5æˆ³å¤±æ•ˆï¼Œå°±å¾—é‡æ–°åŠ è½½ é’ˆå¯¹åˆå¹¶å¸¦æ¥çš„è´Ÿé¢æ•ˆæœï¼Œåº”éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š å…¬å…±åº“åˆå¹¶å…¬å…±åº“ä»£ç æ¯”è¾ƒå°‘åšé¢‘ç¹å˜åŠ¨ï¼Œåº”å•ç‹¬æ‰“åŒ…ä¸ºä¸€ä¸ªjsæ–‡ä»¶ï¼Œå’Œä¸šåŠ¡ä»£ç çš„jsæ–‡ä»¶åˆ†å¼€ï¼Œé¿å…å…¬å…±åº“çš„ç¼“å­˜å¤±æ•ˆ ä¸åŒé¡µé¢çš„åˆå¹¶è¿™ç§å‘ç”Ÿåœ¨vueæˆ–reactçš„å•é¡µé¢åº”ç”¨ï¼Œé€šå¸¸æˆ‘ä»¬æ‰“åŒ…å‡ºæ¥çš„å•é¡µåº”ç”¨åªæœ‰ä¸€ä¸ªjsæ–‡ä»¶ï¼Œä½†è¿™ç§æ–¹æ³•åœ¨æ•ˆç‡æå‡æ¥è¯´æœ‰é˜»ç¢ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯æ¯ä¸ªé¡µé¢æ‰“åŒ…ä¸ºä¸€ä¸ªjsæ–‡ä»¶ï¼Œå½“æŸé¡µé¢è¢«è·¯ç”±åˆ°åŠ è½½åˆ°æ—¶ï¼Œæ‰å»åŠ è½½å¯¹åº”é¡µé¢çš„jsæ–‡ä»¶ï¼Œè¿™ç§æ–¹å¼åœ¨webpackä¸­æœ‰ç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œå°±æ˜¯ loadable å¼‚æ­¥åŠ è½½ç»„ä»¶ ä¼ è¾“æ–¹é¢ï¼šCDNç¼“å­˜http2å……åˆ†åˆ©ç”¨HTTPç¼“å­˜å‹ç¼©htmlï¼Œjsï¼Œcssæ–‡ä»¶ä½“ç§¯ï¼Œç”¨gzip/brotliå¯¹ JSã€CSSã€HTML ç­‰æ–‡æœ¬èµ„æºå‡æœ‰æ•ˆï¼Œä½†æ˜¯å¯¹å›¾ç‰‡æ•ˆæœä¸å¤§ã€‚ gzip é€šè¿‡ LZ77 ç®—æ³•ä¸ Huffman ç¼–ç æ¥å‹ç¼©æ–‡ä»¶ï¼Œé‡å¤åº¦è¶Šé«˜çš„æ–‡ä»¶å¯å‹ç¼©çš„ç©ºé—´å°±è¶Šå¤§ã€‚ brotli é€šè¿‡å˜ç§çš„ LZ77 ç®—æ³•ã€Huffman ç¼–ç åŠäºŒé˜¶æ–‡æœ¬å»ºæ¨¡æ¥å‹ç¼©æ–‡ä»¶ï¼Œæ›´å…ˆè¿›çš„å‹ç¼©ç®—æ³•ï¼Œæ¯” gzip æœ‰æ›´é«˜çš„æ€§èƒ½åŠå‹ç¼©ç‡ å¯åœ¨æµè§ˆå™¨çš„ Content-Encoding å“åº”å¤´æŸ¥çœ‹è¯¥ç½‘ç«™æ˜¯å¦å¼€å¯äº†å‹ç¼©ç®—æ³•ï¼Œç›®å‰çŸ¥ä¹ã€æ˜é‡‘ç­‰å·²å…¨é¢å¼€å¯äº† brotli å‹ç¼©ã€‚ 12345678# Request HeaderAccept-Encoding: gzip, deflate, br# gzipContent-Encoding: gzip# gzipContent-Encoding: br å‹ç¼©æ··æ·†å·¥å…· terser swc html-minifier-terser JSå‹ç¼© ä¸Šè¿°æåˆ°çš„ gzip/brotli å’Œ terser webpack æ‰“åŒ… webpack-bundle-ananlyzeåˆ†ææ‰“åŒ…ä½“ç§¯ ä½¿ç”¨ä¸€äº›æ›´å°ä½“ç§¯çš„åº“ï¼Œå¦‚ moment -&gt; dayjs ä¸€äº›åº“è¿›è¡ŒæŒ‰éœ€åŠ è½½ï¼Œå¦‚ import lodash -&gt; import lodash-es é›…è™35æ¡çš„é“¾æ¥ï¼Œ ä»ä¸­æŒ‘å‡ºä¸€äº›ç‚¹æ¥è®²ï¼Œå¦‚ä¸‹ï¼šImage *ä¹‹æ‰€ä»¥æŠŠå›¾ç‰‡æ”¾åœ¨æœ€å‰ï¼Œå› ä¸ºä¼˜åŒ–å›¾ç‰‡çš„æ•ˆç‡æ˜¯æ¯”è¾ƒå¤§çš„ Optimize Images * å›¾ç‰‡ä¼˜åŒ– å„ç§å›¾ç‰‡æ ¼å¼çš„åº”ç”¨åœºæ™¯ï¼š 1.1 png å¤§éƒ¨åˆ†éœ€è¦ä½¿ç”¨é€æ˜çš„åœºæ™¯ pngcrush æˆ–å…¶ä»–å·¥å…·å‹ç¼©pngã€‚åœ¨çº¿å‹ç¼©å·¥å…· https:/ tinypng.com/ 1.2 jpg å¤§éƒ¨åˆ†ä¸éœ€è¦é€æ˜çš„åœºæ™¯ jpegtranæˆ–å…¶å®ƒå·¥å…·å‹ç¼©jpegï¼Œå¤§å›¾ç”¨jpg 1.3 SVGçŸ¢é‡å›¾ï¼Œç±»ä¼¼XMLè¯­æ³•ï¼Œå†…åµŒåœ¨htmlé‡Œçš„ä»£ç å›¾ç‰‡ï¼ˆç”¨æ¥ç»˜åˆ¶åœ°å›¾ï¼Œè‚¡ç¥¨Kçº¿å›¾ç­‰ï¼‰ï¼Œå¯ä½¿ç”¨ é˜¿é‡Œçš„iconfont è§£å†³iconé—®é¢˜ SVGçš„æ•™ç¨‹ ä¾‹å¦‚ç”»ä¸€ä¸ªé•¿æ–¹å½¢ï¼š 1234567&lt;svg width=&quot;100%&quot; height=&quot;100%&quot; version=&quot;1.1&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt; &lt;rect width=&quot;300&quot; height=&quot;100&quot; style=&quot;fill:rgb(0,0,255);stroke-width:1; stroke:rgb(0,0,0)&quot; /&gt;&lt;/svg&gt; 1.4 Webp å¯å…¨ç”¨ googleåœ¨2010å¹´å¼€å‘çš„ä¸€ç§å…¨èƒ½çš„å›¾ç‰‡ï¼Œä½†safariæµè§ˆå™¨ å’Œ webview çš„å…¼å®¹æ€§ä¸å¤ªå¥½ 1.5 png â€”â€”&gt; Webp æ ¼å¼ç½‘ç«™ï¼šæ™ºå›¾ webp æ¯” jpeg/png æ›´å°ï¼Œè€Œ avif åˆæ¯” webp å°ä¸€ä¸ªçº§åˆ« ä¸ºäº†æ— ç¼å…¼å®¹ï¼Œå¯é€‰æ‹© picture/source è¿›è¡Œå›é€€å¤„ç† 12345&lt;picture&gt; &lt;source srcset=&quot;img/photo.avif&quot; type=&quot;image/avif&quot;&gt; &lt;source srcset=&quot;img/photo.webp&quot; type=&quot;image/webp&quot;&gt; &lt;img src=&quot;img/photo.jpg&quot; width=&quot;360&quot; height=&quot;240&quot;&gt;&lt;/picture&gt; Image inlineï¼Œå³å°†å›¾ç‰‡å†…å®¹å†…åµŒåˆ°htmlé‡Œï¼Œå‡å°‘ç½‘ç«™çš„HTTPè¯·æ±‚æ•°é‡ï¼Œå¤šç”¨äºç§»åŠ¨ç«¯å’Œå°å›¾æ ‡ï¼š å¦‚ä½•å°†å›¾ç‰‡è½¬æ¢ä¸ºbase64ç¼–ç å†…åµŒåˆ°htmlä¸­ï¼Œæœ‰ä¸€ä¸ªåœ¨çº¿è½¬æ¢ç½‘ç«™ï¼Œåœ¨htmlæ–‡ä»¶å›¾ç‰‡æ‰€åœ¨çš„src=â€â€ä¸­æ·»åŠ data:image/jpg;base64,ï¼ˆæ³¨ï¼šè¿™é‡Œæ˜¯jpgæ ¼å¼ï¼Œä½ å¯ä»¥æ”¹å†™æˆä½ ç¼–ç å›¾ç‰‡çš„ç±»å‹ï¼‰ï¼Œå°†ä½ ç¼–ç çš„Base64ä»£ç å¤åˆ¶åˆ°image/jpg;base64, çš„åé¢ï¼Œç„¶åç”¨æµè§ˆå™¨è¿è¡Œå³å¯ã€‚ å½“ç„¶è¿˜å¯ä»¥åƒtaobaoä¸»é¡µä¸€æ ·ï¼ŒåµŒå…¥åˆ°cssçš„å±æ€§ä¸­ä½¿ç”¨ï¼š Optimize CSS Spriteså®é™…ä¸Šï¼Œéšç€å¸¦å®½çš„æ™®éæé«˜ï¼Œç°åœ¨ä¸å°‘ç½‘ç«™éƒ½ä¸ç”¨é›ªç¢§å›¾äº†ï¼Œç‰¹åˆ«æ˜¯PCç«¯ï¼Œç§»åŠ¨ç«¯ç”¨çš„è¿˜ç›¸å¯¹æ¯”PCç«¯å¤šäº›ã€‚ä½†ä»æœ‰ç½‘ç«™åœ¨ä½¿ç”¨ä»–ã€‚è€Œé›ªç¢§å›¾åœ¨åº”ç”¨ä¸Šä¹Ÿæœ‰ç¼ºç‚¹ï¼Œå¦‚æœè¿‡å¤šå›¾æ ‡é›†åˆåœ¨ä¸€ä¸ªå›¾çš„è¯ï¼Œåˆ™ä¼šå‡ºç°å¦‚æœè¯¥å›¾ç‰‡è¯·æ±‚åè¯»å–ä¸å‡ºï¼Œæ‰€æœ‰åº”ç”¨åˆ°è¯¥å›¾ç‰‡çš„å›¾æ ‡å…¨éƒ¨ä¼šå¤±æ•ˆ Arranging the images in the sprite horizontally as opposed to vertically usually results in a smaller file size. Combining similar colors in a sprite helps you keep the color count low, ideally under 256 colors so to fit in a PNG8. â€œBe mobile-friendlyâ€ and donâ€™t leave big gaps between the images in a sprite. This doesnâ€™t affect the file size as much but requires less memory for the user agent to decompress the image into a pixel map. 100x100 image is 10 thousand pixels, where 1000x1000 is 1 million pixels é›ªç¢§å›¾æœ€å¥½ç«–æ”¾ï¼Œé¿å…æ¨ªæ”¾ï¼Œè¾¾åˆ°æœ€å°å°ºå¯¸ ç›¸ä¼¼å›¾ç‰‡åˆå¹¶ï¼Œé¢œè‰²ç›¸è¿‘çš„åˆå¹¶ï¼Œé¢œè‰²æ•°ä¼šæ›´å°‘ ç§»åŠ¨ç«¯çš„é›ªç¢§å›¾å‡å°‘ç©ºéš™ é›ªç¢§å›¾çš„ç”Ÿæˆï¼Œç”¨è¿™ä¸ªç½‘ç«™ é€‰æ‹©å™¨æ€§èƒ½å†…è”æ ·å¼ (style=â€â€) &gt; ID é€‰æ‹©å™¨ (id) &gt; ç±»é€‰æ‹©å™¨ (class) = å±æ€§é€‰æ‹©å™¨ ( a[href], input[type=â€textâ€] ç­‰ ) = ä¼ªç±»é€‰æ‹©å™¨ (nth-child(n), :hover, :active ç­‰) &gt; å…ƒç´ ï¼ˆç±»å‹ï¼‰é€‰æ‹©å™¨ = ä¼ªå…ƒç´ é€‰æ‹©å™¨ Do Not Scale Images in HTML If you need &lt;img width=&quot;100&quot; height=&quot;100&quot; src=&quot;mycat.jpg&quot; alt=&quot;My Cat&quot; /&gt;then your image (mycat.jpg) should be 100x100px rather than a scaled down 500x500px image. ä¸è¦åœ¨HTMLä¸­ç¼©æ”¾å›¾ç‰‡ï¼Œå¦‚æœä½ éœ€è¦ &lt;img width=&quot;100&quot; height=&quot;100&quot; src=&quot;mycat.jpg&quot; alt=&quot;My Cat&quot; /&gt; çš„å›¾ç‰‡ï¼Œç›´æ¥åšä¸€å¼  100*100 çš„å›¾å³å¯ï¼Œè€Œä¸æ˜¯æ‹¿ä¸€å¼  500*500 çš„å›¾ç‰‡è¿›è¡Œç¼©æ”¾ Make favicon.ico Small and Cacheableä½¿å¾— favicon.ico å›¾ç‰‡å¯ä»¥ç¼“å­˜ï¼Œå¦‚æœä¸è¿›è¡Œç¼“å­˜ï¼Œä¸å…³å¿ƒä»–ï¼Œæµè§ˆå™¨è¿˜æ˜¯ä¼šè¯·æ±‚ä»– ContentMake Fewer HTTP Requests *å‡å°‘ HTTP è¯·æ±‚ Reduce DNS Lookupså‡å°‘DNSæŸ¥è¯¢ Avoid Redirects *é¿å…é‡å®šå‘ Postload Components * æ‡’åŠ è½½ç»„ä»¶å›¾ç‰‡è¿›å…¥å¯è§†åŒºåŸŸåå†è¯·æ±‚å›¾ç‰‡èµ„æºã€‚é€‚ç”¨äºç”µå•†ç­‰å›¾ç‰‡å¾ˆå¤šï¼Œé¡µé¢å¾ˆé•¿çš„ä¸šåŠ¡åœºæ™¯å‡å°‘æ— æ•ˆèµ„æºçš„åŠ è½½å¹¶å‘åŠ è½½çš„èµ„æºè¿‡å¤šä¼šé˜»å¡jsçš„åŠ è½½ï¼Œå½±å“ç½‘ç«™æ­£å¸¸ä½¿ç”¨ æ¡ˆä¾‹å¯ä»¥çœ‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼Œå…³äºJS IntersectionObserver Apiï¼Œå¯ä»¥è¿™ä¸ªå°†è¿™ä¸ªapiç”¨äºæ‡’åŠ è½½ ä¸‹é¢ç»“åˆreact å†™ä¸€ä¸ªæ‡’åŠ è½½æ¡ˆä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839import React from &#x27;react&#x27;import &#x27;./Lazyload.css&#x27;import &#123; v4 as uuidv4 &#125; from &#x27;uuid&#x27;/* æ€»ä½“æ€è·¯ï¼š1. å…ˆåˆ›å»ºå›¾ç‰‡å ä½ç¬¦2. åˆ›å»º IntersectionObserver å¯¹è±¡ç›‘å¬è¿™äº›å›¾ç‰‡å ä½ç¬¦*/const refs = [] // å›¾ç‰‡çš„ refï¼ˆæ“ä½œdomæ—¶ç”¨ï¼‰const images = []for (let i=0; i&lt;4; i++) &#123; const ref = React.createRef() refs.push(ref) images.push(&lt;div className=&#x27;image-box&#x27; key=&#123;uuidv4()&#125;&gt; &lt;img ref=&#123; ref &#125; data-src=&#123;`https://pschina.github.io/src/assets/images/$&#123;i&#125;.jpg`&#125; /&gt; &lt;/div&gt;)&#125;const LazyLoadPage = ()=&gt;&#123; const io = new IntersectionObserver( entries =&gt;&#123; entries.forEach((item)=&gt;&#123; if (item.intersectionRatio &lt;= 0 ) return // intersectionRatio æ˜¯å¯è§åº¦ å¦‚æœå½“å‰å…ƒç´ ä¸å¯è§å°±ç»“æŸè¯¥å‡½æ•°ã€‚ item.target.src = item.target.dataset.src &#125;) // [0.01] è¿™æ˜¯è§¦å‘æ—¶æœº 0.01ä»£è¡¨å‡ºç° 1%çš„é¢ç§¯å‡ºç°åœ¨å¯è§†åŒºè§¦å‘ä¸€æ¬¡å›æ‰å‡½æ•° // threshold = [0, 0.25, 0.5, 0.75] è¡¨ç¤ºåˆ†åˆ«åœ¨0% 25% 50% 75% æ—¶è§¦å‘å›æ‰å‡½æ•° &#125;, [0.01] ); const onload = ()=&gt; refs.forEach( i =&gt; io.observe(i.current) ) return &lt;div className=&#x27;box&#x27;&gt; &#123;images&#125; &lt;img onError=&#123;onload&#125; src=&quot;&quot; /&gt; &lt;/div&gt;&#125;export default LazyLoadPage Preload Components * é¢„åŠ è½½ç»„ä»¶æ–¹æ³•ä¸€ï¼ŒåŠ è½½æ—¶å¦ display ä¸º none 1&lt;img src=&quot;http://xxx.xxx&quot; style=&quot;display: none&quot; /&gt; æ–¹æ³•äºŒï¼Œåˆ©ç”¨ new Image() 12var img = new Image()img.src = &#x27;http://xxx.xxx/&#x27; æ–¹æ³•ä¸‰ï¼ŒXHLHttpRequest å¯¹è±¡ï¼Œè¿™ç§æ–¹æ³•æœ‰è·¨åŸŸé—®é¢˜ 12345678910111213141516171819var xmlhttprequest = new XMLHttpRequest()xmlhttprequest.onreadystatechange = callbackxmlhttprequest.onprogress = progressCallbackxmlhttprequest.open(&#x27;GET&#x27;, &#x27;http://image.baidu.com/mouse.jpg&#x27;, true)xmlhttprequest.send()function callback () &#123; if (xmlhttprequest.readyState == 4 &amp;&amp; xmlhttprequest.status == 200 ) &#123; var reponseText = xmlhttprequest.responseText &#125;else&#123; console.log(&#x27;Request was unsuccessful:&#x27; + xmlhttprequest.status) &#125;&#125;function progressCallback (e) &#123; e = e || event if ( e.lengthComputable) console.log(`Receievd $&#123;e.loaded&#125; of $&#123;e.total&#125; bytes`)&#125; æ–¹æ³•å››ï¼Œä½¿ç”¨åº“ PreloadJS è¿›è¡Œé¢„åŠ è½½ 12345678910111213var queue = new createjs.LoadQueue(false)queue.on(&#x27;complete&#x27;, handleComplete, this)queue.loadManifest([ &#123;id: &#x27;myImg&#x27;, src:&#x27;http://pic26.nipic.com/20121213/6168183_004444903000_2.jpg&#x27;&#125;, &#123;id: &#x27;myImg2&#x27;, src:&#x27;http://pic9.nipic.com/20100814/2839526_193147158170_2.jpg&#x27;&#125;,])function handleComplete () &#123; var img = queue.getResult(&#x27;myImg&#x27;) document.body.appendChild(img)&#125; Server æœåŠ¡ç«¯ä¼˜åŒ–Use a Content Delivery Network (CDN) *CDNï¼Œå†…å®¹åˆ†å‘ç½‘ç»œï¼Œç”¨äºé™æ€èµ„æºçš„åŠ è½½ï¼Œé€‰æ‹©ç¦»ç”¨æˆ·è¿‘çš„æœåŠ¡å™¨èŠ‚ç‚¹ï¼ŒèŠ‚çœç‰©ç†ä¸Šçš„è·ç¦»ï¼Œè®©èµ„æºåˆ°è¾¾ç”¨æˆ·çš„ç‰©ç†è·ç¦»ç¼©çŸ­ é‚£ä¹ˆè¯·æ±‚CDNå†…å®¹æ—¶ï¼Œå¦‚æœè¯·æ±‚å¤´æºå¸¦cookieæ˜¯æ²¡ç”¨çš„ï¼Œæ‰€ä»¥è¯·æ±‚CDNæ—¶ï¼Œcookieæœ€å¥½å»æ‰ï¼ŒCDNçš„åŸŸåå¦‚æœå’Œä¸»ç«™åŸŸåä¸€æ ·ï¼Œå°±ä¼šæºå¸¦Cookieè¿‡å»ï¼Œæ‰€ä»¥æ‰¾CDNæ—¶æœ€å¥½ä¸è¦å’Œä¸»ç«™çš„åŸŸåä¸€æ · ä¾‹å¦‚æ·˜å®çš„é¡µé¢ï¼Œç›´æ¥åœ¨å¤´éƒ¨åŠ DNS scriptæ ‡ç­¾å³å¯ã€‚ 1&lt;link rel=&quot;dns-prefetch&quot; href=&quot;//g.alicdn.com&quot; /&gt; Add Expires or Cache-Control Header * There are two aspects to this rule: For static components: implement â€œNever expireâ€ policy by setting far future Expires &gt; header For dynamic components: use an appropriate Cache-Control header to help the browser &gt; with conditional requests é›…è™å»ºè®®å°† Expires å­—æ®µç”¨äºæ‰€æœ‰ç»„ä»¶ï¼Œä¸å•æ­¢äºå›¾ç‰‡ï¼š Expires headers are most often used with images, but they should be used on all components including scripts, stylesheets, and Flash components. é™æ€æ–‡ä»¶ï¼Œè¯·æ±‚å¤´å¯ä»¥è®¾ç½®æ°¸ä¸è¿‡æœŸæˆ–è€…æŠŠæ—¶é—´è®¾ç½®çš„é•¿ä¸€äº› 1234expires: never# orExpires: Thu, 15 Apr 2099 20:00:00 GMT å¯¹äºåŠ¨æ€ç»„ä»¶ï¼Œåˆ©ç”¨è¯·æ±‚å¤´çš„Cache-Control æ§åˆ¶ï¼Œä¾‹å¦‚ 1cache-control: max-age&#x3D;2592000 Cache-Controlçš„å€¼æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š no-cache ç›´æ¥è¦æœåŠ¡çš„æ–°å†…å®¹ï¼Œä¸æ‹¿ç¼“å­˜çš„no-store ä¸ç¼“å­˜è¯·æ±‚æˆ–å“åº”çš„ä»»ä½•å†…å®¹max-age å“åº”çš„æœ€å¤§Ageå€¼min-fresh æœŸæœ›åœ¨æŒ‡å®šæ—¶é—´å†…çš„å“åº”æ‰”æœ‰æ•ˆonly-if-chache ä»ç¼“å­˜è·å–èµ„æºmax-stale æ¥æ”¶å·²è¿‡æœŸå“åº”min-fresh æœŸæœ›åœ¨æŒ‡å®šæ—¶é—´å†…çš„å“åº”ä»æœ‰æ•ˆno-transform ä»£ç†ä¸å¯æ›´æ”¹åª’ä½“ç±»å‹cache-extension æ–°æŒ‡ä»¤æ ‡è®°ï¼ˆtokenï¼‰ å…¶ä¸­ï¼Œæœ€å¸¸ç”¨çš„æ˜¯ no-cacheï¼Œno-storeï¼Œmax-age 3ä¸ªå€¼ Gzip Components *ç½‘é¡µä¸­é‡å¤çš„å†…å®¹ï¼Œä¼šç”¨Gzipå‹ç¼©ï¼Œæ˜¾è‘—å‡å°‘æ–‡ä»¶å¤§å°ï¼Œåœ¨ Nginx é‡Œæœ‰Nigixé…ç½®Gzipçš„ä»‹ç» è¯·æ±‚å¤´ä¸­æ·»åŠ ï¼š 1Accept-Encoding: gzip, deflate ç›¸åº”å¤´ä¸­æ·»åŠ ï¼š 1Content-Encoding: gzip Configure ETags Entity tags (ETags) are a mechanism that web servers and browsers use to determine whether the component in the browserâ€™s cache matches the one on the origin server. ETags æ˜¯ä¸€ç§æœºåˆ¶ï¼Œç”¨æ¥ç¡®å®šæµè§ˆå™¨çš„ç¼“å­˜å†…å®¹å’ŒæœåŠ¡å™¨çš„æ˜¯å¦åŒ¹é…ï¼Œå¦‚åŒ¹é…ï¼Œåˆ™ç”¨æµè§ˆå™¨çš„å†…å®¹ï¼Œå¦‚ä¸åŒ¹é…ï¼Œåˆ™è¯·æ±‚æœåŠ¡å™¨æ–°çš„å†…å®¹ è¯·æ±‚æ—¶çš„å¤´éƒ¨å­—æ®µï¼š 12Last-Modified: Tue, 12 Dec 2006 03:03:59 GMTETag: &quot;10c24bc-4ab-457e1c1f&quot; å“åº”çš„å¤´éƒ¨å­—æ®µï¼š 123If-Modified-Since: Tue, 12 Dec 2006 03:03:59 GMTIf-None-Match: &quot;10c24bc-4ab-457e1c1f&quot;HTTP/1.1 304 Not Modified Browser Storage * æµè§ˆå™¨å­˜å‚¨ä¼˜åŒ–Reduce Cookie Size * Eliminate unnecessary cookiesKeep cookie sizes as low as possible to minimize the impact on the user response &gt; timeBe mindful of setting cookies at the appropriate domain level so other &gt; sub-domains are not affectedSet an Expires date appropriately. An earlier Expires date or none removes the cookie sooner, improving the user response time Cookieæ˜¯è¯·æ±‚å¤´çš„ä¸€ä¸ªå­—æ®µï¼Œå¦‚æœå­˜å‚¨çš„ä¿¡æ¯è¿‡å¤šè¿‡å¤§ï¼Œå¿…ç„¶ä¼šå½±å“æ€§èƒ½ï¼Œå‡å°‘Cookieä½“ç§¯å¤§å°ï¼Œåªå­˜å‚¨ç”¨æˆ·idç­‰ç®€å•ä¿¡æ¯ è®¾ç½®åˆé€‚çš„ expire å­—æ®µè®©cookieè¿‡æœŸ è®¾ç½®cookieæ—¶ï¼Œåº”æ³¨æ„è®¾ç½®å¤´éƒ¨å­—æ®µ Set-Cookieï¼šhttponlyï¼Œåªå…è®¸httpé€šä¿¡ï¼Œè¿™æ ·æ‰ä¸ä¼šè¢«jsç¯¡æ”¹ cookieç”±äºæ˜¯ç§åœ¨åŸŸåä¸‹çš„ï¼Œè¯·æ±‚å¤´çš„ä¸€ä¸ªå­—æ®µï¼Œæ‰€ä»¥å•ç‹¬å¸¦åœ¨åŸŸåä¸­ä¼šé€ æˆCDNçš„æµé‡äº§ç”Ÿä¸å¿…è¦çš„æŸè€—ï¼Œè§£å†³æ–¹æ³•æ˜¯ CDNåŸŸåå’Œä¸»ç«™åŸŸåç‹¬ç«‹å¼€æ¥ LocalStorage * HTML5ä¸“é—¨è®¾è®¡å‡ºæ¥ç”¨äºæµè§ˆå™¨å­˜å‚¨çš„ å¤§å°ä¸º5Mbå·¦å³ï¼Œæ¯”cookieçš„4kbå¤§å¾ˆå¤š ä¸è¿›è¡Œé€šä¿¡ æ¥å£å°è£…ç›¸è¾ƒäºcookieè¾ƒå¥½ æµè§ˆå™¨æœ¬åœ°ç¼“å­˜æ–¹æ¡ˆ SessionStorage * ä¼šè¯çº§åˆ«çš„æµè§ˆå™¨å­˜å‚¨ å¤§å°5Må·¦å³ ä¸è¿›è¡Œé€šä¿¡ æ¥å£å°è£…ç›¸ å¯¹äºè¡¨å•ä¿¡æ¯çš„ç»´æŠ¤ï¼Œå…³é—­æµè§ˆå™¨çš„æ ‡ç­¾é¡µï¼ŒSessionStorageä¼šè‡ªåŠ¨æ¸…ç©ºä¼˜åŒ–ç‚¹ï¼š ä¾‹å¦‚ç”¨æˆ·æ³¨å†Œé¡µé¢ï¼Œéœ€è¦å¡«å†™å¾ˆå¤šä¸œè¥¿ï¼Œå¦‚æœç”¨æˆ·è¿˜æ²¡æäº¤ä½†åˆ·æ–°äº†è¯¥é¡µé¢ï¼Œç”¨æˆ·ä½“éªŒä¼šä¸å¥½ è€Œæ­¤æ—¶å¯å°†ç”¨æˆ·æ‰€å¡«çš„ä¿¡æ¯å­˜å‚¨åˆ°SessionStorageé‡Œï¼Œç”¨æˆ·åˆ·æ–°é¡µé¢æ—¶ï¼Œæ‰€å¡«å†™çš„ä¸œè¥¿ä¹Ÿä¸ä¼šæ¸…ç©ºã€‚ IndexDB æ˜¯ä¸€ç§ä½çº§APIï¼Œç”¨äºå®¢æˆ·ç«¯å­˜å‚¨å¤§é‡ç»“æ„åŒ–æ•°æ®ã€‚è¯´ç™½äº†ï¼Œå°±æ˜¯æµè§ˆå™¨çš„æ•°æ®åº“ ä½¿ç”¨çš„ç½‘ç«™è¾ƒå°‘ Service Worker * Service Worker æ˜¯è¿è¡Œåœ¨æµè§ˆå™¨èƒŒåçš„ç‹¬ç«‹çº¿ç¨‹ï¼Œä¸€èˆ¬å¯ä»¥ç”¨æ¥å®ç°ç¼“å­˜åŠŸèƒ½ã€‚ ä½¿ç”¨ Service Workerçš„è¯ï¼Œä¼ è¾“åè®®å¿…é¡»ä¸º HTTPSã€‚å› ä¸º Service Worker æœ‰æ‹¦æˆªå’Œå¤„ç†ç½‘ç»œè¯·æ±‚çš„èƒ½åŠ›ï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨ HTTPS åè®®æ¥ä¿éšœå®‰å…¨ã€‚ ç®€å•ç‚¹è¯´ï¼Œå°±æ˜¯ç¼“å­˜jsæ–‡ä»¶åˆ°æµè§ˆå™¨é‡Œï¼Œè®©å®¢æˆ·ç«¯æœ‰å¤§é‡å¤„ç†jsçš„èƒ½åŠ›ã€‚ ä¾‹å¦‚ï¼Œç°åœ¨çš„Three.js æˆ– WebGLå¯ä»¥ç”¨äº3Dçš„æ¸²æŸ“ï¼Œä½†3Då›¾çš„jsè„šæœ¬åŠæ•°æ®å ç”¨èµ„æºæ¯”è¾ƒå¤šï¼Œä¸€ä¸ªè„šæœ¬å¯è¾¾å‡ Mbï¼Œå¯ä»¥ç”¨Service Workerå°†å…¶ç¼“å­˜èµ·æ¥æ‰§è¡Œã€‚ åˆ©ç”¨æ‹¦æˆªå’Œå¤„ç†ç½‘ç»œè¯·æ±‚çš„èƒ½åŠ›ï¼Œå¯ä»¥å®ç°ç¦»çº¿åº”ç”¨åŠŸèƒ½ã€‚ æ£€æŸ¥å·¥å…·ï¼šåœ¨chromeæµè§ˆå™¨è¾“å…¥chrome://serviceworker-internals/ æ£€æŸ¥æ‰€æœ‰ service worker chrome://inspect/#service-workers æ£€æŸ¥æ­£åœ¨è¿è¡Œçš„ service worker Progressive Web Apps æ¸è¿›å¼ Web åº”ç”¨ PWA æ ‡å‡†ç”± è°·æ­Œæå‡ºçš„ç§»åŠ¨ç«¯çš„æ ‡å‡†ã€‚ä¾‹å¦‚ï¼Œåœ¨ç§»åŠ¨ç«¯çš„å¼±ç½‘ç¯å¢ƒä¸‹ï¼Œä½ ç«™ç‚¹çš„åŠ è½½é€Ÿåº¦ã€‚ç¦»çº¿ç¯å¢ƒä¸‹ï¼Œèƒ½ä¸èƒ½æœ‰åŸºæœ¬çš„é¡µé¢è®¿é—® å¯é ï¼šåœ¨æ²¡æœ‰ç½‘ç»œç¯å¢ƒä¸­ä¹Ÿèƒ½æä¾›åŸºæœ¬çš„é¡µé¢è®¿é—® å¿«é€Ÿï¼šå› ä¸ºWeb Appæ˜¯ä¸€ä¸ªå¢é‡åŠ è½½çš„è¿‡ç¨‹ï¼Œä¸åŒäºiOSæˆ–è€…å®‰å“çš„åŸç”Ÿå¼€å‘ï¼ŒWeb AppåŠ è½½å¿…å—åˆ°ç½‘ç»œæ¡ä»¶çš„åˆ¶çº¦ èå…¥ï¼ˆEngagingï¼‰ï¼šå°†å…¶èƒ½åŠ›å¯¹æ ‡åŸç”ŸAPPï¼Œåº”ç”¨å¯ä»¥è¢«æ·»åŠ åˆ°æ‰‹æœºæ¡Œé¢ï¼Œå¹¶å’Œæ™®é€šåº”ç”¨ä¸€æ ·æœ‰å…¨å±ï¼Œæ¨é€ç­‰ç‰¹æ€§ CSSCSSæ˜¯å­˜åœ¨CSSé˜»å¡çš„ï¼Œ css å¦‚æœåœ¨ head ä¸­ä»¥ link æ–¹å¼å¼•å…¥ä¼šé˜»å¡é¡µé¢çš„æ¸²æŸ“ css é˜»å¡jsçš„æ‰§è¡Œ ä½† css ä¸é˜»å¡å¤–éƒ¨è„šæœ¬çš„åŠ è½½ Put Stylesheets at Top * While researching performance at Yahoo!, we discovered that moving stylesheets to the document HEAD makes pages appear to be loading faster. This is because putting stylesheets in the HEAD allows the page to render progressively. å°†æ ·å¼è¡¨æ”¾åœ¨å¤´éƒ¨ï¼Œå¯ä»¥è®©é¡µé¢é€æ­¥å‘ˆç° Choose &lt;link&gt; Over @import In IE @import behaves the same as using at the bottom of the page, so itâ€™s best not to use it. åœ¨IEæµè§ˆå™¨ä¸­ @import å’Œ &lt;link&gt; æ˜¯ä¸€æ ·çš„ï¼Œä½äºåº•éƒ¨æ‰§è¡Œï¼Œè¿™å’Œæˆ‘ä»¬æ¨èçš„CSSæ”¾åœ¨HEADä¸­æ‰§è¡ŒèƒŒé“è€Œé©°ï¼Œæ‰€ä»¥å°‘ç”¨ @import JavaScriptJS é˜»å¡ ç›´æ¥å¼•å…¥jsé˜»å¡é¡µé¢çš„æ¸²æŸ“ï¼Œæ‰€ä»¥æ‰æœ‰åé¢ jsä¸é˜»å¡èµ„æºåŠ è½½ jsæŒ‰é¡ºåºæ‰§è¡Œï¼Œé˜»å¡åç»­jsé€»è¾‘æ‰§è¡Œ Put Scripts at Bottom * The problem caused by scripts is that they block parallel downloads. While a script is downloading, however, the browser wonâ€™t start any other downloads, even on different hostnames. JSçš„åŠ è½½æœ¬èº«å°±æ˜¯ä¸€ç§é˜»å¡ï¼Œæ‰€ä»¥å°½é‡è®©HTML+CSSå…ˆæŠŠé¡µé¢æ¸²æŸ“å‡ºæ¥ï¼Œå†æ‰§è¡Œ åº•éƒ¨çš„&lt;script&gt;&lt;/script&gt; æ ‡ç­¾ 1234567891011&lt;!DOCTYPE HTML&gt;&lt;html&gt; &lt;head&gt; &lt;title&gt; &lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div&gt;&lt;/div&gt; &lt;script type=&quot;text/javascript&quot; src=&quot;&quot;&gt;&lt;/script&gt; &lt;/body&gt;&lt;/html&gt; Make JavaScript and CSS External if the JavaScript and CSS are in external files cached by the browser, the size of the HTML document is reduced without increasing the number of HTTP requests. (é™¤äº†ä¸»é¡µ) ä½¿ç”¨CSSæˆ–JSçš„å¤–éƒ¨é“¾æ¥ï¼Œæµè§ˆå™¨ä¼šç¼“å­˜ JavaScript å’Œ CSS æ–‡ä»¶ï¼Œè€Œä¸ä¼šå¢åŠ  HTTP è¯·æ±‚æ•°ã€‚ 12&lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/xxx.min.css&quot;&gt;&lt;script nonce=&quot;b3/zKeoFCfru0lTFQr8Dyg==&quot; src=&quot;https://s.yimg.com/ss/rapid-3.41.3.js&quot;&gt;&lt;/script&gt; Minify JavaScript and CSS * Minification is the practice of removing unnecessary characters from code to reduce its size thereby improving load times. æœ€å°åŒ– JS å’Œ CSSï¼Œç°åœ¨æˆ‘ä»¬å¤šç”¨ webpackç­‰æ‰“åŒ…å·¥å…·æ¥åšåˆ°è¿™ä¸€æ­¥ Minimize DOM Access * Accessing DOM elements with JavaScript is slow so in order to have a more responsive page, you should: Cache references to accessed elements Update nodes â€œofflineâ€ and then add them to the tree Avoid fixing layout with JavaScript æœ€å°åŒ–DOMè®¿é—®ï¼Œå°½å¯èƒ½å°‘çš„è¿›è¡ŒDOMæ“ä½œï¼Œè¿™ç‚¹å¯ä»¥ä»ç°åœ¨çš„React Vueç­‰MVVMæ¡†æ¶ä½“ç°å‡ºæ¥ æ¸²æŸ“ä¼˜åŒ–preload/prefetch dns-prefetchpreload/prefetch å¯æ§åˆ¶ HTTP ä¼˜å…ˆçº§ï¼Œä»è€Œè¾¾åˆ°å…³é”®è¯·æ±‚æ›´å¿«å“åº”çš„ç›®çš„ã€‚ å¦‚å½“é¡µé¢å‡ºç° Linkï¼Œå¯ prefetch å½“å‰ Link çš„è·¯ç”±èµ„æºã€‚ 12&lt;link rel=&quot;prefetch&quot; href=&quot;style.css&quot; as=&quot;style&quot;&gt;&lt;link rel=&quot;preload&quot; href=&quot;main.js&quot; as=&quot;script&quot;&gt; 1&lt;link rel=&quot;dns-prefetch&quot; href=&quot;//shanyue.tech&quot;&gt; é˜²æŠ–ä¸èŠ‚æµ é˜²æŠ–ï¼šé˜²æ­¢æŠ–åŠ¨ï¼Œå•ä½æ—¶é—´å†…äº‹ä»¶è§¦å‘ä¼šè¢«é‡ç½®ï¼Œé¿å…äº‹ä»¶è¢«è¯¯ä¼¤è§¦å‘å¤šæ¬¡ã€‚ä»£ç å®ç°é‡åœ¨æ¸…é›¶ clearTimeoutã€‚é˜²æŠ–å¯ä»¥æ¯”ä½œç­‰ç”µæ¢¯ï¼Œåªè¦æœ‰ä¸€ä¸ªäººè¿›æ¥ï¼Œå°±éœ€è¦å†ç­‰ä¸€ä¼šå„¿ã€‚ä¸šåŠ¡åœºæ™¯æœ‰é¿å…ç™»å½•æŒ‰é’®å¤šæ¬¡ç‚¹å‡»çš„é‡å¤æäº¤ã€‚ èŠ‚æµï¼šæ§åˆ¶æµé‡ï¼Œå•ä½æ—¶é—´å†…äº‹ä»¶åªèƒ½è§¦å‘ä¸€æ¬¡ï¼Œä¸æœåŠ¡å™¨ç«¯çš„é™æµ (Rate Limit) ç±»ä¼¼ã€‚ä»£ç å®ç°é‡åœ¨å¼€é”å…³é” timer=timeout; timer=nullã€‚èŠ‚æµå¯ä»¥æ¯”ä½œè¿‡çº¢ç»¿ç¯ï¼Œæ¯ç­‰ä¸€ä¸ªçº¢ç¯æ—¶é—´å°±å¯ä»¥è¿‡ä¸€æ‰¹ã€‚ æ— è®ºæ˜¯é˜²æŠ–è¿˜æ˜¯èŠ‚æµéƒ½å¯ä»¥å¤§å¹…åº¦å‡å°‘æ¸²æŸ“æ¬¡æ•°ï¼Œåœ¨ React ä¸­è¿˜å¯ä»¥ä½¿ç”¨ use-debounce ä¹‹ç±»çš„ hooks é¿å…é‡æ–°æ¸²æŸ“ã€‚ 123456789101112131415161718192021import React, &#123; useState &#125; from &#x27;react&#x27;;import &#123; useDebounce &#125; from &#x27;use-debounce&#x27;;export default function Input() &#123; const [text, setText] = useState(&#x27;Hello&#x27;); // ä¸€ç§’é’Ÿæ¸²æŸ“ä¸€æ¬¡ï¼Œå¤§å¤§é™ä½äº†é‡æ–°æ¸²æŸ“çš„é¢‘ç‡ const [value] = useDebounce(text, 1000); return ( &lt;div&gt; &lt;input defaultValue=&#123;&#x27;Hello&#x27;&#125; onChange=&#123;(e) =&gt; &#123; setText(e.target.value); &#125;&#125; /&gt; &lt;p&gt;Actual value: &#123;text&#125;&lt;/p&gt; &lt;p&gt;Debounce value: &#123;value&#125;&lt;/p&gt; &lt;/div&gt; );&#125; è™šæ‹Ÿåˆ—è¡¨ä¼˜åŒ–è¿™åˆæ˜¯ä¸€ä¸ªè€ç”Ÿå¸¸è°ˆçš„è¯é¢˜ï¼Œä¸€èˆ¬åœ¨è§†å£å†…ç»´æŠ¤ä¸€ä¸ªè™šæ‹Ÿåˆ—è¡¨(ä»…æ¸²æŸ“åå‡ æ¡æ¡æ•°æ®å·¦å³)ï¼Œç›‘å¬è§†å£ä½ç½®å˜åŒ–ï¼Œä»è€Œå¯¹è§†å£å†…çš„è™šæ‹Ÿåˆ—è¡¨è¿›è¡Œæ§åˆ¶ã€‚ åœ¨ Reactä¸­å¯ä»¥ç”¨ä¸‹åˆ—åº“ react-virtualized react-window","tags":["é¢è¯•","Webæ€§èƒ½ä¼˜åŒ–"]},{"title":"åˆ›å»ºè‡ªå·±çš„node cli","path":"/2021/10/17/ã€2021-10-17ã€‘åˆ›å»ºè‡ªå·±çš„node-cli/","content":"ç»å¸¸ä½¿ç”¨create-react-appä½œä¸ºå‘½ä»¤è¡Œç”Ÿæˆé¡¹ç›®ï¼Œæ€»æƒ³ç€è‡ªå·±èƒ½é…ç½®ä¸€ä¸ªå±äºè‡ªå·±çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¾ˆé…·ç‚«çš„æ ·å­ã€‚æœ€è¿‘æœ‰æ—¶é—´ï¼Œç»ˆäºæ¥å®ç°äº† åˆå§‹åŒ–é¡¹ç›®12mkdir y-cli &amp;&amp; cd y-clinpm init -y æ ¸å¿ƒæ­¥éª¤ npm linkæ–°å»ºä¸€ä¸ªæ–‡ä»¶ ./bin/yyt.jsï¼Œå¹¶å†™ä¸€ç‚¹ç®€å•çš„ä¸œè¥¿ 1234// è¿™é‡Œå‘Šè¯‰ç³»ç»Ÿè¦ä»¥nodeç¯å¢ƒæ‰§è¡Œï¼š#!/usr/bin/env nodeconsole.log(&#x27;hello,node cli!&#x27;) å†åœ¨ package.json é‡Œæ·»åŠ  bin é…ç½®ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰å‘½ä»¤ï¼Œå¦‚ y-cli 123&quot;bin&quot;: &#123; &quot;y-cli&quot;: &quot;./bin/yyt.js&quot;&#125; åœ¨å‘½ä»¤è¡Œé‡Œè¿è¡Œï¼š 123npm link# æˆ–è€…åœ¨å…¨å±€installï¼šnpm install . -g å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ï¼Œnpmå°†å‘½ä»¤ä½œä¸ºè½¯é“¾æ¥è¿æ¥è‡³å¯¹åº”çš„jsæ–‡ä»¶ 123456789xxx@xxxMBP y-cli % sudo npm linknpm WARN y-cli@1.0.0 No descriptionnpm WARN y-cli@1.0.0 No repository field.up to date in 0.832sfound 0 vulnerabilities/usr/local/bin/yyt -&gt; /usr/local/lib/node_modules/y-cli/bin/yyt.js/usr/local/lib/node_modules/y-cli -&gt; /Users/xxx/Documents/code/y-cli æ‰€ç”¨åˆ°çš„åº“cliéœ€è¦è·å–ç”¨æˆ·çš„è¾“å…¥ï¼Œé€‰æ‹©å¹¶åšç›¸åº”çš„äº‹æƒ…ï¼Œå°±éœ€è¦ä½¿ç”¨åˆ°ä¸€äº›åº“æ¥å¸®å¿™æˆ‘ä»¬æ›´æ–¹ä¾¿çš„å†™cli æ ¸å¿ƒï¼š commander - å¤„ç†æ ¸å¿ƒå‘½ä»¤ ä¸»è¦æ¨¡å—ï¼Œåœ¨ç»ˆç«¯è¾“å‡ºå„ç§ä¿¡æ¯å…¨é è¿™ä¸ªæ¨¡å— download-git-repo - ä¸‹è½½gitæ¨¡å— ç¾åŒ–ï¼š chalk â€” ç¾åŒ–ç»ˆç«¯å­—ç¬¦æ˜¾ç¤º figlet â€” åœ¨ç»ˆç«¯è¾“å‡ºå¤§å‹å­—ç¬¦ inquirer â€” å‘½ä»¤è¡Œå‚æ•°è¾“å…¥äº¤äº’ shelljs â€” åœ¨jsæ–‡ä»¶å†™å‘½ä»¤è¡Œ ora - å®è¡Œloadingæ•ˆæœ è®©æˆ‘ä»¬æ¥æŠŠè¿™äº›åº“å…¨éƒ¨å®‰è£…ä¸€é commanderæ ¹æ®commanderæ–‡æ¡£çš„ä¸€äº›å‚æ•°ï¼Œæˆ‘ä»¬æ¥ç¼–å†™è„šæœ¬ yyt.js 12345678#!/usr/bin/env nodeconst program = require(&#x27;commander&#x27;)// è·å–package.jsonä¸­çš„ç‰ˆæœ¬ä¿¡æ¯program.version(require(&quot;../package.json&quot;).version)// è§£ææŒ‡ä»¤ï¼Œè¿™ç‚¹å¾ˆé‡è¦ ä¸è§£ææŒ‡ä»¤åˆ™æ— æ•ˆprogram.parse(process.argv) commanderè‡ªå¸¦ -V å’Œ -h ä¸¤ä¸ªå‘½ä»¤ï¼Œè¿è¡Œ yyt -hå¯çœ‹åˆ°ï¼š 123456xxx@xxxdeMacBook-Pro y-cli % yyt -hUsage: yyt [options]Options: -V, --version output the version number -h, --help display help for command .option() åŠ å…¥è‡ªå®šä¹‰å‘½ä»¤ 1program.option(&#x27;-d, --description&#x27;, &#x27;yyt è„šæ‰‹æ¶ç®€ä»‹ï¼šã€‚ã€‚ã€‚ã€‚&#x27;) å¯ä»¥å‘ç°å·²ç»åŠ ä¸Šè¯¥å‘½ä»¤ï¼š 1234567xxx@xxxdeMacBook-Pro y-cli % yyt -hUsage: yyt [options]Options: -V, --version output the version number -d, --description yyt è„šæ‰‹æ¶ç®€ä»‹ï¼šã€‚ã€‚ã€‚ã€‚ -h, --help display help for command .command() è‡ªå®šä¹‰å‘½ä»¤ï¼Œ åŸºç¡€æ ¼å¼ï¼š 1program.option(&#39;hello &lt;param1&gt; [param2]&#39;) å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå°–æ‹¬å·&lt;&gt;é‡Œçš„å‚æ•°æ˜¯å¿…å¡«å‚æ•°ï¼Œæ–¹æ‹¬å·[]é‡Œçš„å‚æ•°æ˜¯å¯é€‰å‚æ•° åˆ©ç”¨.command()å†™ä¸€ä¸ªç®€å•çš„demoï¼Œå¼„æ¸…æ•´ä¸ªåŸºç¡€æµç¨‹ï¼š 123456789program\t.command(&#x27;hello &lt;param1&gt; [param2]&#x27;) // å‘½ä»¤é‡Œåˆ©ç”¨.usage()å‚æ•°åŒ–ï¼Œä¾›åé¢çš„.action()å›è°ƒä½¿ç”¨ï¼š\t.usage(&#x27;&lt;command&gt; &lt;param1&gt; [param2]&#x27;) // å›è°ƒå¤„ç†ï¼š\t.action((param1, param2)=&gt;&#123; console.log(param1); console.log(param2);\t&#125;) 12345678ziyouzhiyi@ziyouzhiyideMacBook-Pro y-cli % yyt helloerror: missing required argument &#x27;param1&#x27;ziyouzhiyi@ziyouzhiyideMacBook-Pro y-cli % yyt hello t tundefinedziyouzhiyi@ziyouzhiyideMacBook-Pro y-cli % yyt hello t yty ä¸Šé¢è¿™äº›å‚æ•°ä¹Ÿå¯é€šè¿‡.option()æ¥å®ç°ï¼Œä½†éœ€è¦åŠ ä¸Š-ï¼Œå¦‚-reactï¼Œå¦‚ä»¥ä¸‹çš„ä¾‹å­ï¼Œåˆ©ç”¨å‚æ•°åˆ›å»ºé¡¹ç›®ï¼š 12345678910111213141516program.command(&#x27;create &lt;projectName&gt;&#x27;)\t.option(&#x27;-react&#x27;)\t.option(&#x27;-vue&#x27;)\t.action((projectName, option) =&gt; &#123; const type = Object.keys(option)[0] switch(type) &#123; case &quot;Vue&quot;: console.log(&quot;åˆ›å»ºvueé¡¹ç›®&quot;) break; case &quot;React&quot;: console.log(&quot;åˆ›å»ºreacté¡¹ç›®&quot;) break; default: console.log(&quot;æœªæ·»åŠ å‚æ•°ï¼Œä¸èƒ½ä¸‹è½½&quot;) &#125;\t&#125;) æ‰§è¡Œå‘½ä»¤åå¯ä»¥çœ‹åˆ°æ‰“å°ï¼š 12ziyouzhiyi@ziyouzhiyideMacBook-Pro y-cli % yyt create test -reactåˆ›å»ºreacté¡¹ç›® download-git-repoä¸‹è½½çš„æ­¥éª¤æŠŠä»–æ›¿æ¢æˆçœŸçš„ä»“åº“ï¼Œéœ€è¦ç”¨åˆ° download-git-repo åº“ æŠŠconsole.logæ›¿æ¢æˆçœŸå®çš„gitä»“åº“ 1234567891011121314151617... case &quot;React&quot;: download( // æ­¤å¤„åº”åŠ ä¸Š #main åˆ†æ”¯åç§°ï¼Œå¦åˆ™æ§åˆ¶å°ä¼šæ˜¾ç¤ºæŠ¥é”™ &#x27;direct:git@github.com:ys558/yyt-template.git#main&#x27;, projectName, &#123; clone: true &#125;, (err, x) =&gt; &#123; // é”™è¯¯å›è°ƒï¼š if (err) console.log(err) console.log(`$&#123;projectName&#125; é¡¹ç›®åˆ›å»ºæˆåŠŸ`) &#125; ) break; default: console.log(&quot;æœªæ·»åŠ å‚æ•°ï¼Œä¸èƒ½ä¸‹è½½&quot;)... inquirerğŸ‘†çš„æ­¥éª¤ä¸‹è½½çš„ä»“åº“æ˜¯åœ¨å‘½ä»¤è¡Œä¸‹ç›´æ¥å®Œæˆçš„ï¼Œå¦‚æœè¦åƒvueä¸€æ ·èƒ½è®©ç”¨æˆ·è¾“å…¥ç”Ÿæˆçš„ï¼Œå¯ä»¥ç”¨è¯¥åº“ï¼Œæˆ‘ä»¬æŠŠä»£ç æ”¹é€ ä¸€ä¸‹ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨ .action() çš„å›è°ƒä¸­è¿›è¡Œå¤„ç† 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556const questions = [\t&#123; type: &#x27;input&#x27;, name: &#x27;projectName&#x27;, message: &#x27;è¯·è¾“å…¥é¡¹ç›®åç§°&#x27;,\t&#125;,\t&#123; type: &#x27;list&#x27;, name: &#x27;frameWork&#x27;, message: &#x27;è¯·é€‰æ‹©æ¡†æ¶&#x27;, default: &#x27;React&#x27;, choices: [&#x27;React&#x27;,&#x27;Vue&#x27;]\t&#125;,]program\t.command(&#x27;create&#x27;)\t.action(() =&gt; &#123; inquirer.prompt(questions) .then((&#123;projectName, frameWork&#125;) =&gt; &#123; switch (frameWork) &#123; case &#x27;React&#x27;: download( &#x27;direct:git@github.com:ys558/yyt-template.git&#x27;, projectName, &#123; clone: true &#125;, (err) =&gt; &#123; // é”™è¯¯å›è°ƒï¼š if (err) &#123; console.log(err) return &#125;else&#123; console.log(`$&#123;projectName&#125; é¡¹ç›®åˆ›å»ºæˆåŠŸ`) &#125; &#125;) break; case &#x27;Vue&#x27;: download( &#x27;direct:git@github.com:ys558/yyt-template.git&#x27;, projectName, &#123; clone: true &#125;, (err) =&gt; &#123; // é”™è¯¯å›è°ƒï¼š if (err) &#123; console.log(err) return &#125;else&#123; console.log(`$&#123;projectName&#125; é¡¹ç›®åˆ›å»ºæˆåŠŸ`) &#125; &#125;) break; default: break; &#125; &#125;)\t&#125;) ç¾åŒ–chalkï¼Œfigletç¾åŒ–ç»ˆç«¯å­—ä½“ï¼Œå¦‚ chalk: 123456if (err) &#123;\tconsole.log(chalk.bgYellow(err))\treturn&#125;else&#123;\tconsole.log(`$&#123;chalk.bgGrey(projectName)&#125; $&#123;chalk.greenBright(&#x27;é¡¹ç›®åˆ›å»ºæˆåŠŸ&#x27;)&#125;`)&#125; figlet: 1234figlet.defaults(&#123;font: &#x27;Standard&#x27;&#125;)function logo()&#123;\tconsole.log(figlet.textSync(&#x27;hi yyt!&#x27;))&#125; oraè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒéº»çƒ¦çš„æ¨¡å—ï¼Œä»–æ˜¯ es module ç±»å‹çš„importå¯¼å…¥æ¨¡å—ï¼Œè€Œ node ç”¨çš„æ˜¯commonjs çš„ require å¯¼å…¥æ¨¡å—ï¼Œè€Œä¸”é¡»åœ¨ package.json é‡Œæ·»åŠ  &#123; &quot;type&quot; : &quot;module&quot; &#125; æ‰èƒ½æ­£å¸¸åŠ è½½ï¼Œä¸‹é¢è´´ä¸Šç›¸å…³ä»£ç ï¼š 123456const spinner = ora(&quot;ä¸‹è½½åˆå§‹åŒ–æ¨¡æ¿ä¸­...&quot;)spinner.start()spinner.succeed(`$&#123;chalk.bgGrey(projectName)&#125; $&#123;chalk.greenBright(&#x27;é¡¹ç›®åˆ›å»ºæˆåŠŸ&#x27;)&#125;`)spinner.stop() å®Œæ•´ä»£ç ä»“åº“","tags":["node cli"]},{"title":"react-ssræœåŠ¡ç«¯æ¸²æŸ“","path":"/2021/08/27/ã€2021-08-27ã€‘react-ssræœåŠ¡ç«¯æ¸²æŸ“/","content":"æœåŠ¡ç«¯æ¸²æŸ“èƒ½è§£å†³é¦–å±åŠ è½½è¿‡æ…¢çš„é—®é¢˜ï¼Œè¿‘å¹´æ¥è¿™æ˜¯ä¸€ä¸ªè¶‹åŠ¿ï¼Œè¿™é‡Œå†™ä¸€ä¸ªreactçš„demoï¼Œä»¥å…å¿˜äº†ã€‚ æœ¬æ–‡æ¶‰åŠçš„ react apiå¦‚ä¸‹ï¼š ReactDOM.hydrate(&lt;App /&gt;,document.getElementById(&#39;root&#39;) ReactDOMServer.renderToString(&lt;App/&gt;) ç”¨è„šæ‰‹æ¶åˆå§‹åŒ–é¡¹ç›®è¿™éƒ¨åˆ†ä¸è§£é‡Šï¼Œç”¨è„šæ‰‹æ¶å¿«é€Ÿç”Ÿæˆä¸€ä¸ªapp ï¼æ³¨æ„: create-react-app æ–°ç‰ˆæœ¬ç”Ÿæˆçš„ App.js å·²ç»æ²¡æœ‰ import React from &#39;react&#39;ï¼Œæˆ‘ä»¬å¿…é¡»æŠŠå®ƒåŠ å›æ¥ï¼Œå¦åˆ™æœåŠ¡ç«¯æ¸²æŸ“ä¼šæŠ¥é”™ï¼š 123456789101112131415+ import React from &#x27;react&#x27;import &#123; useState &#125; from &#x27;react&#x27;;import &#x27;./App.css&#x27;;function App() &#123; const [count, setCount] = useState(0) return &lt;div className=&quot;App&quot;&gt; &lt;p&gt;&#123;count&#125;&lt;/p&gt; &lt;button onClick=&#123;()=&gt; setCount(count + 1 )&#125;&gt;+&lt;/button&gt; &lt;button onClick=&#123;()=&gt; setCount(count-1)&#125;&gt;-&lt;/button&gt; &lt;/div&gt;&#125;export default App; æ·»åŠ æœåŠ¡ç«¯1234yarn add express# é¦–é¡µé¡»è¿›è¡Œæ‰“åŒ…æ“ä½œç»™æœåŠ¡ç«¯åšæ¸²æŸ“ï¼šyarn buildmkdir server &amp;&amp; cd server &amp;&amp; touch server.js server\\server.js 1234567891011121314151617181920212223242526272829import express from &#x27;express&#x27;import fs from &#x27;fs&#x27;import path from &#x27;path&#x27;import React from &#x27;react&#x27;import ReactDOMServer from &#x27;react-dom/server&#x27;import App from &#x27;../src/App&#x27;const app = express()app.use(&#x27;^/$&#x27;, (req, res, next) =&gt;&#123; fs.readFile(path.resolve(&#x27;../build/index.html&#x27;), &#x27;utf-8&#x27;, (err, data) =&gt; &#123; if (err) &#123; console.log(err) return res.status(500).send(&#x27;smoe error happened&#x27;) &#125; return res.send(data.replace( &#x27;&lt;div id=&quot;root&quot;&gt;&lt;/div&gt;&#x27;, `&lt;div id=&quot;root&quot;&gt;$&#123;ReactDOMServer.renderToString(&lt;App/&gt;)&#125;&lt;/div&gt;` )) &#125; )&#125;)app.use(express.static(path.resolve(__dirname, &#x27;..&#x27;, &#x27;build&#x27;)))const PORT = 8888app.listen(PORT, ()=&gt;console.log(`listen on PORT $&#123;PORT&#125;`)) æŠŠ express è·‘èµ·æ¥ src\\index.js æ”¹é€ 12- ReactDOM.render(&lt;App /&gt;,document.getElementById(&#x27;root&#x27;))+ ReactDOM.hydrate(&lt;App /&gt;,document.getElementById(&#x27;root&#x27;) æ·»åŠ  babel è®©nodeè®¤è¯†jsxè¯­æ³•1yarn add @babel/preset-env @babel/preset-react @babel/register ignore-styles åœ¨ server æ–‡ä»¶å¤¹æ·»åŠ è¿è¡Œ babel æœºåˆ¶æ‰§è¡Œtouch server/index.js nodeåŸç”Ÿçš„å¿…é¡»ç”¨ require çš„å†™æ³•å¯¼å…¥æ¨¡å—ï¼Œå¦‚ä¸‹ï¼š 12345678require(&#x27;ignore-styles&#x27;)require(&#x27;@babel/register&#x27;)(&#123; ignore: [/(node_module)/], presets: [&#x27;@babel/preset-env&#x27;, &#x27;@babel/preset-react&#x27;]&#125;)require(&#x27;./server&#x27;) æ·»åŠ  package.json é‡Œçš„è„šæœ¬åå†è¿è¡Œ yarn ssr 1&quot;ssr&quot;: &quot;node server/index.js&quot; æˆ‘ä»¬ä¼šå‘ç°é¡ºåˆ©è§£æäº† jsx è¯­æ³•ï¼š 12345yuyi@home-pc MINGW64 /e/study/code/react-ssr-demo (main)$ yarn ssryarn run v1.22.10$ node server/index.jslisten on PORT 8888","tags":["react","ssr"]},{"title":"nodeå¤„ç†ES6æ¨¡å—åŠåŠ¨æ€æ¨¡å—å¯¼å…¥","path":"/2021/08/14/ã€2021-08-14ã€‘nodeå¤„ç†ES6æ¨¡å—åŠåŠ¨æ€æ¨¡å—å¯¼å…¥/","content":"æœ¬æ–‡é˜è¿°äº†ä¸¤ä¸ªæ–¹é¢çš„å†…å®¹ã€‚1. nodeå¤„ç†ES6æ¨¡å—ï¼Œå¤§éƒ¨åˆ†å‚è€ƒäº†é˜®ä¸€å³°è€å¸ˆçš„æ–‡ç«  2. åŠ¨æ€æ¨¡å—å¯¼å…¥ nodeï¼ˆCJSï¼‰å¤„ç†ES6æ¨¡å—ï¼ˆESMï¼‰æˆ‘ä»¬çŸ¥é“nodeåªèƒ½é€šè¿‡ require() åŠ è½½æ¨¡å—ï¼Œ module.exportsè¾“å‡ºï¼Œæ˜¯åŒæ­¥æ“ä½œï¼Œè¿™å¥—è¯­æ³•è§„åˆ™ç§°ä½œcommonjsï¼Œå³CJSã€‚ è€ŒES6åˆ™æ˜¯å¦ä¸€å¥—è¯­æ³•è§„åˆ™ï¼ŒECMA Script Moduleï¼Œç®€ç§°ESMã€‚é€šè¿‡importåŠ è½½ï¼Œexportè¾“å‡ºï¼Œæ˜¯å¼‚æ­¥æ“ä½œã€‚ å¦‚æœè¦åœ¨nodeé‡Œç”¨ä¸Š ESM è¯­æ³•è§„åˆ™ï¼Œåˆ™å¾—åšä¸€äº›å¿…è¦çš„æ”¹å˜ï¼š é€šè¿‡æ”¹å˜æ–‡ä»¶åã€‚å°†å¸¦æœ‰ ESM è¯­æ³•è§„åˆ™çš„æ–‡ä»¶ $\\color{CadetBlue} {åç¼€åæ”¹ä¸º .mjs} $ï¼Œnodeåˆ™å¯æ­£å¸¸æ‰§è¡Œã€‚ ä¸æ”¹å˜æ–‡ä»¶åç¼€åï¼Œ$\\color{CadetBlue}åœ¨ package.json é‡Œæ·»åŠ  â€œtypeâ€:â€moduleâ€ ã€‚$ ç›¸å¯¹çš„ï¼Œå¦‚æœè¿™æ—¶æƒ³ç”¨å› require() è¯­æ³•ï¼Œåˆ™è¦æŠŠæ–‡ä»¶åç¼€åæ”¹ä¸ºcjsã€‚$\\color{red} ä½†ä¸¤ç§è¯­æ³•è§„åˆ™å¼ºçƒˆä¸å»ºè®®æ··ç”¨ã€‚$ CommonJS æ¨¡å—åŠ è½½ ES6 æ¨¡å—require() å‘½ä»¤ä¸èƒ½åŠ è½½ ES6 æ¨¡å—ï¼Œä¼šæŠ¥é”™ï¼Œnodeé‡Œåªèƒ½ä½¿ç”¨import()è¿™ä¸ªæ–¹æ³•åŠ è½½ï¼Œå¦‚ 123(async () =&gt; &#123; await import(&#x27;./index.mjs&#x27;)&#125;)() ES6 æ¨¡å—å†…éƒ¨å¯ä»¥ä½¿ç”¨é¡¶å±‚ awaitå‘½ä»¤ï¼Œå¯¼è‡´æ— æ³•è¢«åŒæ­¥åŠ è½½ã€‚ ES6æ¨¡å—åŠ è½½ CommonJS æ¨¡å—import å¯ä»¥åŠ è½½CJSæ¨¡å—ï¼Œä¸èƒ½å•ç‹¬è§£æ„åŠ è½½ã€‚è¿™æ˜¯å› ä¸º ES6 æ¨¡å—éœ€è¦æ”¯æŒé™æ€ä»£ç åˆ†æï¼Œè€Œ CommonJS æ¨¡å—çš„è¾“å‡ºæ¥å£æ˜¯module.exportsï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ— æ³•è¢«é™æ€åˆ†æï¼Œæ‰€ä»¥åªèƒ½æ•´ä½“åŠ è½½ã€‚ 12345// æ­£ç¡®import packageMain from &#x27;commonjs-package&#x27;;// æŠ¥é”™import &#123; method &#125; from &#x27;commonjs-package&#x27;; å¯ä»¥æ”¹æˆå•ä¸€è¾“å‡ºé¡¹ï¼Œå†™æˆä¸‹é¢è¿™ç§ï¼š 12345678import packageMain from &#x27;commonjs-package&#x27;;const &#123; method &#125; = packageMain;// æˆ– ç›´æ¥export æ—¶å¸¦ &#123; &#125;ï¼Œ nodeåˆ™ä¼šè®¤ä¸ºæ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œå¦‚ï¼šimport &#123; method &#125; from &#x27;./other.js&#x27;function method (user) &#123; &#125;export &#123; method &#125; è€Œ class åˆ™ä¸å— default å…³é”®å­—é™åˆ¶ï¼š 123import DefaultClass from &#x27;./other.js&#x27;export default class DefaultClass &#123; &#125; ä¸¤ç§æ ¼å¼æ”¯æŒæ¨¡å— å¦‚æœåŸå§‹æ¨¡å—æ˜¯CJSï¼Œå¯ä»¥åŠ ä¸€ä¸ªåŒ…è£…å±‚ 12import cjsModule from &#x27;./index.js&#x27;export const foo = cjsModle.foo ä¸Šé¢ä»£ç å…ˆæ•´ä½“è¾“å…¥ CommonJS æ¨¡å—ï¼Œç„¶åå†æ ¹æ®éœ€è¦è¾“å‡ºå…·åæ¥å£ã€‚ ä½ å¯ä»¥æŠŠè¿™ä¸ªæ–‡ä»¶çš„åç¼€åæ”¹ä¸º.mjsï¼Œæˆ–è€…å°†å®ƒæ”¾åœ¨ä¸€ä¸ªå­ç›®å½•ï¼Œå†åœ¨è¿™ä¸ªå­ç›®å½•é‡Œé¢æ”¾ä¸€ä¸ªå•ç‹¬çš„package.jsonæ–‡ä»¶ï¼ŒæŒ‡æ˜&#123; type: &quot;module&quot; &#125; å¦ä¸€ç§åšæ³•æ˜¯åœ¨package.jsonæ–‡ä»¶çš„exportså­—æ®µï¼ŒæŒ‡æ˜ä¸¤ç§æ ¼å¼æ¨¡å—å„è‡ªçš„åŠ è½½å…¥å£ã€‚ 1234&quot;exports&quot;ï¼š&#123; &quot;require&quot;: &quot;./index.js&quot;ï¼Œ &quot;import&quot;: &quot;./esm/wrapper.js&quot; &#125; ä¸Šé¢ä»£ç æŒ‡å®šrequire()å’Œimportï¼ŒåŠ è½½è¯¥æ¨¡å—ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸ä¸€æ ·çš„å…¥å£æ–‡ä»¶ã€‚ æ¨¡å—åŠ¨æ€å¯¼å…¥import æ™®é€šåŒæ­¥æ¨¡å—å¯¼å…¥ï¼šè¿™é‡Œå¼€å§‹æœ¬ç¯‡ç¬¬äºŒä¸ªå†…å®¹ï¼Œæ¨¡å—åŠ¨æ€å¯¼å…¥ã€‚è¿™é‡Œä»¥ESMå†™æ³•ä¸ºä¾‹ï¼Œç”¨nodeè¿è¡Œåœ¨ package.json æ–‡ä»¶é‡ŒåŠ ä¸Šï¼š&quot;type&quot;: &quot;module&quot; ä¸‹é¢ä¸¾ä¸ªç®€å•çš„ç¿»è¯‘çš„ä¾‹å­æ¥è¯´æ˜ï¼Œ ./tranlate/en-translation.js 12const translations = &#123; HI: &#x27;hello&#x27; &#125;export const enTranslations = translations ./tranlate/sp-translation.js 12const translations = &#123; HI: &#x27;hola&#x27; &#125;export const spTranslations = translations ./locale.js 12345678910111213import &#123;enTranslations&#125; from &#x27;./translate/en-translation.js&#x27;import &#123;spTranslations&#125; from &#x27;./translate/sp-translation.js&#x27;const user = &#123; locale: &#x27;sp&#x27;&#125;let translationsswitch (user.locale) &#123; case &#x27;sp&#x27;: translations = spTranslations break default: translations = enTranslations break&#125;console.log(translations.HI) // hola è¿è¡Œ node locale.js å¯ä»¥å‘ç°æ‰“å°å‡º hola çš„å†…å®¹ã€‚ ä»¥ä¸Šæ˜¯æˆ‘ä»¬å¹³æ—¶importçš„åšæ³•ï¼Œè¿™ç§æ˜¯åŒæ­¥çš„å†™æ³•ï¼Œimportå®Œåæ‰€æœ‰çš„æ–‡ä»¶ä¼šè¢«åŠ è½½ä¸€éï¼Œå¦‚æœæ–‡ä»¶ä¸€å¤§çš„è¯ï¼Œåˆ™ä¼šå½±å“æ•ˆç‡ã€‚ import() å¼‚æ­¥æ¨¡å—å¯¼å…¥ï¼ŒæŒ‰éœ€åŠ è½½ï¼ŒCJSå†™æ³•ï¼šå¯¹ä»¥ä¸Šç¿»è¯‘æ¨¡å—çš„ä»£ç è¿›è¡Œæ”¹åŠ¨ï¼Œ ç”±äºnodeé‡Œé™¤äº† classï¼Œå‡½æ•°å’Œ{} å‡æ²¡æœ‰ defalut å…³é”®å­—ï¼Œæ‰€ä»¥åªèƒ½å…·åè¿›è¡Œè§£æ„ï¼š./locale.js 123456const user = &#123; locale: &#x27;sp&#x27;&#125;import(`./translate/$&#123;user.locale&#125;-translation.js`) .then((&#123; enTranslations=&#123;&#125;, spTranslations=&#123;&#125; &#125;) =&gt; &#123; console.log(spTranslations.HI) &#125;) æ­¤æ—¶å¯ä»¥çœ‹åˆ°æ§åˆ¶å°æ‰“å° holaï¼š 1234567yuyi@home-pc MINGW64 /e/study/code/dynamic-import-module (master)$ npm run l&gt; dynamic-import-module@1.0.0 l E:\\study\\code\\dynamic-import-module&gt; node locale.jshola æˆ‘ä»¬åˆšåˆšæ”¹é€ ä¹‹å‰çš„ switch å‡½æ•°çš„ default åˆ†æ”¯æ”¹å†™ï¼Œåˆ™ç”¨ catchæ›¿ä»£ï¼šå¦‚æœä¼ å…¥ä¸ºæ‰¾ä¸åˆ°çš„è¯­è¨€ï¼Œåˆ™ä¼šé»˜è®¤è¾“å‡ºè‹±æ–‡çš„ç¿»è¯‘ 123456789// é»˜è®¤åªæœ‰enå’Œspï¼Œæ‰¾ä¸åˆ°çš„è¯­è¨€ cnï¼šconst user = &#123; locale: &#x27;cn&#x27; &#125; ... // åˆ©ç”¨catchæ›¿ä»£äº†switchå‡½æ•°çš„defaultåˆ†æ”¯ï¼š .catch(()=&gt; import(&#x27;./translate/en-translation.js&#x27;).then( module =&gt; &#123; console.log(module.enTranslations.HI) // hello &#125;)) import() çš„ESMå†™æ³•ï¼šå°†ä»¥ä¸Šçš„ä»£ç æ”¹ä¸ºåœ¨æµè§ˆå™¨ä¸­çš„ESMå†™æ³•ï¼Œåœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œæ”¹å†™å¦‚ä¸‹ï¼š locale.html 123456789&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt; &lt;!-- æµè§ˆå™¨ä¹Ÿå¾—åœ¨scriptæ ‡ç­¾ä¸Šä»è¦è§„å®š type=&quot;module&quot; --&gt; &lt;script type=&quot;module&quot; src=&quot;./loacleEMS.js&quot;&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; ./translate/ESM-en-translation.js 12const translations = &#123; HI: &#x27;hello&#x27; &#125;export default translations ./translate/ESM-sp-translation.js 12const translations = &#123; HI: &#x27;hola&#x27; &#125;export default translations ./loacleEMS.js 12345678910111213141516import enTranslations from &#x27;./translate/ESM-en-translation.js&#x27;import spTranslations from &#x27;./translate/ESM-sp-translation.js&#x27;const user = &#123; locale: &#x27;sp&#x27;&#125;let translationsswitch (user.locale) &#123; case &#x27;sp&#x27;: translations = spTranslations break; default: translations = enTranslations break;&#125;console.log(translations.HI) // hola æ”¹å†™ä¸º import() æ–¹æ³•çš„ ./loacleEMS.jsã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äºESM export çš„å…³é”®å­—å±æ€§å¯¹æ‰€æœ‰å‡½æ•°objectç­‰éƒ½æœ‰æ•ˆï¼Œèƒ½åŒ¿ååˆ°å¤„ï¼Œæ‰€ä»¥å†™èµ·æ¥æ›´åŠ ç®€æ´ 1234567const user = &#123; locale: &#x27;sp&#x27;&#125;import(`./translate/ESM-$&#123;user.locale&#125;-translation.js`) // å¯ç›´æ¥è§£æ„åŒ¿å default çš„å€¼ï¼š .then((&#123; default: translations &#125;) =&gt; console.log(translations.HI) // hola ) è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æ€ä¹ˆæ”¹å†™ switch-default åˆ†æ”¯å‘¢ï¼Ÿç­”æ¡ˆæ˜¯åˆ©ç”¨ .catch()ï¼Œå¹¶ä¸”æˆ‘ä»¬æŠŠ const user = &#123; locale: &#39;sp&#39;&#125; æ”¹å†™ä¸º const user = &#123; locale: &#39;cn&#39;&#125;ï¼Œä¸€ä¸ªæ–‡ä»¶é‡Œæ²¡æœ‰çš„è¯­è¨€ 12345678910const user = &#123; locale: &#x27;cn&#x27;&#125;import(`./translate/ESM-$&#123;user.locale&#125;-translation.js`)// å°†.then() æ”¾ç½®äº.catch() é‡Œçš„å›è°ƒ import() ä¹‹åæ‰§è¡Œï¼Œ// è¿™æ ·ï¼Œæ§åˆ¶å°æŠ¥é”™æ‰¾ä¸åˆ° &#x27;cn&#x27;ï¼Œä½†ç¨‹åºä»ä¼šå¾€ä¸‹èµ°ï¼š.catch(()=&gt; import(&#x27;./translate/ESM-en-translation.js&#x27;) .then( (&#123; default: translations&#125;) =&gt; &#123; console.log(translations.HI) // hello &#125;))","tags":["node","ES6","ESM","CJS"]},{"title":"reactç»„ä»¶å˜å¤–æ§çš„å‡ ç§æ–¹å¼ï¼ševentEmitterã€refã€props_this","path":"/2021/08/14/ã€2021-08-14ã€‘reactç»„ä»¶å˜å¤–æ§çš„å‡ ç§æ–¹å¼ï¼ševentEmitterã€refã€props_this/","content":"æœ€è¿‘å¾ˆå¿™ï¼Œæäº†å¾ˆä¹…æ²¡æ›´æ–°äº†ï¼Œè¶ç€ä»Šå¤©ç©ºé—²æ¥æ›´æ–°ä¸€æ³¢ã€‚ç»„ä»¶å¤–æ§çš„å¥½å¤„æ˜¯èƒ½ä½¿å¾—Reactæœ€è¿‘è§£é”äº†ç»„ä»¶ä¼ å€¼çš„æ–°æ¨¡å¼ï¼ŒEventEmitterï¼Œfbä¹Ÿå°è£…äº†ä¸€ä¸ªfbemitterçš„ç»„ä»¶ï¼Œç”¨äºfbç½‘ç«™é—´çš„ä¼ å€¼ã€‚ç”¨è¿‡vueçš„å°ä¼™ä¼´å¯¹event emitterè‚¯å®šä¸é™Œç”Ÿã€‚è¿™é‡Œç»“åˆreactçš„ä½¿ç”¨æ¥ç®€å•è¯´æ˜ä¸€ä¸‹ç”¨æ³•ã€‚ eventEmitterå¼•å…¥12import &#123; EventEmitter &#125; from &#x27;fbemitter&#x27;;var emitter = new EventEmitter(); å®šä¹‰äº‹ä»¶å†™ä¸¤ä¸ªæ²¡æœ‰å±‚çº§å…³ç³»çš„ç»„ä»¶ï¼š 12345678910111213141516171819202122232425262728293031import React, &#123; Component &#125; from &#x27;react&#x27;import &#123; EventEmitter &#125; from &#x27;fbemitter&#x27;export default class EventEmitterDemo extends Component &#123; render() &#123; // 0. å¯ç”¨äºæ— å±‚çº§å…³ç³»ç»„ä»¶ä¼ å€¼ï¼š return &lt;&gt; &lt;Child1 /&gt; &lt;Child2 /&gt; &lt;/&gt; &#125;&#125;// 1. åˆå§‹åŒ–const emitter = new EventEmitter()class Child1 extends Component &#123; state = &#123; show:ã€€&#x27;&#x27; &#125; componentDidMount() &#123; // 2. å®šä¹‰ this.eventEmitter = emitter.addListener( &#x27;event&#x27;, (x,y)=&gt; this.setState(&#123; show: &lt;&gt;&#123;x&#125;,&#123;y&#125;&lt;/&gt; &#125;) ) &#125; render()&#123; return &lt;div&gt; &#123;this.state.show&#125; &lt;/div&gt; &#125;&#125; å‘å‡ºå¹¶è§¦å‘äº‹ä»¶12345678class Child2 extends Component &#123; // 3. å‘å‡ºäº‹ä»¶åç§°åŠå‚æ•°ï¼š render()&#123; return &lt;div&gt; &lt;button onClick=&#123;()=&gt; emitter.emit(&#x27;event&#x27;, 12, 22)&#125;&gt;eventEmitterå‘å‡ºï¼Œè§æ§åˆ¶å°&lt;/button&gt; &lt;/div&gt; &#125;&#125; æ•ˆæœ once(eventType, callback)åªè°ƒç”¨ä¸€æ¬¡çš„eventEmitterï¼Œå¦‚ï¼š 123456789componentDidMount() &#123; this.eventEmitter = emitter.once( &#x27;event&#x27;, (x,y)=&gt; console.log(x,y) )&#125;emitter.emit(&#x27;event&#x27;, 13); // 10 //å†æ¬¡è§¦å‘emitter.emit(&#x27;event&#x27;, 12); // ä¸ä¼šè¾“å‡º remove(eventType) åŠ removeAllListeners(eventType)åˆ é™¤äº‹ä»¶ï¼Œä¸€èˆ¬æˆ‘ä»¬åœ¨ç»„ä»¶å¸è½½æ—¶åº”è¯¥æ‰§è¡Œremoveè¿›è¡Œåˆ é™¤ï¼Œè€ŒremoveAllListenersåˆ™å¯ä»¥ä¸€æ¬¡æ€§åˆ é™¤æ‰€æœ‰ç›‘å¬äº‹ä»¶ï¼Œå¦‚ï¼š 123456componentWillUnmount()&#123; // 3. å½“ç»„ä»¶å¸è½½æ—¶è¦å°†å…¶åˆ é™¤ this.eventEmitter.remove(); // æˆ–ï¼š this.removeAllListeners()&#125; å­ç»„ä»¶æ¥æ”¶æ•´ä¸ªçˆ¶ç»„ä»¶thiså®ä¾‹ï¼Œè¾¾åˆ°å­ç»„ä»¶æ§åˆ¶çˆ¶ç»„ä»¶çš„ç›®çš„è¿™ç§åŸç†ç±»ä¼¼HOCå’Œè£…é¥°å™¨å‡½æ•°ï¼Œä½†æ¯”HOCå†™æ³•æ›´ç®€æ´æ˜äº†ï¼Œç›´æ¥ä¸Šä»£ç  12345678910111213141516171819202122export class ByPropsThis extends Component &#123; state = &#123; count: 0&#125; render()&#123; return &lt;&gt; Father count: &#123;this.state.count&#125; &lt;Child thisFrFather=&#123;this&#125; /&gt; &lt;/&gt; &#125;&#125;class Child extends Component &#123; render()&#123; console.log(this.props.thisFrFather.state) return &lt;div&gt; &lt;p&gt;&#123;this.props.count&#125;&lt;/p&gt; &lt;button onClick=&#123;()=&gt; this.props.thisFrFather.setState((&#123;count&#125;) =&gt; (&#123;count: count + 1&#125;))&#125;&gt; child + &lt;/button&gt; &lt;/div&gt; &#125;&#125; Ref çˆ¶æ§åˆ¶å­çš„äº‹ä»¶1234567891011121314151617181920212223242526272829export class ByRef extends Component &#123; testFunc = null // è‡ªåŠ¨å»å¯»æ‰¾ ChildToPlusé‡Œçš„ plus() å‡½æ•°æ‰§è¡Œï¼š handleChildPlus = () =&gt; this.testFunc.plus() render()&#123; return &lt;&gt; &lt;button onClick=&#123;this.handleChildPlus&#125;&gt;plus fr father&lt;/button&gt; &#123;/* æ•´ä¸ªChildToPluséƒ½è¢«æ‰“ä¸Šrefæ ‡è®° */&#125; &lt;ClickToPlus ref=&#123; ref =&gt; this.testFunc = ref &#125; /&gt; &lt;/&gt; &#125;&#125;class ClickToPlus extends Component &#123; constructor(props)&#123; super(props) this.state = &#123;count : 0&#125; &#125; plus = () =&gt; this.setState((&#123; count &#125;) =&gt; (&#123; count: count + 1 &#125;)) render() &#123; return ( &lt;div&gt; &lt;p&gt;&#123;this.state.count&#125;&lt;/p&gt; &lt;button onClick=&#123;this.plus&#125;&gt;child +&lt;/button&gt; &lt;/div&gt; ) &#125;&#125;","tags":["react","eventEmitter"]},{"title":"å‘å¸ƒè‡ªå·±çš„npm-packageæµç¨‹","path":"/2021/07/07/ã€2021-07-07ã€‘å‘å¸ƒè‡ªå·±çš„npm-packageæµç¨‹/","content":"æœ€è¿‘å·¥ä½œéœ€è¦ï¼Œéœ€å‘å¸ƒè‡ªå·±çš„npmåŒ…ï¼Œè¿™é‡Œå†™ä¸€ä¸ªç®€å•çš„demoï¼Œåšä¸€ä¸ªç®€å•çš„è®°å½•ã€‚ 1. æ³¨å†Œä¸€ä¸ªè‡ªå·±çš„npmè´¦å·è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è§£é‡Šçš„ 2. å»ºä¸€ä¸ªgithubä»“åº“è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è§£é‡Šçš„ 3. é¡¹ç›®ç»“æ„12|__&#x2F;package&#x2F;|__&#x2F;test-folder&#x2F; /package æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾æˆ‘ä»¬å†™çš„åŒ…/test-folder æ–‡ä»¶å¤¹ç”¨äºå¼•ç”¨å¹¶æµ‹è¯• /package é‡Œçš„åŒ… ç¼–å†™åŒ… my-package-publish-test åœ¨ /package é‡Œåˆå§‹åŒ–é¡¹ç›® npm init å¹¶å†™ä¸€äº›å…³äºè¯¥ package çš„åå­—ï¼Œå¦‚my-package-publish-test å’Œæè¿°ç­‰ä¸œè¥¿åƒå†™æ™®é€šæ–‡ä»¶ä¸€æ ·ï¼Œæ–°å»º/package/index.js å¹¶å†™ä¸‹ä¸€äº›ç®€å•åŠŸèƒ½ï¼Œå¦‚ 12const isTest = string =&gt; string === &#x27;test&#x27;module.exports = isTest 4. é€šè¿‡è½¯é“¾æ¥åœ¨æœ¬åœ°ä½¿ç”¨åŒ…/packageå¦‚ä¸ä¸Šä¼ åŒ…åˆ°npmï¼Œæœ¬åœ°ä½¿ç”¨å¯ä»¥ç›´æ¥ä½¿ç”¨è½¯é“¾æ¥ï¼Œå¯ä»¥ç”¨äºæœ¬åœ°è°ƒè¯•ç­‰å·¥ä½œï¼Œæ–¹æ³•å¦‚ä¸‹ã€‚å¦‚è¦ç›´æ¥ä¸Šä¼ å¯è·³è¿‡è¯¥æ­¥éª¤ åœ¨å½“å‰ç›®å½• ./package/ ä¸‹è¿è¡Œåˆ›å»ºè½¯é“¾æ¥ 1npm link è¿”å› ./test-folder/ ä¸‹è¿è¡Œè½¯é“¾æ¥ï¼Œè½¯é“¾æ¥åçš„åå¿…é¡»å¯¹åº” package/package.json çš„ &quot;name&quot; 12cd ../test-folder/npm link my-package-publish-test 5. ç™»å½•å¹¶å‘å¸ƒè¿”å› ./package/ å¹¶æ‰§è¡Œç™»å½•ï¼Œè¿è¡Œ 12cd ../package/npm login è¾“å…¥ä¸€äº› npmjs.orgçš„ç”¨æˆ·åå¯†ç ç­‰ï¼Œç™»å½•npmè´¦å· 123456$ npm loginUsername: ys558Password:Email: (this IS public)Email: (this IS public) yuyi.gz@163.comLogged in as ys558 on https://registry.npmjs.org/. ï¼ï¼å¦‚å‡ºç°ä»¥ä¸‹æŠ¥é”™éœ€è¦ç™»å½•è‡ªå·±çš„é‚®ç®±æ˜¯å¦é€šè¿‡ npmjs.org çš„éªŒè¯é‚®ä»¶ 1234567npm ERR! code E403npm ERR! 403 403 Forbidden - PUT http://registry.npmjs.org/my-package-publish-test - Forbiddennpm ERR! 403 In most cases, you or one of your dependencies are requestingnpm ERR! 403 a package version that is forbidden by your security policy.npm ERR! A complete log of this run can be found in:npm ERR! C:\\Users\\yuyi\\AppData\\Roaming pm-cache\\_logs\\2021-07-04T12_02_21_879Z-debug.log æœ€åè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå³å¯å‘å¸ƒæˆåŠŸå±äºè‡ªå·±çš„npm package 1npm publish å‘å¸ƒæˆåŠŸï¼š 1234567891011121314151617$ npm publishnpm notice npm notice package: my-package-publish-test@1.0.0npm notice === Tarball Contents ===npm notice 85B index.jsnpm notice 564B package.jsonnpm notice 21B README.mdnpm notice === Tarball Details ===npm notice name: my-package-publish-testnpm notice version: 1.0.0npm notice package size: 509 Bnpm notice unpacked size: 670 Bnpm notice shasum: 98b90c3ab222a573f0379802cc3d59d43ffcb402npm notice integrity: sha512-Fz/SDMr5vgoAe[...]UD5J4OP0rFtFA==npm notice total files: 3npm notice+ my-package-publish-test@1.0.0 6. å‘å¸ƒå…·æœ‰å‘½åç©ºé—´çš„packageæ‰€è°“çš„å‘½åç©ºé—´ï¼Œå°±æ˜¯ä»¥ @ å¼€å¤´çš„åŒ…ï¼Œä¾‹å¦‚æˆ‘ä»¬ç†Ÿæ‚‰çš„ @babel/coreï¼Œä¸€èˆ¬è¿™ç§éœ€è¦åˆ›å»ºç»„ç»‡organizationï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š 6.1 åœ¨è‡ªå·±çš„npmé¡µé¢ç”³è¯·æˆç«‹ä¸€ä¸ªç»„ç»‡ï¼Œorganizationæˆ‘æŠŠå‡ ä¸ªå…³é”®æ­¥éª¤è¿›è¡Œäº†æˆªå›¾ï¼Œå¦‚ä¸‹ å¦‚æœæœ‰æ¡ä»¶å¯ä»¥é€‰æ‹©æ”¶è´¹çš„ï¼Œå…¶å®ä¹Ÿä¸è´µï¼Œä¸€ä¸ªæœˆä¹Ÿå°±7ç¾åˆ€ï¼Œ40å¤šè½¯å¦¹å¸ï¼›ä¹Ÿå¯ä»¥ç›´æ¥å°†ä½ çš„è´¦å·è½¬æ¢ä¸ºç»„ç»‡è´¦å·ï¼Œæˆ‘è¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œé€‰æ‹©å…è´¹å…¬å¼€è´¦å·ç¬¬äºŒä¸ªé€‰é¡¹ï¼š 6.2 é‡æ–°ç”¨ç»„ç»‡çš„åè¿›è¡Œç™»å½•æ‰§è¡Œ npm login scope=&lt;ç»„ç»‡åç§°&gt; ï¼Œç”¨æˆ·åä¹Ÿå’Œç»„ç»‡åç§°ä¸€æ ·ï¼š 12345$ npm login scope=zyzy-orgUsername: zyzy-orgPassword:Email: (this IS public) yuyi.gz@163.comLogged in as zyzy-org on https://registry.npmjs.org/. 6.3 åœ¨å‘å¸ƒçš„åŒ…å‰åŠ ä¸Š @ç»„ç»‡åå°†è¯¥é¡¹ç›®çš„ package\\package.json é‡Œ &quot;name&quot; çš„å±æ€§æ”¹ä¸ºå¦‚ä¸‹ï¼Œå‰é¢åŠ ä¸ª @zyzy-org/ 123&#123; &quot;name&quot;: &quot;@my-test-package/my-package-publish-test&quot;,&#125; 6.4 è¿è¡Œ npm publish --access=publicå³å¯è§åˆ°å‘å¸ƒæˆåŠŸï¼š 1234567891011121314151617$ npm publish --access=publicnpm notice npm notice package: @zyzy-org/my-package-publish-test@1.0.0npm notice === Tarball Contents ===npm notice 69B index.jsnpm notice 574B package.jsonnpm notice 21B README.mdnpm notice === Tarball Details ===npm notice name: @zyzy-org/my-package-publish-testnpm notice version: 1.0.0npm notice package size: 503 Bnpm notice unpacked size: 664 Bnpm notice shasum: ddc493df353964be87f43d14e5f7fd877b7b4c04npm notice integrity: sha512-XFE19u9gFMcI1[...]1/LA3ocSzHZ8Q==npm notice total files: 3npm notice+ @zyzy-org/my-package-publish-test@1.0.0 6.5 æ–°é¡¹ç›®åˆå§‹åŒ–æ—¶ï¼Œé¡»è¿è¡Œ npm init scope=zyzy-org7 åˆ é™¤å·²å‘å¸ƒçš„åŒ…1npm unpublish @zyzy-org/my-package-publish-test --force","tags":["npm package"]},{"title":"JWTè‡ªå­¦ç¬”è®°","path":"/2021/06/21/ã€2021-06-21ã€‘JWTè‡ªå­¦ç¬”è®°/","content":"JWTæ˜¯ä¸€ç§è·¨åŸŸé‰´æƒæŠ€æœ¯ï¼Œç°å¹¿æ³›è¿ç”¨äºå„å¤§ç½‘ç«™ï¼Œæœ¬æ–‡ç»“åˆdemoä»£ç ç®€å•é˜è¿°ï¼Œæœ¬ç¯‡çš„æ¦‚å¿µéƒ¨åˆ†1åˆ°4ç‚¹æ¬è¿äº†é˜®å¤§ç¥çš„è¿™ç¯‡æ–‡ç« ï¼Œç¬¬5ç‚¹ç»“åˆæˆ‘è‡ªå·±å†™çš„ä¸€ä¸ªDemoæ¥å®ç°å…·ä½“çš„JWTä¸šåŠ¡ 1. JWTæ˜¯ä»€ä¹ˆï¼ŸJSON Web Token (jwt)æ˜¯ä¸€ä¸ªå¼€æ”¾æ ‡å‡†(RFC 7519)ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ç´§å‡‘çš„ã€è‡ªåŒ…å«çš„æ–¹å¼ï¼Œç”¨äºä½œä¸ºJSONå¯¹è±¡åœ¨å„æ–¹ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“ä¿¡æ¯ã€‚è¯¥ä¿¡æ¯å¯ä»¥è¢«éªŒè¯å’Œä¿¡ä»»ï¼Œå› ä¸ºå®ƒæ˜¯æ•°å­—ç­¾åçš„ã€‚ ç®€å•æ¥è¯´å°±æ˜¯ç”¨äºè·¨åŸŸé‰´æƒã€‚ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬é‰´æƒçš„è¿‡ç¨‹å¦‚ä¸‹ï¼š 1ã€ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€ç”¨æˆ·åå’Œå¯†ç ã€‚2ã€æœåŠ¡å™¨éªŒè¯é€šè¿‡åï¼Œåœ¨å½“å‰å¯¹è¯ï¼ˆsessionï¼‰é‡Œé¢ä¿å­˜ç›¸å…³æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·è§’è‰²ã€ç™»å½•æ—¶é—´ç­‰ç­‰ã€‚3ã€æœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›ä¸€ä¸ª session_idï¼Œå†™å…¥ç”¨æˆ·çš„ Cookieã€‚4ã€ç”¨æˆ·éšåçš„æ¯ä¸€æ¬¡è¯·æ±‚ï¼Œéƒ½ä¼šé€šè¿‡ Cookieï¼Œå°† session_id ä¼ å›æœåŠ¡å™¨ã€‚5ã€æœåŠ¡å™¨æ”¶åˆ° session_idï¼Œæ‰¾åˆ°å‰æœŸä¿å­˜çš„æ•°æ®ï¼Œç”±æ­¤å¾—çŸ¥ç”¨æˆ·çš„èº«ä»½ã€‚ ä¸Šè¿°è¿‡ç¨‹å¦‚æœå•æœºå½“ç„¶æ²¡æœ‰é—®é¢˜ï¼Œå¦‚æœæ˜¯é›†ç¾¤ï¼Œæˆ–è·¨åŸŸçš„æœåŠ¡å¯¼å‘æ¶æ„ï¼Œå°±è¦æ±‚ session æ•°æ®å…±äº«ï¼Œæ¯å°æœåŠ¡å™¨éƒ½èƒ½å¤Ÿè¯»å– sessionã€‚ä¸¾ä¾‹æ¥è¯´ï¼ŒA ç½‘ç«™å’Œ B ç½‘ç«™æ˜¯åŒä¸€å®¶å…¬å¸çš„å…³è”æœåŠ¡ã€‚ç°åœ¨è¦æ±‚ï¼Œç”¨æˆ·åªè¦åœ¨å…¶ä¸­ä¸€ä¸ªç½‘ç«™ç™»å½•ï¼Œå†è®¿é—®å¦ä¸€ä¸ªç½‘ç«™å°±ä¼šè‡ªåŠ¨ç™»å½•ï¼Œè¯·é—®æ€ä¹ˆå®ç°ï¼Ÿä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ session æ•°æ®æŒä¹…åŒ–ï¼Œå†™å…¥æ•°æ®åº“æˆ–åˆ«çš„æŒä¹…å±‚ã€‚å„ç§æœåŠ¡æ”¶åˆ°è¯·æ±‚åï¼Œéƒ½å‘æŒä¹…å±‚è¯·æ±‚æ•°æ®ã€‚è¿™ç§æ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯æ¶æ„æ¸…æ™°ï¼Œç¼ºç‚¹æ˜¯å·¥ç¨‹é‡æ¯”è¾ƒå¤§ã€‚å¦å¤–ï¼ŒæŒä¹…å±‚ä¸‡ä¸€æŒ‚äº†ï¼Œå°±ä¼šå•ç‚¹å¤±è´¥ã€‚ å¦ä¸€ç§æ–¹æ¡ˆæ˜¯æœåŠ¡å™¨ç´¢æ€§ä¸ä¿å­˜ session æ•°æ®äº†ï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å‘å›æœåŠ¡å™¨ã€‚ jwt å°±æ˜¯è¿™ç§æ–¹æ¡ˆçš„ä¸€ä¸ªä»£è¡¨ã€‚ 2. JWTçš„ç»“æ„æˆ‘ä»¬å¯ä»¥åœ¨å®˜ç½‘çœ‹åˆ°ä»–çš„ç»“æ„ JWTç»“æ„ å¯ä»¥çœ‹åˆ°åˆ†ä¸ºä»¥ä¸‹3éƒ¨åˆ†ï¼š Headerï¼ˆå¤´éƒ¨ï¼‰Payloadï¼ˆè´Ÿè½½ï¼‰Signatureï¼ˆç­¾åï¼‰ Header å¤´éƒ¨1234&#123; &quot;alg&quot;: &quot;PS384&quot;, &quot;typ&quot;: &quot;JWT&quot;&#125; ä»¥ä¸Šåˆ†åˆ«ä»£è¡¨ &quot;typ&quot; è¡¨ç¤ºè¿™ä¸ªä»¤ç‰Œï¼ˆtokenï¼‰çš„ç±»å‹ï¼ˆtypeï¼‰ &quot;alg&quot; è¡¨ç¤ºè¯¥tokençš„ç®—æ³•ç±»å‹ï¼Œé»˜è®¤ä¸ºHMAC SHA256ï¼ˆå†™æˆ HS256ï¼‰ Payload è´Ÿè½½ä»¥ä¸‹ä¸ºå®˜æ–¹è§„å®šçš„å¯é€‰å­—æ®µï¼š iss (issuer)ï¼šç­¾å‘äººexp (expiration time)ï¼šè¿‡æœŸæ—¶é—´sub (subject)ï¼šä¸»é¢˜aud (audience)ï¼šå—ä¼—nbf (Not Before)ï¼šç”Ÿæ•ˆæ—¶é—´iat (Issued At)ï¼šç­¾å‘æ—¶é—´jti (JWT ID)ï¼šç¼–å· æ³¨æ„ï¼Œè¿™éƒ¨åˆ†æ˜¯ä¸åŠ å¯†çš„ï¼Œæ˜¯ç®€å•çš„Base64è½¬ç è¿‡ç¨‹ï¼Œæ‰€ä»¥å¯†æ–‡ä¿¡æ¯ä¸èƒ½æ”¾åœ¨è¿™éƒ¨åˆ†ï¼Œé™¤éä½ çš„æ–‡å­—æœ¬èº«åŠ å¯†è¿‡ Signature ç­¾åè¿™éƒ¨åˆ†æ˜¯å¯¹å‰ä¸¤éƒ¨åˆ†çš„ç­¾åï¼Œé˜²æ­¢æ•°æ®ç¯¡æ”¹ã€‚ éœ€æŒ‡å®šä¸€ä¸ªå¯†é’¥ï¼ˆsecretï¼‰ã€‚è¿™ä¸ªå¯†é’¥åªæœ‰æœåŠ¡å™¨æ‰çŸ¥é“ï¼Œä¸èƒ½æ³„éœ²ç»™ç”¨æˆ·ã€‚ç„¶åï¼Œä½¿ç”¨ Header é‡Œé¢æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆé»˜è®¤æ˜¯ HMAC SHA256ï¼‰ï¼ŒæŒ‰ç…§ä¸‹é¢çš„å…¬å¼äº§ç”Ÿç­¾åã€‚ 1HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload), secret) ç®—å‡ºç­¾åä»¥åï¼ŒæŠŠ Headerã€Payloadã€Signature ä¸‰ä¸ªéƒ¨åˆ†æ‹¼æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªéƒ¨åˆ†ä¹‹é—´ç”¨â€ç‚¹â€ï¼ˆ.ï¼‰åˆ†éš”ï¼Œå°±å¯ä»¥è¿”å›ç»™ç”¨æˆ·ã€‚ Header å’Œ Payload ä¸²å‹åŒ–çš„ç®—æ³•æ˜¯ Base64URLã€‚è¿™ä¸ªç®—æ³•è·Ÿ Base64 ç®—æ³•åŸºæœ¬ç±»ä¼¼ï¼Œä½†æœ‰ä¸€äº›å°çš„ä¸åŒã€‚ JWT ä½œä¸ºä¸€ä¸ªä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œæœ‰äº›åœºåˆå¯èƒ½ä¼šæ”¾åˆ° URLï¼ˆæ¯”å¦‚ api.example.com/?token=xxxï¼‰ã€‚Base64 æœ‰ä¸‰ä¸ªå­—ç¬¦+ã€/å’Œ=ï¼Œåœ¨ URL é‡Œé¢æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œæ‰€ä»¥è¦è¢«æ›¿æ¢æ‰ï¼š=è¢«çœç•¥ã€+æ›¿æ¢æˆ-ï¼Œ/æ›¿æ¢æˆ_ ã€‚è¿™å°±æ˜¯ Base64URL ç®—æ³•ã€‚ 3. JWTä½¿ç”¨æ–¹æ³•ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ JWTï¼Œå¯ä»¥å‚¨å­˜åœ¨ Cookie é‡Œé¢ï¼Œä¹Ÿå¯ä»¥å‚¨å­˜åœ¨ localStorageã€‚ æ­¤åï¼Œå®¢æˆ·ç«¯æ¯æ¬¡ä¸æœåŠ¡å™¨é€šä¿¡ï¼Œéƒ½è¦å¸¦ä¸Šè¿™ä¸ª JWTã€‚ä½ å¯ä»¥æŠŠå®ƒæ”¾åœ¨ Cookie é‡Œé¢è‡ªåŠ¨å‘é€ï¼Œä½†æ˜¯è¿™æ ·ä¸èƒ½è·¨åŸŸï¼Œæ‰€ä»¥æ›´å¥½çš„åšæ³•æ˜¯æ”¾åœ¨ HTTP è¯·æ±‚çš„å¤´ä¿¡æ¯Authorizationå­—æ®µé‡Œé¢ã€‚ 1Authorization: Bearer &lt;token&gt; å¦ä¸€ç§åšæ³•æ˜¯ï¼Œè·¨åŸŸçš„æ—¶å€™ï¼ŒJWT å°±æ”¾åœ¨ POST è¯·æ±‚çš„æ•°æ®ä½“é‡Œé¢ã€‚ 4. ä½¿ç”¨æ—¶å‡ ä¸ªæ³¨æ„ç‚¹ï¼ˆ1ï¼‰JWT é»˜è®¤æ˜¯ä¸åŠ å¯†ï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥åŠ å¯†çš„ã€‚ç”ŸæˆåŸå§‹ Token ä»¥åï¼Œå¯ä»¥ç”¨å¯†é’¥å†åŠ å¯†ä¸€æ¬¡ã€‚ ï¼ˆ2ï¼‰JWT ä¸åŠ å¯†çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½å°†ç§˜å¯†æ•°æ®å†™å…¥ JWTã€‚ ï¼ˆ3ï¼‰JWT ä¸ä»…å¯ä»¥ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯ä»¥ç”¨äºäº¤æ¢ä¿¡æ¯ã€‚æœ‰æ•ˆä½¿ç”¨ JWTï¼Œå¯ä»¥é™ä½æœåŠ¡å™¨æŸ¥è¯¢æ•°æ®åº“çš„æ¬¡æ•°ã€‚ ï¼ˆ4ï¼‰JWT çš„æœ€å¤§ç¼ºç‚¹æ˜¯ï¼Œç”±äºæœåŠ¡å™¨ä¸ä¿å­˜ session çŠ¶æ€ï¼Œå› æ­¤æ— æ³•åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åºŸæ­¢æŸä¸ª tokenï¼Œæˆ–è€…æ›´æ”¹ token çš„æƒé™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ JWT ç­¾å‘äº†ï¼Œåœ¨åˆ°æœŸä¹‹å‰å°±ä¼šå§‹ç»ˆæœ‰æ•ˆï¼Œé™¤éæœåŠ¡å™¨éƒ¨ç½²é¢å¤–çš„é€»è¾‘ã€‚ ï¼ˆ5ï¼‰JWT æœ¬èº«åŒ…å«äº†è®¤è¯ä¿¡æ¯ï¼Œä¸€æ—¦æ³„éœ²ï¼Œä»»ä½•äººéƒ½å¯ä»¥è·å¾—è¯¥ä»¤ç‰Œçš„æ‰€æœ‰æƒé™ã€‚ä¸ºå‡å°‘ç›—ç”¨ï¼ŒJWT çš„æœ‰æ•ˆæœŸåº”è¯¥è®¾ç½®å¾—æ¯”è¾ƒçŸ­ã€‚å¯¹äºä¸€äº›æ¯”è¾ƒé‡è¦çš„æƒé™ï¼Œä½¿ç”¨æ—¶åº”è¯¥å†æ¬¡å¯¹ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚ ï¼ˆ6ï¼‰ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT ä¸åº”è¯¥ä½¿ç”¨ HTTP åè®®æ˜ç ä¼ è¾“ï¼Œè¦ä½¿ç”¨ HTTPS åè®®ä¼ è¾“ã€‚ 5. Demo ä»£ç  åŠå®é™…ä½¿ç”¨åœºæ™¯å®Œæ•´ä»£ç å¯ç‚¹å‡»æ ‡é¢˜å¯è§gitä»“åº“ï¼Œä¸‹é¢æŒ‰ç…§æˆ‘ç¼–å†™ä»£ç çš„é¡ºåºé˜è¿°å‡ ä¸ªæ³¨æ„ç‚¹ï¼Œ ä»£ç é‡Œä¸€äº›é…ç½®çš„è§£æ .env æ–‡ä»¶ä¸­çš„ä¸¤ä¸ªtokenç”Ÿæˆå¯ä»¥æŒ‰ç…§ä»¥ä¸‹åŠæ³•ï¼Œåˆ©ç”¨node REPLçš„cryptoæ¨¡å—ç”Ÿæˆï¼š 123456789yuyi@home-pc MINGW64 /e/study/code/2021/jwt-learn (master)$ nodeWelcome to Node.js v14.14.0. Type &quot;.help&quot; for more information.&gt; require(&#x27;crypto&#x27;).randomBytes(64).toString(&#x27;hex&#x27;)&#x27;6dedc49577ebb7c685246241533dc068ee43cba49d01b34d243b6b8924786a69d6637c4335e508343ba4c27a1fec1d2f11ea5eea173bd4af04c0f263a4ee98b5&#x27;&gt; require(&#x27;crypto&#x27;).randomBytes(64).toString(&#x27;hex&#x27;)&#x27;4f3ea9c60d55b2a8a58f559ae76e133353a973708d6575daa10ac4bd28f6314d261a4458703be1333f65eddb29a1b58e21ebe493fede5c198952863f1f97e023&#x27;&gt; å‘é€è¯·æ±‚æ£€æµ‹æ—¶ä¸éœ€è¦å®‰è£…postmanï¼Œåªéœ€åœ¨ vs code ä¸Šå®‰è£…ç¥å™¨ REST Client ï¼Œä¸ä»…å¯ä»¥æµ‹æ™®é€šçš„æ¥å£ï¼Œæœ€æ–°çš„ GraphQL è¯­æ³•ä¹Ÿæ”¯æŒï¼Œå…¶æµ‹è¯•æ–‡ä»¶ä»¥ rest ç»“å°¾ï¼Œå¦‚ request.rest dotenv æ˜¯ä¸ªä¸éœ€è¦ä¾èµ–å°±èƒ½è¯»å–é¡¹ç›®ä¸­ .env æ–‡ä»¶çš„é…åˆ¶çš„åº“ï¼Œåªéœ€åœ¨ æ–‡ä»¶å¼€å§‹å¼•ç”¨å³å¯ï¼Œå¦‚ï¼š 12345678910111213// dotenvåº“å¼•ç”¨ï¼šrequire(&#x27;dotenv&#x27;).config()...app.post(&#x27;/login&#x27;, (req,res) =&gt; &#123; // ç™»å½•tokené‰´æƒ const username = req.body.username const user = &#123; name: username &#125; const accessToken = jwt.sign(user, process.env.ACCESS_TOKEN_SECRET) res.json(&#123; accessToken &#125;)&#125;) è§£æåŠæµ‹è¯•ä¸»ä»£ç  npm run dev-start æŠŠæœåŠ¡è·‘èµ·åï¼Œç‚¹å‡» request.rest æ–‡ä»¶çš„è¿™é‡Œä¸‹é¢çš„ä½ç½®ï¼Œè¿™äº›æœ€åŸºç¡€çš„åŠŸèƒ½åœ¨ 01_base åˆ†æ”¯çš„è¿™äº›ä»£ç å°±èƒ½å®ç°ï¼Œæµ‹è¯•æ¥å£è¿”å›çš„æ­£ç¡®ä¸å¦ é‰´æƒéƒ¨åˆ†æŠ½ç¦»ä¸ºå•ç‹¬çš„ä¸­é—´ä»¶å‡½æ•°ï¼Œ02_authenticate_token_modulize åˆ†æ”¯çš„è¿™äº›ä»£ç ï¼Œ 1234567891011function authenticateToken (req, res, next) &#123; const authHeader = req.headers[&#x27;authorization&#x27;] const token = authHeader &amp;&amp; authHeader.split(&#x27; &#x27;)[1] if (token == null) return res.sendStatus(401) jwt.verify(token, process.env.ACCESS_TOKEN_SECRET, (err, user) =&gt; &#123; if (err) return res.sendStatus(403) req.user = user // äº¤ç»™ä¸‹ä¸ªä¸­é—´ä»¶ï¼š next() &#125;)&#125; å°†å…¶æ”¾å…¥app.get(&#39;/posts&#39;)çš„ç¬¬äºŒä¸ªå‚æ•°å³å¯è°ƒç”¨ï¼š 1234// authenticateToken ä¸ºé‰´æƒä¸­é—´ä»¶ï¼šapp.get(&#x27;/posts&#x27;, authenticateToken, (req, res) =&gt; &#123; res.json(posts.filter(post =&gt; post.username === req.user.name))&#125;) å°†é‰´æƒéƒ¨åˆ†ï¼Œå³tokençš„åˆ†å‘ï¼Œæ‹†åˆ†ä¸ºå•ç‹¬ä¸€ä¸ªæ¨¡å—ã€‚é›†ä¸­ç®¡ç†å„ä¸ªè·¯ç”±ï¼ŒåŒ…æ‹¬/login, /logoutçš„tokenï¼Œåœ¨åç«¯å±äºå¾®æœåŠ¡çš„æ¶æ„ å•ç‹¬æŠŠé¢å‘tokenè¿™éƒ¨åˆ†å†…å®¹å°è£…ä¸€ä¸ªå•ç‹¬æ–‡ä»¶ï¼Œæ–°å»ºæ–‡ä»¶ authServer.js åŠæ›´æ–°å‘½ä»¤ auth 123&quot;scripts&quot;: &#123; &quot;auth-start&quot;: &quot;nodemon authServer.js&quot;&#125;, Refresh Token ä¸Šé¢æ˜¯æ­£å¸¸æµç¨‹çš„æ³¨å†Œç™»å½•æ‰€ç”¨çš„tokenï¼Œä½†å®é™…ä¸šåŠ¡ä¸­ï¼ŒAccess Token è®¾ç½®çš„æ—¶é—´ä¸å¯èƒ½å¾ˆé•¿ï¼Œæ¯”å¦‚è¯´10åˆ†é’Ÿï¼Œè€Œ10åˆ†é’Ÿå¯¹äºç”¨æˆ·ä½“éªŒæ¥è¯´è‚¯å®šä¸å¥½ï¼Œä¸€è¿‡æœŸçš„è¯å°±è¦é‡æ–°ç™»å½•ï¼Œæ‰€ä»¥å¤§å¤šæ•°ä¸šåŠ¡é‡‡ç”¨äº†å¦ä¸€ç§æŠ˜ä¸­çš„æ–¹æ¡ˆï¼Œå³å¤šç”Ÿæˆä¸€ä¸ª Refresh Tokenï¼Œè¿™ç§çš„è¿‡æœŸæ—¶é—´æ¯”è¾ƒé•¿ï¼Œä¾‹å¦‚7å¤©å…ç™»å½• å¦‚æœæºå¸¦ Access Token è®¿é—®éœ€è¦è®¤è¯çš„æ¥å£æ—¶é‰´æƒå¤±è´¥ï¼ˆä¾‹å¦‚è¿”å› 401 é”™è¯¯ï¼‰ï¼Œåˆ™å®¢æˆ·ç«¯ä½¿ç”¨ Refresh Token å‘åˆ·æ–°æ¥å£ç”³è¯·æ–°çš„ Access Token å¦‚æœ Refresh Token æ²¡æœ‰è¿‡æœŸï¼ŒæœåŠ¡ç«¯å‘å®¢æˆ·ç«¯ä¸‹å‘æ–°çš„ Access Token å®¢æˆ·ç«¯ä½¿ç”¨æ–°çš„ Access Token è®¿é—®éœ€è¦é‡æ–°è®¤è¯çš„æ¥å£ ä¸‹é¢è§£æ Refresh Token çš„åˆ¶ä½œè¿‡ç¨‹ï¼šauthServer.jsæ–‡ä»¶ä¸­æŠŠç”ŸæˆTokenå°è£…æˆä¸€ä¸ªå‡½æ•°ï¼Œå¹¶åœ¨ app.post(&#39;/login&#39;, (req,res) =&gt; &#123; é‡Œåº”ç”¨ 1234567891011121314app.post(&#x27;/login&#x27;, (req,res) =&gt; &#123; const username = req.body.username const user = &#123; name: username &#125; const accessToken = generateAccessToken(user) const refreshToken = jwt.sign(user, process.env.REFRESH_TOKEN_SECRET) refreshTokens.push(refreshToken) res.json(&#123; accessToken: accessToken, refreshToken: refreshToken &#125;)&#125;)function generateAccessToken(user)&#123; return jwt.sign(user, process.env.ACCESS_TOKEN_SECRET, &#123; expiresIn: &#x27;15s&#x27; &#125;)&#125; å†æ¬¡æµ‹è¯•ï¼Œèƒ½çœ‹åˆ° Refresh Token çš„è¿”å›ç»“æœï¼Œä½†æˆ‘ä»¬å‘ç°ç›´æ¥ç”¨/posts æ¥å£è¯·æ±‚ï¼Œä¼šå‡ºç° Forbidden æŠ¥é”™ï¼š æ­¤æ—¶ï¼Œæˆ‘ä»¬å†å†™å¤šä¸ªå‡½æ•°æ§åˆ¶ token æ›´æ–°ï¼š 12345678910111213// è¿™é‡Œçš„ refreshTokenslet refreshTokens = []app.post(&#x27;/token&#x27;, (req, res) =&gt; &#123; const refreshToken = req.body.token if (refreshToken == null) return res.sendStatus(401) if (!refreshTokens.includes(refreshToken)) return res.sendStatus(403) jwt.verify(refreshToken, process.env.REFRESH_TOKEN_SECRET, (err, user) =&gt; &#123; if (err) return res.sendStatus(403) const accessToken = generateAccessToken(&#123; name: user.name &#125;) res.json(&#123; accessToken &#125;) &#125;)&#125;) request.rest æ–‡ä»¶æ·»åŠ ä¸€ä¸ª /token è¿›è¡Œæµ‹è¯•ï¼Œbodyçš„ &quot;token&quot; æš‚ä¸”ç•™ç©º 1234567###POST http:&#x2F;&#x2F;localhost:3001&#x2F;tokenContent-Type: application&#x2F;json&#123; &quot;token&quot;: &quot;&quot;&#125; è¿›è¡Œä»¥ä¸‹æ“ä½œï¼Œå¯ä»¥çœ‹åˆ°æ•ˆæœï¼š ä½†ä¸Šè¿°çš„ GET /posts æ“ä½œï¼Œå›  function generateAccessToken(user)&#123; å‡½æ•°é‡Œè¿‡æœŸæ—¶é—´åªè®¾ç½®äº† 15ç§’ï¼Œæ‰€ä»¥15ç§’åï¼Œéœ€è¦ POST /token é‡æ–°è·å¾—ä¸€ä¸ª refresh token æ‰èƒ½ç»§ç»­ç»´æŒç™»å½•çŠ¶æ€ ç™»å‡ºæ¨¡å— å®Œæ•´ä»£ç åœ¨è¿™é‡Œ 1234app.delete(&#x27;/logout&#x27;, (req, res)=&gt;&#123; refreshTokens = refreshTokens.filter( token =&gt; token !== req.body.token) res.sendStatus(204)&#125;) ç”¨ delete æ–¹æ³•ï¼Œåˆ é™¤ let refreshTokens = [] é‡ŒåŸæœ¬å­˜åœ¨çš„ refresh tokenï¼Œå†æ¬¡è¯·æ±‚ /posts æ—¶ï¼Œä¼šå‘ç°å·²ç»å˜ä¸º Forbidden çŠ¶æ€","tags":["JWT","Token"]},{"title":"RenderPropså’Œé«˜é˜¶ç»„ä»¶çš„åå‘ç»§æ‰¿","path":"/2021/06/19/ã€2021-06-19ã€‘RenderPropså’Œé«˜é˜¶ç»„ä»¶çš„åå‘ç»§æ‰¿/","content":"è¿™ä¸¤ç§æ–¹æ³•æ˜¯Reacté‡Œçš„ç®€å•æŠ€æœ¯ï¼Œä½†åœ¨å…·ä½“ä¸šåŠ¡ä¸­å æœ‰ç›¸åº”çš„ä½¿ç”¨åœºæ™¯ï¼Œååˆ†å®ç”¨ï¼Œä¸‹é¢ç®€è¦çš„è¯´æ˜ä¸€ä¸‹ Render Propsè¿™æ˜¯ä¸€ç§ç®€å•çš„æŠ€æœ¯ï¼Œå®˜ç½‘ä¹Ÿæœ‰è§£é‡Šï¼Œç®€å•ç†è§£å°±æ˜¯å°†ä¸€ä¸ªç»„ä»¶é‡Œçš„å±æ€§attributeä½œä¸ºjsxè¯­æ³•çš„å®ç°ã€‚å¦‚ä»¥ä¸‹ä»£ç  1234567891011121314151617181920212223242526272829// çˆ¶ç»„ä»¶export class RenderPropsDemo extends Component &#123; render()&#123; // 1. render ä½œä¸ºç»„ä»¶ &lt;ToggleRenderProps/&gt; çš„å±æ€§ // 3. åå‘åœ¨renderçš„å›è°ƒå‡½æ•°é‡Œè§£æ„å‡ºå­ç»„ä»¶çš„å±æ€§å‡ºæ¥ç”¨ return &lt;ToggleRenderProps render=&#123;(&#123;on, toggle, str&#125;) =&gt; &lt;div&gt; &#123; on &amp;&amp; &lt;h1&gt;Hey zidea&lt;/h1&gt; &#125; &#123; on &amp;&amp; &lt;h2&gt;&#123;str&#125;&lt;/h2&gt; &#125; &lt;button onClick=&#123;toggle&#125;&gt;éšè—/æ˜¾ç¤º&lt;/button&gt; &lt;/div&gt; &#125;/&gt; &#125;&#125;// å­ç»„ä»¶ï¼šclass ToggleRenderProps extends Component &#123; state = &#123; on:false &#125; toggle = () =&gt; this.setState(&#123; on:!this.state.on &#125;) render() &#123; // 2. åœ¨å­ç»„ä»¶è®¾ç½®renderé‡Œé¢çš„å±æ€§ï¼š const &#123; render &#125; = this.props; return render(&#123; str: &#x27;hehe&#x27;, on: this.state.on, toggle: this.toggle, &#125;) &#125;&#125; ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œå­ç»„ä»¶ ToggleRenderProps ä»…è´Ÿè´£å•ä¸€çš„ä¼ å€¼å’Œæ§åˆ¶å€¼å’ŒçŠ¶æ€çš„åŠŸèƒ½ï¼Œç±»ä¼¼å›è°ƒå‡½æ•°ï¼ŒæŠŠè¯¥æ§åˆ¶çš„å€¼å›ä¼ ç»™çˆ¶ç»„ä»¶ RenderPropsDemo å»ä½¿ç”¨ã€‚ å½“ç„¶å±æ€§ render è¿™è¯ä¸æ˜¯å›ºå®šçš„ ä»»ä½•è¢«ç”¨äºå‘ŠçŸ¥ç»„ä»¶éœ€è¦æ¸²æŸ“ä»€ä¹ˆå†…å®¹çš„å‡½æ•° prop åœ¨æŠ€æœ¯ä¸Šéƒ½å¯ä»¥è¢«ç§°ä¸º â€œrender propâ€. æ‰€ä»¥ï¼Œä½ å¯ä»¥ç»™å±æ€§å–ä»»æ„åå­—ï¼Œä¾‹å¦‚ data 1234567891011121314151617// çˆ¶ç»„ä»¶export class RenderPropsDemo extends Component &#123; render()&#123; return &lt;ToggleRenderProps data=&#123;(&#123;on, toggle, str&#125;) =&gt; &lt;&gt; ... &lt;/&gt;&#125;/&gt;&#125;&#125;// å­ç»„ä»¶ï¼šclass ToggleRenderProps extends Component &#123; ... render() &#123; return this.props.data(&#123; ... &#125;) &#125;&#125; çˆ¶ç»„ä»¶è¿˜å¯ä»¥å†™ä¸ºå…ƒç´ å†…éƒ¨çš„æ¨¡å¼ï¼Œå¦‚ 123456789export class RenderPropsDemo extends Component &#123; render()&#123; return &lt;ToggleRenderProps&gt; &#123;data=&#123;(&#123;on, toggle, str&#125;) =&gt; &lt;&gt; ... &lt;/&gt;&#125; &lt;/ToggleRenderProps&gt; &#125;&#125; è€Œå­ç»„ä»¶è°ƒç”¨æ—¶ï¼Œå°±æ˜¯å¦ä¸€ç§æ¦‚å¿µäº†ï¼Œå¯åˆ©ç”¨ this.props.children çš„reactè‡ªå¸¦apiè¿›è¡Œå›ä¼  123456789101112class ToggleRenderProps extends Component &#123; state = &#123; on:false &#125; toggle = () =&gt; this.setState(&#123; on:!this.state.on &#125;) render() &#123; return this.props.children(&#123; str: &#x27;hehe&#x27;, on: this.state.on, toggle: this.toggle, &#125;) &#125;&#125; ä»¥ä¸Šä¸¤ç§æƒ…å†µï¼Œä¸€ç§åœ¨å±æ€§ä¸Šå®šä¹‰çš„ï¼Œç±»ä¼¼å…·åå‡½æ•°ï¼Œè€ŒåŒ…è£¹åœ¨å…ƒç´ å†…éƒ¨ï¼Œåˆ©ç”¨ children è¿›è¡Œè°ƒç”¨çš„ï¼Œç±»ä¼¼åŒ¿åå‡½æ•° Rener Propsçš„åº”ç”¨åœºæ™¯å°±å¾ˆå¹¿æ³›äº†ï¼Œå¾ˆå¤šåº“ä¾‹å¦‚è·¯ç”±åº“React Routerï¼Œè¡¨å•æ ¡éªŒformikéƒ½ç”¨äº†è¯¥æ–¹æ³•ã€‚ æ­£å‘ä»£ç†HOCåœ¨è¯´åå‘ä»£ç†ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè¯´è¯´æ­£å‘ä»£ç†ï¼Œæ­£å‘ä»£ç†å…¶å®å°±æ˜¯é«˜é˜¶ç»„ä»¶ HOCï¼Œæˆ‘ä»¬çœ‹çœ‹ä¸¤è€…çš„åŒºåˆ«ï¼šæ™®é€šHOCï¼Œå³æ­£å‘ä»£ç†ï¼Œç®€è¨€ä¹‹å°±æ˜¯æŠŠä¸€ä¸ªç»„ä»¶å¤–é¢åŒ…è£¹äº†ä¸€å±‚æ–°çš„ç»„ä»¶ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªæ–°ç»„ä»¶å…³äºReactçš„HOCå’Œåå‘ä»£ç†ä¹Ÿå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  123456789101112131415161718192021222324// çˆ¶ç»„ä»¶class AAA extends React.Component &#123; constructor(props) &#123; super(props) this.state = &#123; num: 111 &#125; &#125; render() &#123; return &lt;div num=&#123;this.state.num&#125;&gt;çˆ¶ç»„ä»¶AAAï¼š&#123; this.state.num &#125;&lt;/div&gt; &#125;&#125;// å­ç»„ä»¶// æ™®é€šHOCï¼ŒAAA =&gt; props è¿™éƒ¨åˆ†ï¼Œä»£è¡¨äº† class AAAåŠå…¶é‡Œé¢çš„propså±æ€§// ç›¸å½“äºæŠŠåŸæ¥çš„ AAA æé«˜äº†ä¸€å±‚çŠ¶æ€å˜æˆäº† HOCconst HOC = function (AAA) &#123; return class extends React.Component &#123; render () &#123; return &lt;div style=&#123;&#123;border: &#x27;solid 1px black&#x27;&#125;&#125;&gt; &lt;AAA &#123;...this.props&#125;/&gt; &lt;/div&gt; &#125; &#125;&#125; å­ç»„ä»¶ä¹Ÿå¯æ”¹å†™ä¸ºå‡½æ•°å¼å†™æ³•ï¼š12345678// å­ç»„ä»¶const HOC = AAA =&gt; props =&gt; &#123; return &lt;div style=&#123;&#123;border: &#x27;solid 1px black&#x27;&#125;&#125;&gt; &lt;AAA &#123;...props&#125;/&gt; &lt;/div&gt;&#125;export const Foo = HOC(AAA) å­ç»„ä»¶æ”¹ä¸ºè£…é¥°å™¨å†™æ³•ï¼Œå¯ä»¥çœç•¥ä¸€æ­¥å‘½åçš„æ“ä½œï¼Œä½†å®é™…é¡¹ç›®ä¸­è¿˜éœ€è¦åœ¨babelä¸­å•ç‹¬å¦è¡Œé…åˆ¶è£…é¥°å™¨è¯­æ³•12345678910@InheritanceInversionHOCexport const HOC = function (AAA) &#123; return class extends React.Component &#123; render () &#123; return &lt;div style=&#123;&#123;border: &#x27;solid 1px black&#x27;&#125;&#125;&gt; &lt;AAA &#123;...this.props&#125;/&gt; &lt;/div&gt; &#125; &#125;&#125; åå‘ä»£ç† Inheritance Inversion HOCç›¸å¯¹äºæ­£å‘ä»£ç†ï¼Œåˆ™æ˜¯ç»§æ‰¿ç»„ä»¶è‡ªå·±æœ¬èº«è¿›è¡Œé‡å†™å°†ä¸Šé¢çš„å­ç»„ä»¶è¿›è¡Œé‡å†™ 1234567891011121314151617181920212223242526272829303132333435363738394041// çˆ¶ç»„ä»¶ï¼Œå³åŸæ¥çš„ç»„ä»¶class AAA extends React.Component &#123; constructor(props) &#123; super(props) this.state = &#123; num: 111 &#125; &#125; componentDidMount() &#123; console.log(&quot;child component Did Mount&quot;) &#125; clickComponent = () =&gt; console.log(&#x27;clickComponent func&#x27;) render() &#123; return &lt;div num=&#123;this.state.num&#125;&gt;çˆ¶ç»„ä»¶AAAï¼š&#123; this.state.num &#125;&lt;/div&gt; &#125;&#125;// å­ç»„ä»¶ï¼Œå³åå‘ç»§æ‰¿åçš„ç»„ä»¶const IIHOC = AAA =&gt; class extends AAA &#123; constructor(props) &#123; super(props) this.state = &#123; num: 222 &#125; &#125; componentDidMount() &#123; console.log(&#x27;IIHOC componentDidMount&#x27;) this.clickComponent() // ç›´æ¥è°ƒç”¨ this.clickComponent() å³å¯ï¼Œæ— éœ€é€šè¿‡propsè¿›è¡Œä¼ å‚ &#125; render()&#123; return &lt;div&gt; &lt;button onClick=&#123;this.clickComponent&#125;&gt;IIHocç‚¹å‡»è§æ§åˆ¶å°ï¼ŒAAAç»„ä»¶çš„å‡½æ•°clickComponentåœ¨æ§åˆ¶å°æ‰§è¡Œäº†&lt;/button&gt; &#123;/* ä¸‹é¢çš„&lt;AAA /&gt;ä¼šæ˜¾ç¤ºçˆ¶ç»„ä»¶çš„numå€¼ï¼Œ 111 */&#125; &lt;div&gt;&lt;AAA /&gt;&lt;/div&gt; &#123;/* ä¸‹é¢çš„ &#123;super.render()&#125; ä¸ºæ¸²æŸ“åŠ«æŒï¼Œ ä¼šæ˜¾ç¤ºæœ¬ç»„ä»¶é‡Œçš„å€¼ï¼Œ222 */&#125; &lt;h1&gt;&#123;super.render()&#125;&lt;/h1&gt; &lt;/div&gt; &#125;&#125;export const InheritanceInversionHOC = IIHOC(AAA) åå‘ä»£ç†çš„è§£æåŠå®é™…ä½œç”¨ const IIHOC = AAA =&gt; class extends AAA &#123; ä¸­ï¼Œextends AAAæ˜¯ç»§æ‰¿è‡ªå·± AAA =&gt;æœ¬èº« å½“ç„¶ï¼ŒAAA =&gt; çš„åå­—AAAæ˜¯å¯ä»¥ä»»æ„æ›¿æ¢çš„ï¼Œå¦‚Comp ç”Ÿå‘½å‘¨æœŸå‡½æ•° componentDidMount() &#123; &#125;ï¼Œå› ä¸ºæ˜¯ç»§æ‰¿äºè‡ªèº«ï¼Œæ‰€ä»¥æ— è®ºçˆ¶å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°å‡ä¼šæ‰§è¡Œ å­ç»„ä»¶é‡Œä½¿ç”¨çˆ¶ç»„ä»¶çš„this.clickComponent()ï¼Œç›´æ¥ä½¿ç”¨å³å¯ï¼Œæ— éœ€é€šè¿‡ props è¿›è¡Œä¼ å‚ åå‘ä»£ç†è¿™ç§åšæ³•ä¹ä¸€çœ‹å¥½åƒæ²¡æœ‰å…·ä½“ç”¨é€”ï¼Œä½†å®é™…æ“ä½œä¸­ï¼Œæˆ‘ä»¬å¯ç”¨æ¥åšä¸€ä¸ªåŸæ¥çš„å¤æ‚é¡µé¢çš„å¤šäººåŒæ—¶å¼€å‘ï¼Œåœ¨ä¸€äº›åœ¨åŸæœ‰ä»£ç åŸºç¡€ä¸Šå¼€å‘ï¼Œä¸èƒ½æ”¹å˜åŸæ¥æ—§çš„ä»£ç ï¼Œåˆ™å¯ç”¨åå‘ç»§æ‰¿å®ç°äºŒæ¬¡æ¸²æŸ“è¿›è¡Œå¼€å‘ï¼Œèƒ½ä½¿æ–°çš„åŠŸèƒ½ç‹¬ç«‹æˆä¸€ä¸ªæ¨¡å—ï¼Œæ–¹ä¾¿ç»´æŠ¤","tags":["React","HOC"]},{"title":"Electroné…ç½®Reactæˆ–Vueå®è·µï¼ˆVueéƒ¨åˆ†å¾…æ›´æ–°ï¼‰","path":"/2021/06/08/ã€2021-06-08ã€‘Electroné…ç½®Reactæˆ–Vueå®è·µ/","content":"æœ¬ç¯‡ä»‹ç»åœ¨ Electron ä¸­é…ç½® React æˆ–è€… Vue æ¡†æ¶å¼€å‘ï¼Œæ¯•ç«Ÿç°åœ¨å‰ç«¯å¤šæ˜¯ç”¨æ¡†æ¶å¼€å‘ï¼Œå…¶å®å·²æ—©æœ‰ç°æˆçš„æ¨¡æ¿é…ç½®ï¼Œè‡ªå·±åŠ¨æ‰‹ç”¨ Webpack æ¥æ­å»ºèƒ½æ›´å¥½çš„ç†Ÿæ‚‰é…ç½®çš„è¿‡ç¨‹ã€‚ Electron åŸºç¡€é…ç½®12mkdir &lt;project name&gt; &amp;&amp; cd &lt;project name&gt;npm init -y &amp;&amp; npm install electron@11.1.1 å›½å†…ç›´æ¥å®‰è£… electron ä¼šæ¯”è¾ƒæ…¢ï¼Œå¯ä»¥é…ç½®æ·˜å®æºå®‰è£…ï¼Œç›´æ¥è¾“å…¥ï¼š 1npm set registry http://registry.npm.taobao.org ä½†ä¸‹è½½å®Œæˆåè®°å¾—æ”¹å›æ¥npmå®˜æ–¹çš„æºï¼Œè¦ä¸ç„¶ä¼šå½±å“è‡ªå·± npm æ¨¡å—çš„å‘å¸ƒï¼š 1npm config set registry https://registry.npmjs.org å¯ç”¨ npm get registry æŸ¥çœ‹æœ¬åœ°æ‰€å±çš„æº é¡¹ç›®åŸºç¡€æ¶æ„package.json ä¿®æ”¹æ”¹å¦‚ä¸‹ï¼š 12345678910111213&#123; &quot;name&quot;: &quot;electron-template&quot;, &quot;version&quot;: &quot;0.0.1&quot;, &quot;description&quot;: &quot;Electron + React é…ç½®é¡¹ç›®&quot;, &quot;author&quot;: &quot;ä½™ç¿¼&quot;, &quot;main&quot;: &quot;./app/main/electron.js&quot;, &quot;scripts&quot;: &#123; &quot;start:main&quot;: &quot;electron ./app/main/electron.js&quot; &#125;, &quot;dependencies&quot;: &#123; &quot;electron&quot;: &quot;^13.1.1&quot; &#125;&#125; åˆ›å»ºç›®å½•ç»“æ„å¦‚ä¸‹ï¼š 123456electron-template |__app |__main # ä¸»è¿›ç¨‹æ–‡ä»¶å¤¹ï¼Œå³è·‘èµ· Electron çš„è¿›ç¨‹ï¼Œåªæœ‰ä¸€ä¸ªï¼Œ æ§åˆ¶æµè§ˆå™¨çª—å£çš„æ“ä½œç­‰ |__electron.js |__index.html |__renderer # æ¸²æŸ“è¿›ç¨‹æ–‡ä»¶å¤¹ï¼Œå³æ¸²æŸ“é¡µé¢çš„è¿›ç¨‹ï¼Œå‰ç«¯çš„ç•Œé¢çš„jsæ–‡ä»¶,å¯ä»¥æœ‰å¤šä¸ªæ–‡ä»¶ è®©æˆ‘ä»¬ä¿®æ”¹ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶ï¼š ç”¨äºå¯åŠ¨Electronçš„çª—å£ï¼šapp\\main\\electron.js 12345678910111213141516171819const path = require(&#x27;path&#x27;);const &#123; app, BrowserWindow &#125; = require(&#x27;electron&#x27;);const createWindow = () =&gt; &#123; const mainWindow = new BrowserWindow(&#123; width: 1000, height: 600, // é›†æˆnode webPreferences: &#123; nodeIntegration: true, &#125;, &#125;) mainWindow.loadFile(&#x27;index.html&#x27;)&#125;app.whenReady().then(() =&gt; &#123; createWindow() app.on(&#x27;activate&#x27;, () =&gt; if (BrowserWindow.getAllWindows().length === 0) createWindow())&#125;) app\\main\\index.html 123456789101112&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt; &lt;title&gt;Electron template&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;h1&gt;hello world&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt; è¿è¡Œ npm run start:main å¯ä»¥çœ‹åˆ°ç•Œé¢ï¼š React12npm install reactnpm install react-router react-router-dom react-dom é…ç½® babelbabel ç”¨æ¥ç¼–è¯‘es6åŠjsxä»£ç ï¼š 123456789# æ ¸å¿ƒ babel æ’ä»¶ï¼šnpm install -S @babel/polyfillnpm install -D @babel/core @babel/cli# å¤„ç† jsxnpm install -D @babel/preset-env @babel/preset-react @babel/preset-typescript # ç¼©å° @babel/polyfill å¼•å…¥æ—¶çš„çš„åº“ï¼Œè¿›è¡ŒæŒ‰éœ€å¼•å…¥npm install @babel/plugin-transform-runtime --save --dev# å°†ES modulesè½¬æ¢ä¸º CommonJSnpm install @babel/plugin-transform-modules-commonjs --save --dev ç¼–å†™ babel.config.js ï¼Œbabelå®˜ç½‘æ¨èçš„è¿™ç§å†™æ³•æ›¿æ¢ä»¥å‰çš„ .babelrcï¼Œapi.cache(true);æ®å®˜ç½‘çš„è¯´æ³•ï¼Œå¯ç¼“å­˜ä¼ è¿›æ¥çš„apiï¼Œæ•ˆç‡æ›´é«˜ 12345678910111213141516171819202122232425module.exports = function (api) &#123; api.cache(true); const presets = [ &#x27;@babel/preset-env&#x27;, // å…è®¸ä½¿ç”¨æœ€æ–°çš„JSè¯­æ³•ï¼Œè€Œæ— é¡»è€ƒè™‘ç¯å¢ƒçš„å½±å“ &#x27;@babel/preset-react&#x27;, &#x27;@babel/preset-typescript&#x27;, ] const plugins = [ &#x27;@babel/plugin-transform-runtime&#x27;, [ &#x27;@babel/plugin-transform-modules-commonjs&#x27;, &#123; allowTopLevelThis: true, loose: true, lazy: true &#125; ] ] return &#123; presets, plugins &#125;&#125; é…ç½® webpackï¼æ³¨æ„ï¼Œæˆªè‡³åˆ°æˆ‘å†™è¯¥æ–‡ä¸ºæ­¢ï¼Œå®‰è£…æœ€æ–°çš„webpack5å’Œwebpack-cli4ï¼Œå¹¶ä¸å…¼å®¹ï¼Œè¿è¡Œæ—¶ä¼šæŠ¥å¾ˆå¤šè«åå…¶å¦™çš„é”™è¯¯ï¼Œæ‰€ä»¥å¿…é¡»æŒ‡å®šwebpack4å’Œwebpack-cli3çš„ç‰ˆæœ¬ï¼Œå…¶ä»–ç‰ˆæœ¬æˆ‘ä¹Ÿè¯•è¿‡äº†ï¼Œåªæœ‰è¿™ä¸¤ä¸ªç‰ˆæœ¬ç›¸å®¹è¾ƒä¸ºç¨³å®š 1234# åŸºç¡€npm i -D webpack@4 webpack-cli@3# çƒ­æ›´æ–°npm i -D webpack-dev-server æˆ‘ä»¬ä¼šé…ç½®3ä¸ªwebpackæ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯ webpack.base.js â€“ åŸºç¡€é…ç½® webpack.render.js â€“ ä¸»è¿›ç¨‹é…ç½® webpack.main.js â€“ æ¸²æŸ“è¿›ç¨‹é…ç½® æ‰€ä»¥å®‰è£…è¿™æ¬¾æ’ä»¶ï¼Œç”¨äºå°†ä¸‹é¢ä¸¤ä¸ªä¸ªæ–‡ä»¶å¼•å…¥ webpack.base.js ä¸­ï¼Œå‡å°‘webpacké…ç½®çš„ä»£ç : 1npm i -D webpack-merge å®‰è£…å„ç§loaderï¼Œplugin 123npm i -D html-webpack-plugin@4 # ç”¨äºè¯»å–å…¥å£HTMLæ–‡ä»¶npm i -D clean-webpack-plugin # ä¸»è¿›ç¨‹åªç¼–è¯‘æ¯æ¬¡æ‰“åŒ…å¥½çš„æ–‡ä»¶ï¼Œè¦è¿™ä¸ªæ’ä»¶å¯ä»¥æ¯æ¬¡è‡ªåŠ¨æ¸…é™¤ä¸Šæ¬¡ç•™ä¸‹æ¥çš„æ–‡ä»¶npm i babel-loader é…ç½® cross-env æ’ä»¶ï¼Œç”¨äºæ‰§è¡Œä¸åŒç¯å¢ƒçš„è„šæœ¬ï¼š 1npm i cross-env webpacké…ç½®æ–‡ä»¶webpack.base.js123456789101112131415161718const path = require(&#x27;path&#x27;)const &#123; CleanWebpackPlugin &#125; = require(&#x27;clean-webpack-plugin&#x27;)module.exports = &#123; resolve: &#123; extensions: [&#x27;.js&#x27;, &#x27;.jsx&#x27;, &#x27;.ts&#x27;, &#x27;.tsx&#x27;], alias: &#123; // è·¯å¾„åˆ«åï¼Œå¯å°† import A from &#x27;../../../../../A&#x27;è¿™ç§å¯¼å…¥è·¯å¾„ï¼Œå˜æˆ import A from &#x27;@src/A&#x27; &#x27;@src&#x27;: path.join(__dirname, &#x27;../&#x27;, &#x27;app/renderer&#x27;) &#125; &#125;, module: &#123; rules: [ &#123; test: /\\.(jsx?|tsx?)$/, exclude: /node_modules/, use: &#123; loader: &#x27;babel-loader&#x27;,&#125;&#125;, ] &#125;, plugins: [ new CleanWebpackPlugin(), ],&#125; webpack.main.dev.js123456789101112131415161718192021222324const path = require(&#x27;path&#x27;)const webpack = require(&#x27;webpack&#x27;)const baseConfig = require(&#x27;./webpack.base.js&#x27;)const webpackMerge = require(&#x27;webpack-merge&#x27;)const mainConfig = &#123; entry: path.resolve(__dirname, &#x27;../app/main/electron.js&#x27;), // æ„å»ºå‡ºä¸åŒè¿è¡Œç¯å¢ƒçš„ä»£ç  target: &#x27;electron-main&#x27;, output: &#123; filename: &#x27;electron.js&#x27;, path: path.resolve(__dirname, &#x27;../dist&#x27;), &#125;, devtool: &#x27;inline-source-map&#x27;, mode: &#x27;development&#x27;, plugins: [ // ğŸ‘‡ æ ¹æ®å¯åŠ¨å‘½ä»¤çš„ node_envï¼ŒæŒ‡å®šæ„å»ºå˜é‡ new webpack.DefinePlugin(&#123; &#x27;process.env.NODE_ENV&#x27;: &#x27;&quot;development&quot;&#x27; &#125;) ],&#125;module.exports = webpackMerge.merge(baseConfig, mainConfig) webpack.render.dev.js1234567891011121314151617181920212223242526272829303132333435const path = require(&#x27;path&#x27;)const webpackMerge = require(&#x27;webpack-merge&#x27;)const baseConfig = require(&#x27;./webpack.base.js&#x27;)const HtmlWebPackPlugin = require(&#x27;html-webpack-plugin&#x27;)const devConfig = &#123; mode: &#x27;development&#x27;, entry: &#123; // app.jsx å…¥å£æ–‡ä»¶ index: path.resolve(__dirname, &#x27;../app/renderer/App.jsx&#x27;), &#125;, output: &#123; filename: &#x27;[name].[hash].js&#x27;, path: path.resolve(__dirname, &#x27;../dist&#x27;), &#125;, target: &#x27;electron-renderer&#x27;, devtool: &#x27;inline-source-map&#x27;, devServer: &#123; contentBase: path.join(__dirname, &#x27;../dist&#x27;), compress: true, host: &#x27;127.0.0.1&#x27;, port: 7001, hot: true, &#125;, plugins: [ new HtmlWebPackPlugin(&#123; // ä»¥æ­¤ä¸ºæ¨¡æ¿ï¼Œè‡ªåŠ¨ç”ŸæˆHTML template: path.resolve(__dirname, &#x27;../app/renderer/index.html&#x27;), filename: path.resolve(__dirname, &#x27;../dist/index.html&#x27;), chunks: [&#x27;index&#x27;], &#125;) ]&#125;module.exports = webpackMerge.merge(baseConfig, devConfig) é‡ç»„é¡¹ç›®ç»“æ„ç”±äºreactæ˜¯åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­æ‰§è¡Œï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°†å…¥å£æ–‡ä»¶ index.html ç§»åŠ¨åˆ° .app/render/ æ–‡ä»¶å¤¹ï¼Œ å¹¶åˆ›å»º app.jsxæ–‡ä»¶ä½œä¸ºreactçš„å…¥å£æ–‡ä»¶ 12mv ./app/main/index.html ./app/renderer/touch ./app/renderer/App.jsx index.html æ›´æ”¹å¦‚ä¸‹ï¼š 123456789101112131415&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt; &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt; &lt;title&gt;Electron Platform&lt;/title&gt; &lt;style&gt; * &#123; margin: 0; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; App.jsx 1234567891011121314151617import React from &#x27;react&#x27;import ReactDOM from &#x27;react-dom&#x27;import &#123; HashRouter as Router, Route, Switch &#125; from &#x27;react-router-dom&#x27;function App() &#123; return ( &lt;Router&gt; &lt;Switch&gt; &lt;Route path=&#x27;/&#x27;&gt; &lt;div&gt;å¯è§†åŒ–å¼€å‘å¹³å°&lt;/div&gt; &lt;/Route&gt; &lt;/Switch&gt; &lt;/Router&gt; )&#125;ReactDOM.render(&lt;App/&gt;, document.getElementById(&#x27;root&#x27;)) ä¿®æ”¹electronä¸»çº¿ç¨‹é…ç½®ï¼Œé…åˆreactåšå•é¡µé¢åº”ç”¨æ—¢ç„¶åŸºç¡€æ–‡ä»¶ç»“æ„æ”¹äº†ï¼Œé‚£ä¹ˆ .app/main/electron.js ä¹Ÿå¾—è·Ÿç€å¢åŠ ä»¥ä¸‹é…ç½®ï¼š 12345678910111213141516...const isDev = () =&gt; &#123; // å¯¹åº” webpack.main.dev.jsé‡Œçš„ webpack.DefinePluginçš„å®šä¹‰ return process.env.NODE_ENV === &#x27;development&#x27;;&#125;...const createWindow = () =&gt; &#123; ... // åˆ©ç”¨ if (isDev()) &#123; mainWindow.loadURL(&#x27;http://127.0.0.1:7001&#x27;) &#125; else &#123; mainWindow.loadURL(`file://$&#123;path.join(__dirname, &#x27;./dist/index.html&#x27;)&#125;`) &#125;&#125; package.json çš„ script ä¿®æ”¹å¦‚ä¸‹ 1234&quot;scripts&quot;: &#123; &quot;start:main&quot;: &quot;cross-env NODE_ENV=development webpack --config ./webpack.main.dev.js &amp;&amp; electron ./dist/electron.js&quot;, &quot;start:render&quot;: &quot;webpack-dev-server --config ./webpack.renderer.dev.js&quot;&#125;, æŠ¥é”™å¤„ç† å¦‚æœå‡ºç°æŠ¥é”™ï¼šUncaught ReferenceError: require is not definedï¼Œè¯·æ£€æŸ¥ä½ æ˜¯å¦åœ¨ä¸»è¿›ç¨‹ä¸­æ·»åŠ è¿™è¡Œä»£ç ï¼Œå¦‚æœæ·»åŠ äº†ï¼Œè¯·ç¡®ä¿ä½ æ­å»ºé¡¹ç›®çš„ Electron ä¸æœ¬åº”ç”¨çš„ç‰ˆæœ¬ä¸€è‡´(å½“å‰é¡¹ç›®çš„ Electron@^11.1.1) è¯·è‡ªæ£€æŸ¥ä¸€ä¸‹ä½ çš„ç‰ˆæœ¬æ˜¯å¦æ­£ç¡®ï¼Œè¿›å…¥ node_modulesï¼Œæ‰¾åˆ° electronï¼Œçœ‹çœ‹ package.json ä¸­çš„ version æ˜¯å¦æ˜¯ 11.1.1ã€‚ Vueç°æˆæ¨¡æ¿ï¼šelectron-react-boilerplate å’Œ electron-vueVue æˆ– React å‡æœ‰ä¸€ä¸ªç°æˆçš„æ¨¡æ¿å¯ç”¨ï¼Œè¿™ä¸¤ä¸ªè¯¥æ¨¡æ¿å…±åŒå¥½å¤„æ˜¯ï¼Œåªéœ€è¦ä¸€ä¸ªç»ˆç«¯ï¼Œä¾¿å¯è·‘èµ·ELectronçš„ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ï¼Œé›†æˆåº¦æ›´é«˜ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªæ¨¡æ¿çš„é…ç½®ã€‚ electron-react-boilerplate ä¸¤ä¸ªç»ˆç«¯é›†æˆåŸç†electron-react-boilerplate é›†æˆä¸¤ä¸ªç»ˆç«¯æ˜¯ä½¿ç”¨äº†webpackçš„ä¸€ä¸ªapi webpack deverserve before apiï¼Œåœ¨å…¶æºç æ–‡ä»¶webpack.config.renderer.dev.babel.jsé‡Œå¯ä»¥çœ‹åˆ°é…ç½® 12345678910111213141516import &#123; spawn, execSync &#125; from &#x27;child_process&#x27;export default merge(baseConfig, &#123; ... before() &#123; console.log(&#x27;Starting Main Process...&#x27;); // åˆ©ç”¨nodeçš„ spawn api è·‘ä¸€ä¸ª start:main çš„å­è¿›ç¨‹ spawn(&#x27;npm&#x27;, [&#x27;run&#x27;, &#x27;start:main&#x27;], &#123; shell: true, env: process.env, stdio: &#x27;inherit&#x27;, &#125;) .on(&#x27;close&#x27;, (code) =&gt; process.exit(code)) .on(&#x27;error&#x27;, (spawnError) =&gt; console.error(spawnError)); &#125;,&#125; å…¶å®å¾ˆç®€å•ï¼Œåˆ©ç”¨äº†nodeçš„child_process api æ–°å¼€äº†ä¸ªè¿›ç¨‹ï¼Œè®©æ¸²æŸ“è¿›ç¨‹è·‘åœ¨è¯¥è¿›ç¨‹ä¹‹ä¸Š webpack.devserver.before api ç±»ä¼¼äº webpack çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œè¿˜æœ‰ä¸€ä¸ª webpack.devserver.after electron-vue ä¸¤ä¸ªç»ˆç«¯é›†æˆåŸç†electron-vue æ˜¯å› ä¸ºè¿™ä¸ªçš„è„šæœ¬dev-runner.jsï¼Œåˆ©ç”¨ Promise.all()ï¼Œå‡½æ•°è¿›è¡Œè°ƒç”¨ï¼ŒæŠŠä¸¤ä¸ªç»ˆç«¯æ“ä½œèåˆåˆ°ä¸€èµ·ï¼š 12345678910111213141516...function init () &#123; greeting() // startRender() åˆ©ç”¨ Promise.all([startRenderer(), startMain()]) .then(() =&gt; &#123; startElectron() &#125;) .catch(err =&gt; &#123; console.error(err) &#125;)&#125;init()","tags":["React","Webpack","Vue","Electron"]},{"title":"Nginxè‡ªå­¦ç¬”è®°","path":"/2021/05/28/ã€2021-05-28ã€‘Nginxè‡ªå­¦ç¬”è®°/","content":"Ngixè¿™å‡ å¹´å¤ªç«äº†ï¼Œåœ¨ä¸ä¹…çš„å°†æ¥ä¼šè¶…è¿‡Apacheï¼Œç”±äºä»–çš„åº•å±‚ç”¨epollï¼Œç°åœ¨å¤šç”¨äºæœåŠ¡å™¨ç«¯çš„åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ ï¼Œå¼ºå¤§çš„å¹¶å‘æ€§èƒ½ä½¿å…¶åŸºæœ¬ä¸Šæ²¡æœ‰é¡¹ç›®ä¸ç”¨ä»–ã€‚æœ¬ç¯‡æŠŠ Ngix çš„åŸºç¡€é…ç½®æ’¸äº†ä¸€éï¼Œè®°ä¸‹æ¥ä»¥å…ä»¥åå¿˜äº†ã€‚ å®‰è£…å¯æŸ¥çœ‹Nginxå®˜ç½‘ è¿æ¥è¿œç¨‹æœåŠ¡å™¨1ssh root@8.134.120.206 è¾“å…¥å¯†ç åè§åˆ°ç™»å½•äº† å®‰è£…äº›å¿…è¦çš„å·¥å…·12yum -y install gcc gcc-c++ autoconf pcre-devel make automakeyum -y install wget httpd-tools vim è¿”å›å®¶ç›®åˆ›å»ºNginxä¸»è¦æ–‡ä»¶å¤¹123cd ~mkdir nginx-learn &amp;&amp; cd nginx-learnmkdir app backup download logs work app: æ”¾ç¨‹åºæºç backup: å¤‡ä»½æ–‡ä»¶download: ä¸‹è½½æ–‡ä»¶å¤¹logs: æ—¥å¿—work: æ”¾ä¸€äº›é¡¹ç›®æ–‡æ¡£ å®‰è£…æœ€æ–°ç‰ˆNginxéœ€æŸ¥çœ‹Nginxçš„yumæºçš„ç‰ˆæœ¬ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1yum list | grep nginx yum æºçš„æ›´æ–°é…ç½®ï¼Œå¤åˆ¶Nginxå®˜ç½‘è¿™é‡Œçš„é…ç½®ï¼Œæˆ‘æŠŠä»–ç²˜å‡ºæ¥ 123456789101112131415[nginx-stable]name=nginx stable repobaseurl=http://nginx.org/packages/centos/$releasever/$basearch/gpgcheck=1enabled=1gpgkey=https://nginx.org/keys/nginx_signing.keymodule_hotfixes=true[nginx-mainline]name=nginx mainline repobaseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/gpgcheck=1enabled=0gpgkey=https://nginx.org/keys/nginx_signing.keymodule_hotfixes=true 1vim /etc/yum.repos.d/nginx.repo å…¶ä¸­ baseurl=http://nginx.org/packages/centos/$releasever/$basearch/ çš„ $releasever æˆ‘ç”¨çš„æ˜¯centOS 7çš„ç‰ˆæœ¬ï¼Œæ‰€ä»¥æˆ‘ç›´æ¥æ”¹æˆ7ï¼Œå¦‚ä¸‹ï¼š è¿™æ¬¡å†å®‰è£…nginx 1234yum install nginxnginx -v# ornginx -V å¯ä»¥å‘ç°æ›´æ–°åˆ°æœ€æ–°çš„nginxç‰ˆæœ¬ æŸ¥çœ‹æ‰€æœ‰ nginx ç›®å½•åŠé…ç½®æ–‡ä»¶çš„å‘½ä»¤ï¼š 1rpm -ql nginx Nginxé…ç½®é¡¹è¯¦è§£é…ç½®é¡¹ï¼šå¤§éƒ¨åˆ†å·¥ä½œåœ¨ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶æ‰§è¡Œä¿®æ”¹ï¼š/etc/nginx/nginx.confcd /etc/nginxcat nginx.conf ä¸‹é¢è§£é‡Šä¸€ä¸‹å„é…ç½®çš„ä½œç”¨ï¼š 123456789101112131415161718192021222324252627282930313233343536373839user nginx; # é»˜è®¤ç”¨æˆ·worker_processes auto; # è¿›ç¨‹æ•°ï¼Œå³cpuæ•°error_log /var/log/nginx/error.log notice; # é”™è¯¯æ—¥å¿—pid /var/run/nginx.pid; # è¿›ç¨‹events &#123; worker_connections 1024; # å…è®¸æœ€å¤§è¿æ¥æ•°&#125;http &#123; include /etc/nginx/mime.types; # æ–‡ä»¶æ‰©å±•åçš„æ˜ å°„è¡¨ default_type application/octet-stream; # # è®¾ç½®æ—¥å¿—æ ¼å¼ï¼š log_format main &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27; &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27; &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;; # è®¿é—®æ—¥å¿—å­˜æ”¾ä½ç½® access_log /var/log/nginx/access.log main; # å¼€å¯é»˜è®¤ä¼ è¾“æ¨¡å¼ sendfile on; # å‡å°‘ç½‘ç»œæŠ¥æ–‡æ•°é‡ #tcp_nopush on; # è¶…æ—¶æ—¶é—´ keepalive_timeout 65; # å¼€å¯å‹ç¼© #gzip on; # å­é…ç½®é¡¹ include /etc/nginx/conf.d/*.conf;&#125; 12cd conf.d/vim default.conf 12345678910111213141516171819202122232425262728293031323334353637383940414243server &#123; listen 80; # ç›‘å¬ç«¯å£å· server_name localhost; #access_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;host.access.log main; location &#x2F; &#123; root &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html; index index.html index.htm; &#125; #error_page 404 &#x2F;404.html; # redirect server error pages to the static page &#x2F;50x.html # error_page 500 502 503 504 &#x2F;50x.html; location &#x3D; &#x2F;50x.html &#123; root &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html; &#125; # proxy the PHP scripts to Apache listening on 127.0.0.1:80 # #location ~ \\.php$ &#123; # proxy_pass http:&#x2F;&#x2F;127.0.0.1; #&#125; # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000 # #location ~ \\.php$ &#123; # root html; # fastcgi_pass 127.0.0.1:9000; # fastcgi_index index.php; # fastcgi_param SCRIPT_FILENAME &#x2F;scripts$fastcgi_script_name; # include fastcgi_params; #&#125; # deny access to .htaccess files, if Apache&#39;s document root # concurs with nginx&#39;s one # #location ~ &#x2F;\\.ht &#123; # deny all; #&#125;&#125; ç½‘ç«™æ ¹ç›®å½•æˆ‘ä»¬æ”¹åŠ¨ä¸€ç‚¹æ ¹ç›®å½•çš„å†…å®¹ï¼š 1vim /usr/share/nginx/html/index.html è¿è¡ŒNginxå¼€å¯1nginx å…³é—­123456# æ­£å¸¸å…³åœnginx -s quit# å‡ ç§å¼ºåˆ¶å…³åœnginx -s stopkillall nginx é‡è½½æ¯æ¬¡æ”¹å®Œé…ç½®æ–‡ä»¶åï¼Œéœ€è¦é‡è½½nginxï¼Œè¿è¡Œä¸€ä¸‹å‘½ä»¤ï¼š 1nginx -s reload Linuxé€šç”¨å‘½ä»¤æ‰§è¡Œå¼€å¯ï¼Œå…³é—­å’Œé‡è½½å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç”¨Linuxçš„é€šç”¨å‘½ä»¤è¿›è¡Œå…³åœæˆ–é‡å¯ï¼š 12345678# æˆ– Linuxé€šç”¨å‘½ä»¤ï¼šsystemctl start nginx.service# Linuxé€šç”¨å‘½ä»¤å…³åœï¼šsystemctl stop nginx.service# é‡å¯ï¼šsystemctl restart nginx.service æŸ¥çœ‹è¿›ç¨‹é€šè¿‡æŸ¥çœ‹nginxæ‰€æœ‰è¿›ç¨‹ç¡®è®¤å…¶å·²ç»è¿è¡Œï¼š 1ps aux | grep nginx æŸ¥çœ‹æ‰€æœ‰å¼€å¯çš„ç«¯å£å·1netstat -tlnp é…ç½®ä¸€ä¸ª404é¡µé¢ï¼Œä¿®æ”¹ä¸€ä¸ªé…ç½®å¦‚ä¸‹ï¼š 1vim /etc/nginx/conf.d/default.conf å¢åŠ ä¸€è¡Œï¼Œæ”¹æˆè¿™æ ·ï¼š åšä¸€ä¸ª404é¡µé¢ï¼š 1vim /usr/share/nginx/html/404_error.html å†™å®Œé¡µé¢åï¼Œåœ°å€æ éšä¾¿è¾“å…¥ä¸€åœ°å€ä¼šå‘ç°å‡ºç°äº†404é¡µé¢ï¼š ä¹Ÿå¯ä»¥é‡å®šå‘åˆ°å…¶ä»–é¡µé¢ï¼Œå¦‚ï¼š 1vim /etc/nginx/conf.d/default.conf æƒé™æ§åˆ¶ç¦æ­¢æŸäº›ipä¸èƒ½è®¿é—®1vim /etc/nginx/conf.d/default.conf åœ¨default.confåŠ ä¸Š deny 113.65.137.13; ï¼Œå¦‚ä¸‹ï¼Œç¦æ­¢äº†æˆ‘æœ¬æœºä¸å¯ä»¥è®¿é—® å¦‚æœè¦ç¦æ­¢æŸä¸€ç½‘æ®µçš„IPä¸èƒ½è®¿é—®ï¼Œåˆ™å†™ï¼šdeny 113.65.137.13/200; ï¼Œè¡¨ç¤º 13 åˆ° 200 çš„æ‰€æœ‰IPå·éƒ½ä¸èƒ½è®¿é—® allow å…è®¸å“ªäº›IPå¯ä»¥è®¿é—® æ³¨æ„ï¼ï¼ï¼default.conf æ–‡ä»¶æ˜¯ä»ä¸Šå¾€ä¸‹æ‰§è¡Œï¼Œå¦‚ deny all; å†™åœ¨ allow 113.65.137.13;ä¹‹å‰ï¼Œé‚£ä¹ˆ113.65.137.13ä»ä¸èƒ½è®¿é—® å†æ¬¡åœ¨é¡µé¢æ‰“å¼€ï¼Œå°±ä¼šå‘ç°ä¸èƒ½è®¿é—®é¡µé¢ï¼Œå‡ºç°403é¡µé¢ï¼š ç²¾ç¡®åŒ¹é…è·¯å¾„è®¿é—®æƒé™ åœ¨ location é…ç½®æŸäº›è·¯å¾„å…è®¸å“ªäº›IP è¿›è¡Œè®¿é—®ï¼Œæ·»åŠ å¦‚ä¸‹ï¼š éƒ½æ˜¯æ­£åˆ™åŒ¹é…ï¼Œé™¤äº†è·¯å¾„ï¼Œè¿˜å¯åŒ¹é…ä¸èƒ½è®¿é—®çš„æ–‡ä»¶ï¼Œå¦‚ .php ç»“å°¾çš„æ–‡ä»¶ 123456789location =/img &#123; allow all;&#125;location =/admin &#123; deny all;&#125;location ~\\.php$ &#123; deny all;&#125; è™šæ‹Ÿä¸»æœºé…ç½®è™šæ‹Ÿä¸»æœºçš„å¥½å¤„ï¼Œå¯ä»¥çœé’±ï¼Œä¸€å°ç‰©ç†æœåŠ¡å™¨å¯åˆ’åˆ†å¤šä¸ªç©ºé—´ï¼Œæ¯ä¸ªç‹¬ç«‹ç©ºé—´å¯é…ç½®ç‹¬ç«‹çš„è™šæ‹Ÿä¸»æœºï¼Œå½¼æ­¤ç›¸äº’éš”ç¦»ï¼Œæ¯ä¸ªè™šæ‹Ÿä¸»æœºå¯ä»¥ç‹¬ç«‹é…ç½®webæœåŠ¡ åŸºäºç«¯å£å·é…ç½®è™šæ‹Ÿä¸»æœºåœ¨ /etc/nginx/conf.d/ ä¸‹æ–°å»º 8001.conf æ–‡ä»¶ï¼Œç”¨äºé…ç½® 8001 ç«¯å£çš„è™šæ‹Ÿä¸»æœº 1vim /etc/nginx/conf.d/8001.conf åŸºäºæ”¹è™šæ‹Ÿä¸»æœºé…ç½®ä¸€ä¸ª index.html æ–‡ä»¶ï¼š 1touch /usr/share/nginx/html/html8001/index.html å†™ä¸‹ 1&lt;h1&gt;welcome to port 8001&lt;/h1&gt; æˆ‘è¿™é‡Œç”¨çš„æ˜¯é˜¿é‡Œäº‘åšæ¼”ç¤ºï¼Œæ‰€ä»¥è¿”å›é˜¿é‡Œäº‘ç•Œé¢é…ç½®8001ç«¯å£ï¼š åŸºäºIPé…ç½®è™šæ‹Ÿä¸»æœºåŒæ ·æ˜¯æ”¹å˜ 8001.conf æ–‡ä»¶çš„ localhost é¡¹çš„é…ç½® 1vim /etc/nginx/conf.d/8001.conf å¦‚ï¼š 123456server&#123; listen 80; server_name 192.168.1.200; root /usr/share/nginx/html/html8001; index index.html;&#125; åŸºäºåŸŸåé…ç½®è™šæ‹Ÿä¸»æœºåœ¨é˜¿é‡Œäº‘ä¸Šç”³è¯·åŸŸåï¼Œè¿™é‡Œä¸æ¼”ç¤ºï¼Œç°åœ¨ .top ç»“å°¾çš„åŸŸååœ¨åšä¿ƒé”€ï¼Œèµ·ä¸ªç¨å¾®é•¿ç‚¹çš„åŸŸåæ³¨å†Œåªéœ€9å…ƒå°±èƒ½æ³¨å†Œä¸€å¹´ï¼Œ æˆ‘è¿™é‡Œæ³¨å†Œäº† service-learn.top èŠ±äº†9å…ƒ ç‚¹å‡»åŸŸåè§£æï¼š è¾“å…¥ipåœ°å€ï¼Œç±»å‹é€‰æ‹©Aç±»å‹ï¼š åœ¨nginx é…ç½® 1vim /etc/nginx/conf.d/default.conf å°† server_name localhost; æ”¹ä¸º server_name niginx.service-learn.top; åŒæ ·çš„åŸæ¥çš„åŸºäºç«¯å£çš„è™šæ‹Ÿæœº8001ç«¯å£ä¹Ÿä¿®æ”¹ï¼šå…ˆå»é˜¿é‡Œäº‘é…ç½®è§£æ nginx2.service-learn.top åœ°å€ 1vim /etc/nginx/conf.d/8001.conf å°† server_name localhost; æ”¹ä¸º server_name nginx2.service-learn.top;ï¼Œæ”¹åå¦‚ä¸‹ï¼š 123456server&#123; listen 80; server_name nginx2.service-learn.top; root /usr/share/nginx/html/html8001; index index.html;&#125; åå‘ä»£ç†æ­£å‘ä»£ç†ï¼ˆProxyï¼‰ä¸ºå®¢æˆ·ç«¯åšçš„ä»£ç†æœåŠ¡å™¨ï¼Œæœ€å½¢è±¡çš„è§£é‡Šå°±æ˜¯ï¼Œæˆ‘ä»¬å¹³æ—¶ç”¨vpnç¿»å¢™ä¸Šå¤–ç½‘ï¼Œ åå‘ä»£ç†ï¼ˆReverse Proxy)ä¸ºæœåŠ¡ç«¯åšçš„ä»£ç†æœåŠ¡ï¼Œåå‘ä»£ç†æœ€å¤§çš„å¥½å¤„æ˜¯ å®‰å…¨æ€§ï¼Œä½¿ç”¨åå‘ä»£ç†å®¢æˆ·ç«¯ç”¨æˆ·åªèƒ½é€šè¿‡å¤–æ¥ç½‘æ¥è®¿é—®ä»£ç†æœåŠ¡å™¨ï¼Œå¹¶ä¸”ç”¨æˆ·å¹¶ä¸çŸ¥é“è‡ªå·±è®¿é—®çš„çœŸå®æœåŠ¡å™¨æ˜¯é‚£ä¸€å°ï¼Œå¯ä»¥å¾ˆå¥½çš„æä¾›å®‰å…¨ä¿æŠ¤ã€‚åœ¨é­å—ç½‘ç»œæ”»å‡»æ—¶ï¼Œä¼šè¢«åœç•™åœ¨åå‘ä»£ç†ä¸Šï¼Œæ”»å‡»ä¸åˆ°æˆ‘ä»¬çœŸå®çš„æœåŠ¡å™¨ã€‚ åŠŸèƒ½æ€§ï¼Œåå‘ä»£ç†çš„ä¸»è¦ç”¨é€”æ˜¯ä¸ºå¤šä¸ªæœåŠ¡å™¨æä¾›è´Ÿå€ºå‡è¡¡ã€ç¼“å­˜ç­‰åŠŸèƒ½ã€‚è´Ÿè½½å‡è¡¡å°±æ˜¯ä¸€ä¸ªç½‘ç«™çš„å†…å®¹è¢«éƒ¨ç½²åœ¨è‹¥å¹²æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥æŠŠè¿™äº›æœºå­çœ‹æˆä¸€ä¸ªé›†ç¾¤ï¼Œé‚£Nginxå¯ä»¥å°†æ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯è¯·æ±‚â€œå‡åŒ€åœ°â€åˆ†é…åˆ°è¿™ä¸ªé›†ç¾¤ä¸­æ‰€æœ‰çš„æœåŠ¡å™¨ä¸Šï¼Œä»è€Œå®ç°æœåŠ¡å™¨å‹åŠ›çš„å¹³å‡åˆ†é…ï¼Œä¹Ÿå«è´Ÿè½½å‡è¡¡ã€‚ Nginxçš„åå‘ä»£ç†å®æ“è¿™é‡Œæˆ‘ä»¬ç”¨ 8001 çš„é…ç½®æ¥åšåå‘ä»£ç†ï¼Œè®¾ç½®ä¹Ÿå¾ˆç®€å•ï¼Œä¿®æ”¹ vim /etc/nginx/conf.d/8001.conf å¦‚ä¸‹ æˆ‘ä»¬è¦è®¿é—® 8.134.120.206:8001 ç«¯å£çš„ç½‘ç«™ï¼Œåå‘ä»£ç†åˆ° æˆ‘çš„åšå®¢ è¿™ä¸ªç½‘ç«™ä¸Š 1234567server&#123; listen 8001; server_name 8.134.120.206; location / &#123; proxy_pass http://zyzy.info; &#125;&#125; æ‰“å¼€æµè§ˆå™¨æ˜¾ç¤ºå¦‚ä¸‹ï¼Œåå‘ä»£ç†è®¾ç½®æˆåŠŸï¼š åå‘ä»£ç†å…¶ä»–é…ç½®å‚æ•°proxy_set_header :åœ¨å°†å®¢æˆ·ç«¯è¯·æ±‚å‘é€ç»™åç«¯æœåŠ¡å™¨ä¹‹å‰ï¼Œæ›´æ”¹æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚å¤´ä¿¡æ¯ã€‚proxy_connect_timeout:é…ç½®Nginxä¸åç«¯ä»£ç†æœåŠ¡å™¨å°è¯•å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚proxy_read_timeout : é…ç½®Nginxå‘åç«¯æœåŠ¡å™¨ç»„å‘å‡ºreadè¯·æ±‚åï¼Œç­‰å¾…ç›¸åº”çš„è¶…æ—¶æ—¶é—´ã€‚proxy_send_timeoutï¼šé…ç½®Nginxå‘åç«¯æœåŠ¡å™¨ç»„å‘å‡ºwriteè¯·æ±‚åï¼Œç­‰å¾…ç›¸åº”çš„è¶…æ—¶æ—¶é—´ã€‚proxy_redirect :ç”¨äºä¿®æ”¹åç«¯æœåŠ¡å™¨è¿”å›çš„å“åº”å¤´ä¸­çš„Locationå’ŒRefreshã€‚ Nginxé€‚é…ç§»åŠ¨ç«¯è¿™é‡Œå’Œå‰ç«¯çš„è°ƒæ•´é¡µé¢å¸ƒå±€çš„è‡ªé€‚åº”ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œç°åœ¨çš„ç§»åŠ¨ç«¯é€‚é…ï¼Œæ˜¯ç”±äºä¸åŒåŸŸåçš„åˆ‡æ¢ï¼Œå¼•èµ·çš„é€‚é…ï¼Œæ‰€ä»¥Nginxåœ¨è¿™å—å°±èƒ½å‘æŒ¥ä½œç”¨ï¼Œè¿™ç§é€šè¿‡Nginxçš„é€‚é…ï¼Œä½“éªŒæ•ˆæœä¼šæ›´å¥½ï¼ŒåŒ…æ‹¬æ·˜å®äº¬ä¸œåœ¨å†…çš„å›½å†…å¤§å‹ç½‘ç«™éƒ½æ˜¯é‡‡ç”¨Nginxçš„æ–¹æ¡ˆ æˆ‘ä»¬å¯ä»¥æ‰“å¼€æµè§ˆå™¨æ‰“å¼€äº¬ä¸œçœ‹åˆ°è¿™ç§é€‚é…ï¼š æˆ‘ä»¬æ¥åšç±»ä¼¼çš„åŠŸèƒ½ï¼š å»ºç«‹pcå’Œç§»åŠ¨ç«¯ä¸¤ä¸ªæ–‡ä»¶å¤¹ 1mkdir /usr/share/nginx/pc /usr/share/nginx/mobile åˆ†åˆ«ç¼–è¾‘ vim /usr/share/nginx/mobile/pc/index.html å’Œ vim /usr/share/nginx/mobile/mobile/index.htmlï¼Œéšä¾¿å†™ç‚¹å†…å®¹ ç¼–è¾‘Nginxè®¾ç½®å¦‚ä¸‹å³å¯ 1234567891011server&#123; listen 8001; server_name 8.134.120.206; location / &#123; root /usr/share/nginx/pc; if ($http_user_agent ~* &#x27;Android|webOS|iPhone|BlackBerry&#x27;) &#123; root /usr/share/nginx/mobile; &#125; index index.html; &#125;&#125; æ‰“å¼€æµè§ˆå™¨çœ‹çœ‹æ•ˆæœ Gzipå‹ç¼©ç½‘é¡µçš„ä¸€ç§å‹ç¼©æŠ€æœ¯ï¼Œç»è¿‡Gzipå‹ç¼©è¿‡åçš„ç½‘é¡µï¼Œä¼šç¼©å°åˆ°åŸæ¥30%çš„å¤§å° æŸ¥çœ‹ä¸€ä¸ªç½‘ç«™æ˜¯å¦æœ‰gzipå‹ç¼©åœ¨ç«™é•¿å·¥å…· é‡ŒæŸ¥çœ‹ï¼Œç›´æ¥è¾“å…¥åŸŸåå³å¯ï¼Œä¾‹å¦‚æˆ‘ä»¬æŸ¥è¯¢ 8.134.120.206è¿˜æ²¡é…ç½®gzipå‹ç¼© Nginxçš„gzipå‹ç¼©åŠŸèƒ½éå¸¸ä¸°å¯Œï¼Œé…ç½®ä¹Ÿå¾ˆç®€å• 1vim /etc/nginx/nginx.conf æ·»åŠ ä¸¤è¡Œé…ç½®å¦‚ä¸‹ï¼š 12gzip on;gzip_types text/plain application/javascript text/css; æ”¹å®Œåé‡è½½NginxæœåŠ¡ï¼Œå†ç”¨ç«™é•¿å·¥å…·æŸ¥è¯¢å¯çœ‹åˆ°","tags":["åç«¯","Nginx","åå‘ä»£ç†"]},{"title":"Dartè¯­æ³•è‡ªå­¦ç¬”è®°ï¼ˆäºŒï¼‰","path":"/2021/05/26/ã€2021-05-26ã€‘Dartè¯­æ³•è‡ªå­¦ç¬”è®°ï¼ˆäºŒï¼‰/","content":"æœ¬ç¯‡ä»‹ç»Dartçš„å‡½æ•°ï¼Œç±»ï¼ŒæŠ½è±¡ç±»ï¼Œæ¥å£ï¼Œæ³›å‹åŠåº“çš„ä½¿ç”¨ å‘½åå‡½æ•°ï¼ŒåŒ¿åå‡½æ•°ï¼Œç®­å¤´å‡½æ•°æ³¨æ„ï¼ï¼ç®­å¤´å‡½æ•°åªèƒ½å†™ä¸€ä¸ªè¯­å¥ 12345678910// void å¯çœç•¥void func () &#123; print(&#x27;hello world&#x27;);&#125;;// åŒ¿å() &#123; print(123); &#125;;// ç®­å¤´func2 () =&gt; print(123); å‡½æ•°çš„å®šä¹‰åŠè°ƒç”¨123456789101112int sunNum(int n)&#123; var sum = 0; for (var i =1; i&lt;=n; i++) &#123; sum+=i; &#125; return sum;&#125;void main() &#123; print(sumNum(10)); // 55&#125; å¯é€‰å‚æ•°ï¼Œ é»˜è®¤å‚æ•°ï¼Œå‘½åå‚æ•° å¯é€‰å‚æ•°ï¼Œç”¨ [] æ‹¬èµ·æ¥ï¼Œä¸”ä¸èƒ½æŒ‡å®šç±»å‹ é»˜è®¤å‚æ•°ï¼Œç›´æ¥ç­‰äºä¸€ä¸ªå€¼å°±æ˜¯é»˜è®¤å‚æ•°ï¼Œå¯æŒ‡å®šç±»å‹ 123456789String userInfo (String username, [age, String gender=&#x27;m&#x27;] ) &#123; if (age == null ) return &#x27;$username&#x27;; return &#x27;$username, $age, $gender&#x27;;&#125;void main()&#123; print(userInfo(&#x27;æ²¡åå­—&#x27;, 23)); // æ²¡åå­—, 23, m&#125; å‘½åå‚æ•°ï¼Œå’Œä¸Šé¢ä¸¤ç§ç±»ä¼¼ï¼Œå¦‚æœè¦æŒ‡å®šç±»å‹ï¼Œåˆ™å¿…é¡»æœ‰é»˜è®¤å€¼ 123456789yyy (String username, &#123;age, String gender=&#x27;male&#x27;, job=&#x27;programmer&#x27;&#125;) &#123; if (age == null || job == null) return &#x27;$username, å¹´é¾„ä¿å¯†, $gender&#x27;; return &#x27;$username, å¹´é¾„ä¿å¯†, $gender, $job&#x27;;&#125;void main () &#123; print(yyy(&#x27;å¼ ä¸‰&#x27;, age:23, gender: &#x27;female&#x27;)); // å¼ ä¸‰, å¹´é¾„ä¿å¯†, male programmer&#125; æŠŠå‡½æ•°ä½œä¸ºå‚æ•°ä¼ å‚12345678fn1() =&gt; print(&#x27;fn1&#x27;);fn2(fn)&#123; fn();&#125;void main() &#123; fn2(fn1); // fn1&#125; ç±»å’Œæ„é€ å‡½æ•° dartä¸ºå•ç»§æ‰¿è¯­è¨€ ç±»é‡Œçš„åŒåæ–¹æ³•ä¸ºæ„é€ å‡½æ•°ï¼Œåœ¨æ„é€ å‡½æ•°ç”Ÿæˆä¹‹å‰è¿˜èƒ½æ‰§è¡Œå…¶ä»–çš„æ“ä½œï¼Œå†™åœ¨æ‹¬å·å’Œå·¦èŠ±æ‹¬å·ä¹‹é—´ï¼Œå¦‚ä¸‹ï¼š 123456789101112131415161718class PersonY &#123; String name; int age; // ä¸”æ„é€ å‡½æ•°ä¹‹å‰è¿˜èƒ½è¿›è¡Œæ“ä½œ :name=&#x27;æ„é€ å‡½æ•°ä¹‹å‰ç”Ÿæˆçš„name&#x27;, age=999 .ç”¨çš„å°‘ PersonY(String name, int age): name=&#x27;æ„é€ å‡½æ•°ä¹‹å‰ç”Ÿæˆçš„name&#x27;, age=999 &#123; print(&#x27;æ„é€ å‡½æ•°ç”Ÿæˆä¹‹å‰æ‰“å°çš„å†…å®¹:$&#123;this.name&#125;--$&#123;this.age&#125;&#x27;); this.name=name; this.age=age; &#125;&#125;main() &#123; PersonY p2 = new PersonY(&#x27;æå››&#x27;, 45); print(p2.name); // æ„é€ å‡½æ•°ç”Ÿæˆä¹‹å‰æ‰“å°çš„å†…å®¹:æ„é€ å‡½æ•°ä¹‹å‰ç”Ÿæˆçš„name--999 // æå››&#125; æ„é€ å‡½æ•°å¯ä»¥ç®€å†™ dartæ„é€ å‡½æ•°åªæœ‰ä¸€ä¸ªï¼Œä½†å‘½åæ„é€ å‡½æ•°å¯ä»¥å†™å¤šä¸ªï¼š 123456789101112131415161718class PersonZ &#123; String name; int age; // ç®€å†™ï¼š PersonZ(this.name, this.age); // å‘½åæ„é€ å‡½æ•°ï¼šå¦‚æœæœ‰å±æ€§ï¼Œåˆ™ä¸€å®šè¦ä¼ å…¥å±æ€§ç»´æŠ¤èµ·æ¥ï¼šä¾‹å¦‚è¿™é‡Œçš„ this.name å’Œ this.age PersonZ.named(this.name, this.age) &#123; print(&#x27;è¿™æ˜¯å‘½åæ„é€ å‡½æ•°&#x27;); &#125;&#125;main() &#123; // è°ƒç”¨å‘½åæ„é€ å‡½æ•°ä»è¦ä¼ å‚ï¼š PersonZ pp = new PersonZ.named(&#x27;xxxx&#x27;, 12); print(pp.name); print(pp.age); &#125; ä»¥ä¸Šæ‰§è¡Œè¾“å‡ºå¦‚ä¸‹ï¼š è¿™æ˜¯å‘½åæ„é€ å‡½æ•°xxxx12 ç§æœ‰å±æ€§darté‡Œå¹¶æ²¡æœ‰ public private protected ç­‰å…³é”®å­—ï¼Œå®šä¹‰ç§æœ‰å±æ€§æ—¶ï¼Œå¿…é¡»ï¼š ä»¥ _ ä¸ºå¼€å¤´çš„å±æ€§ ç‹¬ç«‹ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶ä¸” import åˆ° main æ–¹æ³•é‡Œæ‰§è¡Œï¼Œæ‰èƒ½è¾¾åˆ°ç§æœ‰å±æ€§çš„æ•ˆæœ 12345678910111213141516171819202122class Pet&#123; // ç§æœ‰å±æ€§å‰åŠ ä¸‹åˆ’çº¿,å¹¶ä¸”å¿…é¡»å†™åœ¨ç‹¬ç«‹çš„æ–‡ä»¶é‡Œ: String _name; int age; Pet(this._name, this.age); void printInfo() &#123; // ç±»é‡Œå¯ä»¥ç›´æ¥è®¿é—®ç§æœ‰å±æ€§_name, Petå¤–éƒ¨åˆ™ä¸èƒ½ print(&#x27;$&#123;this._name&#125;====$&#123;this.age&#125;&#x27;); &#125; // ç§æœ‰æ–¹æ³•_run void _run()&#123; print(&#x27;ç§æœ‰æ–¹æ³•&#x27;); &#125; // å¤–éƒ¨è®¿é—®ç§æœ‰æ–¹æ³•: execRun()&#123; this._run(); &#125;&#125; è°ƒç”¨å¤„ï¼š 12345678910111213141516// 1. å¿…é¡»å¸è½½ç‹¬ç«‹çš„æ–‡ä»¶é‡Œ,ç§æœ‰å˜é‡æ‰ç”Ÿæ•ˆ:import &#x27;./08-ç§æœ‰å±æ€§/Pet.dart&#x27;;void main() &#123; Pet a = new Pet(&#x27;ç‹—&#x27;, 3); /* // print(a._name); 2. æŠ¥é”™,ä¸èƒ½ç›´æ¥è®¿é—®,_nameä¸ºç§æœ‰å±æ€§,é¡»è¦å®šä¹‰æ–¹æ³•è®¿é—® */ // éç§æœ‰å±æ€§,å¯ä»¥ç›´æ¥è®¿é—®: print(a.age); // 3 a.printInfo(); // ç‹—====3 a.execRun(); //é—´æ¥è°ƒç”¨ç§æœ‰æ–¹æ³•&#125; è¿ç¼€æ“ä½œç¬¦123456789Person p2 = new Person(&#x27;ç‹äº”&#x27;, 34);p1..name = &#x27;æå››&#x27; ..age = 30 ..printInfo();// ç›¸å½“äº// p1.name = &#x27;æå››&#x27;;// p1.age = 30;// p1.printInfo(); ç»§æ‰¿å¯åˆ©ç”¨ vs code é‡Œçš„å¿«æ·æ–¹å¼è¿›è¡Œæ“ä½œï¼Œä¸ç”¨è‡ªå·±å†™ï¼š super å…³é”®å­—1234567891011121314151617181920212223242526272829303132class Person &#123; String name; num age; Person(this.name, this.age); void printInfo() &#123; print(&#x27;çˆ¶ç±»çš„printInfoï¼š$&#123;this.name&#125;---$&#123;this.age&#125;&#x27;); &#125;&#125;class Web extends Person &#123; String gender=&#x27;m&#x27;; Web(String name, num age, // String gender å­ç±»è‡ªå·±çš„å±æ€§ï¼š String gender) : // super å¯ç”¨äºç»§æ‰¿çˆ¶ç±»çš„å±æ€§ï¼š super(name, age) &#123; // 2. å±äºè¯¥å‡½æ•°è‡ªç”±çš„æ„é€ å‡½æ•°å†™è¿™é‡Œ: this.gender = gender; &#125; run()&#123; // super å¯ç”¨äºç»§æ‰¿çˆ¶ç±»çš„æ–¹æ³•ï¼š super.printInfo(); print(&#x27;$&#123;this.name&#125;--$&#123;this.age&#125;--$&#123;this.gender&#125;&#x27;); &#125; // é‡å†™çˆ¶ç±»å­˜åœ¨çš„æ–¹æ³•: @override, ç”¨äºæ ‡ç¤ºï¼Œå¯çœç•¥ @override void printInfo() &#123; print(&#x27;å­ç±»é‡å†™çš„æ–¹æ³•ï¼š$&#123;this.gender&#125;-$&#123;this.name&#125;&#x27;); &#125;&#125; abstract æŠ½è±¡ç±» æŠ½è±¡ç±»ï¼š 12345678910abstract class Pet &#123; // æŠ½è±¡æ–¹æ³•ï¼Œä¸å†™æ–¹æ³•ä½“ï¼š eat(); run(); // æŠ½è±¡ç±»é‡Œçš„æ™®é€šæ–¹æ³•ï¼š printInfo()&#123; print(&#x27;æŠ½è±¡ç±»çš„æ™®é€šæ–¹æ³•&#x27;); &#125;&#125; æŠ½è±¡æ–¹æ³•è¢«ç»§æ‰¿æ—¶å‡è¦é‡å†™ï¼š 12345678910111213class Dog extends Pet &#123; @override eat() &#123; // TODO: implement eat print(&#x27;å°ç‹—åƒéª¨å¤´&#x27;); &#125; @override run() &#123; // TODO: implement run print(&#x27;å°ç‹—åœ¨è·‘&#x27;); &#125;&#125; implements æ¥å£ darté‡Œæ²¡æœ‰æ¥å£çš„æ¦‚å¿µï¼Œç”¨æŠ½è±¡ç±»æ›¿ä»£ æ¥å£ç»§æ‰¿æ—¶ï¼Œç”¨å…³é”®å­— implements ä¸‹é¢çš„ä¾‹å­ä¸¾è¿æ¥æ•°æ®åº“çš„æŠ½è±¡ç±»å’Œå®ä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132abstract class Db &#123; String uri=&#x27;&#x27;; //æ•°æ®åº“è¿æ¥åœ°å€ add(String data); save(); delete();&#125;class Mysql implements Db &#123; @override String uri; Mysql(this.uri); @override add(String data) &#123; // TODO: implement add print(&#x27;è¿™æ˜¯mysqlçš„addæ–¹æ³•:$&#123;data&#125;&#x27;); &#125; @override delete() &#123; // TODO: implement delete return null; &#125; @override save() &#123; // TODO: implement save return null; &#125; &#125; ä¸€ä¸ªç±»å¯ implements å¤šä¸ªæ¥å£ï¼š 123456789101112131415abstract class A &#123; printA(); &#125;abstract class B &#123; printB(); &#125;class C implements A, B &#123; @override printA() &#123; // TODO: implement printA return null; &#125; @override printB() &#123; // TODO: implement printB return null; &#125;&#125; mixins æ··åˆ dart ç‰¹æœ‰çš„ç‰¹æ€§ï¼Œå› ä¸ºdartæ˜¯å•ç»§æ‰¿ï¼Œmixins å¯è®©å…¶å®ç°å®ç°ç±»ä¼¼å¤šç»§æ‰¿çš„ç‰¹æ€§ï¼Œä¸€ä¸ªç±»å¯ mixins å¤šä¸ªç±» å®ç°è¯¥ç‰¹æ€§ç”¨ with å…³é”®å­— è¢« mixins çš„çˆ¶ç±»ä¸èƒ½æœ‰æ„é€ å‡½æ•°ï¼Œå¦‚æœ‰æ„é€ å‡½æ•°ï¼Œä¸èƒ½è¢« mixins 1234567891011// D å’Œ E æ²¡æœ‰æ„é€ å‡½æ•°ï¼šclass D &#123; printD()&#123; print(&#x27;D&#x27;); &#125;&#125;class E &#123; printE()&#123; print(&#x27;E&#x27;); &#125;&#125;class F with D, E &#123;&#125;main() &#123; F f = new F(); f.printD(); // D f.printE(); // E&#125; æœ‰æ„é€ å‡½æ•°è¢« mixinsçš„æ–¹æ³•ï¼šextends åå† with, å¦‚ä¸‹ä¾‹å­: 123456789101112131415161718class Person &#123; String name; int age; // æ„é€ å‡½æ•°: Person(this.name, this.age); void printInfo()&#123; print(&#x27;$&#123;this.name&#125;-$&#123;this.age&#125;&#x27;);&#125;&#125;class G &#123; void printG()&#123;print(&#x27;G&#x27;);&#125; &#125;// P ç»§æ‰¿è‡ªPerson, ä¸”æ··åˆG: å› Personä¸­æœ‰æ„é€ å‡½æ•°Person(this.name, this.age); æ•…ä¸èƒ½ç›´æ¥withclass P extends Person with G &#123; P(String name, int age) : super(name, age);&#125;main() &#123; P p = new P(&#x27;å‘µå‘µ&#x27;,37); p.printInfo(); // å‘µå‘µ-37 p.printG(); // G&#125; æ³›å‹æ³›å‹å³å®šä¹‰ä¼ å…¥å’Œè¿”å›ç±»å‹çš„æ ¡éªŒçš„ä¸€ç§è§„èŒƒ 12345678910// 1. å®šä¹‰ä¸€ç§æ³›å‹ï¼Œè¿”å›çš„æ˜¯æ³›å‹ Tï¼Œä¼ å…¥çš„æ˜¯ç±»å‹ &lt;T&gt;ï¼ŒT getData &lt;T&gt; (T value)&#123; print(value);&#125;main() &#123; // 2. è°ƒç”¨æ³›å‹æ–¹æ³•å¹¶æŒ‡å®šç±»å‹ï¼š print(getData &lt;String&gt; (&#x27;ä½ å¥½&#x27;)); // ä½ å¥½ print(getData &lt;int&gt; (123)); // 123&#125; æ³›å‹ç”¨äºç±» 1234567891011121314151617181920// &lt;T&gt; å°†æ£€éªŒç±»å‹ä½œä¸ºå‚æ•°ä¼ å…¥class PrintClass &lt;T&gt; &#123; List list = &lt;T&gt;[]; // T å°†æ£€éªŒç±»å‹ä½œä¸ºå‚æ•°ä¼ å…¥ void add(T value) &#123; this.list.add(value); &#125; void printInfo() &#123; for(var i=0; i&lt;this.list.length; i++) &#123; print(this.list[i]); &#125; &#125;&#125;main() &#123; // è°ƒç”¨æ—¶é¡»ä¼ å…¥æ£€éªŒçš„ç±»å‹ &lt;String&gt; PrintClass p = new PrintClass &lt;String&gt; (); p.add(&#x27;xxxxxxx&#x27;); p.printInfo(); // xxxxxxx&#125; æ³›å‹ç”¨äºæ¥å£ 123456789101112131415161718192021abstract class Cache &lt;T&gt; &#123; getByKey(String key); void setByKey(String key, T value);&#125;// 3.1 å®ç°:class FileCache &lt;T&gt; implements Cache &lt;T&gt; &#123; @override getByKey(String key) &#123; return null; &#125; @override void setByKey(String key, T value) &#123; print(&#x27;æˆ‘æ˜¯æ–‡ä»¶ç¼“å­˜, æŠŠkey=$&#123;key&#125; value=$&#123;value&#125;çš„æ•°æ®å†™å…¥å†…å­˜ä¸­&#x27;); &#125;&#125;main() &#123; MemoryCache m = new MemoryCache &lt;String&gt; (); m.setByKey(&#x27;index&#x27;, &#x27;123&#x27;); // æˆ‘æ˜¯å†…å­˜ç¼“å­˜, æŠŠkey=index value=123çš„æ•°æ®å†™å…¥å†…å­˜ä¸­&#125; åº“çš„ä½¿ç”¨ ç³»ç»Ÿå†…ç½®åº“ï¼Œå¦‚ï¼š 1234567891011121314import &#x27;dart:io&#x27;;import &#x27;dart:convert&#x27;;_getDataFromZhihu() async &#123; var httpClient = new HttpClient(); var uri = new Uri.http(&#x27;news-at.zhihu.com&#x27;, &#x27;/api/3/stories/latest&#x27;); var request = await httpClient.getUrl(uri); var response = await request.close(); return await response.transform(utf8.decoder).join(&#x27; &#x27;);&#125;main(List&lt;String&gt; args) async &#123; var result = await _getDataFromZhihu(); print(result);&#125; ç¬¬ä¸‰æ–¹åŒ…ç®¡ç†ç³»ç»Ÿpubï¼Œå®˜ç½‘åœ¨è¿™é‡Œï¼ŒåŠŸèƒ½ç±»ä¼¼npmçš„ç½‘ç«™ï¼Œè¿™é‡Œä¸¾ä¾‹ http åº“çš„ä½¿ç”¨ å¼•å…¥ï¼Œåœ¨æ ¹ç›®å½•ä¸‹å†™ä¸‹ä¸€ä¸ªpubspec.yaml æ–‡ä»¶ï¼Œç±»ä¼¼ package.json å†™ä¸‹ä½ éœ€è¦å®‰è£…çš„åº“çš„ç‰ˆæœ¬ï¼Œå¦‚ä¸‹ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‹·è´å…¶ç‰ˆæœ¬å· 123456name: xxxdescription: A new flutter module.environment: sdk: &#x27;&gt;=2.10.0 &lt;3.0.0&#x27;dependencies: http: ^0.13.3 æ‰§è¡Œå®‰è£… æ–¹æ³•ä¸€ï¼Œåœ¨pubspec.yaml æ–‡ä»¶å†™å¥½ dependenciesï¼Œå†æ‰§è¡Œå¦‚ä¸‹ï¼š 1dart pub get æ–¹æ³•äºŒï¼Œç›´æ¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå®‰è£…æœ€æ–°ç‰ˆæœ¬ 1dart pub add http_parser ä½¿ç”¨ pub åº“æ˜¯ä»¥ package å¼€å¤´ï¼š 1import &#x27;package:http/http.dart&#x27; as http;","tags":["Dart","flutter"]},{"title":"Dartè¯­æ³•è‡ªå­¦ç¬”è®°ï¼ˆä¸€ï¼‰","path":"/2021/05/25/ã€2021-05-25ã€‘Dartè¯­æ³•è‡ªå­¦ç¬”è®°ï¼ˆä¸€ï¼‰/","content":"flutteræ¡†æ¶ä»19å¹´å¼€å§‹å°±ç«äº†ï¼Œä¸»è¦ç”¨äºè·¨ç«¯è§£å†³æ–¹æ¡ˆï¼Œä¸€å¥—ä»£ç å¯ä»¥è¦†ç›–iosï¼ŒAndroidå’ŒWebï¼Œæ®è¯´æ³•æ‰§è¡Œæ•ˆç‡å¾ˆé«˜ï¼Œå› å»æ‰äº†åƒReact Nativeé‚£æ ·çš„è½¬è¯‘å±‚ï¼Œç›´æ¥ä½œç”¨äºåº•å±‚ï¼Œé‚£å¿…é¡»å­¦èµ·æ¥ã€‚ flutterå…¶frameworkå±‚é¢è°ƒç”¨çš„æ˜¯Dartï¼Œä¸€æ–°çš„é™æ€è¯­è¨€ï¼Œå’Œjsç‚’é¸¡åƒï¼Œæœ¬æ–‡ä»ç€é‡è®²è§£Dartçš„åŸºç¡€è¯­æ³•ï¼ŒåŒ…æ‹¬åŸºç¡€æ•°æ®è§£æ„ï¼Œå¸¸ç”¨apiåŠå¾ªç¯ï¼Œä¸ç½—åˆ—æ‰€æœ‰åŸºç¡€è¯­æ³•ç‚¹ï¼ŒåªæŒ‘ä¸€äº›æœ‰ç‰¹ç‚¹æ¼”ç¤ºã€‚ æœ¬æ–‡çš„ç¤ºä¾‹ä»£ç ï¼Œæ”¾åœ¨è¿™ä¸ª ä»“åº“ï¼Œæœ¬æ–‡é˜è¿°äº† 01-06 çš„ä»£ç  å®‰è£… Dartå®˜ç½‘ä¸Šæœ‰å‘½ä»¤è¡Œçš„å®‰è£…æ–¹æ³•ï¼Œæˆ‘ç”¨winå¹³å°ï¼Œå¯ä»¥ç›´æ¥ä»è¿™é‡Œä¸‹è½½ä¸€ä¸ªSDKå®‰è£…åŒ…ï¼Œç›´æ¥ä¸‹ä¸€æ­¥ä¸‹ä¸€æ­¥å®‰è£…å®Œæˆã€‚ å®‰è£…å®Œæˆåå¯ä»¥åœ¨å‘½ä»¤è¡Œæ£€éªŒç‰ˆæœ¬æ˜¯å¦å®‰è£…æˆåŠŸï¼š C:\\WINDOWS\\System32&gt;dart â€“versionDart SDK version: 2.13.0 (stable) (Wed May 12 12:45:49 2021 +0200) on â€œwindows_x64â€ æˆ‘ç”¨ vs code å¼€å‘ï¼Œå®‰è£… æ’ä»¶ Dart ï¼ŒCode Runner hello worldå…ˆæ¥ä¸ª hello worldï¼Œå‘ç°å’Œ go è¯­è¨€è¯­æ³•æœ‰ç‚¹åƒï¼Œ åŒæ ·æ˜¯ä¸»å…¥å£å‡½æ•° main()&#123;&#125; ä¸»å¯¼ç€æ•´ä¸ªæ–‡ä»¶çš„æ‰§è¡Œ ä¸€ä¸ªè¯­å¥å®Œæˆé¡»å¼ºè¡ŒåŠ  ; 1234// void å¯çœç•¥void main()&#123; print(&#x27;hello world&#x27;);&#125; è¿è¡Œ å‘½ä»¤è¡Œé‡Œç›´æ¥è·‘ dart &lt;DartDoc&gt;.dartï¼Œå°±å¯ä»¥çœ‹åˆ°æ‰“å°çš„ hello world E:\\study\\code\\2021\\dart-learn&gt;dart 01-hello-world.darthello world å˜é‡ var å¸¸é‡ const final dartç±»ä¼¼ ts æœ‰ç±»å‹æ£€æŸ¥åŠŸèƒ½ï¼Œ 12345String str1 = &#x27;ä½ å¥½&#x27;;print(str1); // ä½ å¥½int num1 = 123;print(num1); // 123 ä½† dart ä¹Ÿå¯è‡ªåŠ¨æ¨æ–­ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ— é¡»å£°æ˜ç›´æ¥å®šä¹‰ï¼Œç±»ä¼¼ js ï¼š 12345var str = &#x27;hehe&#x27;;print(str); // heheconst e = 2.14;print(e); // 2.14 dart æœ‰ä¸€ä¸ªæƒ°æ€§å¸¸é‡ finalï¼Œå…¶å’Œæ™®é€šå¸¸é‡ const çš„åŒºåˆ«ï¼š final å¯ä»¥åªå®šä¹‰ï¼Œä¸èµ‹å€¼ï¼›const åˆ™ä¸å¯ä»¥ final åªæœ‰åœ¨è¿è¡Œæ—¶æ‰ä¼šåˆå§‹åŒ– ä¾‹å¦‚å®šä¹‰æ—¥æœŸï¼Œå®æ—¶ç”Ÿæˆçš„ï¼Œåªèƒ½ç”¨ final 1234final timeNow;timeNow = new DateTime.now();print(timeNow);// 2021-05-24 12:53:04.819814 æ•°æ®ç±»å‹dartä¸åƒjsï¼Œä¸èƒ½è¿›è¡Œç±»å‹è‡ªåŠ¨è½¬æ¢ï¼Œéœ€è¦æ‰‹åŠ¨è¿›è¡Œè½¬æ¢1234print(&#x27;string&#x27; + 1); // é”™è¯¯// æŠ¥é”™ï¼š// Error: A value of type &#x27;int&#x27; can&#x27;t be assigned to a variable of type &#x27;String&#x27;. boolå¸ƒå°”ç±»å‹ä¸ºä¸€ç§å•ç‹¬ç±»å‹ï¼Œä¸åŒäºjsï¼Œä¸èƒ½è½¬æ¢ä¸º0ï¼Œ1 12bool k = true;print(k); // true int doubleæ•´æ•°ç±»å‹å’Œæµ®ç‚¹ç±»å‹ï¼Œæ²¡å•¥å¥½è®²çš„ String å•è¡Œå­—ç¬¦ä¸²ã€‚å¯ä»¥å•å¼•å·&#39; &#39;æˆ–åŒå¼•å·&quot; &quot;å®šä¹‰ï¼› æ¢è¡Œçš„å­—ç¬¦ä¸²ã€‚ç±»ä¼¼ Python ï¼Œéœ€ç”¨ä¸‰å•å¼•&#39;&#39;&#39; &#39;&#39;&#39; æˆ– ä¸‰åŒå¼•&quot;&quot;&quot; &quot;&quot;&quot;ï¼› å ä½ç¬¦ç”¨ $ï¼Œå•è¡Œæˆ–å¤šè¡Œå­—ç¬¦ä¸²å‡å¯ä½¿ç”¨ï¼› 123456789String str = &#x27;1223&#x27;;var str2 = &#x27;&#x27;&#x27;line1: heheline2: haha&#x27;&#x27;&#x27;;print(&#x27;$str + $str2&#x27;);print(&#x27;-------------&#x27;);print(str + str2); ç»“æœï¼š 1223 + line1: hehe line2: haha 1223 line1: hehe line2: haha Listå®šä¹‰List123456789List l = [&#x27;aaa&#x27;, 3, true];print(l.length); // 3const l2 = [&#x27;vvv&#x27;, &#x27;xx&#x27;];print(&#x27;$l $l2&#x27;); // [aaa, 2, true] [vvv, 5]// å¢åŠ å…ƒç´  .add() æ–¹æ³•ï¼šList l3 = &lt;String&gt;[&#x27;foo&#x27;, &#x27;bar&#x27;];l3.add(&#x27;fee&#x27;); // [foo, bar, fee] åˆ›å»ºå›ºå®šé•¿åº¦Listï¼ŒList.filled(length, å¡«å……çš„å…ƒç´ )ï¼Œä¸èƒ½å¢åŠ æ•°æ®ä½¿ç”¨ add()123// &lt;String&gt; å¯çœç•¥List l5 = List&lt;String&gt;.filled(3, &#x27;&#x27;);print(l5); // [, , ] å¸¸ç”¨Listæ–¹æ³•:å°†ä¸€ä¸ªç°æœ‰Liståè½¬ .reversed.toList()12345List a = [&#x27;12&#x27;, &#x27;23&#x27;, &#x27;34&#x27;, &#x27;45&#x27;];print(a.reversed);// (45, 34, 23, 12)print(a.reversed.toList());// [45, 34, 23, 12] æ›¿æ¢å…ƒç´  fillRange(å¼€å§‹, ç»“æŸ, æ›¿æ¢çš„å…ƒç´ ) æ’å…¥ insert(æ’å…¥ä½ç½®ï¼Œæ’å…¥å…ƒç´ ) insertAll(æ’å…¥ä½ç½®ï¼Œæ’å…¥å¤šä¸ªå…ƒç´ )123456789List l = [&#x27;12&#x27;, &#x27;23&#x27;, &#x27;34&#x27;, &#x27;45&#x27;];l.fillRange(1,3, &#x27;c&#x27;);print(l); // [12, c, c, 45] l.insert(3, &#x27;å•ä¸ªå…ƒç´ &#x27;);print(l); // [12, c, c, å•ä¸ªå…ƒç´ , 45]l.insertAll(2, [&#x27;å…ƒç´ 1&#x27;, &#x27;å…ƒç´ 2&#x27;]);print(l); // [12, c, å…ƒç´ 1, å…ƒç´ 2, c, å•ä¸ªå…ƒç´ , 45] List â€”â€”&gt; Stringï¼š .join()ï¼›String â€”â€”&gt; Listï¼š.split()1234567891011List a = [12, &#x27;CC&#x27;, &#x27;zengjia&#x27;, &#x27;hehe&#x27;, &#x27;haha&#x27;, &#x27;CC&#x27;, 67];var b = a.join(&#x27;-&#x27;);print(b);// 12-CC-zengjia-hehe-haha-CC-67print(b is String);// truevar c = b.split(&#x27;-&#x27;);print(c);// [12, CC, zengjia, hehe, haha, CC, 67]print(c is List);// true Setå’Œ js çš„ Set ç±»ä¼¼ æœ€ä¸»è¦çš„åŠŸèƒ½å°±æ˜¯å»é™¤æ•°ç»„é‡å¤å†…å®¹ æ²¡æœ‰é¡ºåºä¸”ä¸èƒ½é‡å¤çš„é›†åˆï¼Œæ‰€ä»¥ä¸èƒ½é€šè¿‡ç´¢å¼•å»è·å–å€¼ 12345List l = [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;];Set ss = new Set();ss.addAll(l);print(ss); // &#123;a, b, c&#125;print(ss.toList()); // [a, b, c] Mapç±»ä¼¼ js çš„objï¼Œå®šä¹‰Mapä¸¤ç§æ–¹æ³•ï¼š 12345var p = &#123;&#x27;name&#x27;: &#x27;zhangsan&#x27;, &#x27;age&#x27;:20&#125;;print(p); // &#123;name: zhangsan, age: 20&#125;var p2 = new Map();print(p2); // &#123;&#125; æ³¨æ„ï¼Map ä¸èƒ½ç”¨ç‚¹ . è¿ç®—ï¼Œåªèƒ½ç”¨å±æ€§é€‰æ‹©å™¨ [] 1print(p[&#x27;age&#x27;]); // 20 keys.toList() values.toList() è®©é”®æˆ–å€¼å˜æˆæ•°ç»„12345678Map p = &#123;&#x27;name&#x27;: &#x27;zhangsan&#x27;, &#x27;age&#x27;:20&#125;;print(person.keys.toList()); // [name, age]print(person.values.toList());// [xxx, 20]print(person.entries);// (MapEntry(name: xxx), MapEntry(age: 20)) is å…³é”®å­—åˆ¤æ–­ç±»å‹1234567String str = &#x27;1223&#x27;;if (str is String) print(&#x27;stringç±»å‹&#x27;);else if(str is int) print(&#x27;intç±»å‹&#x27;);else print(&#x27;å…¶ä»–&#x27;);// stringç±»å‹ å¯è¿­ä»£æ•°æ®çš„é€šç”¨æ–¹æ³•æ‹¼æ¥ .addAll()æ³¨æ„ï¼šList å’Œ Map æ‹¼æ¥å¯åœ¨åŸæ¥çš„åŸºç¡€ä¸Šæ‹¼æ¥ï¼Œå…¶å†…å­˜æŒ‡å‘ä¸å˜ï¼ŒSet æ‹¼æ¥åˆ™éœ€é‡æ–° new ä¸€ä¸ªå¯¹è±¡ 12345678910111213141516171819// List æ‹¼æ¥ï¼šList a = [&#x27;12&#x27;, &#x27;23&#x27;, &#x27;34&#x27;, &#x27;45&#x27;];a.addAll([&#x27;67&#x27;,&#x27;89&#x27;]);print(a);// [12, 23, 34, 45, 67, 89]// Set æ‹¼æ¥ï¼šList l = [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;];Set ss = new Set();ss.addAll(l);print(ss); // &#123;a, b, c&#125;print(ss.toList()); // [a, b, c]// Map æ‹¼æ¥ï¼šMap m = &#123;&#x27;name&#x27;:&#x27;Tom&#x27;,&#x27;Id&#x27;:&#x27;E1001&#x27;&#125;;m.addAll(&#123;&#x27;dept&#x27;:&#x27;HR&#x27;,&#x27;email&#x27;:&#x27;tom@xyz.com&#x27;&#125;);print(m);// &#123;name: Tom, Id: E1001, dept: HR, email: tom@xyz.com&#125; è½¬æ¢ä¸ºæ•°ç»„ .toList()è§ä¸Šé¢æè¿‡çš„ä¾‹å­å…·æœ‰æ¶‰åŠ: Listï¼Œ Set è½¬æ¢ä¸ºå­—ç¬¦ä¸² .toString()Listï¼ŒSetï¼ŒMapå‡æœ‰æ­¤åŠŸèƒ½ ä¸¤ä¸ªç‰¹æ®Šè¿ç®—ç¬¦dartçš„è¿ç®—ç¬¦ï¼Œé™¤äº†è¿™é‡Œæåˆ°çš„ä¸¤ç§ç¬¦å·ï¼Œå…¶ä»–å’Œ js ä¸€æ · ~/ å’Œ ~/= å–æ•´ç¬¦å· ~/ï¼Œå¾ˆç®€å•ï¼š 1234int a = 12;int b = 5;print(a~/b);// 2 å¦å¤–ï¼Œå’Œå¤§å¤šæ•°è¯­è¨€ä¸€æ ·ï¼Œdarté‡Œæ²¡æœ‰ä¸‰ç­‰ç¬¦å·ï¼Œåªæœ‰ä¸¤ç­‰ == æ˜¯å¦ä¸ºç©ºèµ‹å€¼ ??=??= è¡¨ç¤ºï¼Œå¦‚æœå€¼ä¸ä¸ºç©ºï¼Œåˆ™èµ‹å€¼ä¸ºæ–°å€¼ï¼›å¦‚æœä¸ä¸ºç©ºï¼Œåˆ™ç”¨åŸå€¼ï¼› 1234567b??=89;print(b);// 5var c = 45;c ??= 8;print(c);// 45 ç±»å‹è½¬æ¢ String â€”â€”&gt; Number ï¼š int.parse() å’Œ double.parse()123456789String y = &#x27;123&#x27;;var m = int.parse(y);print(m is int);// trueString u = &#x27;23.345&#x27;;var x = double.parse(u);print(x is double);// true isEmpty å’Œ isNotEmpty åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦ä¸ºç©ºï¼›isNaN åˆ¤æ–­æ•°å€¼æ˜¯å¦åˆæ³•1234567891011var er = &#x27;xxx&#x27;;var xu = 0/0;if(er.isEmpty) print(&#x27;strä¸ºç©º&#x27;); else print(&#x27;strä¸ä¸ºç©º&#x27;);// strä¸ä¸ºç©ºif(xu.isNaN)&#123; print(&#x27;xuä¸åˆæ³•&#x27;);&#125;else&#123; print(&#x27;xuåˆæ³•&#x27;);&#125;// xuä¸åˆæ³• å¾ªç¯å’Œ js ç›¸ä¼¼åº¦è¾¾åˆ° 95% forï¼Œ for indartæ²¡æœ‰ for of å¾ªç¯ï¼Œfor for inå’Œ js åŸºæœ¬ä¸€æ ·çš„å†™æ³• 123456789// ä¾‹ï¼šæ‰“å°1åˆ°9ä¹‹é—´æ‰€æœ‰å¶æ•°ï¼šfor (int i=1; i&lt;=9; i++) &#123; if (i%2 == 0) &#123; print(i); &#125;&#125;// p.s. å¦‚æœåœ¨åŒä¸€è¡Œå†™å¯çœç•¥èŠ±æ‹¬å· `&#123;&#125;` for (int i in [1,2,3,4,5,6,7,8,9]) if(i%2 == 0) print(i); ä»¥ä¸Šå‡è¾“å‡ºï¼š 2468 forEach123456789101112131415161718// å¾ªç¯Listconst l2 = [2,3];l2.forEach((el) &#123; print(el);&#125;);// 2// 3// å¾ªç¯MapMap m = &#123;&#x27;a&#x27;:1, &#x27;b&#x27;:2&#125;;m.forEach((key, value) &#123; print(&#x27;$key --- $value&#x27;);&#125;);// a --- 1// b --- 2// æˆ–å¯å†™ä¸º ç®­å¤´å‡½æ•° =&gt;// m.forEach((key, value) =&gt; print(&#x27;$key --- $value&#x27;)); Listï¼Œ Set çš„é€šç”¨æ–¹æ³•: whereï¼Œanyï¼Œeveryä¸€ä¸ªæ¯”è¾ƒæœ‰è¶£çš„æ–¹æ³•ï¼Œç±»ä¼¼æ¡ä»¶è¯­å¥ï¼Œç”¨äºç‰¹å®šå…ƒç´ çš„æŸ¥æ‰¾å’Œ js çš„æ•°ç»„æ–¹æ³•çš„ .some() .every()ç­‰æ–¹æ³•ç±»ä¼¼ 1234567891011121314151617// ListList l3 = [2,3,6,8];var ll = l3.where((item) =&gt; item &gt;3);print(ll); // (6, 8)print(ll.toList()); // [6, 8]print(l3.any((item) =&gt; item &gt;=3)); // trueprint(l3.every((item) =&gt; item % 2 == 0 || item % 3 == 0 )); // truel3.removeWhere((item) =&gt; item &lt; 7 );print(l3); // [8]// SetSet s2 = &#123;2, 3, 4, 2, 8, 9, 8&#125;;bool ss = s2.any((item) =&gt; item &lt; 1);print(ss); // falseprint(s2.where((item) =&gt; item &gt; 3)); // (4, 8, 9)print(s2.every((item) =&gt; item &lt;= 10)); // true","tags":["Dart","Flutter","è·¨ç«¯"]},{"title":"ã€2021-05-04ã€‘tsåœ¨ReactClasså’ŒReactHooksçš„åº”ç”¨","path":"/2021/05/23/ã€2021-05-04ã€‘TSåœ¨ReactClasså’ŒReactHooksä¸­çš„åº”ç”¨/","content":"å¯¹äºç°è¡Œçš„ESè§„èŒƒï¼Œå·²ç»å…·æœ‰å¾ˆå¥½çš„è§„èŒƒæ€§ä¸å¯è¯»æ€§ï¼Œtype scriptè™½å½“ä¸‹å¤§è¡Œå…¶é“ï¼Œå…¶å®æˆ‘è§‰å¾—æ„ä¹‰ä¸ç®—å¾ˆå¤§ï¼Œtsæœ€é‡è¦çš„åŠŸèƒ½å°±æ˜¯ç±»å‹æ£€æŸ¥ï¼ŒåŒ…æ‹¬ interface, type ç­‰ä¹Ÿæ˜¯ä¸€ç§ç±»å‹æ£€æŸ¥ï¼Œä½†ä¸€ä¸å°å¿ƒå°±ä¼šå†™æˆ any scriptã€‚é‰´äºå°†æ¥çš„é¡¹ç›®æˆ–è€…ç°è¡Œçš„é¡¹ç›®å¯èƒ½ä¼šç”¨åˆ°ï¼Œè¿™é‡Œç»“åˆ React Hooks å†™ä¸ª tsx ç‰ˆçš„ demo è‡ªå·±å†™çš„ TypeScript demoï¼ŒTSåŸºç¡€å†…å®¹å¯ä»¥ç¿»çœ‹è¯¥ä»“åº“å®‰è£…æ–°é¡¹ç›®ï¼Œåªéœ€å¸¦--template typescriptå‚æ•°å³å¯ï¼š123create-react-app &lt;app name&gt; --template typescript#or yarn create-react-app &lt;app name&gt; --template typescript è€é¡¹ç›®ï¼Œåœ¨åŸæœ‰JSXé¡¹ç›®create-react-appåŸºç¡€ä¸Šå¢åŠ typescriptå†…å®¹ï¼š12345npm install --save typescript @types/node @types/react @types/react-dom @types/jest # or yarn add typescript @types/node @types/react @types/react-dom @types/jest åˆ›å»º*.d.ts æ–‡ä»¶ï¼Œä¸“é—¨ç”¨äºå„ç§ä¾èµ–çš„å£°æ˜è¯¦ç»†çš„ç”¨æ³•å¯å‚è€ƒæ˜é‡‘ç­”ç¥è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘è¿™é‡Œç®€å•çš„è¯´æ˜ä¸€ä¸‹ï¼š å¤–éƒ¨npm installä¸€ä¸ªåº“æ—¶: 1declare module &#x27;lodash&#x27; interface å£°æ˜ 12345interface xxxProps &#123; name: string; age?: number; method(f: string): string;&#125; åˆå­¦è€…çš„ç¼–å†™åˆ©å™¨ â€”â€” vs code ä¸­çš„æç¤ºå¯ä»¥åˆ©ç”¨å¥½ vs code ä¸­è‡ªå¸¦çš„æç¤ºï¼Œä¾‹å¦‚ä¸‹é¢çš„æç¤ºï¼Œä¸‹é¢çš„ä¾‹å­ä¼šæˆªå›¾æ­¤ç±»æç¤ºæ¡†ï¼š æœ€å¤–å±‚ index.tsx12345678910111213141516171819import React from &#x27;react&#x27;;import ReactDOM from &#x27;react-dom&#x27;;import App from &#x27;./App&#x27;;// å…¨å±€å˜é‡ï¼Œå¦‚æœ‰ï¼šdeclare global &#123; interface Window &#123; API: any, _store: any &#125;&#125;ReactDOM.render( &lt;React.StrictMode&gt; &lt;App /&gt; &lt;/React.StrictMode&gt;, // HTMLElement æ¥å£ï¼š document.getElementById(&#x27;root&#x27;) as HTMLElement); ç»„ä»¶Function ç»„ä»¶1const App: React.FC = () =&gt; null vs code é‡Œçš„æç¤ºï¼š Class ç»„ä»¶123456// è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œå†™åˆ°çƒ‚äº†export class ClassTS extends React.Component &#123; public render(): React.ReactNode &#123; return null &#125; &#125; propsFunction ç»„ä»¶é‡Œçš„props12345678910111213// 1ï¼Œç›´æ¥å†™ï¼šexport const TextField: React.FC&lt;&#123; text: string &#125;&gt; = () =&gt; &#123; return &lt;div&gt;&lt;input type=&quot;text&quot;/&gt;&lt;/div&gt;&#125;// 2. å°† &#123; text: string &#125; ç‹¬ç«‹ä¸ºæ¥å£ç±»ï¼šinterface Props &#123; text: string&#125;export const TextField: React.FC&lt;Props&gt; = () =&gt; &#123; return &lt;div&gt;&lt;input type=&quot;text&quot;/&gt;&lt;/div&gt;&#125; å…¶ä¸­ï¼Œæ¥å£ä¹Ÿå¯éšæ„æ‰©å±•åŠå®šä¹‰å­æ¥å£ï¼Œå¦‚ï¼š 12345678910111213interface Person &#123; firstName: string lastName: string&#125;interface Props &#123; text: string ok?: boolean i?: number fn?: (bob: string) =&gt; string // person: Person&#125; Class ç»„ä»¶é‡Œçš„ props123456789101112131415161718192021// 1ï¼Œç›´æ¥å†™, ä¸¤ä¸ªå‚æ•°é—´ç”¨é€—å·æˆ–åˆ†å·éš”å¼€å‡å¯ï¼šexport class ClassTS extends React.Component &lt;&#123; text: string, age?: number &#125;&gt; &#123; &#125; // 2. å°†propsçš„å‚æ•°ç‹¬ç«‹ä¸ºæ¥å£ç±»ï¼šinterface IProps &#123; text: string age?: number&#125;// 3. é¡ºå¸¦ä¸€æstateï¼Œåªæœ‰interfaceçš„å†™æ³•ï¼šinterface IState &#123; email: string name: string&#125;export class ClassTS extends React.Component &lt;IProps&gt; &#123; state: IState = &#123; name: &#x27;&#x27;, email: &#x27;&#x27; &#125;&#125; ç»„ä»¶é‡Œçš„å‡½æ•°Reactç‰¹æœ‰çš„ç±»å‹ï¼ŒReact.FormEventï¼Œè™šæ‹ŸDOMæŠŠæ‰€æœ‰åŸç”Ÿå‡½æ•°éƒ½æ’¸äº†ä¸ªé: 1234handleChange = ( e : React.FormEvent&lt;HTMLInputElement&gt; ) =&gt; &#123; const &#123; name, value &#125; : any = e.target this.setState(&#123; [name]: value &#125;)&#125; å‡½æ•°ç»„ä»¶çš„ hooksuseState12345678// æˆ–ç”¨ | ï¼Œä¸ç”¨ ||const [count, setCount] = useState &lt; string | null | &#123; text: string &#125; &gt;(&#123; text: &#x27;hello&#x27; &#125;)// æˆ– ç‹¬ç«‹ä¸ºæ¥å£ï¼šinterface TextNode &#123; text: string&#125;const [count, setCount] = useState &lt; number | TextNode &gt;(5) useRef1234// å› ä¸ºrefçš„ç›®æ ‡æ˜¯ä¸€ä¸ªinputæ¡†ï¼Œæ‰€ä»¥ç”¨ &lt;HTMLInputElement&gt;// å¦‚æœæ‰“ä¸Šrefçš„æ˜¯&lt;div&gt;&lt;/div&gt;, åˆ™ç”¨ &lt;HTMLDivElement&gt;const inputRef = useRef&lt;HTMLInputElement&gt;(null) å¦å¤–ï¼ŒhandleChange 123456// å¦‚æœæ˜¯Propsä¼ è¿‡æ¥ï¼Œå¹¶ä¸”å®šä¹‰äº†interfaceæ¥å£ï¼Œåˆ™è¦æ³¨æ˜ï¼šinterface Props &#123; handleChange: ( event: React.ChangeEvent&lt;HTMLInputElement&gt; ) =&gt; void // æˆ–è€…å¦‚ä¸‹å®šä¹‰ä¸ºanyï¼Œä½†ä¸å»ºè®®ï¼Œå› å¤±å»äº†æ£€æŸ¥çš„ä½œç”¨ï¼š // handleChange: ( event: any ) =&gt; void&#125; useReducer12345678910111213141516171819202122interface Todos &#123; text: string complete: boolean&#125;// type State = Array&lt;Todos&gt;// æˆ–ä¸‹é¢è¿™ç§ï¼Œæ›´å½¢è±¡åŒ–ï¼štype State = Todos[]type Actions = &#123; type: &#x27;add&#x27;, text: string &#125; | &#123; type:&#x27;remove&#x27;, idx: number &#125;const TodoReducer = ( state: State, action: Actions ) =&gt; &#123; switch (action.type) &#123; case &#x27;add&#x27;: return [...state, &#123; text: action.text, complete: false &#125;] case &#x27;remove&#x27;: return state.filter((_, i) =&gt; action.idx !== i) default: return state; &#125; &#125;const [todos, dispatch] = useReducer(TodoReducer, []) hooks çš„ render propså°† hooks å‡½æ•° setXXX ä½œä¸ºå‚æ•°ä¼ å‚ï¼Œè¿™ç§propsæ˜¯reactç‹¬æœ‰çš„ï¼ŒReact.Dispatch&lt;React.SetStateAction&lt;number&gt;&gt; 123456789101112131415interface Props &#123; children:( count: number, // å°†`setCount`ä½œä¸ºpropsè¿›è¡Œä¼ å‚ï¼š setCount: React.Dispatch&lt;React.SetStateAction&lt;number&gt;&gt; // è¿”å›å€¼ä¸ºReactç‹¬æœ‰çš„ï¼šJSX.Element ) =&gt; JSX.Element | null&#125;export const Counter: React.FC&lt;Props&gt; = (&#123; children &#125;) =&gt; &#123; const [count, setCount] = useState(0) return &lt;div&gt; &#123;children(count, setCount)&#125; &lt;/div&gt;&#125; å¦ä¸€ç§ï¼ŒåŸç”Ÿçš„å‡½æ•°åœ¨è™šæ‹ŸDOMé‡Œçš„å‡½æ•°ï¼š å†™çš„æ—¶å€™ vs code é‡Œçš„æç¤ºï¼š","tags":["React","type script"]},{"title":"Vue2+3è‡ªå­¦ç¬”è®°ï¼ˆä¸€ï¼‰","path":"/2021/05/19/ã€2021-05-19ã€‘Vue2+3è‡ªå­¦ç¬”è®°ï¼ˆä¸€ï¼‰/","content":"ä¸€ç›´ä»¥æ¥ï¼Œåšé¡¹ç›®éƒ½æ˜¯ç”¨Reactï¼Œæœ€è¿‘å…¬å¸çš„é¡¹ç›®æ¥è§¦åˆ° Vueï¼Œè¿™é‡Œå…ˆæ¡èµ·å¤šå¹´æœªç¢°çš„ Vue ï¼Œå†™ä¸€äº›demoï¼Œ é‡æ¸©ä¸€ä¸‹ Vue2 æœ€ç®€å•çš„ç”¨æ³•ï¼Œå¹¶ç»“åˆæ˜é‡‘çš„è¿™ç¯‡æ–‡ç« ï¼Œçœ‹çœ‹ Vue3 çš„æ–°å˜åŒ– ä» Vue2 å¼€å§‹æ¬ç –ï¼Œè‡ªå·±å†™äº†ä¸ªTODO Listï¼Œå®Œæ•´ä»£ç åœ¨è¿™é‡Œï¼Œé…åˆVueå®˜æ–¹æ–‡æ¡£å†…å®¹ï¼Œè¿›è¡Œæœ¬æ–‡çš„é˜è¿° è„šæ‰‹æ¶å¼€å§‹é¡¹ç›®å®‰è£… 1yarn global add @vue/cli è„šæ‰‹æ¶åˆ›å»ºé¡¹ç›®å¹¶è¿è¡Œï¼š 12vue create &lt;AppName&gt; &amp;&amp; cd &lt;AppName&gt;vue run serve import åä»è¦å£°æ˜ç»„ä»¶ç”±äºvueæ˜¯ç»è¿‡å®ä¾‹åŒ–çš„ï¼Œå±æ€§éƒ½ç»‘å®šåœ¨thisä¸Šï¼Œä»¥thisä½œä¸ºä¸­è½¬ï¼Œæ‰€ä»¥ import åä»è¦åœ¨ component ä¸­å£°æ˜ä¸€æ¬¡ï¼Œå¦åˆ™æŠ¥é”™ï¼š 123456789&lt;script&gt;import Header from &#x27;./components/Header&#x27;export default &#123; components: &#123; Header, &#125;,&#125;&lt;/script&gt; props å±æ€§å¯ä»¥å£°æ˜æ•°ç»„æˆ–å¯¹è±¡å£°æ˜å¯¹è±¡æ—¶ç±»ä¼¼tsçš„ç±»å‹æ£€éªŒ 123456789 props: [&#x27;text&#x27;, &#x27;color&#x27;, &#x27;title&#x27;, &#x27;showAddTask&#x27;]// or props: &#123; text: String, color: String, title: String, showAddTask: Boolean &#125;, æ’å€¼è¡¨è¾¾å¼æ’å€¼è¡¨è¾¾å¼å…¶å€¼å¯æ¥è‡ªè‡ªèº«æ–‡ä»¶çš„ data å±æ€§ï¼Œä¹Ÿå¯æ¥è‡ª props å±æ€§ 12345678910&lt;button :style=&quot;&#123; background: color &#125;&quot; class=&quot;btn&quot;&gt;&#123;&#123; text &#125;&#125;&lt;/button&gt; props: &#123; text: String &#125;, // or data: &#123; text: &#x27;hehe&#x27; &#125; è¿˜æœ‰ä¸¤ä¸ªç‰¹æ®Šçš„æ’å€¼è¡¨è¾¾å¼ v-text ç”¨äºæ˜¾ç¤ºå­—ç¬¦ä¸²ï¼š 123&lt;p v-text=&quot;data&quot;&gt;&lt;/p&gt;data: &#123; text: &#x27;æˆ‘æ˜¯è¦æ˜¾ç¤ºçš„ä¿¡æ¯&#x27; &#125; v-html ç”¨äºæ˜¾ç¤ºå¸¦HTMLçš„æ–‡æœ¬ï¼š 123&lt;div v-html=&quot;data&quot;&gt;&lt;/div&gt;data: `&lt;a&gt;1111111111&lt;/a&gt;` å®é™…ä¸Šï¼Œv-html ç¼–è¯‘åé•¿è¿™æ ·ï¼š123&lt;div&gt; &lt;a&gt;1111111111&lt;/a&gt;&lt;/div&gt; æ•°å€¼ç»‘å®š v-bind: æˆ–ç®€å†™ :ç”¨äºç»‘å®šæ ·å¼ï¼š 123&lt;button v-bind:style=&quot;&#123; background: color &#125;&quot; class=&quot;btn&quot;&gt;x&lt;/button&gt;&lt;!-- æˆ–ç®€å†™ä¸º --&gt;&lt;button :style=&quot;&#123; background: color &#125;&quot; class=&quot;btn&quot;&gt;x&lt;/button&gt; äº‹ä»¶ç»‘å®š v-on: æˆ–ç®€å†™ @12345678&lt;button @click=&quot;onClick()&quot; &gt;&#123;&#123; text &#125;&#125;&lt;/button&gt;// éœ€åœ¨ `methods` é‡Œå®šä¹‰ç»‘å®šäº‹ä»¶ï¼šmethods: &#123; onClick() &#123; // ... &#125;&#125; è¿˜æœ‰åŠ¨æ€å‚æ•°çš„ç¼©å†™(v2.6.0+)ï¼Œç±»ä¼¼å±æ€§é€‰æ‹©å™¨ï¼ŒeventName æ–¹æ³•åå¯åŠ¨æ€ä¼ å…¥ï¼Œæ‘˜è‡ªå®˜ç½‘ï¼š 1&lt;a @[eventName]=&quot;doSomething&quot;&gt; ... &lt;/a&gt; å¾ªç¯ v-for åŸºç¡€æ‰“æ³•â€”â€”ç”¨äºæ•°ç»„ï¼Œè¿™é‡Œç”¨åœ¨äº†ç»„ä»¶ &lt;Task :task=&quot;task&quot; /&gt; ä¸Šï¼Œ å¿…é¡»ç»‘å®škey å€¼ï¼Œ å’Œ React ä¸€æ ·ï¼Œç”±äºè™šæ‹ŸDOM Diffç®—æ³•çš„åŸå› ï¼Œkeyä¸èƒ½ç”¨æ•°ç»„ä¸‹æ ‡ï¼Œå¿…é¡»æ˜¯ä¸é‡å¤çš„å­—ç¬¦ä¸²ï¼š 123&lt;div v-for=&quot;task in tasks&quot; :key=&quot;task.id&quot;&gt; &lt;Task :task=&quot;task&quot; /&gt;&lt;/div&gt; è¿˜å¯ç”¨äºå¯¹è±¡objï¼š 12345678910111213&lt;ul id=&quot;v-for-object&quot; class=&quot;demo&quot;&gt; &lt;li v-for=&quot;value in object&quot;&gt; &#123;&#123; value &#125;&#125; &lt;/li&gt;&lt;/ul&gt;data: &#123; object: &#123; title: &#x27;How to do lists in Vue&#x27;, author: &#x27;Jane Doe&#x27;, publishedAt: &#x27;2016-04-10&#x27; &#125;&#125; æ˜¾ç¤ºä¸ºï¼š How to do lists in Vue Jane Doe 2016-04-10 objä¹Ÿå¯ä»¥ç”¨é”®å€¼å¯¹è§£æ„æ˜¾ç¤ºï¼Œä»–è¿˜æœ‰ç¬¬ä¸‰ä¸ªå‚æ•° index 123&lt;div v-for=&quot;(value, name, index) in object&quot;&gt; &#123;&#123; index &#125;&#125;. &#123;&#123; name &#125;&#125;: &#123;&#123; value &#125;&#125;&lt;/div&gt; æ˜¾ç¤ºä¸ºï¼š 0.title:How to do lists in Vue 1.name:Jane Doe 2.value:2016-04-10 ä½ ä¹Ÿå¯ä»¥ç”¨ of æ›¿ä»£ in ä½œä¸ºåˆ†éš”ç¬¦ï¼Œå› ä¸ºå®ƒæ›´æ¥è¿‘ JavaScript è¿­ä»£å™¨çš„è¯­æ³•ï¼š 1&lt;div v-for=&quot;item of items&quot;&gt;&lt;/div&gt; äº‹ä»¶æ´¾å‘ $emit ä¸ç›‘å¬ :é¡¹ç›®ä¸­æˆ‘ä»¬æœ€å¸¸ç”¨çš„æ•°æ®æµ å­ â€”â€”&gt; çˆ¶ çš„æ–¹å¼å°±æ˜¯ $emit â€”â€”&gt; @ ï¼Œå¦‚ï¼š å‘å°„å¤„ï¼Œå°†idä¹Ÿä¸€èµ·å‘å‡ºï¼Œ $emit(&#39;å‡½æ•°å&#39;, å‘å°„çš„å‚æ•°)ï¼Œå…¶ä¸­ï¼Œå‘å°„çš„å‚æ•°å¯ä»¥å¦‚ä¸‹ï¼Œä¸€ä¸ªç®€å•çš„id1234&lt;div v-for=&quot;task of tasks&quot; :key=&quot;task.id&quot;&gt; &lt;Task :task=&quot;task&quot; @delete-task=&quot;$emit(&#x27;delete-task&#x27;, task.id)&quot; /&gt;&lt;/div&gt;&lt;script&gt; script é‡Œä¹Ÿè¦æ³¨å†Œè¯¥äº‹ä»¶ï¼š1emits: [&#x27;delete-task&#x27;,], @ æ¥æ”¶è¯¥ emit å‡ºæ¥çš„äº‹ä»¶ï¼Œå¹¶å‘½åï¼š 1&lt;Task :task=&quot;task&quot; @delete-task=&quot;$emit(&#x27;delete-task&#x27;, task.id)&quot; /&gt; åœ¨ script é‡Œç»‘å®š deleteTask(id)&#123;&#125; äº‹ä»¶ï¼Œè¦æ³¨æ„ï¼Œè¿™é‡Œçš„ id å³ä¸º $emit ä¼ è¿‡æ¥çš„ç¬¬äºŒä¸ªå‚æ•° 1234567methods: &#123; deleteTask(id) &#123; if (confirm(&#x27;r u sure?&#x27;)) this.tasks = this.tasks.filter( task =&gt; task.id !== id ) &#125;, ...&#125; åŒå‘æ•°æ®ç»‘å®š v-model è¿™ä¸ªæ˜¯Vueæ¡†æ¶çš„ç²¾åæ‰€åœ¨ï¼ŒæŠ„è¢­Ngçš„ï¼Œåœ¨è¾“å…¥å¤„ç”¨ v-model ç»‘å®šï¼š 123456789&lt;!-- formè¡¨å•ç»‘å®š onSubmit äº‹ä»¶ --&gt;&lt;form class=&quot;add-form&quot; @submit=&quot;onSubmit&quot;&gt; &lt;!-- æœé›†è¾“å…¥ --&gt; &lt;input type=&quot;text&quot; name=&quot;text&quot; placeholder=&quot;Add Task&quot; v-model=&quot;text&quot; &gt; &lt;!-- æäº¤æŒ‰é’® --&gt; &lt;input type=&quot;submit&quot; value=&quot;Save Task&quot; class=&quot;btn btn-block&quot;&gt;&lt;/form&gt; script é‡Œç»‘å®š onSubmit(e) äº‹ä»¶ 12345678910111213141516171819onSubmit(e) &#123; e.preventDefault() if (!this.text) &#123; alert(&#x27;Pls add a task&#x27;) return &#125; const newTask = &#123; id: Math.floor(Math.random() * 100000), text: this.text, day: this.day, reminder: this.reminder &#125; this.$emit(&#x27;add-task&#x27;, newTask) this.text = &#x27;&#x27; this.day = &#x27;&#x27; this.reminder = false&#125;","tags":["Vue"]},{"title":"æ ‡ç­¾æ¨¡æ¿ï¼ˆTagged Template)â€”â€”ESçŸ¥è¯†ç‚¹è¡¥æ¼ç³»åˆ—ï¼ˆ2ï¼‰","path":"/2021/05/12/ã€2021-05-12ã€‘æ ‡ç­¾æ¨¡æ¿ï¼ˆTagged-Template-â€”â€”ESçŸ¥è¯†ç‚¹è¡¥æ¼ç³»åˆ—ï¼ˆ2ï¼‰/","content":"![](https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@0.31/articles/æ ‡ç­¾æ¨¡æ¿ï¼ˆTagged Template)â€”â€”ESçŸ¥è¯†ç‚¹è¡¥æ¼ç³»åˆ—ï¼ˆ2ï¼‰/cover.jpg) å­—ç¬¦ä¸²æ¨¡æ¿ç›¸ä¿¡å¤§å®¶ç”¨çš„æŒºå¤šäº†ï¼Œè¿™é‡Œä¸èµ˜è¿°ï¼Œä»Šå¤©è§£é”å­—ç¬¦ä¸²æ¨¡æ¿çš„å¦ä¸€ä¸ªåŠŸèƒ½ï¼Œæ ‡ç­¾æ¨¡æ¿ï¼ˆTagged Templateï¼‰ å¯ä½œä¸ºä¼ å‚ç”¨æ ‡ç­¾æ¨¡æ¿å¯ç”¨äºä¼ å‚ï¼Œå°±è¡Œæ™®é€šå‡½æ•°ä¸€æ ·æ¥æ”¶å‚æ•°ï¼Œè¯·çœ‹ç¤ºä¾‹ä»£ç ï¼š 12345678910const custom = (strings, ...placeholder) =&gt; &#123; console.log(strings) console.log(placeholder)&#125;const firstName = &#x27;å‘µå‘µ&#x27;const hobby = &#x27;ç‚¹èµ&#x27;// è°ƒç”¨æ—¶æ”¹ä¸ºæ ‡ç­¾æ¨¡æ¿ä¼ å‚ï¼Œä¸ç”¨æ™®é€šå‡½æ•°çš„()ä¼ å‚custom`my name is $&#123;firstName&#125;, my hobby is $&#123;hobby&#125;` ç›´æ¥åœ¨æ§åˆ¶å°æ‰§è¡Œåï¼Œä¼šå‘ç°ç»“æœå¦‚ä¸‹ï¼š 12[ &#x27;my name is &#x27;, &#x27;, my hobby is &#x27;, &#x27;&#x27; ][ &#x27;å‘µå‘µ&#x27;, &#x27;ç‚¹èµ&#x27; ] æˆ‘ä»¬å‘ç°æ ‡ç­¾æ¨¡æ¿å®é™…ä¸Šæ˜¯ä¸€ç§ç‰¹æ®Šå‡½æ•°ï¼Œæ¥æ”¶ä¸¤ä¸ªå‚æ•° @ç¬¬ä¸€ä¸ªå‚æ•° ï¼š é™¤äº†${}ä»¥å¤–çš„éƒ¨åˆ†å­—ç¬¦ä¸²éƒ¨åˆ†@ç¬¬äºŒä¸ªå‚æ•° ï¼š ${}é‡Œé¢çš„éƒ¨åˆ†ï¼Œå¯ä»¥ç”¨è§£æ„â€¦æ¥æ”¶æ‰€æœ‰${}çš„å‚æ•°ï¼Œå¦åˆ™åˆ™æŒ‰å½¢å‚ä¸€ä¸ªä¸ªæŒ‰é¡ºåºä¼ å…¥ å®é™…ä½œç”¨ä¸‹é¢ï¼Œæˆ‘ä»¬å°±è¿™ç§ç‰¹æ®Šå‡½æ•°çš„å®é™…ä½œç”¨ä¸¾2ä¸ªä¾‹å­ ç»™ç‰¹å®šæ–‡æœ¬æ·»åŠ æ ·å¼æ ‡ç­¾æ¨¡æ¿è¢«å‘æ˜å‡ºæ¥çš„æœ€ä¸»è¦ç›®çš„å°±æ˜¯æ‹¼æ¥HTMLå­—ç¬¦ä¸²çš„ï¼Œä¸‹é¢æˆ‘ä¸¾2ä¸ªä¾‹å­ï¼š ç”¨äºä¸€æ®µæ–‡å­—ä¸­æ·»åŠ HTMLæ ·å¼ï¼š 12345const a = (arr, ...placeholder) =&gt; arr.reduce((prev, cur, i) =&gt; prev + `&lt;span class=&quot;addColor&quot;&gt;$&#123;placeholder[i-1]&#125;&lt;/span&gt;`+ cur)console.log(a`my name is $&#123;firstName&#125;, my hobby is $&#123;hobby&#125;`)// my name is &lt;span class=&quot;addColor&quot;&gt;å‘µå‘µ&lt;/span&gt;, my hobby is &lt;span class=&quot;addColor&quot;&gt;ç‚¹èµ&lt;/span&gt; ç”¨äºæ ¡éªŒHTMLé‡Œçš„å­—ç¬¦ä¸²ï¼Œé˜²æ­¢ç”¨æˆ·è¿›è¡ŒXSSæ”»å‡» 12345678910111213141516171819202122function filterMsg(data) &#123; let ret = data[0] // ç›´æ¥åˆ©ç”¨ function çš„ arguments å‚æ•°è¿›è¡Œæ‹¼æ¥ï¼š for (let i = 1; i &lt; arguments.length; i++) &#123; const arg = String(arguments[i]) ret += arg.replace(/&amp;/g, &quot;&amp;amp;&quot;) .replace(/&lt;/g, &quot;&amp;lt;&quot;) .replace(/&gt;/g, &quot;&amp;gt;&quot;) ret += data[i] &#125; return ret&#125;// ç”¨æˆ·è¾“å…¥ï¼šconst userInput = &#x27;&lt;script&gt;alert(&quot;123&quot;)&lt;/script&gt;&#x27;// è°ƒç”¨å¤„ï¼šconst safeMsg = filterMsg`&lt;div&gt;$&#123;userInput&#125; has been send&lt;/div&gt;`console.log(safeMsg)// è¾“å‡ºï¼š// &lt;div&gt;&amp;lt;script&amp;gt;alert(&quot;123&quot;)&amp;lt;/script&amp;gt; has been send&lt;/div&gt;","tags":["ES"]},{"title":"Symbolçš„ç†è§£â€”â€”ESçŸ¥è¯†ç‚¹è¡¥æ¼ç³»åˆ—ï¼ˆ1ï¼‰","path":"/2021/05/11/ã€2021-05-11ã€‘Symbolçš„ç†è§£â€”â€”ESçŸ¥è¯†ç‚¹è¡¥æ¼ç³»åˆ—ï¼ˆ1ï¼‰/","content":"å¯¹äº Symbol çš„ç†è§£ï¼Œä¸€ç›´æ¯”è¾ƒé™Œç”Ÿï¼ŒåªçŸ¥é“ä»–æ˜¯ ES6 çš„è¯­æ³•è§„èŒƒï¼Œå…·ä½“æ¦‚å¿µï¼Œå¯å‚è€ƒé˜®ä¸€å³°è€å¸ˆçš„ Symbol æ–‡ç« ã€‚è¿™é‡Œæˆ‘å°±è‡ªå·±çš„ç†è§£å†™ï¼Œä¸è®²æ¦‚å¿µï¼Œå†™ä¸€ä¸ªå®¹æ˜“ç†è§£çš„demoï¼Œä»‹ç» Symbol çš„ä½œç”¨ã€‚ ä¼ ç»Ÿobj keyå€¼çš„ç—›ç‚¹ä¸€ä¸ªäº¿ä¸‡å¯Œè±ªï¼Œæœ‰å‡ ä¸ªå„¿å­å’Œå¥³å„¿ï¼Œè¿˜æœ‰ä¸€ç§ç”Ÿå­ï¼Œå¦‚æœæ­¤æ—¶ï¼Œæˆ‘ä»¬ç›´æ¥è¿™æ ·å®šä¹‰è¿™ä¸ªäº¿ä¸‡å¯Œè±ªï¼š 12345let billionaire = &#123; son: [&#x27;son1&#x27;, &#x27;son2&#x27;, &#x27;son3&#x27;,], daughter: [&#x27;daughter1&#x27;, &#x27;daughter2&#x27;], son: &#x27;bastard&#x27;&#125; åœ¨æ§åˆ¶å°æˆ‘ä»¬ä¼šå‘ç°ï¼Œç§ç”Ÿå­bastard ä¼šç›´æ¥è¦†ç›–æ‰å‰é¢çš„sonï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆé€‚çš„ äºæ˜¯ Symbol ä½œä¸ºESé‡ŒåŸå§‹çš„æ•°æ®ç±»å‹çš„ä½œç”¨å°±å‡ºç°äº† åˆ©ç”¨ Symbol æ·»åŠ ç§ç”Ÿå­, è§£å†³ç—›ç‚¹æ­£ç¡®çš„åšæ³•åº”è¯¥å¦‚ä¸‹ï¼Œå…ˆå®šä¹‰äº†å„¿å­å’Œå¥³å„¿ä»¬ï¼š 1234let billionaire = &#123; son: [&#x27;son1&#x27;, &#x27;son2&#x27;, &#x27;son3&#x27;,], daughter: [&#x27;daughter1&#x27;, &#x27;daughter2&#x27;]&#125; æŠŠç§ç”Ÿå­ son: &#39;bastard&#39; å•ç‹¬æŠ½å‡ºæ¥ï¼Œç”¨ Symbol å®šä¹‰ï¼Œä»¥ä¸‹æœ‰3ç§å®šä¹‰æ–¹æ³•ï¼š 1234567891011121314const son = Symbol(&#x27;son&#x27;)// 1.billionaire[son] = &#x27;bastard&#x27;// 2.let billionaire = &#123; son: [&#x27;son1&#x27;, &#x27;son2&#x27;, &#x27;son3&#x27;,], daughter: [&#x27;daughter1&#x27;, &#x27;daughter2&#x27;], [son] : &#x27;bastard&#x27;&#125;// 3. Object.defineProperty(billionaire, son, &#123; value: &#x27;bastard&#x27; &#125;) è‡³æ­¤ï¼ŒSymbol çš„ä½œç”¨å¾ˆæ˜ç¡®äº†ï¼Œ ç”±äº JS çš„ obj keyå€¼ä¸ºå­—ç¬¦ä¸²ï¼Œä¸ºäº†é¿å… JS çš„ obj ä¸­å±æ€§åå­—çš„å†²çªè€Œäº§ç”Ÿ ç§ç”Ÿå­èº«ä»½ç¥ç§˜ï¼Œæ™®é€šnewï¼Œ. ç­‰æ–¹æ³•å¯¹å…¶æ— æ•ˆï¼Œåªæœ‰äº¿ä¸‡å¯Œç¿è‡ªå·±çŸ¥é“ç”±äº Symbol æ˜¯åŸå§‹ç±»å‹ï¼Œæ²¡æœ‰æ„é€ å‡½æ•°ï¼Œä¸èƒ½ä½¿ç”¨ new å…³é”®å­— ä¹Ÿä¸èƒ½ç”¨ . è¿ç®—å°†å…¶ç‚¹å‡ºæ¥ï¼š ç§ç”Ÿå­çš„èº«ä»½ç¡®è®¤å¦‚ä½•å¾—åˆ°ä¿éšœï¼Ÿä½œä¸ºäº¿ä¸‡å¯Œè±ªçš„ç§ç”Ÿå­ï¼Œåªæœ‰äº¿ä¸‡å¯Œè±ªè‡ªå·±ä¸€ä¸ªäººçŸ¥é“å…¶èº«ä»½ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ç”¨æ™®é€šæ–¹æ³•æ˜¯æ‰¾ä¸åˆ°è¿™ä¸ªç§ç”Ÿå­çš„ï¼š è€Œç§ç”Ÿå­æœ‰ç‹¬ç‰¹çš„æ–¹æ³•èƒ½å¾—åˆ°ç¡®è®¤ï¼ŒSymbol ä¸ºæˆ‘ä»¬æä¾›äº†å‡ ç§æ–¹æ³• Object.getOwnPropertySymbols()1234const querySon = Object.getOwnPropertySymbols(billionaire)console.log(querySon)// [Symbol(son)] å¤šä¸ªç§ç”Ÿå­äº¿ä¸‡å¯Œè±ªä¹Ÿå¯èƒ½æœ‰ä¸æ­¢ä¸€ä¸ªç§ç”Ÿå­ï¼Œæ¯”å¦‚å’Œ â€˜çŸ¥å·±å°ç§˜â€™ ç”Ÿäº†ä¸€ä¸ªç§ç”Ÿå­ï¼Œå’Œ â€˜çµé­‚ä¼´ä¾£â€™ åˆç”Ÿäº†ä¸€ä¸ªç§ç”Ÿå­ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ç”¨ Symbol.for() å®šä¹‰: 123456const bastard1 = Symbol.for(&#x27;çŸ¥å·±å°ç§˜&#x27;)billionaire[bastard1] = &#x27;çŸ¥å·±å°ç§˜å„¿å­1&#x27;const bastard2 = Symbol.for(&#x27;çµé­‚ä¼´ä¾£&#x27;)billionaire[bastard2] = &#x27;çµé­‚ä¼´ä¾£å„¿å­1&#x27;console.log(billionaire) 123456&#123; son: [ &#x27;son1&#x27;, &#x27;son2&#x27;, &#x27;son3&#x27; ], daughter: [ &#x27;daughter1&#x27;, &#x27;daughter2&#x27; ], [Symbol(çŸ¥å·±å°ç§˜)]: &#x27;çŸ¥å·±å°ç§˜å„¿å­1&#x27;, [Symbol(çµé­‚ä¼´ä¾£)]: &#x27;çµé­‚ä¼´ä¾£å„¿å­1&#x27;&#125; Symbol keyå€¼åŒåæ—¶ï¼Œå…¶ value ä¹Ÿèƒ½è¢«è¦†ç›–æ‰å¦‚æœ â€˜çµé­‚ä¼´ä¾£â€™ åˆç”Ÿå¤šäº†ä¸€ä¸ªç§ç”Ÿå­ â€˜çµé­‚ä¼´ä¾£å„¿å­2â€™ ï¼Œä¼šå‡ºç°ä»€ä¹ˆæƒ…å†µï¼Ÿ 1234const bastard3 = Symbol.for(&#x27;çµé­‚ä¼´ä¾£&#x27;)billionaire[bastard3] = &#x27;çµé­‚ä¼´ä¾£å„¿å­2&#x27;console.log(billionaire) ç›´æ¥æ‰“å°å‡ºæ¥ï¼Œä¼šå‘ç° value å€¼ â€˜çµé­‚ä¼´ä¾£å„¿å­2â€™ è¦†ç›–æ‰äº† â€˜çµé­‚ä¼´ä¾£å„¿å­1â€™ 123456&#123; son: [ &#x27;son1&#x27;, &#x27;son2&#x27;, &#x27;son3&#x27; ], daughter: [ &#x27;daughter1&#x27;, &#x27;daughter2&#x27; ], [Symbol(çŸ¥å·±å°ç§˜)]: &#x27;çŸ¥å·±å°ç§˜å„¿å­1&#x27;, [Symbol(çµé­‚ä¼´ä¾£)]: &#x27;çµé­‚ä¼´ä¾£å„¿å­2&#x27;&#125; bastard2 å’Œ bastard3 éƒ½æ˜¯Symbolå€¼ï¼Œå®ƒä»¬éƒ½æ˜¯ç”±åŒæ ·å‚æ•°çš„ Symbol.for æ–¹æ³•ç”Ÿæˆçš„keyï¼Œæ‰€ä»¥å®é™…ä¸Šæ˜¯ä»æ˜¯åŒä¸€ä¸ªå€¼: 12console.log(bastard2 === bastard3)// true æŸ¥è¯¢æ‰€æœ‰å„¿å¥³ï¼ŒåŒ…æ‹¬ç§ç”Ÿå­çš„Keyå€¼ï¼šReflect.ownKeys()ä¼šä»¥ä¸€ä¸ªæ•°ç»„è¿”å›æ‰€æœ‰ Key å€¼ï¼ŒåŒ…æ‹¬ Symbol Key 12console.log(Reflect.ownKeys(billionaire))// [ &#x27;son&#x27;, &#x27;daughter&#x27;, Symbol(çŸ¥å·±å°ç§˜), Symbol(çµé­‚ä¼´ä¾£) ] Symbol.for() å’Œ Symbol() ç”Ÿæˆçš„Keyå€¼æœ‰ä½•ä¸åŒSymbol.for() ä¼šè¢«ç™»è®°åœ¨å…¨å±€ç¯å¢ƒä¸­ä¾›æœç´¢ï¼Œè€Œ Symbol() å°±ä¸ä¼šï¼Œæˆ‘ä»¬æ”¹åŠ¨ç§ç”Ÿå­ä¸º Symbol() ç”Ÿæˆï¼Œå¦‚ï¼š 12345678910const bastard1 = Symbol.for(&#x27;çŸ¥å·±å°ç§˜&#x27;)billionaire[bastard1] = &#x27;çŸ¥å·±å°ç§˜å„¿å­1&#x27;const bastard2 = Symbol(&#x27;çµé­‚ä¼´ä¾£&#x27;)billionaire[bastard2] = &#x27;çµé­‚ä¼´ä¾£å„¿å­1&#x27;console.log(bastard1, Symbol.keyFor(bastard1))console.log(bastard2, Symbol.keyFor(bastard2))// Symbol(çŸ¥å·±å°ç§˜) çŸ¥å·±å°ç§˜// Symbol(çµé­‚ä¼´ä¾£) undefined æ¢å¥è¯è¯´ï¼ŒSymbol.for() æ¯æ¬¡ç”Ÿæˆå‰ï¼Œä¼šæ£€æŸ¥å…¨å±€ç¯å¢ƒä¸­æ˜¯å¦å­˜åœ¨è¯¥Keyï¼›Symbol() åˆ™ä¸ä¼šï¼Œæ¯æ¬¡è°ƒç”¨ä¼šæ¯æ¬¡éƒ½ç”Ÿæˆ 12345console.log(Symbol.for(&#x27;a&#x27;) === Symbol.for(&#x27;a&#x27;))// trueconsole.log(Symbol(&#x27;a&#x27;) === Symbol(&#x27;a&#x27;))// false","tags":["ES"]},{"title":"è„±ç¦»è„šæ‰‹æ¶webpacké…åˆ¶React+typescripté¡¹ç›®ï¼ˆäºŒï¼‰","path":"/2021/05/08/ã€2021-05-04ã€‘è„±ç¦»è„šæ‰‹æ¶webpacké…åˆ¶React-typescripté¡¹ç›®ï¼ˆäºŒï¼‰/","content":"è¿™èŠ‚ä¼šç€é‡ä»‹ç»TSçš„é…ç½®ï¼Œè¿™ä¸ªæ˜¯å¯¹åº”çš„ repo å®‰è£…jsx è¯­æ³•é‡Œå·²æ”¯æŒäº† TS, è¦å…ˆå®‰è£…ä»¥ä¸‹ä¸¤ä¸ªåº“: 1yarn add @types/react @types/react-dom React TSçš„ä¸‰ç§æ–¹æ¡ˆ1. awesome-typescript-loader æ–¹æ¡ˆ è¿™ç§ä¸å»ºè®®, å› ä¸ºè¯¥æ’ä»¶ä½œè€…å·²ç»å¾ˆä¹…ä¸æ›´æ–°äº†, ä¸”æœ‰äº›æ£€æŸ¥ä¸å…¨é¢ 2. ts-loader + fork-ts-checker-webpack-plugin æ–¹æ¡ˆ webpack ç¼–è¯‘ä¼šé€šè¿‡æœ¬åœ°çš„ typescript , æ‰€ä»¥æœ¬åœ°å¿…é¡»å®‰è£… typescript, æœ¬åœ° typescript ä¼šè°ƒç”¨ tsconfig.json æ–‡ä»¶ æ¯æ¬¡æ–‡ä»¶æ”¹åŠ¨æ—¶, ts-loader éƒ½ä¼šè¿›è¡Œè½¬ç§»å’Œç±»å‹æ£€æŸ¥, å½“æ–‡ä»¶å¤šæ—¶, é€Ÿåº¦ä¼šå˜æ…¢ fork-ts-checker-webpack-plugin, åˆ©ç”¨è¯¥æ’ä»¶å¼€è¾Ÿä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹å»æ‰§è¡Œç±»å‹æ£€æŸ¥, ä¼šæé«˜ webpack çš„ç¼–è¯‘é€Ÿåº¦. è¯¥æ’ä»¶æœ‰æœ€ä½å®‰è£…è¦æ±‚: Node.js 6.11.5ï¼Œwebpack 4ï¼ŒTypeScript 2.1 å’Œå¯é€‰çš„ ESLint 6ï¼ˆå…¶æœ¬èº«è¦æ±‚æœ€ä½ Node.js 8.10.0ï¼‰ å…ˆå®‰è£…ä¸Šè¿°lib 1yarn add -D typescript ts-loader fork-ts-checker-webpack-plugin tsconfig.json æ–‡ä»¶é…ç½®æœ€ä¸»è¦æ˜¯ä»¥ä¸‹ä¸¤é¡¹é…ç½®ï¼š 123456789&#123; &quot;compilerOptions&quot;:Â &#123; &quot;jsx&quot;:Â &quot;preserve&quot;, &quot;moduleResolution&quot;: &quot;node&quot;, // &quot;module&quot;: &quot;ESNEXT&quot;, &quot;target&quot;: &quot;es6&quot;, // &quot;esModuleInterop&quot;: true &#125;,&#125; jsx å‚æ•°æœ‰3ä¸ªï¼Œåˆ†åˆ«æ˜¯&#39;react&#39;ï¼Œ&#39;preserve&#39;ï¼Œ&#39;react-native&#39; &#39;react&#39;Â æ¨¡å¼ä¸‹ï¼ŒtsÂ ä¼šå°†Â tsxÂ ç¼–è¯‘æˆÂ jsxÂ åå†å°†Â jsxÂ ç¼–è¯‘æˆÂ js &#39;preserve&#39; å’Œ &#39;react-native&#39;Â æ¨¡å¼ä¸‹ï¼šTSÂ ä¼šå°†Â tsxÂ ç¼–è¯‘æˆÂ jsxÂ åï¼Œä¸å†å°†Â jsxÂ ç¼–è¯‘æˆÂ jsï¼Œä¿ç•™Â jsx ã€‚ä¿ç•™Â jsxÂ æ—¶ï¼Œå°±éœ€è¦åœ¨webpack.config.js - module - ts-loader çš„å‰é¢åŠ ä¸ŠÂ babel-loaderÂ å»å¤„ç†Â jsxè¯­æ³• &quot;moduleResolution&quot; é¡»é…ç½®ä¸º &quot;node&quot;ï¼Œ å¦åˆ™ä¼šæŠ¥é”™å¦‚ä¸‹ webpack.config.js æ–‡ä»¶é…ç½®1234567891011121314151617181920212223242526272829303132333435const ForkTsCheckerWebpackPlugin = require(&#x27;fork-ts-checker-webpack-plugin&#x27;)module.export = &#123; ... module: &#123; rules: [ &#123;Â test:Â /\\.(jsx?)$/, exclude:Â /node_modules/, loader: &#x27;babel-loader&#x27;, options: &#123; cacheDirectory: true, cacheCompression: false &#125; &#125;, &#123; test: /\\.(tsx?)$/, exclude: /node_modules/, use: [ &#x27;babel-loader&#x27;, // ä¸Šé¢çš„ tsconfig.json çš„ compilerOptions.jsx å€¼ä¸º preserveï¼Œè¿™é‡ŒåŠ ä¸Š abel-loader è½¬è¯‘ jsx &#123; loader: &#x27;ts-loader&#x27;, options: &#123; // disable type checker - we will use it in fork plugin transpileOnly: true, &#125;&#125; ]&#125;, ... ] &#125;, plugins:Â [ newÂ HtmlWebpackPlugin(&#123; template:Â &quot;./src/index.html&quot;, inject: true, &#125;), // fork ä¸€ä¸ªè¿›ç¨‹è¿›è¡Œæ£€æŸ¥ï¼š new ForkTsCheckerWebpackPlugin() ], &#125; 3. @babel/preset-typescript æ–¹æ¡ˆ æ¯”è¾ƒè½»çš„æ–¹æ¡ˆ, ç›´æ¥é€šè¿‡ babel-loader çš„æ’ä»¶è¿›è¡Œè½¬è¯‘, æœ¬åœ°æ— é¡»å®‰è£… typescript , å› æ­¤ä¸ä¼šå»åšç±»å‹æ£€æŸ¥ åœ¨ tsconfig.json é‡Œé…ç½®ååœ¨æ§åˆ¶å°æç¤ºè¯­æ³•é”™è¯¯, ä½†ä¸åšå¼ºåˆ¶æ€§æ£€æŸ¥, å¦‚æœå†™æ³•ä¸ä¸¥æ ¼, é¡¹ç›®ä¹Ÿä¸ä¼šç¼–è¯‘ä¸é€šè¿‡ è¿™ç§æ–¹æ¡ˆç›¸æ¯”èµ·ä¸Šä¸€ç§æ–¹æ¡ˆå°‘äº†ç±»å‹æ£€æŸ¥, å¦‚æœè¿˜æƒ³åšç±»å‹æ£€æŸ¥, é¡»è¿›è¡Œé¢å¤–æœ¬åœ°å®‰è£…typescript , ä¸”è¿›è¡Œé¢å¤–å³é…ç½®, è¿è¡Œ tsc çš„å‘½ä»¤ 1yarn add -D @babel/preset-typescript babel.config.js é‡Œå¢åŠ è¯¥æ’ä»¶: 12345const presets = [ ... &#x27;@babel/preset-typescript&#x27; ... ] webpack.config.js é‡Œç›¸åº”çš„ module - rules è¦åšç›¸åº”æ”¹åŠ¨: 123rules: [ &#123;Â test:Â /\\.(jsx?|tsx?)$/, exclude:Â /node_modules/,Â use:Â [&#x27;babel-loader&#x27;] &#125;,] ä»¥ä¸Šé…ç½®, å°±èƒ½é¡ºåˆ©çš„å†™å‡º ts è¯­æ³•äº†, å¦‚:app.tsx 123456789101112131415161718192021import React, &#123; Component, FC &#125; from &#x27;react&#x27;import ReactDOM from &#x27;react-dom&#x27;interface aProps &#123; data: string&#125;const A: React.FC&lt;aProps&gt; = (&#123;data&#125;) =&gt; &#123; return &lt;div&gt; &#123;data&#125; &lt;/div&gt;&#125;export default class App extends Component &#123; render() &#123; return &lt;div&gt; &lt;A data=&#x27;data from App&#x27; /&gt; &lt;/div&gt; &#125;&#125;ReactDOM.render(&lt;App /&gt;, document.getElementById(&#x27;root&#x27;)) é¢å¤–å¤šåŠ ç›‘æµ‹tscç¼–è¯‘ æœ¬åœ°åº”é¢å¤–å®‰è£… typescript è¯­æ³•åŠŸèƒ½ï¼š 1yarn add -D typescript ç›´æ¥ tsc --watch ç›‘å¬è¿è¡Œ ä¹Ÿå¯ä»¥ script é‡Œå¢åŠ ä¸€ä¸ªå‘½ä»¤ä¸“é—¨ç”¨äºç›‘å¬ï¼š 123&#123; &quot;ts-chk&quot;: &quot;tsc --watch&quot;&#125; tsconfig.json 12345678910&#123; &quot;compilerOptions&quot;:Â &#123; //Â ä¸ç”Ÿæˆç¼–è¯‘æ–‡ä»¶ï¼Œåªåšç±»å‹æ£€æŸ¥ï¼š &quot;noEmit&quot;:Â true, // jsæ¨¡å—å¯¼å…¥æ–¹å¼ä¸åštsçš„æ£€æŸ¥ï¼š &quot;esModuleInterop&quot;: true, // ä½¿å…¶è¾¨è®¤jsxè¯­æ³•ï¼Œéœ€é‡å¯tscç›‘å¬ï¼š &quot;jsx&quot;: &quot;preserve&quot;, &#125;&#125; å…¶ä¸­ï¼Œ&quot;esModuleInterop&quot;: true æ˜¯ç”±äºTSçš„æ¨¡å—å¯¼å…¥æ–¹å¼å’ŒJSä¸åŒï¼Œå¦‚æœå»æ‰ä¼šæŠ¥ä»¥ä¸‹é”™è¯¯ï¼š æŒ‰ç…§å…¶æç¤ºçš„é”™è¯¯ TSçš„å¯¼å…¥è§„åˆ™ï¼Œè¦æ”¹æˆè¿™æ ·ï¼Œè¿™æ˜¾ç„¶ä¸ç¬¦åˆå¹³æ—¶çš„ä¹ æƒ¯ï¼Œ 12import * as React from &#x27;react&#x27;import * as ReactDOM from &#x27;react-dom&#x27; å…³äºæ¨¡å—å¯¼å…¥æ–¹å¼å¯ä»¥å‚è€ƒçŸ¥ä¹çš„è¿™ç¯‡æ–‡ç« ","tags":["React","type script","Webpack","Babel"]},{"title":"è„±ç¦»è„šæ‰‹æ¶webpacké…åˆ¶React+typescripté¡¹ç›®ï¼ˆä¸€ï¼‰","path":"/2021/05/04/ã€2021-05-04ã€‘è„±ç¦»è„šæ‰‹æ¶webpacké…åˆ¶React+typescripté¡¹ç›®ï¼ˆä¸€ï¼‰/","content":"å¦‚é¢˜ã€‚ä»¥å‰é…è¿‡ï¼Œä½†æ²¡ç›´æ¥æ”¯æŒtsçš„ï¼Œè¿™æ¬¡å¤ä¹ ä¸€éè®°å½•ä¸‹æ¥ï¼Œwebpack è¿™ä¸œè¥¿ï¼Œåœ¨é¡¹ç›®å¼€å§‹æ—¶æ•´ä¸€æ¬¡åç»å¸¸å°±å¾ˆå°‘ç¢°äº†ï¼Œæ›´è¦åŠ¨æ‰‹è®°å½•ä¸‹æ¥ã€‚ åˆå§‹åŒ–é¡¹ç›®1yarn init -y åŸºç¡€å®‰è£…é…ç½® webpack 1yarn add webpack webpack-cli@3* -D babel ç”¨äºå¤„ç†ES6+çš„ä»£ç è½¬æ¢ 1yarn add -D @babel/core @babel/preset-env babel-loader é…ç½® less ã€ sass æˆ– postcss ç­‰æ ·å¼é¢„å¤„ç†è¯­è¨€ï¼Œè¿™é‡Œä¸‰ä¸ªéƒ½ç»™ä»–é…ä¸Šï¼šautoprefixer å¯ä»¥è‡ªåŠ¨åœ¨æ ·å¼ä¸­æ·»åŠ æµè§ˆå™¨å‚å•†å‰ç¼€ï¼Œé¿å…æ‰‹åŠ¨å¤„ç†æ ·å¼å…¼å®¹é—®é¢˜ 123456# lessyarn add -D css-loader less less-loader style-loader# sass# postcss é…ç½®å¤„ç† HTML æ’ä»¶ 1yarn add -D html-webpack-plugin é…ç½®çƒ­æ›´æ–°æ’ä»¶ 1yarn add -D webpack-dev-server æ–°å»º src/app.jsï¼Œ webpack.config.jsï¼Œ src/index.html 1mkdir src &amp;&amp; touch src/app.js &amp;&amp; touch webpack.config.js æ”¯æŒreactçš„é…ç½®åŸºç¡€ï¼š 1yarn add react-dom react æ”¯æŒå„ç§è¯­æ³•ï¼š@babel/preset-react â€”â€” æ”¯æŒ jsx è¯­æ³•@babel/plugin-proposal-class-properties â€”â€” æ”¯æŒ class è¯­æ³•@babel/plugin-proposal-decorators â€”â€” æ”¯æŒè£…é¥°å™¨è¯­æ³• 1yarn add -D @babel/preset-react @babel/plugin-proposal-class-properties @babel/plugin-proposal-decorators babel é…ç½®åŸæ¥çš„ .babelrc ä»…é€‚ç”¨äºç®€å•å•ä¸ªåŒ…çš„é™æ€é…ç½®ï¼Œ babel7+ ç‰ˆæœ¬é‡‡ç”¨ babel.config.jsï¼Œå¯ä»¥é™æ€ç¼–è¯‘ node_modules æˆ‘ä»¬å»ºè®®ä½¿ç”¨babel.config.jsæ ¼å¼ã€‚babelæœ¬èº«æ­£åœ¨ä½¿ç”¨å®ƒã€‚ å¯¹äºå¤§å‹é¡¹ç›®ï¼Œbabelå®˜æ–¹è¿˜æ˜¯å»ºè®®é‡‡ç”¨ babel.config.js æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œå› ä¸º .babelrc æ˜¯ä»æ¯ä¸€ä¸ªæ–‡ä»¶å‘ä¸ŠæŸ¥æ‰¾é…ç½®çš„ï¼Œbabel.config.jsåˆ™ä¸ä¼š 1touch babel.config.js ç¼–å†™å¦‚ä¸‹ï¼š 1234567891011121314module.exports = function (api) &#123; api.cache(true) const presets = [ [ &#x27;@babel/preset-env&#x27;, &#123; modules: false &#125; ], &#x27;@babel/preset-react&#x27;, ] const plugins = [ [&#x27;@babel/plugin-proposal-decorators&#x27;, &#123; legacy: true &#125;], [&#x27;@babel/plugin-proposal-class-properties&#x27;, &#123; loose: true &#125;] ] return &#123; presets, plugins &#125;&#125; å®˜æ–¹æ–‡æ¡£ webpack.config.jsåŸºç¡€é…åˆ¶é…ç½®å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728const path = require(&#x27;path&#x27;)const HtmlWebpackPlugin = require(&#x27;html-webpack-plugin&#x27;)module.exports = &#123; entry: &#x27;./src/app.js&#x27;, output: &#123; path: path.resolve(__dirname, &#x27;dist&#x27;), filename: &#x27;bundle.js&#x27;, library: &#x27;ReactByWebpack&#x27;, libraryTarget: &#x27;umd&#x27; &#125;, module: &#123; rules: [ &#123;Â test:Â /\\.(jsx?)$/, exclude:Â /node_modules/,Â use:Â [&#x27;babel-loader&#x27;] &#125;, &#123; test: /\\.less$/, exclude:Â /node_modules/, use: [&#x27;style-loader&#x27;, &#x27;css-loader&#x27;, &#x27;less-loader&#x27;]&#125; ] &#125;,Â plugins:Â [ newÂ HtmlWebpackPlugin(&#123; template:Â &quot;./src/index.html&quot;, &#125;) ], devServer: &#123; contentBase: &#x27;./dist&#x27;, port: 8888, compress: true &#125;&#125; é”™è¯¯è§£å†³ ï¼šwebpack4 å’Œ webpack-cli4 å‘ç”Ÿå†²çª1234567891011121314151617181920212223242526yarn run v1.22.10$ webpack-dev-serverinternal/modules/cjs/loader.js:883 throw err; ^Error: Cannot find module &#x27;webpack-cli/bin/config-yargs&#x27;Require stack:- E:\\study\\code\\tech-blog-code\\2021\\11-webpack-react-ts-config ode_modules\\webpack-dev-server\\bin\\webpack-dev-server.js at Function.Module._resolveFilename (internal/modules/cjs/loader.js:880:15) at Function.Module._load (internal/modules/cjs/loader.js:725:27) at Module.require (internal/modules/cjs/loader.js:952:19) at require (internal/modules/cjs/helpers.js:88:18) at Object.&lt;anonymous&gt; (E:\\study\\code\\tech-blog-code\\2021\\11-webpack-react-ts-config ode_modules\\webpack-dev-server\\bin\\webpack-dev-server.js:65:1) at Module._compile (internal/modules/cjs/loader.js:1063:30) at Object.Module._extensions..js (internal/modules/cjs/loader.js:1092:10) at Module.load (internal/modules/cjs/loader.js:928:32) at Function.Module._load (internal/modules/cjs/loader.js:769:14) at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:72:12) &#123; code: &#x27;MODULE_NOT_FOUND&#x27;, requireStack: [ &#x27;E:\\\\study\\\\code\\\\tech-blog-code\\\\2021\\\\11-webpack-react-ts-config\\ ode_modules\\\\webpack-dev-server\\\\bin\\\\webpack-dev-server.js&#x27; ]&#125;error Command failed with exit code 1.info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command. è§£å†³åŠæ³•ï¼šä» webpack repo issue #1948 é‡Œå¯ä»¥æ‰¾åˆ°ç­”æ¡ˆ: If you upgrade webpack to 5. *, and webpack cli to 4. *, an error &gt; will be reported: Error: Cannot find module â€˜webpack-cli/bin/config-yargsâ€™ Temporary solution:Back off webpack cli to version 3. * for example: â€œwebpack-cliâ€: â€œ^ 3.3.12â€ é¡»è¦æŠŠ webpack-cli é™å›3åŠä»¥ä¸‹ç‰ˆæœ¬ 12yarn remove webpack-cliyarn add -D webpack-cli@3 é…ç½®å…¥å£æ–‡ä»¶1mkdir src &amp;&amp; touch src/app.js &amp;&amp; touch src/index.html app.js12345678910111213import React, &#123; Component &#125; from &#x27;react&#x27;import ReactDOM from &#x27;react-dom&#x27;const A = () =&gt; 123export default class App extends Component &#123; render() &#123; return &lt;div&gt; &lt;A/&gt; &lt;/div&gt; &#125;&#125;ReactDOM.render(&lt;App /&gt;, document.getElementById(&#x27;root&#x27;)) index.html123456789&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;title&gt;Document&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;div id=&#x27;root&#x27;&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; è¿è¡Œæ·»åŠ  script å¦‚ä¸‹ 1234&quot;scripts&quot;: &#123; &quot;dev&quot;: &quot;webpack-dev-server&quot;, &quot;build&quot;: &quot;webpack --mode=production&quot;&#125;, è‡³æ­¤ï¼Œæ™®é€šçš„ React é¡¹ç›®å·²é…ç½®æˆåŠŸï¼Œå¯ä»¥å°½æƒ…å†™ jsx äº†ï¼Œä¸‹ä¸€èŠ‚ä¼šç»§ç»­åŠ ä¸ŠTSé…ç½®","tags":["React","Webpack","Babel"]},{"title":"é€šè¿‡ReactHooksç›´æ¥æ“ä½œapiç¥åº“ï¼šReactQuery","path":"/2021/04/26/ã€2021-04-26ã€‘é€šè¿‡ReactHooksç›´æ¥æ“ä½œapiç¥åº“ï¼šReactQuery/","content":"React Query æ˜¯ä¸€ä¸ªä»¥react hooksä¸ºåŸºç¡€è¿›è¡Œå¼‚æ­¥è·å–ï¼Œç¼“å­˜å’Œæ›´æ”¹æ•°æ®çš„åº“ï¼Œreact queryä»“åº“æ–‡æ¡£åŸæ–‡æè¿°ï¼š Hooks for fetching, caching and updating asynchronous data in React æ¢è¨€ä¹‹ï¼Œæ˜¯ä¸€ä¸ªå¼‚æ­¥å¤„ç†æ•°æ®çš„åº“ã€‚è¿™ä¹ˆé‡è¦è€Œä¸”å¥½ç”¨çš„åº“å½“ç„¶è¦æ”¶å…¥å›Šä¸­ï¼ŒæŠŠä»–å­¦èµ·æ¥ï¼Œæœ¬ç¯‡ç€é‡ä»‹ç»æ•´ä¸ªé¡¹ç›®çš„æ„å»ºè¿‡ç¨‹ã€‚p.s è¯¥ç¯‡çš„åç«¯æœåŠ¡ç”¨è¿™ç¯‡ é…ç½®çš„æœåŠ¡ç«¯ å‰ç«¯åŸºç¡€æœåŠ¡æ­å»ºåˆå§‹åŒ–é¡¹ç›®: 1npx create-react-app client &amp;&amp; cd client å®‰è£…ä¾èµ–å¹¶è¿è¡Œ:å…¶ä¸­ react-hook-from @rebass/forms @rebass/preset styled-components react-loader-spinner å‡ä¸ºæ ·å¼ç»„ä»¶ 12yarn add react-query react-router-dom react-hook-from @rebass/forms @rebass/preset styled-components react-loader-spinneryarn start ä¿®æ”¹src/client.js æ–‡ä»¶å¦‚ä¸‹: QueryClientProvideræ–‡æ¡£ 12345678910111213141516171819202122232425262728import React from &#x27;react&#x27;import ReactDOM from &#x27;react-dom&#x27;import &quot;react-loader-spinner/dist/loader/css/react-spinner-loader.css&quot;import App from &#x27;./App&#x27;import &#123; BrowserRouter &#125; from &quot;react-router-dom&quot;import &#123; ThemeProvider &#125; from &quot;styled-components&quot;import preset from &quot;@rebass/preset&quot;// æ ¸å¿ƒéƒ¨åˆ†: react-queryimport &#123; QueryClientProvider, QueryClient &#125; from &quot;react-query&quot;// å®ä¾‹åŒ–queryClientconst queryClient = new QueryClient()ReactDOM.render( &#123;/* Reactä¸¥æ ¼æ¨¡å¼ï¼Œå®˜æ–¹æ–‡æ¡£ï¼š https://react.html.cn/docs/strict-mode.html */&#125; &lt;React.StrictMode&gt; &#123;/* QueryClientProvider å¯ä½œä¸ºå…¨å±€å¯¹è±¡æ³¨å…¥ï¼Œç±»ä¼¼ react-redux */&#125; &lt;QueryClientProvider client=&#123;queryClient&#125;&gt; &#123;/* æ ·å¼ç»„ä»¶ï¼š */&#125; &lt;ThemeProvider theme=&#123;preset&#125;&gt; &lt;BrowserRouter&gt; &lt;App /&gt; &lt;/BrowserRouter&gt; &lt;/ThemeProvider&gt; &lt;/QueryClientProvider&gt; &lt;/React.StrictMode&gt;, document.getElementById(&#x27;root&#x27;)) åŸºç¡€è·¯ç”±æ¨¡å—åŠåŸºç¡€æ¶æ„ï¼šsrc/App.js åˆ©ç”¨ &#39;react-router-dom&#39; ä½œä¸ºè·¯ç”±çš„ç®¡ç†å™¨ï¼Œä¹Ÿæ˜¯reactå¸¸è§çš„ç»“æ„æ¨¡å¼ï¼š ä¿®æ”¹src/App.jsæ–‡ä»¶å¦‚ä¸‹: 12345678910111213141516import &#123; Switch, Route &#125; from &#x27;react-router-dom&#x27;import &#123; BooksList &#125; from &#x27;./BookList&#x27;import &#123; CreateBook &#125; from &#x27;./CreateBook&#x27;import &#123; UpdateBook &#125; from &#x27;./UpdateBook&#x27;function App() &#123; return &lt;&gt; &lt;Switch&gt; &lt;Route path=&#x27;/update-book/:id&#x27;&gt;&lt;UpdateBook/&gt;&lt;/Route&gt; &lt;Route path=&#x27;/create-book&#x27;&gt;&lt;CreateBook /&gt;&lt;/Route&gt; &lt;Route path=&#x27;/&#x27;&gt;&lt;BooksList /&gt;&lt;/Route&gt; &lt;/Switch&gt; &lt;/&gt;&#125;export default App; è·å–æ‰€æœ‰å›¾ä¹¦åˆ›å»º src/BookList/index.js å’Œ src/BookList/BookList.jsx ï¼š src/BookList/index.js: 1export * from &#x27;./BooksList&#x27; src/BookList/BookList.jsx: 123export const BooksList = () =&gt; &#123; return null&#125; åˆ›å»ºå›¾ä¹¦åˆ›å»º src/BookList/index.js å’Œ src/BookList/BookList.jsx : src/CreateBook/index.js: 1export * from &#x27;./CreateBook&#x27; src/CreateBook/CreateBook.jsx: 12345678910export const CreateBook = () =&gt; &#123; return null&#125;``` ### æ›´æ–°å›¾ä¹¦ åˆ›å»º `src/BookList/index.js` å’Œ `src/BookList/BookList.jsx` : `src/UpdateBook/index.js`:```jsexport * from &#x27;./UpdateBook&#x27; src/UpdateBook/UpdateBook.jsx: 123export const UpdateBook = () =&gt; &#123; return null&#125; åŸºæœ¬ç»“æ„ï¼š1234567891011src |_App.js |_BookList | |_index.js | |_BookList.jsx |_CreateBook | |_CreateBook.jsx | |_index.js |_UpdateBook |_UpdateBook.jsx |_index.js æ·»åŠ å¯¼èˆªæ æ ·å¼src/shared/NavBar.jsx: 12345678910111213141516171819202122import &#123; Flex, Box, Link as StyledLink, Image &#125; from &#x27;rebass/styled-components&#x27;import &#123; Link &#125; from &#x27;react-router-dom&#x27;import &#123; Container &#125; from &#x27;./Container&#x27;import logo from &#x27;./logo.svg&#x27;export const NavBar = () =&gt; &#123; return &lt;Flex bg=&quot;black&quot; color=&quot;white&quot; justifyContent=&quot;center&quot;&gt; &lt;Container&gt; &lt;Flex px=&#123;2&#125; width=&#x27;100%&#x27; alignItems=&#x27;center&#x27;&gt; &lt;Image size=&#123;20&#125; src=&#123;logo&#125; /&gt; &lt;Link component=&#123;StyledLink&#125; variant=&#x27;nav&#x27; to=&#x27;/&#x27;&gt; React Query CRUD &lt;/Link&gt; &lt;Box mx=&quot;auto&quot;/&gt; &lt;Link component=&#123;StyledLink&#125; variant=&#x27;nav&#x27; to=&#x27;/create-book&#x27;&gt; + Add new book &lt;/Link&gt; &lt;/Flex&gt; &lt;/Container&gt; &lt;/Flex&gt;&#125; src/shared/Container.jsx : 1234567import &#123; Box &#125; from &#x27;rebass/styled-components&#x27;export const Container = (&#123;children&#125;) =&gt; &#123; return &lt;Box sx=&#123;&#123; width: &quot;100%&quot;, maxWidth: 1024, mx: &quot;auto&quot; &#125;&#125;&gt; &#123;children&#125; &lt;/Box&gt;&#125; è¿”å› src/App.js æŠŠå¯¼èˆªæ åŠ ä¸Š: 123import &#123; NavBar &#125; from &#x27;./shared/NavBar&#x27;&lt;NavBar/&gt; åˆ›å»º api.js æ¥å£æ–‡ä»¶è·å–å¹¶æ•°æ®ï¼šé…åˆ¶æ–‡ä»¶ .envè·¯å¾„å¿…é¡»åœ¨æ ¹ç›®å½• 1REACT_APP_SERVER &#x3D; http:&#x2F;&#x2F;localhost:4800 src/api.js12345export const getAllBooks = async () =&gt; &#123; const response = await fetch(`$&#123;process.env.REACT_APP_SERVER&#125;/books`) if (!response.ok) throw new Error(&#x27;something wrong&#x27;) return response.json()&#125; ã€ useQuery ã€‘ åº”ç”¨ â€”â€” src/BookList.jsx ä¸­æŸ¥è¯¢æ‰€æœ‰å›¾ä¹¦123456789101112131415161718192021222324252627import &#123; useQuery &#125; from &#x27;react-query&#x27;import &#123; Flex &#125; from &#x27;rebass&#x27;import &#123; getAllBooks &#125; from &#x27;../api&#x27;import &#123; Container &#125; from &#x27;../shared/Container&#x27;import Loader from &#x27;react-loader-spinner&#x27;export const BooksList = () =&gt; &#123; // useQueryå·²ç»å‡†å¤‡å¥½äº†å„ç§çŠ¶æ€ï¼Œç›´æ¥è°ƒç”¨å³å¯ï¼š const &#123; data, error, isLoading, isError &#125; = useQuery(&#x27;books&#x27;, getAllBooks) if (isLoading) return &lt;Container&gt; &lt;Flex&gt; &lt;Loader type=&#x27;ThreeDots&#x27; color=&#x27;#ccc&#x27; height=&#123;30&#125; /&gt; &lt;/Flex&gt; &lt;/Container&gt; if (isError) return &lt;span&gt; Error: &#123;error.message&#125; &lt;/span&gt; return &lt;Container&gt; &lt;Flex flexDirection=&#x27;column&#x27; alignItems=&#x27;center&#x27;&gt; &#123; data.map((&#123;author, title, id&#125;) =&gt; &lt;div key=&#123;id&#125;&gt; &#123;author&#125; - &#123;title&#125; &lt;/div&gt; )&#125; &lt;/Flex&gt; &lt;/Container&gt;&#125; æ­¤æ—¶ç•Œé¢å¯çœ‹åˆ°æ•ˆæœï¼š æ¯æ¡è®°å½•å•ç‹¬æŠ½ç¦»åšæ¨¡å— src\\BookList\\BookItem.jsx123456789101112131415import &#123; Flex, Text, Button, Link as StyledLink &#125; from &#x27;rebass/styled-components&#x27;import &#123; Link &#125; from &#x27;react-router-dom&#x27;export const BookItem = (&#123; author, title, id &#125;) =&gt; &#123; return &lt;Flex p=&#123;3&#125; width=&quot;100%&quot; alignItems=&#x27;center&#x27;&gt; &lt;Link component=&#123;StyledLink&#125; to=&#123;`/update-book/$&#123;id&#125;`&#125; mr=&quot;auto&quot;&gt; &#123; title &#125; &lt;/Link&gt; &lt;Text&gt;&#123;author&#125;&lt;/Text&gt; &lt;Button ml=&quot;3&quot;&gt; remove &lt;/Button&gt; &lt;/Flex&gt;&#125; ä» src\\BookList\\BookList.jsx å¯¼å…¥å¹¶å–ä»£å…·ä½“è®°å½•çš„ä½ç½®12345import &#123; BookItem &#125; from &#x27;./BookItem&#x27;data.map((&#123;author, title, id&#125;) =&gt; &lt;BookItem author=&#123;author&#125; title=&#123;title&#125; id=&#123;id&#125; key=&#123;id&#125;/&gt;) çœ‹çœ‹é¡µé¢çš„æ•ˆæœï¼š ã€ useMutation ã€‘å’Œã€ queryClient ã€‘ çš„åº”ç”¨ â€”â€” åˆ é™¤å›¾ä¹¦åœ¨ src\\api.js å¢åŠ åˆ é™¤æ¥å£ï¼š1234567export const removeBook = async id =&gt; &#123; const response = await fetch(`$&#123;process.env.REACT_APP_API_SERVER&#125;/books/$&#123;id&#125;`, &#123; method: &#x27;DELETE&#x27; &#125;) if (!response.ok) throw new Error(response.json().message) return true&#125; ä¸ºåˆ é™¤å›¾ä¹¦ä¿®æ”¹ç•Œé¢å¹¶åœ¨ src\\BookList\\BookList.jsx é‡Œå¢åŠ ç›¸åº”çš„ useMutation å’Œ queryClient çš„å†™æ³•ï¼š 1234567891011121314import &#123; removeBook &#125; from &#x27;../api&#x27;const queryClient = useQueryClient()// å°† removeBook ç›´æ¥ä¼ å…¥ useMutationconst &#123; mutateAsync, isLoading &#125; = useMutation(removeBook)const remove = async () =&gt; &#123; await mutateAsync(id) queryClient.invalidateQueries(&#x27;books&#x27;)&#125;&lt;Button ml=&quot;3&quot; onClick=&#123;remove&#125;&gt; &#123; isLoading ? &lt;Loader type=&#x27;ThreeDots&#x27; color=&#x27;#fff&#x27; height=&#123;10&#125; /&gt;: &#x27;Remove&#x27; &#125;&lt;/Button&gt; queryClient.invalidateQueries() ç”¨äºæ¸…é™¤ç¼“å­˜å¹¶åˆ·æ–°é¡µé¢ï¼š æ¥è‡ªä¸­æ–‡å®˜æ–¹æ–‡æ¡£çš„è§£é‡Šï¼š å¯ä»¥æ™ºèƒ½åœ°å°†æŸ¥è¯¢æ ‡è®°ä¸ºè¿‡æ—¶çš„ï¼Œå¹¶ä½¿ä¹‹å¯ç”¨é‡æ–°è·å–æ•°æ®ï¼Œ ç®€è¨€ä¹‹ï¼ŒqueryClient.invalidateQueries(&#39;books&#39;) å¯æ¸…é™¤æ—§ â€˜booksâ€™ çš„æ˜¾ç¤ºç¼“å­˜ï¼Œå¹¶ç›´æ¥åˆ·æ–°æœ€æ–°çš„ â€˜booksâ€™ æ¥å£æ•°æ®ï¼Œå¦‚æœä¸åŠ ï¼Œé¡µé¢å°±ä¸ä¼šåˆ·æ–°ï¼Œéœ€è¦æ‰‹åŠ¨åˆ·æ–° å˜æ›´ä¸€æœ¬å›¾ä¹¦ä¿¡æ¯src\\api.js å¢åŠ è·å–ä¸€æœ¬ä¹¦çš„æ¥å£ï¼š12345678export const getBook = async (&#123; queryKey &#125;) =&gt; &#123; // useQuery ä¼ è¿‡æ¥çš„å‚æ•°ï¼š const [_key, &#123; id &#125;] = queryKey const response = await fetch(`$&#123;process.env.REACT_APP_API_SERVER&#125;/books/$&#123;id&#125;`) if (!response.ok) throw new Error(response.json().message) return response.json()&#125; src\\api.js å¢åŠ  updateBook æ¥å£ï¼š123456789101112export const updateBook = async (&#123; id, ...data &#125;) =&gt; &#123; const response = await fetch(`$&#123;process.env.REACT_APP_API_SERVER&#125;/books/$&#123;id&#125;`, &#123; method: &#x27;PUT&#x27;, headers: &#123; &#x27;Content-Type&#x27; : &#x27;application/json&#x27; &#125;, body: JSON.stringify(data) &#125;) if (!response.ok) throw new Error(response.json().message) return response.json()&#125; æ–°å»º src\\shared\\BookForm.jsx ç”¨åšæ›´æ–°å›¾ä¹¦çš„è¾“å…¥ç•Œé¢ï¼š12345678910111213141516171819202122232425import &#123; Box, Button &#125; from &#x27;rebass/styled-components&#x27;import &#123; Label, Input &#125; from &#x27;@rebass/forms&#x27;import &#123; useForm &#125; from &#x27;react-hook-form&#x27;import Loader from &#x27;react-loader-spinner&#x27;export const BookForm = (&#123; defaultValues, onFormSubmit, isLoading &#125;) =&gt; &#123; const &#123; register, handleSubmit &#125; = useForm(&#123; defaultValues &#125;) const onSubmit = handleSubmit( data =&gt; &#123; onFormSubmit(data) &#125;) return &lt;form onSubmit=&#123;onSubmit&#125;&gt; &lt;Box sx=&#123;&#123; marginBottom : 3 &#125;&#125;&gt; &lt;Label htmlFor=&quot;title&quot;&gt;Title&lt;/Label&gt; &lt;Input ref=&#123;register&#125; id=&#x27;title&#x27; name=&#x27;title&#x27; type=&#x27;text&#x27; /&gt; &lt;/Box&gt; &lt;Box sx=&#123;&#123; marginBottom : 3 &#125;&#125;&gt; &lt;Label htmlFor=&#x27;author&#x27;&gt;Author&lt;/Label&gt; &lt;Input ref=&#123;register&#125; id=&#x27;author&#x27; name=&#x27;author&#x27; type=&#x27;text&#x27; /&gt; &lt;/Box&gt; &lt;Button&gt; &#123; isLoading ? &lt;Loader type=&#x27;ThreeDots&#x27; color=&#x27;#fff&#x27; height=&#123;10&#125; /&gt; : &#x27;Submit&#x27; &#125; &lt;/Button&gt; &lt;/form&gt;&#125; src\\UpdateBook\\UpdateBook.jsx æ›´æ”¹å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940import Loader from &quot;react-loader-spinner&quot;import &#123; useMutation, useQuery &#125; from &quot;react-query&quot;import &#123; useHistory, useParams &#125; from &quot;react-router-dom&quot;import &#123; Box, Flex, Heading &#125; from &quot;rebass/styled-components&quot;import &#123; getBook, updateBook &#125; from &quot;../api&quot;import &#123; BookForm, Container &#125; from &quot;../shared&quot;export const UpdateBook = () =&gt; &#123; const &#123; id &#125; = useParams() const history = useHistory() // è·å–å•æœ¬ä¹¦çš„æ¥å£ï¼š const &#123; data, error, isLoading, isError &#125; = useQuery([&#x27;book&#x27;, &#123;id&#125;], getBook) // æ›´æ”¹å•æœ¬ä¹¦ useMutation const &#123; mutateAsync, isLoading: isMutating &#125; = useMutation(updateBook) // å°†æ•°æ®ä¼ ç»™åç«¯ï¼š const onFormSubmit = async data =&gt; &#123; await mutateAsync(&#123; ...data, id &#125;) history.push(&#x27;/&#x27;) &#125; if ( isLoading ) return &lt;Container&gt; &lt;Flex&gt; &lt;Loader type=&#x27;ThreeDots&#x27; color=&#x27;#ccc&#x27; height=&#123;30&#125; /&gt; &lt;/Flex&gt; &lt;/Container&gt; if ( isError ) return &lt;Container&gt; &lt;Flex py=&#x27;5&#x27; justifyContent=&#x27;center&#x27;&gt; Error: &#123;error.message&#125; &lt;/Flex&gt; &lt;/Container&gt; return &lt;Container&gt; &lt;Box sx=&#123;&#123; py: 3 &#125;&#125;&gt; &lt;Heading sx=&#123;&#123; marginBottom: 3 &#125;&#125;&gt;Update Book&lt;/Heading&gt; &lt;BookForm defaultValues=&#123;data&#125; onFormSubmit=&#123;onFormSubmit&#125; isLoading=&#123;isMutating&#125; /&gt; &lt;/Box&gt; &lt;/Container&gt;&#125; æ–°å»º src\\shared\\index.js å°†æ‰€æœ‰å…±ç”¨ç»„ä»¶å¯¼å‡ºï¼š 123export * from &#x27;./Container&#x27;export * from &#x27;./BookForm&#x27;export * from &#x27;./NavBar&#x27; çœ‹çœ‹é¡µé¢çš„æ•ˆæœï¼š æ–°å»ºä¸€æœ¬å›¾ä¹¦src\\api.js é‡Œæ·»åŠ 1234567891011export const createBook = async (data) =&gt; &#123; const response = await fetch(`$&#123;process.env.REACT_APP_API_SERVER&#125;/books/`, &#123; method: &#x27;POST&#x27;, headers: &#123; &#x27;Content-Type&#x27;: &#x27;application/json&#x27; &#125;, body: JSON.stringify(data) &#125;) if (!response.ok) throw new Error(response.json().message) return response.json()&#125; æ›´æ”¹åˆ›å»ºå›¾ä¹¦ç•Œé¢ src\\CreateBook.jsx å¦‚ä¸‹ï¼š12345678910111213141516171819202122import &#123; useMutation &#125; from &quot;react-query&quot;import &#123; useHistory &#125; from &quot;react-router-dom&quot;import &#123; Box, Heading &#125; from &quot;rebass&quot;import &#123; createBook &#125; from &quot;../api&quot;import &#123; BookForm, Container, &#125; from &#x27;../shared&#x27;export const CreateBook = () =&gt; &#123; const history = useHistory() const &#123; mutateAsync, isLoading &#125; = useMutation(createBook) const onFormSubmit = async data =&gt; &#123; await mutateAsync(data) history.push(&#x27;/&#x27;) &#125; return &lt;Container&gt; &lt;Box sx=&#123;&#123; py: 3 &#125;&#125;&gt; &lt;Heading sx=&#123;&#123; marginBottom: 3 &#125;&#125;&gt;Create New Book&lt;/Heading&gt; &lt;BookForm onFormSubmit=&#123;onFormSubmit&#125; isLoading=&#123;isLoading&#125; /&gt; &lt;/Box&gt; &lt;/Container&gt;&#125; çœ‹çœ‹é¡µé¢çš„æ•ˆæœï¼š","tags":["React Query"]},{"title":"SwaggerUIé€šè¿‡swagger-jsdocåœ¨nodeé‡Œçš„åº”ç”¨å’Œé…ç½®","path":"/2021/04/25/ã€2021-04-25ã€‘SwaggerUIé€šè¿‡swagger-jsdocåœ¨nodeé‡Œçš„åº”ç”¨å’Œé…ç½®/","content":"SwaggerUIï¼Œåœ¨Javaé‡Œåº”è¯¥æ˜¯å¸¸ç”¨å·¥å…·ï¼Œèƒ½æ ¹æ®apiæ–‡ä»¶è‡ªåŠ¨ç”Ÿæˆç½‘é¡µç‰ˆçš„apiæ–‡æ¡£ç•Œé¢ï¼Œæ„Ÿè§‰æŒºæœ‰æ„æ€çš„ï¼Œå…¶å®ä»–æ”¯æŒå„ç§è¯­è¨€ï¼Œæœ¬ç¯‡åˆ†äº«ä¸€ä¸‹åœ¨nodeé‡Œçš„ç®€å•é…ç½®æ–¹æ³•ï¼Œé¡ºæ‰‹æ­å»ºäº†ä¸ªç®€å•çš„æœåŠ¡ã€‚ï¼ˆp.s. æœ¬ç¯‡åç»­æœ‰ç»­ç¯‡ï¼Œåˆ©ç”¨æœ¬ç¯‡çš„æœåŠ¡ï¼Œä»‹ç»ä¸€ä¸‹å‰ç«¯çš„çŠ¶æ€ç®¡ç†ç»„ä»¶React Queryçš„ç©æ³•ï¼Œé…åˆæœ¬ç¯‡æ­å»ºçš„æœåŠ¡ä½¿ç”¨ã€‚ï¼‰ åŸºæœ¬æ¶æ„åˆå§‹åŒ–é¡¹ç›®ï¼Œå®‰è£…ä¾èµ–: 123npm init -yyarn add express lowdb morgan nanoid cors swagger-jsdoc swagger-ui-expresstouch index.js index.js å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425const express = require(&quot;express&quot;);const cors = require(&quot;cors&quot;);const morgan = require(&quot;morgan&quot;);const low = require(&quot;lowdb&quot;);const PORT = process.env.PORT || 4800const FileSync = require(&quot;lowdb/adapters/FileSync&quot;)// ç”¨ db.json æ–‡ä»¶å……å½“æ•°æ®åº“: const adapter = new FileSync(&quot;db.json&quot;)const db = low(adapter)db.defaults(&#123; books: [] &#125;).write()const app = express()app.db = dbapp.use(cors())app.use(express.json())app.use(morgan(&quot;dev&quot;))app.listen(PORT, () =&gt; console.log(`the server run on port $&#123;PORT&#125;`)) è¯•ç€è¿è¡Œä¸€ä¸‹ï¼Œä¼šå‘ç°ç”Ÿæˆäº†ä¸€ä¸ª db.json æ–‡ä»¶ï¼Œæ€»ä½“ç›®å½•å¦‚ä¸‹ï¼š server |__node_modules/ |__db.json |__index.js |__package.json |__yarn.lock å»ºç«‹è·¯ç”±1mkdir route &amp;&amp; cd route &amp;&amp; touch books.js books.js å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445const express = require(&quot;express&quot;);const router = express.Router()const &#123; nanoid &#125; = require(&quot;nanoid&quot;);const idLength = 8router.get(&#x27;/&#x27;, (req, res) =&gt; &#123; const books = req.app.db.get(&#x27;books&#x27;) res.send(books)&#125;)router.get(&#x27;/:id&#x27;, (req, res) =&gt; &#123; const book = req.app.db.get(&#x27;books&#x27;).find(&#123; id: req.params.id &#125;).value() if (!book) res.send(404) res.send(book)&#125;)router.post(&#x27;/&#x27;, (req, res) =&gt; &#123; try &#123; const book = &#123; id: nanoid(idLength), ...req.body &#125; req.app.db.get(&#x27;books&#x27;).push(book).write() res.send(book) &#125;catch (error) &#123; return res.status(500).send(error) &#125;&#125;)router.put(&#x27;/:id&#x27;, (req, res) =&gt; &#123; try &#123; req.app.db.get(&#x27;books&#x27;).find(&#123; id: req.params.id &#125;).assign(req.body).write() res.send(req.app.db.get(&#x27;books&#x27;)).find(&#123;id: req.params.id&#125;) &#125;catch (error) &#123; return res.status(500).send(error) &#125;&#125;)router.delete(&#x27;/:id&#x27;, (req, res) =&gt; &#123; req.app.db.get(&#x27;books&#x27;).remove(&#123; id: req.params.id &#125;).write() res.sendStatus(200)&#125;)module.exports = router åº”ç”¨SwaggerUI:åœ¨ index.js é‡Œå¼•ç”¨ SwaggerUIï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼š 12345678910111213141516171819202122const swaggerUI = require(&quot;swagger-ui-express&quot;);const swaggerJsDoc = require(&quot;swagger-jsdoc&quot;);const booksRouter = require(&quot;./route/books&quot;);const specs = swaggerJsDoc(&#123; definition: &#123; // å¿…é¡»å‚æ•°ï¼Œä¸å¡«åˆ™æ²¡æœ‰æƒé™ï¼Œå¡«çš„è¯ä¹Ÿåªæ”¯æŒ 3.0.n openapi: &quot;3.0.0&quot;, // ä¸€äº›æè¿°ï¼Œå¯é€‰ï¼š info: &#123; title: &quot;Library API&quot;, version: &quot;1.0.0&quot;, description: &quot;A simple Express Library API&quot; &#125;, servers: [&#123; url: &quot;http://localhost:4800&quot;&#125;], &#125;, apis: [&quot;./route/*.js&quot;]&#125;)app.use(&quot;/api-docs&quot;, swaggerUI.serve, swaggerUI.setup(specs))app.use(&#x27;/books&#x27;, booksRouter) å¯åœ¨ç•Œé¢çœ‹åˆ°ï¼š è‡ªåŠ¨ç”Ÿæˆapiæ–‡æ¡£é¡µé¢ï¼šå‚ç…§å…¶æ–‡æ¡£ï¼Œæ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯swagger-jsdocï¼Œä»–å°†å¤šè¡Œæ³¨é‡Šé‡Œçš„apié…ç½®è½¬æ¢ä¸ºé¡µé¢çš„æ–‡æ¡£é…ç½®ï¼Œæˆ‘ä»¬å°† route/books.js æ”¹å†™ä¸ºä»¥ä¸‹æ ¼å¼ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181/** * @swagger * components: * schemas: * Book: * type: object * required: * - title * - author * properties: * id: * type: string * description: The auto-generated id of the book * title: * type: string * description: The book title * author: * type: string * description: The book author * example: * id: d5fE_asz * title: The New Turing Omnibus * author: Alexander K. Dewdney *//** * @swagger * tags: * name: Books * description: The books managing API *//** * @swagger * /books: * get: * summary: Returns the list of all the books * tags: [Books] * responses: * 200: * description: The list of the books * content: * application/json: * schema: * type: array * items: * $ref: &#x27;#/components/schemas/Book&#x27; */router.get(&#x27;/&#x27;, (req, res) =&gt; &#123; const books = req.app.db.get(&#x27;books&#x27;) res.send(books)&#125;)/** * @swagger * /books/&#123;id&#125;: * get: * summary: Get the book by id * tags: [Books] * parameters: * - in: path * name: id * schema: * type: string * required: true * description: The book id * responses: * 200: * description: The book description by id * contents: * application/json: * schema: * $ref: &#x27;#/components/schemas/Book&#x27; * 404: * description: The book was not found */router.get(&#x27;/:id&#x27;, (req, res) =&gt; &#123; const book = req.app.db.get(&#x27;books&#x27;).find(&#123; id: req.params.id &#125;).value() if (!book) res.send(404) res.send(book)&#125;)/** * @swagger * /books: * post: * summary: Create a new book * tags: [Books] * requestBody: * required: true * content: * application/json: * schema: * $ref: &#x27;#/components/schemas/Book&#x27; * responses: * 200: * description: The book was successfully created * content: * application/json: * schema: * $ref: &#x27;#/components/schemas/Book&#x27; * 500: * description: Server Error */router.post(&#x27;/&#x27;, (req, res) =&gt; &#123; try &#123; const book = &#123; id: nanoid(idLength), ...req.body &#125; req.app.db.get(&#x27;books&#x27;).push(book).write() res.send(book) &#125;catch (error) &#123; return res.status(500).send(error) &#125;&#125;)/** * @swagger * /books/&#123;id&#125;: * put: * summary: Update the book by the id * tags: [Books] * parameters: * - in: path * name: id * schema: * type: string * required: true * description: The book id * requestBody: * required: true * content: * application/json: * schema: * $ref: &#x27;#/components/schemas/Book&#x27; * responses: * 200: * description: The Book was updated * content: * application/json: * schema: * $ref: &#x27;#/components/schemas/Book&#x27; */router.put(&#x27;/:id&#x27;, (req, res) =&gt; &#123; try &#123; req.app.db.get(&#x27;books&#x27;).find(&#123; id: req.params.id &#125;).assign(req.body).write() res.send(req.app.db.get(&#x27;books&#x27;)).find(&#123;id: req.params.id&#125;) &#125;catch (error) &#123; return res.status(500).send(error) &#125;&#125;)/** * @swagger * /books/&#123;id&#125;: * delete: * summary: Update the book by the id * tags: [Books] * parameters: * - in: path * name: id * schema: * type: string * required: true * description: The book id * responses: * 200: * description: The Book was deleted * 404: * description: The Book was not found */router.delete(&#x27;/:id&#x27;, (req, res) =&gt; &#123; req.app.db.get(&#x27;books&#x27;).remove(&#123; id: req.params.id &#125;).write() res.sendStatus(200)&#125;)module.exports = router é‡è·‘æœåŠ¡ï¼Œå¯ä»¥å‘ç°ä»¥ä¸‹ç•Œé¢ï¼š swagger-jsdoc æ˜¯é€šè¿‡ openapi çš„3.0ç‰ˆæœ¬è¿›è¡Œçš„æ”¹åŠ¨ï¼Œä¼ ç»Ÿçš„ openapi æ˜¯é€šè¿‡ç‹¬ç«‹çš„ json æ–‡ä»¶å¯¹ swaggerè¿›è¡Œé…ç½®ï¼Œä¸åœ¨æœ¬ç¯‡è®¨è®ºèŒƒå›´ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹è¿™ç¯‡å›½å¤–çš„demo","tags":["Swagger UI","åç«¯","Nodejs","swagger-jsdoc"]},{"title":"æ— é™æ»šåŠ¨å’Œæ‡’åŠ è½½é€šè¿‡IntersectionObserverå’ŒReact_Hookså®ç°","path":"/2021/04/23/ã€2021-04-23ã€‘æ— é™æ»šåŠ¨å’Œæ‡’åŠ è½½é€šè¿‡IntersectionObserverå’ŒReact_Hookså®ç°/","content":"ç”¨React Hooksåšé¡¹ç›®æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œç‚’é¸¡å–œæ¬¢ï¼Œè¿™é‡Œç»“åˆ IntersectionObserver åŸç”Ÿjs apiåŠå„ç§hooksï¼Œåšä¸ªç®€å•çš„æ— é™æ»šåŠ¨+æ‡’åŠ è½½é¡µé¢ï¼Œå…³äº IntersectionObserverï¼Œ é˜®å¤§ç¥çš„è¿™ç¯‡åšå®¢æ–‡ç« é‡Œæœ‰éå¸¸è¯¦å°½çš„æè¿°ï¼ˆp.s. dataç”¨åˆ°æ•°æ®æ¥å£éœ€ç§‘å­¦ä¸Šç½‘ï¼‰ åŸºç¡€æ¶æ„ ç”¨ create-react-app æ„å»ºé¡¹ç›®åè£… axiosï¼ŒApp.jsä¿®æ”¹å¦‚ä¸‹ï¼Œé¡µé¢å‘ˆç°å¦‚ä¸‹ç®€å•æ•ˆæœï¼Œå³åœ¨è¾“å…¥æ¡†è¾“å…¥æŸä¸€ä¹¦ç±å…³é”®å­—æ—¶ï¼Œä¼šå‡ºç°å¯¹åº”æ‰€æœ‰çš„ä¹¦ç±åˆ—è¡¨ï¼š 1234567891011const App = () =&gt; &#123; return &lt;div&gt; &lt;input type=&quot;text&quot;/&gt; &lt;div&gt;Title&lt;/div&gt; &lt;div&gt;Title&lt;/div&gt; &lt;div&gt;Title&lt;/div&gt; &lt;div&gt;Title&lt;/div&gt; &lt;div&gt;Loading...&lt;/div&gt; &lt;div&gt;Error&lt;/div&gt; &lt;/div&gt;&#125; è‡ªå®šä¹‰ custom hooks ä½œä¸ºå¼‚æ­¥è¯·æ±‚æ•°æ®ï¼šæ ¹æ®hooksä¹ æƒ¯ï¼Œåå­—ç”¨useå¼€å¤´ï¼š 1234567891011121314151617181920import &#123; useState, useRef, useCallback &#125; from &#x27;react&#x27;/** * @params * input è¾“å…¥æ¡†è¾“å…¥éœ€è¦æŸ¥è¯¢çš„å­—æ®µ * pageNum é¡µç ï¼Œå¦‚æœé¡µé¢ä¸€é¡µå±•ç¤ºä¸ç©ï¼Œä¼šæŒç»­æ·»åŠ pageNum*/export const useBookSearch = (query, pageNum) =&gt; &#123; useEffect(() =&gt; &#123; axios(&#123; method: &#x27;GET&#x27;, url: &#x27;http://openlibrary.org/search.json&#x27;, params: &#123; q: query, page: pageNum &#125;, &#125;).then(res =&gt; &#123; // è¿œç¨‹è·å–æ•°æ®ï¼Œæš‚æ—¶æ§åˆ¶å°æ‰“å°ï¼š console.log(res.data) &#125;) &#125;, [query, pageNum]) return null&#125; åœ¨ App.js é‡Œå¼•å…¥è‡ªå®šä¹‰hooks 123456789101112const App = () =&gt; &#123; useBookSearch(query, pageNum) return &lt;div&gt; &lt;input type=&quot;text&quot;/&gt; &lt;div&gt;Title&lt;/div&gt; &lt;div&gt;Title&lt;/div&gt; &lt;div&gt;Title&lt;/div&gt; &lt;div&gt;Title&lt;/div&gt; &lt;div&gt;Loading...&lt;/div&gt; &lt;div&gt;Error&lt;/div&gt; &lt;/div&gt;&#125; å®ç°åŠ¨æ€æ•ˆæœ ç»§ç»­æ”¹é€  App.js query å’Œ pageNumä¸¤ä¸ªå‚æ•°éœ€è¦åœ¨æœ¬é¡µè¿›è¡Œå˜åŠ¨ï¼Œäºæ˜¯åŠ å…¥ useState é’©å­ 1234567891011121314151617181920212223import &#123; useState, useRef, useCallback &#125; from &#x27;react&#x27;const App = () =&gt; &#123; const [query, setInput] = useState(&#x27;&#x27;) const [pageNum, setPageNum] = useState(1) const handleSearch = e =&gt; &#123; setInput(e.target.value) // é‡æ–°è¾“å…¥æŸ¥è¯¢å­—æ®µåï¼Œé¡µæ•°é‡æ–°è®¾ç½®ä¸º1ï¼š pageNum(1) &#125; useBookSearch(query, pageNum) return &lt;div&gt; &lt;input type=&quot;text&quot; onChange=&#123;handleSearch&#125;/&gt; &lt;div&gt;Title&lt;/div&gt; &lt;div&gt;Title&lt;/div&gt; &lt;div&gt;Title&lt;/div&gt; &lt;div&gt;Title&lt;/div&gt; &lt;div&gt;Loading...&lt;/div&gt; &lt;div&gt;Error&lt;/div&gt; &lt;/div&gt;&#125; query é€šè¿‡è¾“å…¥æ¡†æ”¹å˜ï¼Œä¼ é€’ç»™ useBookSearch(query, pageNum)ï¼Œæ§åˆ¶å°èƒ½çœ‹åˆ°è¯·æ±‚å›æ¥çš„æ•°æ®ï¼Œå¦‚ä¸‹æ¼”ç¤ºï¼Œä½†è¿™ç§è¯·æ±‚æ˜¯å®æ—¶çš„ï¼Œå³æ¯è¾“å…¥ä¸€ä¸ªå­—ç¬¦å°±ä¼šè¯·æ±‚ä¸€æ¬¡ï¼Œä¼šæµªè´¹æ€§èƒ½ï¼Œå¿…é¡»ä¼˜åŒ– useBookSearch ä¼˜åŒ–è¯·æ±‚æ€§èƒ½ï¼š axios æœ‰ä¸ªå‚æ•° CancelTokenï¼Œå¯å–æ¶ˆé‡å¤è¯·æ±‚ï¼Œåšå¦‚ä¸‹æ”¹åŠ¨ï¼š 123456789101112131415161718192021useEffect(() =&gt; &#123; setLoading(true) setError(false) // å®šä¹‰å–æ¶ˆå˜é‡ let cancel axios(&#123; method: &#x27;GET&#x27;, url: &#x27;http://openlibrary.org/search.json&#x27;, params: &#123; q: query, page: pageNum &#125;, // æ‰§è¡Œå–æ¶ˆå˜é‡ï¼š cancelToken: new axios.CancelToken(c =&gt; cancel = c) &#125;).then(res =&gt; console.log(res.data) ).catch(e =&gt; &#123; if (axios.isCancel(e)) return setError(true) &#125;) // æœ€åï¼ŒuseEffecté‡Œå¿…é¡»åˆ é™¤newå‡ºæ¥çš„å®ä¾‹ return () =&gt; cancel()&#125;, [query, pageNum]) æ”¹é€ å®Œæˆåï¼Œç»§ç»­é‡æ–°å°è¯•ï¼š é¡µé¢UIå®ç°ï¼š é’ˆå¯¹ç•Œé¢å®ç°çš„ä¸°å¯Œï¼Œæˆ‘ä»¬å¯¹ useBookSearch å‡½æ•°ç»§ç»­åšæ”¹é€ ï¼Œåˆ†åˆ«å¢åŠ ä»¥ä¸‹çŠ¶æ€ï¼š loading : è¯»å– error : è·å–æ•°æ®é”™è¯¯ hasMore : åˆ¤æ–­æ˜¯å¦è¿˜æœ‰æ•°æ® books : è·å–åˆ°çš„æ‰€æœ‰ä¹¦ç±çš„æ•°æ® 12345678910111213141516171819202122232425262728293031323334353637383940414243const useBookSearch = (query, pageNum) =&gt; &#123; const [loading, setLoading] = useState(true) const [error, setError] = useState([]) const [books, setBooks] = useState([]) const [hasMore, setHasMore] = useState(false) useEffect(() =&gt; &#123; setLoading(true) setError(false) let cancel axios(&#123; method: &#x27;GET&#x27;, url: &#x27;http://openlibrary.org/search.json&#x27;, params: &#123; q: query, page: pageNum &#125;, cancelToken: new axios.CancelToken(c =&gt; cancel = c) &#125;) .then(res =&gt; &#123; // å°†åé¢è¯·æ±‚å›æ¥booksåŠ å…¥ç°æœ‰æ•°ç»„ä¸­ï¼šç”¨Setå»é‡ï¼š setBooks(prevBooks =&gt; &#123; return [...new Set([...prevBooks, ...res.data.docs.map(b =&gt; b.title)])] &#125;) // æ¯æ¬¡åªèƒ½æ˜¾ç¤ºæ»¡å±çš„æ•°æ®ï¼Œå¦‚æœè¯·æ±‚çš„æ•°æ®æ²¡æ˜¾ç¤ºå®Œ setHasMore(res.data.docs.length &gt; 0) // åˆ™æŠŠloadingæ˜¾ç¤ºä¸ºfalse setLoading(false) &#125;) .catch(e =&gt; &#123; if (axios.isCancel(e)) return // è®¾ç½®é”™è¯¯ï¼š setError(true) &#125;) return () =&gt; cancel() &#125;, [query, pageNum]) // æ¯æ¬¡æ”¹å˜ useEffect(() =&gt; &#123; setBooks([]) &#125;, [query]) // å°†ä¸Šé¢çš„çŠ¶æ€ä¸€æ¦‚å¯¼å‡ºï¼Œç»™Appå‡½æ•°ç”¨ï¼š return &#123; loading, error, books, hasMore &#125;&#125; æ”¹é€ ä¸»é¡µé¢çš„ App ç»„ä»¶: 123456789101112131415161718192021222324import &#123; useState &#125; from &#x27;react&#x27;const App = () =&gt; &#123; const [query, setInput] = useState(&#x27;&#x27;) const [pageNum, setPageNum] = useState(1) // å°†çŠ¶æ€ä»useBookNameSearchè§£æ„å‡ºæ¥ï¼š const &#123; books, hasMore, loading, error &#125; = useBookSearch(query, setPageNum) const handleSearch = e =&gt; &#123; setInput(e.target.value) pageNum(1) &#125; return ( &lt;&gt; &lt;input type=&quot;text&quot; onChange=&#123;handleSearch&#125;/&gt; &#123; books.map((book, index) =&gt; &lt;div key=&#123;book&#125;&gt;&#123;book&#125;&lt;/div&gt;)&#125; &lt;div&gt;&#123; loading &amp;&amp; &#x27;Loading...&#x27; &#125;&lt;/div&gt; &lt;div&gt;&#123; error &amp;&amp; &#x27;Error&#x27; &#125;&lt;/div&gt; &lt;/&gt; );&#125;export default App; æœ€åï¼Œç»§ç»­åšç¿»é¡µçš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬è¦å®ç°çš„æ•ˆæœæ˜¯ï¼Œæ»šåŠ¨åˆ°é¡µé¢æœ€ä¸‹é¢ï¼Œåˆ™è‡ªåŠ¨è§¦å‘loadingå’Œç¿»é¡µï¼Œåœ¨ App é‡Œç”¨åˆ°useRef é’©å­ï¼Œæ£€æµ‹åˆ°æ»šåŠ¨åˆ°æœ€åä¸€è¡Œ ç”¨åˆ° useCallback é’©å­ï¼Œå…·æœ‰ç¼“å­˜ä½œç”¨ï¼Œä¾èµ–æ”¹å˜æ‰é‡æ–°æ¸²æŸ“ã€‚ ç”¨åˆ° IntersectionObserver api, ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå›è°ƒå‡½æ•°ï¼Œå…¶ entries ä¸ºæ£€æµ‹åˆ°çš„è§¦å‘çš„ç‚¹ 12345678910111213const last = useRef()const lastRecordRef = useCallback( node =&gt; &#123; if (loading) return if (observer.current) observer.current.disconnect() observer.current = new IntersectionObserver(entries =&gt; &#123; // entries[0].isIntersectingæ£€æµ‹å¯è§é¡µé¢å†…æ˜¯å¦éœ€è¦è°ƒç”¨æ–°çš„æ•°æ®ï¼š if( entries[0].isIntersecting &amp;&amp; hasMore ) &#123; setPageNum(prevPageNumber =&gt; prevPageNumber + 1) &#125; &#125;) // æ£€æµ‹æ˜¯å¦æœ€åä¸€ä¸ªèŠ‚ç‚¹node if (node) observer.current.observe(node)&#125;, [loading, hasMore] æ§åˆ¶å°æ‰“å°äº†entries[0].isIntersectingï¼Œå½“å‡ºç°LoadingçŠ¶æ€æ—¶ï¼Œè¯¥å€¼ä¸ºtrue, å•å½“å®ŒæˆåŠ è½½åä¸ºfalseï¼Œå¦‚ä¸‹ï¼š è´´å‡ºå®Œæ•´ä»£ç ï¼š App.js 1234567891011121314151617181920212223242526272829303132333435363738394041424344import useBookSearch from &#x27;./useBookSearch&#x27;import &#123; useState, useRef, useCallback &#125; from &#x27;react&#x27;function App() &#123; const [query, setQuery] = useState(&#x27;&#x27;) const [pageNumber, setPageNumber] = useState(1) const &#123; books, hasMore, loading, error &#125; = useBookSearch(query, pageNumber) const observer = useRef() const lastBookElementRef = useCallback(node =&gt; &#123; if (loading) return if (observer.current) observer.current.disconnect() observer.current = new IntersectionObserver(entries =&gt; &#123; // detected is it the last one: if( entries[0].isIntersecting &amp;&amp; hasMore ) &#123; setPageNumber(prevPageNumber =&gt; prevPageNumber + 1) &#125; &#125;) if (node) observer.current.observe(node) &#125;, [loading, hasMore]) const handleSearch = e =&gt; &#123; setQuery(e.target.value) setPageNumber(1) &#125; return ( &lt;&gt; &lt;input type=&quot;text&quot; onChange=&#123;handleSearch&#125;/&gt; &#123; books.map( (book, index) =&gt; &#123; if (books.length === index + 1) &#123; return &lt;div ref=&#123;lastBookElementRef&#125; key=&#123;book&#125;&gt;&#123;book&#125;&lt;/div&gt; &#125;else&#123; return &lt;div key=&#123;book&#125;&gt;&#123;book&#125;&lt;/div&gt; &#125; &#125;)&#125; &lt;div&gt;&#123; loading &amp;&amp; &#x27;Loading...&#x27; &#125;&lt;/div&gt; &lt;div&gt;&#123; error &amp;&amp; &#x27;Error&#x27; &#125;&lt;/div&gt; &lt;/&gt; );&#125;export default App; useBookSearch ç‹¬ç«‹æˆä¸€ä¸ªæ–‡ä»¶ 12345678910111213141516171819202122232425262728293031323334353637383940414243import &#123; useEffect, useState &#125; from &#x27;react&#x27;import axios from &#x27;axios&#x27;const useBookSearch = (query, pageNumber) =&gt; &#123; const [loading, setLoading] = useState(true) const [error, setError] = useState([]) const [books, setBooks] = useState([]) const [hasMore, setHasMore] = useState(false) useEffect(() =&gt; &#123; setLoading(true) setError(false) let cancel axios(&#123; method: &#x27;GET&#x27;, url: &#x27;http://openlibrary.org/search.json&#x27;, params: &#123; q: query, page: pageNumber &#125;, cancelToken: new axios.CancelToken(c =&gt; cancel = c) &#125;) .then(res =&gt; &#123; setBooks(prevBooks =&gt; &#123; return [...new Set([...prevBooks, ...res.data.docs.map(b =&gt; b.title)])] &#125;) setHasMore(res.data.docs.length &gt; 0) setLoading(false) &#125;) .catch(e =&gt; &#123; if (axios.isCancel(e)) return setError(true) &#125;) return () =&gt; cancel() &#125;, [query, pageNumber]) useEffect(() =&gt; &#123; setBooks([]) &#125;, [query]) return &#123; loading, error, books, hasMore &#125;&#125;export default useBookSearch","tags":["React","React Hooks","IntersectionObserver"]},{"title":"å‘ç°ä¸€å…è´¹CDNï¼Œæˆ‘ç”¨æ¥å­˜è¯¥ç«™çš„å›¾","path":"/2021/04/22/ã€2021-04-22ã€‘å‘ç°ä¸€å…è´¹CDNï¼Œæˆ‘ç”¨æ¥å­˜è¯¥ç«™çš„å›¾/","content":"å…ˆä¸Šç½‘å€ï¼šhttps://www.jsdelivr.com/?docs=gh è¯´è¯´æˆ‘é‡åˆ°çš„ç—›ç‚¹ï¼Œè¯¥ç«™é‡‡ç”¨hexoç”Ÿæˆï¼Œåœ¨ç½‘ä¸Šæœäº†ä¸€åœˆï¼Œå»ºè®®ç”¨hexo-asset-imageå·¥å…·ï¼Œä½†_postæ–‡ä»¶å¤¹é‡Œä¼šå¤šå‡ºä¸€ä¸ªæ–‡ä»¶å¤¹ä¸“é—¨ç”¨äºå­˜å‚¨å›¾ç‰‡ï¼Œä¸”è¯¥å·¥å…·è¿˜æœ‰ä¸€ç‚¹bugï¼Œè™½ç„¶æœ€åä¹Ÿè§£å†³äº†ï¼Œä½†æ€»æœ‰ç‚¹ä¸çˆ½ã€‚æ€å‰æƒ³åï¼Œè¿˜æ˜¯æ–°å»ºä¸€ä¸ªæ”¾å›¾ç‰‡çš„git repoæœ€çœäº‹ï¼Œå¦‚æœç›´æ¥è´´ä»“åº“ï¼Œå¯èƒ½é€Ÿåº¦æœ‰ç‚¹æ…¢ï¼Œäºæ˜¯å°±å¾—æ‰¾CDNäº†ã€‚ CDN ï¼ˆContent Delivery Network/Content Distribution Networkï¼‰å†…å®¹åˆ†å‘ç½‘ç»œã€‚æ˜¯æŒ‡ä¸€ç§é€è¿‡äº’è”ç½‘äº’ç›¸è¿æ¥çš„ç”µè„‘ç½‘ç»œç³»ç»Ÿï¼Œåˆ©ç”¨æœ€é è¿‘æ¯ä½ç”¨æˆ·çš„æœåŠ¡å™¨ï¼Œæ›´å¿«ã€æ›´å¯é åœ°å°†éŸ³ä¹ã€å›¾ç‰‡ã€å½±ç‰‡ã€åº”ç”¨ç¨‹åºåŠå…¶ä»–æ–‡ä»¶å‘é€ç»™ç”¨æˆ·ï¼Œæ¥æä¾›é«˜æ€§èƒ½ã€å¯æ‰©å±•æ€§åŠä½æˆæœ¬çš„ç½‘ç»œå†…å®¹ä¼ é€’ç»™ç”¨æˆ·ã€‚ é€‰æ‹©äº†GitHubç‰ˆæœ¬ï¼Œæ“ä½œå¦‚ä¸‹ï¼š é¦–å…ˆï¼Œæ–°å»ºä¸€ä¸ªGitHubä»“åº“ï¼šä¾‹å¦‚æˆ‘è‡ªå·±çš„å›¾ç‰‡çš„ä»“åº“ï¼š https://github.com/ys558/my-blog-imgs å°†ä½ è¦æ”¾ç½‘ç»œçš„å›¾ç‰‡æ¨åˆ°ä½ è‡ªå·±ä»“åº“ å…³é”®çš„ä¸€æ­¥ï¼šç»™ä»“åº“ç‰ˆæœ¬æ‰“æ ‡ç­¾ï¼Œä¸¤ä¸ªæ–¹æ³•ï¼šæ–¹æ³•ä¸€ã€å‘½ä»¤è¡Œ, ä¾‹å¦‚ï¼š 1git tag -a v1.4 -m &quot;my version 1.4&quot; å‘½ä»¤è¡Œæ›´è¯¦ç»†çš„æ“ä½œå¯å‚è€ƒè¿™é‡Œ æ–¹æ³•äºŒã€æ¨å®Œå›¾ç‰‡åï¼Œç›´æ¥åœ¨ä½ githubå›¾ç‰‡ä»“åº“ä¸Šæ“ä½œï¼š å°†ä½ æ”¾å›¾ç‰‡é“¾æ¥çš„ä½ç½®æ›¿æ¢ä¸º jsdelivr ä¸¾ä¾‹çš„CDNæ ¼å¼å³å¯ï¼Œä»¥æˆ‘å¤´åƒçš„å›¾ç‰‡ä¸¾ä¾‹ï¼Œç”¨GitHubçš„æ ¼å¼ä¸ºï¼š 1https://cdn.jsdelivr.net/gh/user/repo@version/file æ›¿æ¢ä¸ºï¼š 1https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@0.17/avatar/å®‡èˆªå‘˜.svg","tags":["CDN"]},{"title":"GraphQLå­¦ä¹ ","path":"/2021/04/20/ã€2021-04-20ã€‘GraphQLå­¦ä¹ /","content":"å»å¹´è‡ªå­¦äº†GraphQLï¼Œè¿™é‡Œé‡æ–°æ•´ç†ä¸€ä¸‹ç¬”è®°ã€‚å›½å†…ä½¿ç”¨GraphQLçš„é¡¹ç›®æ¯•ç«Ÿè¿˜ä¸å¤šï¼Œè¿™é‡Œå†™ä¸ªdemoï¼Œåšä¸ªå°å°çš„æ¢ç´¢ã€‚ GraphQLæ˜¯facebookå‘æ˜çš„ä¸€å¥—APIæŸ¥è¯¢è¯­è¨€ï¼Œæ”¯æŒå¤šç§è¯­è¨€ï¼Œè¿™é‡Œç”¨jsæ¼”ç¤ºï¼Œå®˜ç½‘æœ‰è¯¦ç»†çš„è¯´æ˜æ¯”èµ·ä¼ ç»Ÿçš„åç«¯APIæ•´åˆ GraphQLä¸ºä½ çš„APIæ•°æ®æä¾›äº†ä¸€ç§å®Œæ•´ä¸”æ˜“äºç†è§£çš„æè¿°ã€‚ï¼ˆGraphQL provides a complete and understandable description of the data in your APIï¼‰ ä»¥ä¸Šæ˜¯å®˜ç½‘å¯¹GraphQLçš„è§£é‡Šï¼Œåˆ©ç”¨GraphQLå¯ä»¥æŒ‰éœ€å–å­—æ®µç»™å‰ç«¯åˆ©ç”¨ï¼Œä¸å¿…å–åˆ°ä¸éœ€è¦çš„å­—æ®µï¼Œè§ä¸‹å›¾è§£é‡Šï¼š GraphQLåˆ™å¯ä»¥ç²¾ç¡®æŸ¥æ‰¾æƒ³è¦çš„å­—æ®µï¼Œæ•ˆç‡æ˜¾è‘—æé«˜ï¼š ä¸‹é¢ï¼Œç»“åˆè‡ªå·±å†™çš„demoï¼šhttps://github.com/ys558/tech-blog-code/tree/master/2020/04-graphql-learn å®Œæˆä»¥ä¸‹å®Œæˆæœ¬ç¯‡åšå®¢ï¼š ä¸€ã€HelloWorld å°†é¡¹ç›®æ‹‰ä¸‹æ¥åï¼Œcdåˆ°å¯¹åº”ç›®å½•ä¸‹ï¼Œç”¨npm installæˆ–yarnå®‰è£…ä¾èµ–ï¼Œè¿è¡Œnpm run hello æˆ– yarn helloï¼Œå…ˆä» 01helloworld.js æ–‡ä»¶è·‘èµ·ï¼Œæµè§ˆå™¨è¿è¡Œhttp://localhost:5000/å·¦è¾¹è¾“å…¥æ¡†è¾“å…¥123query &#123; message&#125; æ³¨æ„ï¼Œè¿™ç§æ˜¯GraphQLç‰¹æœ‰çš„æŸ¥è¯¢è¯­æ³• ç‚¹å‡»è¿è¡Œï¼Œ( æˆ–å¿«æ·é”® ctrl+enter ) åï¼Œå³è¾¹ä¼šæ˜¾ç¤ºï¼š 01helloworld.jsè§£æï¼š graphqlHTTP ä¸º express-graphql åº“è§£æ„çš„å®ä¾‹1const &#123; graphqlHTTP &#125; = require(&#x27;express-graphql&#x27;) GraphQLè‡ªå¸¦å›¾å½¢åŒ–ç•Œé¢ä¸”å‹å¥½ï¼Œï¼Œåªéœ€åœ¨å®ä¾‹ graphqlHTTP ä¸­è®¾ç½®graphiql: trueå³å¯ï¼š1app.use(&#x27;/&#x27;, graphqlHTTP(&#123; schema, graphiql: true &#125;)) åœ¨queryå®ä¾‹ä¸­ï¼Œfields å­—æ®µç”¨äºè®¾ç½®æŸ¥è¯¢æ¡ä»¶ï¼Œæ˜¯å›è°ƒå‡½æ•°ï¼Œ fields å‡½æ•°è¿”å›çš„ä¸œè¥¿ç”¨ resolve å‡½æ•°æ¥æ”¶å…¶è¿”å›ç»“æœï¼Œæ¥æ”¶ç»“æœä¹Ÿä¸ºå›è°ƒå‡½æ•° åœ¨æ¥æ”¶ç»“æœä¸­ï¼Œå¯ä»¥è§„å®šå…¶è¿”å›ç±»å‹ typeï¼Œå…¶å€¼ä¸º Scalar Type (æ ‡é‡ç±»å‹)1234567891011const schema = new GraphQLSchema(&#123; query: new GraphQLObjectType(&#123; name: &#x27;helloWorld&#x27;, fields: () =&gt; (&#123; message: &#123; type: GraphQLString, resolve: () =&gt; &#x27;Hello World&#x27; &#125; &#125;) &#125;)&#125;) äºŒã€åŸºç¡€æ“ä½œ è¿è¡Œnpm run ds2 æˆ– yarn ds2ï¼Œæµè§ˆå™¨è·‘ http://localhost:5000/booksï¼Œ 123456&#123; books &#123; id name &#125;&#125; è¾“å…¥ä»¥ä¸Šæ¡ä»¶ï¼Œé€šè¿‡ books å­—æ®µæŸ¥è¯¢å…¶å¯¹åº”çš„ id, name åè¿è¡Œï¼Œå¯ä»¥æŸ¥è¯¢å‡ºä»¥ä¸‹ç»“æœï¼š 02base.js è§£æï¼š booksæŸ¥è¯¢å‡ºæ¥çš„ä¸ºä¸€æ•°ç»„ï¼Œå…¶æ ‡é‡ å®šä¹‰ä¸º GraphQLList1234567891011121314151617181920212223const RootQueryType = new GraphQLObjectType(&#123; name: &#x27;Query&#x27;, description: &#x27;Root Query&#x27;, fields: () =&gt; (&#123; /* ç¬¬ä¸€ä¸ª books æ˜¯å‘½åï¼Œä¹Ÿå¯å« aaaï¼Œå¦‚æœæ”¹ aaa åˆ™ åœ¨ query æ¡ä»¶æ”¹ä¸ºï¼š aaa &#123; books &#123; id name &#125; &#125; */ books: &#123; // BookType as params pass to RootQueryType type: new GraphQLList(BookType), description: &#x27;List of all books&#x27;, // è¿™é‡Œçš„ books å¯¹åº”å®é™…çš„ books æ•°ç»„ï¼Œ // è¦æŸ¥è¯¢æ•°ç»„ booksé‡Œçš„ä¸œè¥¿ï¼š resolve: () =&gt; books &#125; &#125;)&#125;) BookType ç‹¬ç«‹ä¸ºæ ‡é‡GraphQLObjectTypeçš„å®ä¾‹åŒ–ï¼Œç”±äºå…¶ä¸ºæœ€åä¸€å±‚æ•°æ®ï¼Œæ— éœ€å‘ä¸‹æ·±æŒ–ï¼Œæ‰€ä»¥resolve æ–¹æ³•ä¸éœ€è¦ GraphQLNonNull è¡¨ç¤ºè¯¥å­—æ®µä¸ºå¿…é¡»å­—æ®µ12345678const BookType = new GraphQLObjectType(&#123; name: &#x27;Book&#x27;, description: &#x27;this is represents a book written by an author&#x27;, fields: () =&gt; (&#123; id: &#123; type: GraphQLNonNull(GraphQLInt) &#125;, name: &#123; type: GraphQLNonNull(GraphQLString) &#125;, &#125;)&#125;) ä¸‰ã€é€šè¿‡ä¹¦ç±æŸ¥è¯¢å¯¹åº”ä½œè€…ï¼ˆä¸€å¯¹ä¸€å…³ç³»æŸ¥è¯¢ï¼‰åŠä½œè€…æŸ¥è¯¢å¯¹åº”çš„ä¹¦ç±ä¿¡æ¯ï¼ˆä¸€å¯¹å¤šæŸ¥è¯¢ï¼‰ è·‘ 03listQuery.js æ–‡ä»¶ï¼Œè¾“å…¥ 12345678&#123; authors &#123; books &#123; id name &#125; &#125;&#125; å¯ä»¥å¾—åˆ°ç»“æœï¼š è§£æ03listQuery.js ï¼š å¯ä»¥æŒ‰ç…§ä¸Šé¢çš„æ–¹æ³•ç»§ç»­ä¸°å¯ŒæŸ¥è¯¢ï¼Œå»ºç«‹ä¸€ä¸ªæ¨¡æ‹Ÿæ•°æ® author ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 12345const authors = [ &#123; id: 1, name: &#x27;J. K. Rowling&#x27;&#125;, &#123; id: 2, name: &#x27;J. R. R. Tolkien&#x27;&#125;, &#123; id: 3, name: &#x27;Brent Weeks&#x27;&#125;,] åŒæ ·çš„ï¼Œå»ºç«‹ä¸¤ä¸ªå®ä¾‹æŸ¥è¯¢å¯¹åº”ä¿¡æ¯ï¼šresolve éƒ¨åˆ†å¯¹åº”ç›¸åº”çš„æ•°æ® 123456789101112&#123; books: &#123; type: new GraphQLList(BookType), description: &#x27;List of all books&#x27;, resolve: () =&gt; books &#125;, authors: &#123; type: new GraphQLList(AuthorType), description: &#x27;List of all Authors&#x27;, resolve: () =&gt; authors &#125;&#125; æ ¹æ®ä¸Šé¢çš„å­—æ®µåå­—books å’Œ authors åˆ›å»ºå¯¹åº”çš„æŸ¥è¯¢å®ä¾‹ï¼š bookså®ä¾‹é‡Œï¼Œid, name, authorId å‡æ˜¯ books å¯¹è±¡é‡Œçš„ï¼Œå¯ç›´æ¥æŸ¥å‡ºï¼Œ authorå­—æ®µåœ¨ author æ•°ç»„é‡Œ books æ•°æ®æœ‰å…³è”çš„æ˜¯authorIdï¼Œç”¨jsçš„æ•°ç»„æ–¹æ³•.find()å»æ‰¾ books &lt;â€“&gt; authors æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼ŒAuthorTypeæœ¬èº«å°±æ˜¯GraphQLObjectType æ ‡é‡ï¼Œå¯ç›´æ¥ä½¿ç”¨ 12345678910111213141516const BookType = new GraphQLObjectType(&#123; name: &#x27;Book&#x27;, description: &#x27;this is represents a book written by an author&#x27;, fields: () =&gt; (&#123; id: &#123; type: GraphQLNonNull(GraphQLInt) &#125;, name: &#123; type: GraphQLNonNull(GraphQLString) &#125;, authorId: &#123; type: GraphQLNonNull(GraphQLInt)&#125;, author: &#123; type: AuthorType, // query book by authorId resolve: book =&gt; &#123; return authors.find( author =&gt; author.id === book.authorId ) &#125; &#125; &#125;)&#125;) authorså®ä¾‹ä¹Ÿæ˜¯åŒæ ·é“ç† authors &lt;â€“&gt; books æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼ŒBookTypeå®ä¾‹è¦è£…å…¥GraphQLListæ ‡é‡ä¸­ 123456789101112131415const AuthorType = new GraphQLObjectType(&#123; name: &#x27;Author&#x27;, description: &#x27;this is represents a author of a book&#x27;, fields: () =&gt; (&#123; id: &#123; type: GraphQLNonNull(GraphQLInt) &#125;, name: &#123; type: GraphQLNonNull(GraphQLString) &#125;, // query author by book&#x27;s id books: &#123; type: new GraphQLList(BookType), resolve: author =&gt; &#123; return books.filter(book =&gt; book.authorId === author.id) &#125; &#125; &#125;)&#125;) å››ã€é€šè¿‡ä¹¦ç±idæŸ¥è¯¢ä¹¦æœ¬ä¿¡æ¯ è¿è¡Œ04singleQuery.jsï¼Œè¾“å…¥ä»¥ä¸‹æŸ¥è¯¢æ¡ä»¶ï¼š 12345678&#123; book(id: 4) &#123; name author &#123; name &#125; &#125;&#125; æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š è¾“å…¥ä»¥ä¸‹æ¡ä»¶ 12345678&#123; book(id: 4) &#123; name author &#123; name &#125; &#125;&#125; æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š 04singleQuery.jsè§£æï¼š ä»ä»¥ä¸Šçš„æŸ¥è¯¢æ¡ä»¶ book(id: 4) å¯çœ‹å‡ºï¼Œé€šè¿‡ä¼ å‚idæŸ¥è¯¢å…·ä½“ä¹¦ç±ä¿¡æ¯ï¼Œè¿™é‡Œçš„idå°±ä½“ç°åœ¨argså‚æ•°ä¸Šï¼š args åœ¨ resolve å‡½æ•°é‡Œå¤„äºç¬¬äºŒä¸ªå‚æ•°çš„ä½ç½®1234567book: &#123; type: BookType, description: &#x27;A Single Book&#x27;, // must query this book by params of book id: args: &#123; id: &#123; type: GraphQLInt &#125; &#125;, resolve: ( parent, args ) =&gt; books.find( book =&gt; book.id === args.id )&#125;, åŒæ ·çš„ï¼Œ authorä¹Ÿå¯ä»¥æŒ‰ç…§ä¼ å…¥authorIdæŸ¥è¯¢å¾—åˆ°ï¼š1234567author: &#123; type: AuthorType, description: &#x27;A Single Author&#x27;, // query an author by params of author id: args: &#123; id: &#123; type: GraphQLInt &#125; &#125;, resolve: ( parent, args ) =&gt; authors.find( author =&gt; author.id === args.id )&#125;, ç”¨ author(id) æŸ¥è¯¢ç»“æœï¼š äº”ã€ä¿®æ”¹æ•°æ®ï¼ˆMutationTypeï¼‰ è¿è¡Œyarn ds5ï¼Œæµè§ˆå™¨è¾“å…¥ï¼š 123456mutation &#123; addBook(name: &quot;new book&quot;, authorId: 1) &#123; id name &#125;&#125; å¯ä»¥çœ‹åˆ°å¢åŠ å•æœ¬ä¹¦æˆåŠŸï¼š è¾“å…¥ï¼š 12345mutation &#123; addAuthor(name: &quot;new author&quot;) &#123; name &#125;&#125; å¯ä»¥çœ‹åˆ°å¢åŠ ä¸€ä¸ªä½œè€…æˆåŠŸï¼š ç‚¹å‡»å³ä¸Šè§’çš„ &lt; Docsï¼Œå¯ä»¥å‘ç°è¯¥æ–‡ä»¶çš„Mutationå‡½æ•°ï¼Œå…¶ä¸­!æ„ä¸ºå¿…è¦å­—æ®µï¼š 05mutationType.jsè§£æï¼š æƒ³è¦å®ç° Mutation Type é¡»åœ¨GraphQLSchemaå®ä¾‹é‡Œæ·»åŠ mutationç±»å‹ï¼š1234const Schema = new GraphQLSchema(&#123; query: RootQueryType, mutation: RootMutationType&#125;) å’Œæ™®é€šçš„ Query Type ç±»ä¼¼ï¼Œåªä¸è¿‡ Mutation Type åœ¨ resolve é‡Œç›´æ¥å¯¹æ•°æ®è¿›è¡Œæ”¹åŠ¨è€Œå·²ï¼š123456789101112131415161718192021222324252627fields: () =&gt; (&#123; addBook: &#123; type: BookType, description: &#x27;Add a book&#x27;, args: &#123; name: &#123; type: GraphQLNonNull(GraphQLString) &#125;, authorId: &#123; type: GraphQLNonNull(GraphQLInt) &#125; &#125;, resolve: ( parent, args ) =&gt; &#123; const book = &#123; id: books.length + 1, name: args.name, authorId: args.authorId &#125; books.push(book) return book &#125; &#125;, addAuthor: &#123; type: AuthorType, description: &#x27;Add a author&#x27;, args: &#123; name: &#123; type: GraphQLNonNull(GraphQLString) &#125; &#125;, resolve: ( parent, args ) =&gt; &#123; const author = &#123; id: authors.length + 1, name: args.name &#125; authors.push(author) return author &#125; &#125;,&#125;)","tags":["GraphQL"]},{"title":"Github Pageå»ºç«™å¿ƒå¾—åŠæ‰€è¸©çš„å‘","path":"/2021/04/19/ã€2021-04-19ã€‘GithubPageå»ºç«™å¿ƒå¾—åŠæ‰€è¸©çš„å‘/","content":"æœ€è¿‘æƒ³ç”¨ github.io å»ºç«‹æˆ‘çš„ä¸ªäººåšå®¢ç«™ç‚¹ï¼Œå…·ä½“æ­¥éª¤æˆ‘å‚è€ƒäº†çŸ¥ä¹ä¸Šçš„ä¸€ç¯‡æ–‡ç« ï¼Œé‡Œé¢å†™çš„å¤Ÿæ¸…æ¥šäº†ï¼Œä¸‹é¢å°±å»ºç«™æ—¶ç¢°åˆ°çš„å‘å†™çš„ä¸å®Œå…¨æ€»ç»“ï¼Œä¼°è®¡ä»¥åé™†ç»­å¢åŠ  ys558.github.ioæ”¹ä¸ºè‡ªå·±çš„åŸŸåå»é˜¿é‡Œäº‘ç”³è¯·ä¸€ä¸ªè‡ªå·±çš„åŸŸååç»‘å®šåŸç†çš„ys558.github.ioåŸŸåï¼Œæ­¥éª¤ï¼š ç™»é™†é˜¿é‡Œäº‘çš„ä¸‡ç½‘ï¼ŒæŒ‘ä¸€ä¸ªå–œæ¬¢ä¾¿å®œçš„åŸŸåæ³¨å†Œï¼Œæˆ‘çš„åŸŸå zyzy.info ä¸€å¹´åªèŠ±21å…ƒï¼Œæ³¨å†Œå®Œæˆåé€‰æ‹©ä¸ªäººç«™ç‚¹ï¼Œé¡ºä¾¿ä¹Ÿå°±å¼€é€šäº†é˜¿é‡Œäº‘è´¦å·ï¼Œå¦‚å…¶ä»–åŸŸåæœåŠ¡å•†ï¼Œå¦‚ç”³è¯·.meç»“å°¾çš„ä¸ªäººç½‘ç«™ï¼Œåº”è¯¥å»GoDaddyç­‰ ä¾æ¬¡è¿›å…¥å³ä¸Šè§’çš„ æ§åˆ¶å° =&gt; è¿ç»´ç®¡ç† é€‰é¡¹å¡ä¸‹æ‰¾åˆ° åŸŸå æ ‡ç­¾ =&gt; ç‚¹å‡» è§£æï¼Œå¦‚ä¸‹ï¼š =&gt; ç‚¹å‡»æ·»åŠ è®°å½•ï¼Œ åœ¨ è®°å½•å€¼ å¤„å¡«ä¸‹ys558.github.ioï¼Œå¦‚ä¸‹ï¼Œç‚¹å‡»ç¡®å®šã€‚è¿™æ ·å°±æŠŠä½ github.ioä¸Šçš„é¡µé¢ç»‘å®šäº†è´­ä¹°çš„åŸŸåä¸‹ ç”¨ping ä¹Ÿå¯æŸ¥è¯¢åˆ°æ–°ç»‘å®šçš„åŸŸåç½‘å€IPï¼š æŒ‰ä»¥ä¸‹å‘½ä»¤åœ¨è‡ªå·±çš„githubä»“åº“ä¸­æ·»åŠ CNAMEæ–‡ä»¶ï¼Œå…¶ä¸­å¡«å…¥è´­ä¹°çš„åŸŸåã€‚æˆ–è€…å¯ä»¥åœ¨ä»“åº“çš„settingsä¸­è®¾ç½®Custom Domainè®¾ç½®å¥½è‡ªå·±çš„åŸŸåï¼Œgithubä¼šè‡ªåŠ¨æ·»åŠ CNAMEæ–‡ä»¶ã€‚ 12touch CNAMEecho &#x27;zyzy.info&#x27;&gt; CNAME å›¾ç‰‡æ˜¾ç¤ºé”™è¯¯ï¼šï¼ï¼ï¼è¯¥æ–¹æ³•ä¹Ÿæ˜¯åœ¨ç½‘ä¸Šæœç´¢å¾—åˆ°ï¼Œè™½å¯è¡Œï¼Œä½†è§£æä¸­æ–‡è·¯å¾„æ—¶ç»å¸¸ä¼šå‡ºé”™ï¼Œåæ¥è¿˜æ˜¯è½¬ç”¨CDNï¼ŒæŠŠå›¾ç‰‡å…¨éƒ¨ç§»åˆ°å¦ä¸€ä¸ªrepoï¼Œæ¨èç”¨CDNçš„æ–¹æ³•ï¼Œå…·ä½“æ“ä½œåŠæ³•çœ‹æˆ‘å¦ä¸€ç¯‡æ–‡ç«  éœ€è¦å®‰è£…ä¸€ä¸ªå›¾ç‰‡è·¯å¾„è½¬æ¢çš„æ’ä»¶ï¼Œè¿™ä¸ªæ’ä»¶åå­—æ˜¯ hexo-asset-image 123npm i hexo-asset-image --save# oryarn add hexo-asset-image --save _config.ymlæ–‡ä»¶ï¼Œä¿®æ”¹ä¸‹è¿°å†…å®¹ï¼Œç”¨ hexo n &lt;åšå®¢æ–‡ç« åå­—&gt; ç”Ÿæˆæ–°åšå®¢æ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„æ–‡ä»¶å¤¹ï¼Œå°†å›¾ç‰‡æ”¾å…¥è¯¥æ–‡ä»¶å¤¹å¼•ç”¨å³å¯ï¼š 1post_asset_folder: true ä¿®æ”¹åšå®¢ç›®å½•ä¸‹node_modules\\hexo-asset-image\\index.js (hexoæ–‡ä»¶æœ‰bug) è¯ä¹¦é”™è¯¯ï¼Œä¸æ˜¯ç§å¯†è¿æ¥Githubå»ºç«™å¥½ä¹‹åï¼Œç»å¸¸ä¼šç¢°åˆ°æ‰“å¼€é¡µé¢æµè§ˆå™¨æ˜¾ç¤ºä¸æ˜¯ç§å¯†é“¾æ¥çš„æƒ…å†µï¼Œæœæ¥æœå»ï¼Œè¯´æ˜¯GitHubçš„SSLè¯ä¹¦ä¸ç¨³å®šï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯å¢™çš„åŸå› ã€‚ æœ‰ä¸¤ä¸ªæ–¹æ³•å¯ä»¥è§£å†³ï¼šä¸€æ˜¯ç”³è¯· cloudfare çš„å…è´¹è¯ä¹¦ï¼ŒäºŒæ˜¯è‡ªå·±ä¹°è¯ä¹¦ï¼Œä¸¤ç§æ–¹æ³•éƒ½ä»‹ç»ä»¥ä¸‹ æ–¹æ³•ä¸€ï¼š æŸå®ä¹°è¯ä¹¦å»æŸå®ä¹°äº†è¯ä¹¦ï¼Œï¼ˆp.s. ä¸å·®é’±ä¹Ÿå¯ä»¥ç›´æ¥ä¹°é˜¿é‡Œäº‘çš„è¯ä¹¦ï¼Œä¸¤å¹´2000å¤šï¼‰ï¼Œè¯ä¹¦æ˜¯æœ‰æœ‰æ•ˆæœŸçš„ï¼Œæˆ‘ä¹°çš„é‚£å®¶è¯ä¹¦ä¸€å¹´80å…ƒï¼Œä¸¤å¹´140å…ƒï¼Œ5å¹´300å…ƒã€‚é€‰ä¸ªè‡ªå·±èƒ½æ¥å—ï¼Œä¸å¤ªè´µçš„ä»·æ ¼å³å¯ã€‚ä¸€èˆ¬é”€é‡é«˜çš„åº—å®¶éƒ½æœ‰æ•™ä½ æ€ä¹ˆé…ç½®ï¼Œæˆ‘è¿™é‡ŒæŠŠå…¶é…ç½®è®°å½•äº†ä¸‹æ¥ï¼š 1. åœ¨ Github Page ä¸Šå–æ¶ˆå‹¾é€‰ Enforce HTTPS æœåŠ¡ä½ç½®å¦‚ä¸‹å›¾ï¼š 2. å°†ä¹°åˆ°çš„è¯ä¹¦åœ¨é˜¿é‡Œäº‘ä¸Šè®¾ç½®å¦‚ä¸‹å›¾é¡ºåºè®¾ç½®ä¾¿å¯å®Œæˆï¼š æ–¹æ³•äºŒï¼šè¹­ cloudfare çš„å…è´¹è¯ä¹¦1. ç”³è¯·ä¸ª cloudfare è´¦å·ï¼Œå¹¶æ·»åŠ DNScloudfare æˆ‘çš„cloudfareæ˜¯ä»¥å‰æ³¨å†Œçš„ï¼Œå¿˜äº†ä¸€æ­¥æ­¥æˆªå›¾ï¼Œä½†æœ‰ä¸­æ–‡ç•Œé¢è·Ÿç€æç¤ºæ“ä½œå³å¯ï¼Œä¸ä¼šå¾ˆéš¾ï¼Œæ³¨å†Œå®Œæˆåï¼Œåœ¨ä»¥ä¸‹ç•Œé¢æ“ä½œï¼š æ‰¾åˆ°githubçš„ipv4çš„åœ°å€ä¸ºä»¥ä¸‹å‡ ä¸ªï¼Œä¹Ÿä¸çŸ¥é“è®¿é—®æ—¶ä¼šåˆ†é…åˆ°å“ªä¸ªipï¼Œç´¢æ€§Aç±»åœ°å€å…¨éƒ¨æ·»åŠ ä¸Šï¼Œåƒé˜¿é‡Œäº‘ä»¥ä¸‹ï¼ŒæŠŠ CHAME ç±»åœ°å€ä¹Ÿæ·»åŠ ä¸Šï¼Œå¦‚ä¸‹ï¼š 2. è¿”å›é˜¿é‡Œäº‘æ·»åŠ  cloudfare ç”³è¯·çš„DNSæœåŠ¡å™¨ Github Page æ›´æ–°è‡ªå·±çš„åŸŸå ç‚¹å‡»ä»“åº“ ys558.github.io é‡Œçš„ Settings ç‚¹å‡»å·¦ä¾§çš„ Pages åœ¨ Custom domain é‡Œè¾“å…¥è‡ªå·±é…ç½®å¥½DNSçš„åŸŸå ç‚¹å‡» Save, åˆ™ä¼šè‡ªåŠ¨æ£€æŸ¥åŸŸåæ˜¯å¦å¯ç”¨","tags":["Hexo","Github Page"]}]