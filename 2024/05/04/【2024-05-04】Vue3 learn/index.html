
<!DOCTYPE html><html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta name="hexo-theme" content="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1" theme-name="Stellar" theme-version="1.28.1">
  
  <meta name="generator" content="Hexo 5.4.0">
  <meta http-equiv='x-dns-prefetch-control' content='on' />
  
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f9fafb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000">
  
  <title>Vue3 新特性一览 - 自由の翼小栈</title>

  
    <meta name="description" content="最近学习 Vue3, 这里做个简单的记录，Vue3 在 Vue2 的升级，语法和 API 都发生了变化。下面就一些新增的 API，写一些简单的 demo 进行记录。">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue3 新特性一览">
<meta property="og:url" content="https://zyzy.info/2024/05/04/%E3%80%902024-05-04%E3%80%91Vue3%20learn/index.html">
<meta property="og:site_name" content="自由の翼小栈">
<meta property="og:description" content="最近学习 Vue3, 这里做个简单的记录，Vue3 在 Vue2 的升级，语法和 API 都发生了变化。下面就一些新增的 API，写一些简单的 demo 进行记录。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@1.55/articles/Vue3%E5%AD%A6%E4%B9%A0/vue%E5%BC%95%E5%85%A5%E9%94%99%E8%AF%AF.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@1.55/articles/Vue3%E5%AD%A6%E4%B9%A0/%E5%A4%9A%E5%B1%82%E7%BA%A7%E4%BC%A0%E5%8F%82.gif">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@1.56/articles/Vue3%E5%AD%A6%E4%B9%A0/global-api.gif">
<meta property="article:published_time" content="2024-05-04T02:00:00.000Z">
<meta property="article:modified_time" content="2024-05-15T00:44:31.975Z">
<meta property="article:author" content="自由の翼">
<meta property="article:tag" content="Vue">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@1.55/articles/Vue3%E5%AD%A6%E4%B9%A0/vue%E5%BC%95%E5%85%A5%E9%94%99%E8%AF%AF.png">
  
  
  
  <meta name="keywords" content="Vue">

  <!-- feed -->
  

  <link rel="stylesheet" href="/css/main.css?v=1.28.1">

  

  

  
</head>
<body>

<div class="l_body s:aa content tech" id="start" layout="post" ><aside class="l_left"><div class="leftbar-container">


<header class="header"><div class="logo-wrap"><a class="avatar" href="/about/"><div class="bg" style="opacity:0;background-image:url(https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/rainbow64@3x.webp);"></div><img no-lazy class="avatar" src="https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@0.12/avatar/宇航员.svg" onerror="javascript:this.classList.add('error');this.src='https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/image/2659360.svg';"></a><a class="title" href="/"><div class="main" ff="title">自由の翼小栈</div><div class="sub cap">技术&生活分享</div></a></div></header>

<div class="nav-area">
<div class="search-wrapper" id="search-wrapper"><form class="search-form"><a class="search-button" onclick="document.getElementById(&quot;search-input&quot;).focus();"><svg t="1705074644177" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1560" width="200" height="200"><path d="M1008.839137 935.96571L792.364903 719.491476a56.783488 56.783488 0 0 0-80.152866 0 358.53545 358.53545 0 1 1 100.857314-335.166073 362.840335 362.840335 0 0 1-3.689902 170.145468 51.248635 51.248635 0 1 0 99.217358 26.444296 462.057693 462.057693 0 1 0-158.255785 242.303546l185.930047 185.725053a51.248635 51.248635 0 0 0 72.568068 0 51.248635 51.248635 0 0 0 0-72.978056z" p-id="1561"></path><path d="M616.479587 615.969233a50.428657 50.428657 0 0 0-61.498362-5.534852 174.655348 174.655348 0 0 1-177.525271 3.484907 49.403684 49.403684 0 0 0-58.833433 6.76482l-3.074918 2.869923a49.403684 49.403684 0 0 0 8.609771 78.10292 277.767601 277.767601 0 0 0 286.992355-5.739847 49.403684 49.403684 0 0 0 8.404776-76.667958z" p-id="1562"></path></svg></a><input type="text" class="search-input" id="search-input" placeholder="站内搜索"></form><div id="search-result"></div><div class="search-no-result">没有找到内容！</div></div>


<nav class="menu dis-select"></nav>
</div>
<div class="widgets">


<widget class="widget-wrapper post-list"><div class="widget-header dis-select"><span class="name">最近更新</span></div><div class="widget-body fs14"><a class="item title" href="/2024/06/03/%E3%80%902024-06-03%E3%80%91%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B%E6%8C%87%E5%8D%97/"><span class="title">js 的函数式编程 (更新至 2024-06-12)</span></a><a class="item title" href="/2024/05/20/%E3%80%902024-05-20%E3%80%91Node%E5%A4%9A%E8%BF%9B%E7%A8%8B%E8%A7%A3%E5%86%B3%E8%AE%A1%E7%AE%97%E5%AF%86%E9%9B%86%E5%9E%8B%E9%97%AE%E9%A2%98/"><span class="title">Node 的多进程管理————多核CPU解决计算密集型应用 (更新中)</span></a><a class="item title" href="/2024/05/15/%E3%80%902024-05-15%E3%80%91MongoDB%20%E8%87%AA%E5%AD%A6%E7%AC%94%E8%AE%B0/"><span class="title">MongoDB 基础自学笔记</span></a><a class="item title" href="/2024/05/15/%E3%80%902024-05-14%E3%80%91Nginx%E9%85%8D%E7%BD%AE/"><span class="title">Nginx 简介及配置 (24-05-15)</span></a><a class="item title" href="/2024/05/23/%E3%80%902024-05-23%E3%80%91Docker%E8%87%AA%E5%AD%A6/"><span class="title">Docker 自学</span></a><a class="item title" href="/2024/05/26/%E3%80%902024-05-26%E3%80%91Kubernetes%20%E5%9F%BA%E7%A1%80/"><span class="title">Kubernetes 基础</span></a><a class="item title" href="/2024/02/29/%E3%80%902024-02-29%E3%80%91Learn%20Nextjs%20with%20TodoList%20Demo%20Project/"><span class="title">Learn Nextjs with TodoList Demo Project</span></a><a class="item title" href="/2024/02/17/%E3%80%902024-02-17%E3%80%91%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84npm%20package%E6%AD%A5%E9%AA%A4/"><span class="title">创建并发布的npm ui库(npm packages)</span></a><a class="item title" href="/2024/05/04/%E3%80%902024-05-04%E3%80%91Vue3%20learn/"><span class="title">Vue3 新特性一览</span></a><a class="item title" href="/2023/12/09/%E3%80%902023-12-09%E3%80%91Bun%E7%9A%84%E5%88%9D%E5%B0%9D%E8%AF%95/"><span class="title">bun之初尝试</span></a></div></widget>
</div>

</div></aside><div class="l_main" id="main">





<div class="article banner top">
  <div class="content">
    <div class="top bread-nav footnote"><div class="left"><div class="flex-row" id="breadcrumb"><a class="cap breadcrumb" href="/">主页</a>
<span class="sep"></span><a class="cap breadcrumb" href="/">文章</a></div>
<div class="flex-row" id="post-meta"><span class="text created">发布于：<time datetime="2024-05-04T02:00:00.000Z">2024-05-04</time></span><span class="sep updated"></span><span class="text updated">更新于：<time datetime="2024-05-15T00:44:31.975Z">2024-05-15</time></span></div></div></div>
    
    <div class="bottom only-title">
      
      <div class="text-area">
        <h1 class="text title"><span>Vue3 新特性一览</span></h1>
        
      </div>
    </div>
    
  </div>
  </div><article class="md-text content"><div style="display: flex; justify-content: center;">

<script src="https://unpkg.com/@dotlottie/player-component@latest/dist/dotlottie-player.mjs" type="module"></script><dotlottie-player src="https://lottie.host/7b916581-6d8b-425d-8df1-1d363691a65f/0QJRiGVfSP.json" background="transparent" speed="2" style="height: 40vh" direction="1" playMode="normal" loop autoplay></dotlottie-player>
</div>

<p>最近学习 Vue3, 这里做个简单的记录，Vue3 在 Vue2 的升级，语法和 API 都发生了变化。下面就一些新增的 API，写一些简单的 demo 进行记录。</p>
<span id="more"></span>

<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>vue3 创建项目，使用 <code>Vite</code> 脚手架。放弃了原来的 <code>vue-cli</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 跟着cli的提示一步步创建即可：</span></span><br><span class="line">npm init vite@latest</span><br></pre></td></tr></table></figure>

<p>我尝试着删除 <code>src</code> 目录，重新新建一个 src 目录，自己写一个 <code>src/main.ts</code> 和 <code>src/App.vue</code>。</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@1.55/articles/Vue3%E5%AD%A6%E4%B9%A0/vue%E5%BC%95%E5%85%A5%E9%94%99%E8%AF%AF.png" alt="App.vue文件引入typescript 文件报错"></p>
<p>会发现 ts 检查在 <code>App.vue</code> 中报错。这时因为 ts 的检查中，不认识.vue 文件，需要配置 <code>env.d.ts</code>文件。cmd (Mac)/ctrl (Windows) + 左键点击下面的 <code>&quot;vite/client&quot;</code> 路径</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference types=&quot;vite/client&quot; /&gt;</span></span><br></pre></td></tr></table></figure>

<p>会跳转到 <code>vite/client</code> 文件，添加：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="built_in">module</span> <span class="string">&quot;*.vue&quot;</span> &#123;</span><br><span class="line">  <span class="keyword">import</span> &#123; ComponentOptions &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> componentOptions: ComponentOptions;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> componentOptions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>即可</p>
<h2 id="Vue3-入口文件一些概念"><a href="#Vue3-入口文件一些概念" class="headerlink" title="Vue3 入口文件一些概念"></a>Vue3 入口文件一些概念</h2><ul>
<li><code>Vite</code> 项目中，<code>index.html</code> 是项目的入口文件，在项目最外层。</li>
<li>加载 <code>index.html</code> 后，<code>Vite</code> 解析 <code>&lt;script type=&quot;module&quot; src=&quot;xxx&quot;&gt;</code>指回的 Javascript</li>
<li>Vue3 中是通过<code>createApp</code>函数创建一个应用实例。</li>
</ul>
<h2 id="Options-API-和-Composition-API"><a href="#Options-API-和-Composition-API" class="headerlink" title="Options API 和 Composition API"></a><code>Options API</code> 和 <code>Composition API</code></h2><p>Vue2 属于 <code>Option API</code> (配置选项式 API)，Vue3 属于 <code>Composition API</code>（组合式 API），我愿意称他为功能性组合 API。</p>
<p>随着 Vue2 里的各个组件越来越复杂，配置式 API 缺点非常明显，所有的值散落在诸如 data(), methods(), computed(), watch()等等方法中，修改一处有可能要修改多处。</p>
<p>比起原来 Options API（例如：<code>data()</code>,<code>methods()</code>），<code>setup</code>有两个特点：</p>
<ul>
<li>一个 vue 文件可以同时具备 <code>data()</code>, <code>methods()</code> 等 Vue2 的功能，也可以同时具备 <code>setup()</code>写法的 Vue3 功能。</li>
<li><code>setup()</code> 函数中，不能再使用 <code>this</code>。而且<code>setup</code>是最早的生命周期函数。所以 data() 和 methods() 函数中，可以访问 setup() 函数中定义的变量。但 setup() 函数中，不能访问 data() 和 methods() 函数中定义的变量。</li>
</ul>
<h2 id="setup"><a href="#setup" class="headerlink" title="setup()"></a><code>setup()</code></h2><p>这个是 Vue3 追赶 React 函数式编程的新概念，在 Vue2 里，<code>setup</code>普通的写法，他是执行在生命周期里的 <code>beforeCreate</code> 阶段之前的函数，因此，Vue3 将 <code>setup</code>函数提升到一个新的高度。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;&#125;,</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="语法糖-lt-script-setup-lang-quot-ts-quot-gt"><a href="#语法糖-lt-script-setup-lang-quot-ts-quot-gt" class="headerlink" title="语法糖 &lt;script setup lang=&quot;ts&quot;&gt;"></a>语法糖 <code>&lt;script setup lang=&quot;ts&quot;&gt;</code></h3><p>鉴于 <code>setup()</code>的特殊性，Vue3 将其独立为一个语法糖的写法，将其整合进 <code>&lt;script lang=&quot;ts&quot; setup&gt;</code> 里，下面是 vue3 <code>App.vue</code> 文件的 setup 改法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ChildComp</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 直接导出子组件即可，省略 export default</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> ChildComp <span class="keyword">from</span> <span class="string">&quot;./components/WatchEffectDemo.vue&quot;</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="setup插件-VueSetupExtend-增强-script-标签用法"><a href="#setup插件-VueSetupExtend-增强-script-标签用法" class="headerlink" title="setup插件: VueSetupExtend 增强 script 标签用法"></a><code>setup</code>插件: <code>VueSetupExtend</code> 增强 script 标签用法</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vite-plugin-vue-setup-extend -D</span><br></pre></td></tr></table></figure>

<p><code>vite.config.ts</code> 配置：plugins 中添加 <code>VueSetupExtend()</code>，如：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fileURLToPath, URL &#125; <span class="keyword">from</span> <span class="string">&quot;node:url&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; defineConfig &#125; <span class="keyword">from</span> <span class="string">&quot;vite&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> vue <span class="keyword">from</span> <span class="string">&quot;@vitejs/plugin-vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> VueSetupExtend <span class="keyword">from</span> <span class="string">&quot;vite-plugin-vue-setup-extend&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// https://vitejs.dev/config/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  plugins: [vue(), VueSetupExtend()],</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    alias: &#123;</span><br><span class="line">      <span class="string">&quot;@&quot;</span>: fileURLToPath(<span class="keyword">new</span> URL(<span class="string">&quot;./src&quot;</span>, <span class="keyword">import</span>.meta.url)),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="ref-和-reactive，将数变为响应式"><a href="#ref-和-reactive，将数变为响应式" class="headerlink" title="ref 和 reactive，将数变为响应式"></a><code>ref</code> 和 <code>reactive</code>，将数变为响应式</h2><p>让我们看一个例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;car&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123; car.brand &#125;&#125; -&gt; &#123;&#123; car.price &#125;&#125;元<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addPrice&quot;</span>&gt;</span>修改价格+10万<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;minusPrice&quot;</span>&gt;</span>修改价格-1万<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeCarByReactive&quot;</span>&gt;</span>修改整车by reactive<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123; car2.brand &#125;&#125; -&gt; &#123;&#123; car2.price &#125;&#125;元<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeCarByRef&quot;</span>&gt;</span>修改整车by ref<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span> <span class="attr">name</span>=<span class="string">&quot;Car12&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref, reactive, toRefs &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> car = reactive(&#123; <span class="attr">brand</span>: <span class="string">&quot;Toyota&quot;</span>, <span class="attr">price</span>: <span class="number">200000</span> &#125;);</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 如果要解构，必须用toRefs套上，否则页面无法响应</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> &#123; price &#125; = toRefs(car);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> addPrice = <span class="function">() =&gt;</span> (price.value += <span class="number">100000</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 如果只修改某一个属性，用.语法修改</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> minusPrice = <span class="function">() =&gt;</span> (car.price -= <span class="number">10000</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> changeCarByReactive = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 如果涉及整个对象修改过，必须用Object.assign</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">Object</span>.assign(car, &#123; <span class="attr">brand</span>: <span class="string">&quot;Audi&quot;</span>, <span class="attr">price</span>: <span class="number">300000</span> &#125;);</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> car2 = ref(&#123; <span class="attr">brand</span>: <span class="string">&quot;Benz&quot;</span>, <span class="attr">price</span>: <span class="number">800000</span> &#125;);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> changeCarByRef = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 如果改用ref，必须用value修改，而且.value就是响应式，页面可以实时呈现</span></span></span><br><span class="line"><span class="javascript">    car2.value = &#123; <span class="attr">brand</span>: <span class="string">&quot;Audi&quot;</span>, <span class="attr">price</span>: <span class="number">300000</span> &#125;;</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>ref</code> 可以包裹任意数据类型，作为响应式数据，并实时修改视图的值</li>
<li>被 <code>ref</code> 包裹的数据，如果要更改页面的值，必须用 <code>.value</code> 修改。例如例子中的：<code>car2.value = &#123; brand: &quot;Audi&quot;, price: 300000 &#125;;</code></li>
<li><code>reactive</code> 只能用来包裹一个对象，作为响应式数据。</li>
<li>被 <code>reactive</code> 包裹的对象，如果要整体修改，必须用 <code>Object.assign</code> 修改。例如例子中的: <code>Object.assign(car, &#123; brand: &quot;Audi&quot;, price: 300000 &#125;);</code></li>
<li>如果遇到解构，必须用<code>toRefs</code> 包裹普通对象，使其变为响应式对象，要不页面上的响应式数据就不会更新。例如例子中的：<code>let &#123; price &#125; = toRefs(car);</code></li>
</ul>
<h2 id="computed-计算属性"><a href="#computed-计算属性" class="headerlink" title="computed 计算属性"></a><code>computed</code> 计算属性</h2><p><code>computed</code> 是一个计算属性，它依赖其他数据，当依赖的数据发生变化时，计算属性会重新计算。这是我们在 Vue2 中经常使用的。</p>
<p>但是 Vue3 中，我们还可以用<code>computed</code>自带的 getter 和 setter 来实现计算属性的获取和修改。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;person&quot;</span>&gt;</span></span><br><span class="line">    全名：<span class="tag">&lt;<span class="name">span</span>&gt;</span>这个是计算属性计算出来的全名：&#123;&#123; fullName &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeFullName&quot;</span>&gt;</span>点击修改姓名为Li si<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span> <span class="attr">name</span>=<span class="string">&quot;Person&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref, computed &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> firstName = ref(<span class="string">&quot;zhang&quot;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> lastName = ref(<span class="string">&quot;san&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 传统vue2，计算属性是只读属性，页面上并不能直接修改：</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// const fullName = computed(</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">//   () =&gt;</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">//     `$&#123;firstName.value.slice(0, 1).toUpperCase()&#125;$&#123;firstName.value.slice(1)&#125; - $&#123;lastName.value&#125;`</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// )</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// vue3的fullName计算属性，可读可写：用setter，可以直接修改</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> fullName = computed(&#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;firstName.value</span></span></span></span><br><span class="line">        .slice(0, 1)</span><br><span class="line">        .toUpperCase()&#125;$&#123;firstName.value.slice(1)&#125; - $&#123;lastName.value&#125;`;</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">set</span>(<span class="params">val</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> [f, l] = val.split(<span class="string">&quot;-&quot;</span>);</span></span><br><span class="line">      firstName.value = f;</span><br><span class="line">      lastName.value = l;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> changeFullName = <span class="function">() =&gt;</span> (fullName.value = <span class="string">&quot;li-si&quot;</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="watch-监视"><a href="#watch-监视" class="headerlink" title="watch 监视"></a><code>watch</code> 监视</h2><p><code>watch</code> 是一个监听器，它监听某个数据，当数据发生变化时，执行回调函数。<br><code>watch</code> 监听的数据可以是一个响应式数据，也可以是一个普通数据。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;person&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>姓名：&#123;&#123; person.name &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>汽车：&#123;&#123; person.car.c1 &#125;&#125; &#123;&#123; person.car.c2 &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeName&quot;</span>&gt;</span>改名<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeCar1&quot;</span>&gt;</span>改第一台🚗<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeCar2&quot;</span>&gt;</span>改第二台🚗<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeCars&quot;</span>&gt;</span>改所有🚗<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; reactive, watch &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> person = reactive(&#123;</span></span><br><span class="line"><span class="javascript">    name: <span class="string">&quot;张三&quot;</span>,</span></span><br><span class="line">    car: &#123;</span><br><span class="line"><span class="javascript">      c1: <span class="string">&quot;奔驰&quot;</span>,</span></span><br><span class="line"><span class="javascript">      c2: <span class="string">&quot;宝马&quot;</span>,</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> changeName = <span class="function">() =&gt;</span> (person.name += <span class="string">&quot;~&quot;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> changeCar1 = <span class="function">() =&gt;</span> (person.car.c1 = <span class="string">&quot;audi&quot;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> changeCar2 = <span class="function">() =&gt;</span> (person.car.c2 = <span class="string">&quot;Toyota&quot;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> changeCars = <span class="function">() =&gt;</span> (person.car = &#123; <span class="attr">c1</span>: <span class="string">&quot;byd&quot;</span>, <span class="attr">c2</span>: <span class="string">&quot;yy&quot;</span> &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// reactive监视属性时候，第一个参数必须写为函数返回类型，否则报错</span></span></span><br><span class="line">  watch(</span><br><span class="line">    () =&gt; person.name,</span><br><span class="line">    (newValue, oldValue) =&gt; &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&quot;newValue&quot;</span>, newValue);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&quot;oldValue&quot;</span>, oldValue);</span></span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 监视的reactive对象属性也是obj时</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// 如果要监视除该</span></span></span><br><span class="line">  watch(</span><br><span class="line">    () =&gt; person.car,</span><br><span class="line">    (newValue, oldValue) =&gt; &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&quot;newValue&quot;</span>, newValue);</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&quot;oldValue&quot;</span>, oldValue);</span></span><br><span class="line">    &#125;,</span><br><span class="line"><span class="javascript">    <span class="comment">// 加上deep：true，可以监视任意person对象里的细微变化</span></span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">deep</span>: <span class="literal">true</span> &#125;</span></span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 监视多个属性</span></span></span><br><span class="line"><span class="javascript">  watch([<span class="function">() =&gt;</span> person.name, <span class="function">() =&gt;</span> person.car.c1], <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&quot;newValue&quot;</span>, newValue);</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&quot;oldValue&quot;</span>, oldValue);</span></span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>和 <code>watch</code> 等价的，有另一个 api <code>watchEffect</code>，它更智能，它接收一个函数，函数里可以写异步代码，当函数执行时，会自动收集依赖，当依赖的数据发生变化时，会重新执行函数。</p>
<p>下面写一个 demo 实现：下面是一个简单的监测水温和水位的例子，当水温达到或超过 60℃，或者水位达到或超过 80cm 时，给服务器发请求。这里的请求用了 console.log，实际应用中，可以发送请求。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>当水温达到或超过60℃，或者水位达到或超过80cm时，给服务器发请求<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>水温：&#123;&#123; temp &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>水位：&#123;&#123; height &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeTemp&quot;</span>&gt;</span>水温+10 ℃<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;changeHeight&quot;</span>&gt;</span>水位+10 cm<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref, watch, watchEffect &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> temp = ref(<span class="number">10</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> height = ref(<span class="number">0</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> changeTemp = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">    temp.value += 10;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> changeHeight = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">    height.value += 10;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// watch实现：</span></span></span><br><span class="line"><span class="javascript">  watch([temp, height], <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> [newTemp, newHeight] = value;</span></span><br><span class="line">    if (newTemp &gt;= 60 || newHeight &gt;= 80) &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&quot;给服务器发请求&quot;</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// watchEffect实现：</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// wathcEffect可以不用写函数，直接写代码，会自动收集依赖。</span></span></span><br><span class="line"><span class="javascript">  watchEffect(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line">    if (temp.value &gt;= 60 || height.value &gt;= 80) &#123;</span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&quot;给服务器发请求&quot;</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="defineExpose-暴露响应式数据"><a href="#defineExpose-暴露响应式数据" class="headerlink" title="defineExpose 暴露响应式数据"></a><code>defineExpose</code> 暴露响应式数据</h2><ol>
<li><code>ref</code> 除了定义一个引用之外，还可以给真实 DOM 元素或组件元素打标记，然后通过 <code>ref</code> 获取到该元素或者组件元素实例。</li>
<li>和 vue2 不一样，vue3 的引用值 ref 必须用 defineExpose 暴露给父组件，父组件才能获取到他的值</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&quot;x&quot;</span>&gt;</span>hello vue3<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;showRef&quot;</span>&gt;</span>get ref DOM<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref, defineExpose &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 和vue2不一样，vue3的引用值ref必须用defineExpose暴露</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> a = ref(<span class="string">&quot;1&quot;</span>);</span></span><br><span class="line">  defineExpose(&#123; a &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// x 必须与上面的 ref 标签名字一致</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> x = ref();</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> showRef = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(x.value); <span class="comment">// &lt;div&gt;hello vue3&lt;/div&gt;</span></span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ref 打在组件标签上，能打印出组件实例</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">RefDemo</span> <span class="attr">ref</span>=<span class="string">&quot;aa&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;showRef&quot;</span>&gt;</span>showRef<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> RefDemo <span class="keyword">from</span> <span class="string">&quot;./components/RefDemo.vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> aa = ref();</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> showRef = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(aa.value); <span class="comment">// Proxy(Object) &#123;__v_skip: true&#125;</span></span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="props-defineProps-和-withDefaults"><a href="#props-defineProps-和-withDefaults" class="headerlink" title="props, defineProps 和 withDefaults"></a><code>props</code>, <code>defineProps</code> 和 <code>withDefaults</code></h2><p>不废话，直接上 demo，和 React 不同的是，子组件如果要显示 Props，需要用<code>defineProps</code>定义，否则会报错。</p>
<p>父组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PropsDemo</span> <span class="attr">a</span>=<span class="string">&quot;hehe&quot;</span> <span class="attr">:personsList</span>=<span class="string">&quot;persons&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> PropsDemo <span class="keyword">from</span> <span class="string">&quot;./components/PropsDemo.vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> persons = [</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;张三&quot;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;,</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;李四&quot;</span>, <span class="attr">age</span>: <span class="number">19</span> &#125;,</span></span><br><span class="line">  ];</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>子组件的写法就有点奇葩，如果定义默认值，还要再引入一个<code>withDefaults</code>，他的定义是比 vue2 啰嗦的。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; a &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">:key</span>=<span class="string">&quot;person.id&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;person in personsList&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123; person.name &#125;&#125;: &#123;&#123; person.age &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; defineProps, withDefaults &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> type &#123; Person &#125; <span class="keyword">from</span> <span class="string">&quot;@/types&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 写法1：如果不用ts的普通写法</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// const props1 = defineProps([&#x27;a&#x27;, &#x27;personsList&#x27;])</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// console.log(props1)</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// // 写法2：用上ts及withDefaults，当然，withDefaults可以省略不用</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> props = withDefaults(</span></span><br><span class="line">    defineProps&lt;&#123; a: string; personsList: Person[] &#125;&gt;(),</span><br><span class="line">    &#123;</span><br><span class="line"><span class="javascript">      a: <span class="string">&quot;xx&quot;</span>,</span></span><br><span class="line"><span class="javascript">      personsList: <span class="function">() =&gt;</span> [&#123; <span class="attr">id</span>: <span class="string">&quot;kk&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;yy&quot;</span>, <span class="attr">age</span>: <span class="number">18</span> &#125;],</span></span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="built_in">console</span>.log(props); <span class="comment">// Proxy(Object) &#123;a: &#x27;hehe&#x27;, personsList: Array(2)&#125;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><p><code>Vue2</code> 的生命周期：<br>创建阶段：<code>beforeCreate</code> <code>created</code><br>挂载阶段：<code>beforeMount</code> <code>mounted</code><br>更新阶段：<code>beforeUpdate</code> <code>updated</code><br>销毀阶段：<code>beforeDestroy</code> <code>destroyed</code></p>
<p><code>Vue3</code> 的生命周期：</p>
<p>创建阶段：<code>setup</code><br>挂载阶段：<code>onBeforeMount</code> <code>onMounted</code><br>更新阶段：<code>onBeforeUpdate</code> <code>onUpdated</code><br>销毁阶段：<code>onBeforeUnmount</code> <code>onUnmounted</code></p>
<p>由于 Vue3 我们把 setup 阶段写在 script 标签里，所以 Vue3 的生命周期比 Vue2 的少了 2 个，分别是<code>beforeCreate</code>和<code>created</code>。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- vue2的写法： --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">created</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&quot;created&quot;</span>);</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Vue3的写法： --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">  onMounted(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="string">&quot;onMounted&quot;</span>);</span></span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Custom-Hooks-模块化封装"><a href="#Custom-Hooks-模块化封装" class="headerlink" title="Custom Hooks 模块化封装"></a>Custom Hooks 模块化封装</h2><p>这个概念完全是抄袭 React hooks，由于 Vue3 设计成了<code>setup</code> 语法，所以使得函数式编程称为可能，下面是一个 demo</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;person&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">v-for</span>=<span class="string">&quot;(image, idx) in dogImages&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;image&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;idx&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;dog&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addNewDogImage&quot;</span>&gt;</span>添加狗图<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> useDogImages <span class="keyword">from</span> <span class="string">&quot;@/hooks/useDogImages&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> &#123; dogImages, addNewDogImage &#125; = useDogImages();</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="selector-tag">img</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="attribute">height</span>: <span class="number">150px</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">margin-right</span>: <span class="number">10px</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 <code>useDogImages.ts</code> 文件里，可以写下</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加狗图</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (url: <span class="built_in">string</span> = <span class="string">&quot;https://dog.ceo/api/breeds/image/random&quot;</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// https://dog.ceo/api/breeds/image/random</span></span><br><span class="line">  <span class="keyword">const</span> defaultDogImage =</span><br><span class="line">    <span class="string">&quot;https://images.dog.ceo/breeds/affenpinscher/n02110627_11811.jpg&quot;</span>;</span><br><span class="line">  <span class="keyword">const</span> dogImages = reactive([defaultDogImage]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> addNewDogImage = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    fetch(url)</span><br><span class="line">      .then(<span class="function">(<span class="params">res</span>) =&gt;</span> res.json())</span><br><span class="line">      .then(<span class="function">(<span class="params">data</span>) =&gt;</span> dogImages.push(data.message))</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> alert(err));</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    dogImages,</span><br><span class="line">    addNewDogImage,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Pinia-状态管理"><a href="#Pinia-状态管理" class="headerlink" title="Pinia 状态管理"></a><code>Pinia</code> 状态管理</h2><p><code>pinia</code> 是一个<strong>符合直觉</strong>的状态管理库，和<code>vuex</code>一样，都是基于<code>vue3</code>的，但是<code>pinia</code>比<code>vuex</code>更简单易用，而且<code>vuex</code>的作者已经推荐使用<code>pinia</code>了。<br><code>pinia</code> 的使用非常简单，只需要在<code>main.ts</code>里引入<code>createPinia</code>，然后<code>app.use(createPinia())</code>，然后就可以在<code>setup</code>函数里使用<code>defineStore</code>定义一个状态了。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i pinia</span><br></pre></td></tr></table></figure>

<h3 id="createApp"><a href="#createApp" class="headerlink" title="createApp"></a><code>createApp</code></h3><p><code>main.ts</code> 引入：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 下面这个顺序不能乱，必须按照这个顺序，先createPinia()，再app.use(pinia), 再挂载到app的根节点上</span></span><br><span class="line"><span class="keyword">const</span> app = createApp(App);</span><br><span class="line"><span class="keyword">const</span> pinia = createPinia();</span><br><span class="line">app.use(pinia);</span><br><span class="line">app.mount(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="defineStore-state-actions"><a href="#defineStore-state-actions" class="headerlink" title="defineStore, state, actions"></a><code>defineStore</code>, <code>state</code>, <code>actions</code></h3><p>创建一个<code>store/count.ts</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useCountStore = defineStore(<span class="string">&quot;count&quot;</span>, &#123;</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="function"><span class="title">addToMaxTwenty</span>(<span class="params">value: number</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.count &lt;= <span class="number">20</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.count += value;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">state</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      count: <span class="number">0</span>,</span><br><span class="line">      by: <span class="string">&quot;X&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useCountStore;</span><br></pre></td></tr></table></figure>

<p>在应用中使用：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;talk&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>count：&#123;&#123; countStore.count &#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>countStore的其他数据: &#123;&#123; countStore.by &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- v-model.number 可以直接转换为数字类型 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">select</span> <span class="attr">v-model.number</span>=<span class="string">&quot;n&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">selected</span>&gt;</span>1<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;plus&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;minus&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> useCountStore <span class="keyword">from</span> <span class="string">&quot;@/store/count&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> useTalkStore <span class="keyword">from</span> <span class="string">&quot;@/store/talks&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> countStore = useCountStore();</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> n = ref(<span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> plus = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 第一种改法：pinia符合直觉的状态管理，可以直接修改其值，例如：</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// countStore.count += n.value</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// 第二种改法：$patch</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// countStore.$patch(&#123;</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//   count: 1,</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//   by: &#x27;pinia&#x27;</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// &#125;)</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// 第三种改法：actions，这种方法的好处是可以在addToMaxTwenty里添加复杂逻辑</span></span></span><br><span class="line">    countStore.addToMaxTwenty(n.value);</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> minus = <span class="function">() =&gt;</span> (countStore.count -= n.value);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="defineStore-第二个参数改写为组合式-API"><a href="#defineStore-第二个参数改写为组合式-API" class="headerlink" title="defineStore 第二个参数改写为组合式 API"></a><code>defineStore</code> 第二个参数改写为组合式 API</h4><p>上面的 <code>talkStore</code> 的例子，第二个参数，我们写的是配置式的 API（OptionAPI），但是 <code>pinia</code> 也支持组合式 API，可以改为：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Talk = &#123;</span><br><span class="line">  id: <span class="built_in">number</span>;</span><br><span class="line">  content: <span class="built_in">string</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> useTalkStore = defineStore(<span class="string">&quot;talks&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> talkList = reactive&lt;Talk[]&gt;(</span><br><span class="line">    <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;talkList&quot;</span>) <span class="keyword">as</span> <span class="built_in">string</span>) ?? []</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> assertOneNewTalk = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(</span><br><span class="line">        <span class="string">&quot;https://api.uomg.com/api/rand.qinghua?format=json&quot;</span></span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">if</span> (!response.ok) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Network response was not ok&quot;</span>);</span><br><span class="line">      <span class="keyword">const</span> &#123; content &#125; = <span class="keyword">await</span> response.json();</span><br><span class="line">      <span class="keyword">return</span> talkList.push(&#123; <span class="attr">id</span>: talkList.length + <span class="number">1</span>, content &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.error(err);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; talkList, assertOneNewTalk &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useTalkStore;</span><br></pre></td></tr></table></figure>

<h3 id="storeToRefs"><a href="#storeToRefs" class="headerlink" title="storeToRefs"></a><code>storeToRefs</code></h3><p>如果我们要省略上面的写法 <code>countStore.count</code>，在 <code>pinia</code> 中，可以使用 <code>storeToRefs</code> 解构，这样我们就可以省略 <code>countStore.count</code>，直接使用 <code>count</code>。<br>这里最好<strong>不要使用</strong> <code>vue</code> 自带的 **<code>toRefs</code>**，因为 <code>toRefs</code> 会将所有属性都变成响应式，而 <code>storeToRefs</code> 只会将 <code>state</code> 中的属性变成响应式。</p>
<p><code>TalkStore</code> 的例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;talk&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;addNewTalk&quot;</span>&gt;</span>获取一句土味情话<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;talk in talkList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;talk.id&quot;</span>&gt;</span>&#123;&#123; talk.content &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; storeToRefs &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> useCountStore <span class="keyword">from</span> <span class="string">&quot;@/store/count&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> useTalkStore <span class="keyword">from</span> <span class="string">&quot;@/store/talks&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> talkStore = useTalkStore();</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 不能直接解构，const &#123; talkList &#125; = talkStore，这样解构出来的 talkList 不是是响应式对象数据，页面用了不会触发更新</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> &#123; talkList &#125; = storeToRefs(talkStore);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> addNewTalk = <span class="function">() =&gt;</span> talkStore.assertOneNewTalk();</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>store/talks</code> 文件里，可以直接请求数据：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Talk = &#123;</span><br><span class="line">  id: <span class="built_in">number</span>;</span><br><span class="line">  content: <span class="built_in">string</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> useTalkStore = defineStore(<span class="string">&quot;talks&quot;</span>, &#123;</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="keyword">async</span> <span class="function"><span class="title">assertOneNewTalk</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> response = <span class="keyword">await</span> fetch(</span><br><span class="line">          <span class="string">&quot;https://api.uomg.com/api/rand.qinghua?format=json&quot;</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">if</span> (!response.ok) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;Network response was not ok&quot;</span>);</span><br><span class="line">        <span class="keyword">const</span> &#123; content &#125; = <span class="keyword">await</span> response.json();</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.talkList.push(&#123; <span class="attr">id</span>: <span class="built_in">this</span>.talkList.length + <span class="number">1</span>, content &#125;);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">state</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      talkList: [] <span class="keyword">as</span> Talk[],</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useTalkStore;</span><br></pre></td></tr></table></figure>

<h3 id="getters-处理数据"><a href="#getters-处理数据" class="headerlink" title="getters 处理数据"></a><code>getters</code> 处理数据</h3><p>接着上面的例子，我们在 <code>defineStore</code> 函数中加入：<code>getters</code>, 如：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineStore &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useCountStore = defineStore(<span class="string">&quot;count&quot;</span>, &#123;</span><br><span class="line">  actions: &#123;</span><br><span class="line">    <span class="function"><span class="title">addToMaxTwenty</span>(<span class="params">value: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.count &lt;= <span class="number">20</span>) &#123;</span><br><span class="line">        <span class="built_in">this</span>.count += value;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="title">state</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      count: <span class="number">0</span>,</span><br><span class="line">      by: <span class="string">&quot;X&quot;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 两种写法均可</span></span><br><span class="line">  getters: &#123;</span><br><span class="line">    doubleCount: <span class="function">(<span class="params">state</span>) =&gt;</span> state.count * <span class="number">2</span>,</span><br><span class="line">    square(): <span class="built_in">number</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.count ** <span class="number">2</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useCountStore;</span><br></pre></td></tr></table></figure>

<p>这样就可以在 <code>template</code> 里面直接使用 <code>doubleCount</code> 和 <code>square</code> 了。</p>
<h3 id="subscribe-store-的订阅"><a href="#subscribe-store-的订阅" class="headerlink" title="$subscribe store 的订阅"></a><code>$subscribe</code> store 的订阅</h3><p>接着上面<code>TalkStore</code>的例子，添加<code>$subscribe</code>，监视数据，并将其存在浏览器，进行简单的数据持久化，如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">talkStore.$subscribe(<span class="function">(<span class="params">_, state</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">localStorage</span>.setItem(<span class="string">&quot;talkList&quot;</span>, <span class="built_in">JSON</span>.stringify(state.talkList));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>再将<code>state</code>里的<code>talkList</code> 换成在 <code>localStorage</code> 里取：当然，必须判断第一次打开页面时，<code>localStorage</code> 里没有数据，所以需要写一下空值判断符：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">state: <span class="function">() =&gt;</span> (&#123;</span><br><span class="line">  talkList: <span class="built_in">JSON</span>.parse(<span class="built_in">localStorage</span>.getItem(<span class="string">&quot;talkList&quot;</span>) <span class="keyword">as</span> <span class="built_in">string</span>) ?? [],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="vue-router-路由"><a href="#vue-router-路由" class="headerlink" title="vue-router 路由"></a><code>vue-router</code> 路由</h2><p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i vue-router</span><br></pre></td></tr></table></figure>

<h3 id="创建路由"><a href="#创建路由" class="headerlink" title="创建路由"></a>创建路由</h3><p>创建 <code>src/router/index.ts</code>，当然，前提还必须创建页面的组件如 <code>Home.vue</code> 等 3 个，这里不详细介绍。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&quot;@/views/Home.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> News <span class="keyword">from</span> <span class="string">&quot;@/views/News.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&quot;@/views/About.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">  <span class="comment">// Provide the history routes to use.</span></span><br><span class="line">  <span class="comment">// 消灭url的#号</span></span><br><span class="line">  <span class="comment">// 但history 路由必须要服务器配合设置</span></span><br><span class="line">  history: createWebHistory(),</span><br><span class="line">  routes: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">      name: <span class="string">&quot;Home&quot;</span>,</span><br><span class="line">      component: Home,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;/news&quot;</span>,</span><br><span class="line">      name: <span class="string">&quot;News&quot;</span>,</span><br><span class="line">      component: News,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&quot;/about&quot;</span>,</span><br><span class="line">      name: <span class="string">&quot;About&quot;</span>,</span><br><span class="line">      component: About,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router;</span><br></pre></td></tr></table></figure>

<p>history 模式 在 <code>Nginx</code>上配置如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name your-domain.com;</span><br><span class="line"></span><br><span class="line">    root /path/to/your/webroot;</span><br><span class="line">    index index.html;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">      <span class="comment"># 当Nginx接收到一个请求时，它会首先尝试按照请求的URI提供文件（$uri），如果找不到，它会尝试将请求定向到URI对应的目录（$uri/），如果还是找不到，那么最终会提供/index.html文件。</span></span><br><span class="line">      try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>main.ts</code> 中，引入路由，并挂载到 <code>app</code> 上：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;./router&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = createApp(App);</span><br><span class="line">app.use(router);</span><br><span class="line">app.mount(<span class="string">&quot;#app&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="使用路由"><a href="#使用路由" class="headerlink" title="使用路由"></a>使用路由</h3><p>在路由页面可以显示：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;router-demo&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>Vue Router<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navigator&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span> <span class="attr">active-class</span>=<span class="string">&quot;active&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">:to</span>=<span class="string">&quot;&#123; name: &#x27;News&#x27; &#125;&quot;</span> <span class="attr">active-class</span>=<span class="string">&quot;active&quot;</span>&gt;</span>新闻<span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">:to</span>=<span class="string">&quot;&#123; path: &#x27;/about&#x27; &#125;&quot;</span> <span class="attr">active-class</span>=<span class="string">&quot;active&quot;</span></span></span><br><span class="line"><span class="tag">        &gt;</span>关于&lt;/RouterLink</span><br><span class="line">      &gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">RouterView</span>&gt;</span><span class="tag">&lt;/<span class="name">RouterView</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; RouterView, RouterLink &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="comment">/* a.active 对应上面的 active-class， 其他样式省略 */</span></span></span><br><span class="line"><span class="css">  <span class="selector-class">.navigator</span> <span class="selector-tag">a</span><span class="selector-class">.active</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(<span class="number">76</span>, <span class="number">146</span>, <span class="number">199</span>);</span></span><br><span class="line"><span class="css">    <span class="attribute">font-weight</span>: <span class="number">900</span>;</span></span><br><span class="line"><span class="css">    <span class="attribute">text-shadow</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span> black;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>&lt;RouterView&gt;&lt;/RouterView&gt;</code> 为各个路由组件的占位符，</li>
<li><code>&lt;RouterLink to=&quot;/&quot; active-class=&quot;active&quot;/&gt;</code> 是<code>&lt;a/&gt;</code> 标签的二次封装</li>
<li>属性 <code>to</code> 有 2 种写法，可<code>to=&quot;/&quot;</code>, 也可 <code>:to=&quot;&#123;path: &#39;/&#39;&#125;&quot;</code> 或 <code>:to=&quot;&#123;name: &#39;Home&#39;&#125;&quot;</code>, 这里的 name 对应路由文件 <code>router/index.ts</code> 里定义的 <code>name</code></li>
<li>路由导航到的页面，挂载到页面的根节点上，切换时则卸载该节点，可以用在具体页面里用 <code>onMounted</code> 和 <code>onUnmounted</code> 来监听，验证这点。</li>
</ul>
<h3 id="子路由"><a href="#子路由" class="headerlink" title="子路由"></a>子路由</h3><p>在上面我们创建的 <code>router/index.ts</code> 文件里，用 <code>news</code> 页面创建二级路由， 在 <code>/news</code>路由下，添加 <code>children</code> 数组，如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> NewsDetail <span class="keyword">from</span> <span class="string">&#x27;@/views/NewsDetail.vue&#x27;</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&#x27;/news&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;News&#x27;</span>,</span><br><span class="line">      component: News,</span><br><span class="line">      children: [</span><br><span class="line">        &#123;</span><br><span class="line">          path: <span class="string">&#x27;newsDetail&#x27;</span>,</span><br><span class="line">          name: <span class="string">&#x27;NewsDetail&#x27;</span>,</span><br><span class="line">          component: NewsDetail</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h3 id="路由传参"><a href="#路由传参" class="headerlink" title="路由传参"></a>路由传参</h3><h4 id="query-传参"><a href="#query-传参" class="headerlink" title="query 传参"></a><code>query</code> 传参</h4><p>这种是放在 url 的后面，如：<code>/news?id=1&amp;title=xxx&amp;content=xxx</code>，比较啰嗦，不太推荐。<br>改造 <code>views/News.vue</code> 文件，添加 <code>RouterLink</code> 组件，并添加 <code>query</code> 参数，如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;news&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;news in newsList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;news.id&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 1. 利用字符串模板，拼接query参数，太长，比较恶心 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;RouterLink</span></span><br><span class="line"><span class="comment">          :to=&quot;`/news/newsDetail?id=$&#123;news.id&#125;&amp;title=$&#123;news.title&#125;&amp;content=$&#123;news.content&#125;`&quot;</span></span><br><span class="line"><span class="comment">          &gt;&#123;&#123; news.title &#125;&#125;&lt;/RouterLink</span></span><br><span class="line"><span class="comment">        &gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 2. 以对象拼接query参数 --&gt;</span></span><br><span class="line">        &lt;RouterLink</span><br><span class="line">          :to=&quot;&#123;</span><br><span class="line">            path: &#x27;/news/newsDetail&#x27;,</span><br><span class="line">            query: &#123;</span><br><span class="line">              id: news.id,</span><br><span class="line">              title: news.title,</span><br><span class="line">              content: news.content</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;&quot;</span><br><span class="line">          &gt;&#123;&#123; news.title &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;news-content&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">RouterView</span>&gt;</span><span class="tag">&lt;/<span class="name">RouterView</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; RouterView, RouterLink &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> newsList = reactive([</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">title</span>: <span class="string">&quot;1111111&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;aaaaaa&quot;</span> &#125;,</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">title</span>: <span class="string">&quot;2222222&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;bbbbbb&quot;</span> &#125;,</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">title</span>: <span class="string">&quot;3333333&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;cccccc&quot;</span> &#125;,</span></span><br><span class="line">  ]);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 <code>views/NewsDetail.vue</code> 文件里，添加 <code>props</code> 接收传参，如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>编号：&#123;&#123; query.id &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>标题：&#123;&#123; query.title &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容：&#123;&#123; query.content &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; toRefs &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; useRoute &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> route = useRoute();</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> &#123; query &#125; = toRefs(route);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="params-传参"><a href="#params-传参" class="headerlink" title="params 传参"></a><code>params</code> 传参</h4><p>这种传参是放在 url 的后面，如：<code>/news/newsDetail/1</code>，写起来比 query 传参简洁些</p>
<p>先改造 <code>router/index.ts</code> 文件，添加 <code>params</code> 参数，如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: <span class="string">&#x27;/news&#x27;</span>,</span><br><span class="line">  name: <span class="string">&#x27;News&#x27;</span>,</span><br><span class="line">  component: News,</span><br><span class="line">  children: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&#x27;newsDetail/:id/:title/:content&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;NewsDetail&#x27;</span>,</span><br><span class="line">      component: NewsDetail</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>在<code>views/News.vue</code> 文件，改造如下，值得注意的是，写法 2 对象里不能用 <code>path</code>,必须写路由里的 <code>name</code> 参数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;news&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;news in newsList&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;news.id&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- parmas传参写法1 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;RouterLink :to=&quot;`/news/newsDetail/$&#123;news.id&#125;/$&#123;news.title&#125;/$&#123;news.content&#125;`&quot;&gt;&#123;&#123;</span></span><br><span class="line"><span class="comment">          news.title</span></span><br><span class="line"><span class="comment">        &#125;&#125;&lt;/RouterLink&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- parmas传参写法2 --&gt;</span></span><br><span class="line">        &lt;RouterLink</span><br><span class="line">          :to=&quot;&#123;</span><br><span class="line">            name: &#x27;NewsDetail&#x27;,</span><br><span class="line">            params: &#123;</span><br><span class="line">              id: news.id,</span><br><span class="line">              title: news.title,</span><br><span class="line">              content: news.content</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;&quot;</span><br><span class="line">          &gt;&#123;&#123; news.title &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;news-content&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">RouterView</span>&gt;</span><span class="tag">&lt;/<span class="name">RouterView</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; RouterView, RouterLink &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> newsList = reactive([</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">title</span>: <span class="string">&quot;1111111&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;aaaaaa&quot;</span> &#125;,</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">title</span>: <span class="string">&quot;2222222&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;bbbbbb&quot;</span> &#125;,</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">title</span>: <span class="string">&quot;3333333&quot;</span>, <span class="attr">content</span>: <span class="string">&quot;cccccc&quot;</span> &#125;,</span></span><br><span class="line">  ]);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>NewsDetail.vue</code> 文件:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>编号：&#123;&#123; params.id &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>标题：&#123;&#123; params.title &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容：&#123;&#123; params.content &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; toRefs &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; useRoute &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> route = useRoute();</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> &#123; params &#125; = toRefs(route);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="路由props参数"><a href="#路由props参数" class="headerlink" title="路由props参数"></a>路由<code>props</code>参数</h3><p>上面提到的<code>params</code>传参，都可以通过 <code>props</code> 参数来接收，<strong>最推荐</strong>这种写法，改写如下：</p>
<p>在 <code>router/index.ts</code> 文件里，添加 <code>props</code> 参数，如下：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: <span class="string">&#x27;/news&#x27;</span>,</span><br><span class="line">  name: <span class="string">&#x27;News&#x27;</span>,</span><br><span class="line">  component: News,</span><br><span class="line">  children: [</span><br><span class="line">    &#123;</span><br><span class="line">      path: <span class="string">&#x27;newsDetail/:id/:title/:content&#x27;</span>,</span><br><span class="line">      name: <span class="string">&#x27;NewsDetail&#x27;</span>,</span><br><span class="line">      component: NewsDetail,</span><br><span class="line">      props: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line">      <span class="comment">// props可以写成回调函数的写法，但没必要</span></span><br><span class="line">      <span class="comment">// props: (&#123; params: &#123; id, title, content &#125; &#125;) =&gt; (&#123;</span></span><br><span class="line">      <span class="comment">//   id</span></span><br><span class="line">      <span class="comment">//   title,</span></span><br><span class="line">      <span class="comment">//   content</span></span><br><span class="line">      <span class="comment">// &#125;)</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>views/News.vue</code> 文件 和上面提到的一样，无需改动，<code>views/NewsDetail.vue</code> 改造如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>编号：&#123;&#123; id &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>标题：&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>内容：&#123;&#123; content &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  defineProps([<span class="string">&quot;id&quot;</span>, <span class="string">&quot;title&quot;</span>, <span class="string">&quot;content&quot;</span>]);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="replace"><a href="#replace" class="headerlink" title="replace"></a><code>replace</code></h3><p><code>replace</code> 是一个<code>&lt;RouterLink&gt;</code>组件的属性，加上则表示不缓存该页面，不能点击浏览器上的后退按钮，如：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">RouterLink</span> <span class="attr">replace</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span> <span class="attr">active-class</span>=<span class="string">&quot;active&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">RouterLink</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="useRouter-编程式路由导航"><a href="#useRouter-编程式路由导航" class="headerlink" title="useRouter 编程式路由导航"></a><code>useRouter</code> 编程式路由导航</h3><p>上面我们提到的例子都是<code>&lt;RouterLink&gt;</code>组件，实际应用中，还有一种编程式路由导航，使用频率远大于<code>&lt;RouterLink&gt;</code>组件，例如我们用上面的例子，在首页有一个 button，点击可以跳转到 news 新闻页面，<code>views/Home.vue</code>文件如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>home page<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;jumpToNews&quot;</span>&gt;</span>jump to news page<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; useRouter &#125; <span class="keyword">from</span> <span class="string">&quot;vue-router&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> navigateTo = useRouter();</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> jumpToNews = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 用push：</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// navigateTo.push(&#x27;/news&#x27;)</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 也可这种写法：</span></span></span><br><span class="line">    navigateTo.push(&#123;</span><br><span class="line"><span class="javascript">      path: <span class="string">&quot;/news&quot;</span>,</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// 用replace：不能后退</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// navigateTo.replace(&#x27;/news&#x27;)</span></span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="redirect-重定向"><a href="#redirect-重定向" class="headerlink" title="redirect 重定向"></a><code>redirect</code> 重定向</h3><p>这个太简单，不赘述了，直接上代码<code>router/index.ts</code>：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">  redirect: <span class="string">&quot;/home&quot;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="组件间通信-ICC-inner-component-communication"><a href="#组件间通信-ICC-inner-component-communication" class="headerlink" title="组件间通信 ICC inner-component communication"></a>组件间通信 ICC <code>inner-component communication</code></h2><h3 id="父子互传"><a href="#父子互传" class="headerlink" title="父子互传"></a>父子互传</h3><h4 id="definedProps-和回调函数"><a href="#definedProps-和回调函数" class="headerlink" title="definedProps 和回调函数"></a><code>definedProps</code> 和回调函数</h4><p>父子组件间通信，demo 如下：</p>
<p>父组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;parent&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>parent<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>parent&#x27;s house：&#123;&#123; house &#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>toy fr child：&#123;&#123; toy &#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Child</span> <span class="attr">:house</span>=<span class="string">&quot;house&quot;</span> <span class="attr">:sendToyToParent</span>=<span class="string">&quot;getToyFromChild&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Child <span class="keyword">from</span> <span class="string">&quot;./ChildComp.vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> house = ref(<span class="string">&quot;🏠&quot;</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 回调函数：在Child上定义的是sendToyToParent</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> toy = ref(<span class="string">&quot;&quot;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> getToyFromChild = <span class="function">(<span class="params">value: string</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(value);</span></span><br><span class="line">    toy.value = value;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>子组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    house fr parent：&#123;&#123; house &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>my toy: &#123;&#123; toy &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;sendToyToParent(toy)&quot;</span>&gt;</span>send to parent<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> toy = ref(<span class="string">&quot;🐻&quot;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="comment">// 第一个参数是父组件传过来的数据，第二个是父组件传过来的函数</span></span></span><br><span class="line"><span class="javascript">  defineProps([<span class="string">&quot;house&quot;</span>, <span class="string">&quot;sendToyToParent&quot;</span>]);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="v-model-双绑-gt-组件封装"><a href="#v-model-双绑-gt-组件封装" class="headerlink" title="v-model 双绑 -&gt; 组件封装"></a><code>v-model</code> 双绑 -&gt; 组件封装</h4><p>说实话，这个属性在项目中是不常用的特性，项目中我们多用第三方组件库，</p>
<p>而 vue2 的<code>v-model</code>必须写在原生的 input 框上，</p>
<p>但 vue3 中的 <code>v-model</code>，可以<strong>直接写在组件标签上</strong>，有了这个特性，可以使其拥有更多的用法</p>
<p>首先，我们先看一下 <code>v-model</code> 在 vue2 中的实现原理</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; inputValue &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- v-model 用在HTML标签上 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;inputValue&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 原理： --&gt;</span></span><br><span class="line">  &lt;input</span><br><span class="line">    :value=&quot;inputValue&quot;</span><br><span class="line">    type=&quot;text&quot;</span><br><span class="line">    @input=&quot;inputValue = ($event.target as HTMLInputElement).value&quot;</span><br><span class="line">  /&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> inputValue = ref(<span class="string">&quot;hello&quot;</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>原始的 <code>v-model</code> 是一个语法糖，实际上，是将 input 框的 <code>:value</code> 和 <code>@input</code>，利用这个特性，我们可以实现一个多 input 的组件，实现和 vue2 的 v-model 一样的效果。</p>
<p>被封装的多 input 组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  &lt;input</span><br><span class="line">    type=&quot;text&quot;</span><br><span class="line">    :value=&quot;uName&quot;</span><br><span class="line">    @input=&quot;emit(&#x27;update:uName&#x27;, ($event.target as HTMLInputElement).value)&quot;</span><br><span class="line">  /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;input</span><br><span class="line">    type=&quot;password&quot;</span><br><span class="line">    :value=&quot;pwd&quot;</span><br><span class="line">    @input=&quot;emit(&#x27;update:pwd&#x27;, ($event.target as HTMLInputElement).value)&quot;</span><br><span class="line">  /&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  defineProps([<span class="string">&quot;uName&quot;</span>, <span class="string">&quot;pwd&quot;</span>]);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> emit = defineEmits([<span class="string">&quot;update:uName&quot;</span>, <span class="string">&quot;update:pwd&quot;</span>]);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">scoped</span>&gt;</span></span><br><span class="line"><span class="css">  <span class="comment">/* 特别牛叉的样式： */</span></span></span><br><span class="line"><span class="css">  <span class="selector-tag">input</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="attribute">background-color</span>: <span class="number">#26b9b1</span>;</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在页面里使用：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;&#123; userName &#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h4</span>&gt;</span>&#123;&#123; userPwd &#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Inputs</span> <span class="attr">v-model:uName</span>=<span class="string">&quot;userName&quot;</span> <span class="attr">v-model:pwd</span>=<span class="string">&quot;userPwd&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Inputs <span class="keyword">from</span> <span class="string">&quot;./FormInputs.vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> userName = ref(<span class="string">&quot;hello&quot;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> userPwd = ref(<span class="string">&quot;123456&quot;</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>通过以上的例子，可以看出以下特征：</p>
<ul>
<li>被封装的组件中，<code>:value</code> 和 <code>@input</code> 事件，实现了使用中 <code>&lt;Inputs v-model:uName=&quot;userName&quot; v-model:pwd=&quot;userPwd&quot; /&gt;</code> 的 <code>v-model</code> 效果。</li>
<li><code>v-model:uName=&quot;userName&quot;</code> 可以取别名<code>uName</code>，我们在封装的组件里提取时，也可以使用其别名</li>
</ul>
<h4 id="slot"><a href="#slot" class="headerlink" title="slot"></a><code>slot</code></h4><p>相当于 react 的 <code>children</code>，自定义组件双标签中包的那一块内容</p>
<h5 id="匿名插槽：数据-父-gt-子"><a href="#匿名插槽：数据-父-gt-子" class="headerlink" title="匿名插槽：数据 父-&gt;子"></a>匿名插槽：数据 父-&gt;子</h5><p>父组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;parent&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>parent Comp<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Category</span> <span class="attr">title</span>=<span class="string">&quot;热门游戏列表&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;game in ganmes&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;game.id&quot;</span>&gt;</span>&#123;&#123; game.name &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">Category</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Category <span class="keyword">from</span> <span class="string">&quot;./CategoryBoard.vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> ganmes = reactive([</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;英雄联盟&quot;</span> &#125;,</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;王者荣耀&quot;</span> &#125;,</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;绝地求生&quot;</span> &#125;,</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&quot;原神&quot;</span> &#125;,</span></span><br><span class="line">  ]);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>子组件：相当于用 slot 进行占位 html 的内容：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;category&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123; title &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- slot 相当于react 的 children --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span>&gt;</span>默认内容<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  defineProps([<span class="string">&quot;title&quot;</span>]);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="具名插槽：数据-父-gt-子"><a href="#具名插槽：数据-父-gt-子" class="headerlink" title="具名插槽：数据 父-&gt;子"></a>具名插槽：数据 父-&gt;子</h5><p>父组件：其中 #s1 #s2 是插槽的名称，可以自定义，#s1 号是<code>v-slot:s1</code>的缩写</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;parent&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>parent Comp<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Category</span> <span class="attr">title</span>=<span class="string">&quot;热门游戏列表&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> #<span class="attr">s1</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h2</span>&gt;</span>热门游戏列表<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">template</span> #<span class="attr">s2</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;games&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;game in ganmes&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;game.id&quot;</span>&gt;</span>&#123;&#123; game.name &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">Category</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Category <span class="keyword">from</span> <span class="string">&quot;./CategoryBoard.vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> ganmes = reactive([</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;英雄联盟&quot;</span> &#125;,</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;王者荣耀&quot;</span> &#125;,</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;绝地求生&quot;</span> &#125;,</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&quot;原神&quot;</span> &#125;,</span></span><br><span class="line">  ]);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>子组件：可以看到，slot 分为 s1 和 s2，分别对应子组件中的上下的两个插槽</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;category&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;s1&quot;</span>&gt;</span>默认内容1<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;s2&quot;</span>&gt;</span>默认内容2<span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="作用域插槽：数据-子-gt-父"><a href="#作用域插槽：数据-子-gt-父" class="headerlink" title="作用域插槽：数据 子-&gt;父"></a>作用域插槽：数据 子-&gt;父</h5><p>简单来说，这个是要解决数据放在子组件处，将子组件数据传递给父组件而设计的插槽。</p>
<p>父组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;game&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ScopedSlotChild</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> <span class="attr">v-slot:game-slot</span>=<span class="string">&quot;params&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ol</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;game in params.games&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;game.id&quot;</span>&gt;</span>&#123;&#123; game.name &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ScopedSlotChild</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> ScopedSlotChild <span class="keyword">from</span> <span class="string">&quot;./ScopedSlotChild.vue&quot;</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>子组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;game&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>游戏列表<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">&quot;game-slot&quot;</span> <span class="attr">:games</span>=<span class="string">&quot;games&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> games = reactive([</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;Dota 2&quot;</span> &#125;,</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;Counter-Strike: Global Offensive&quot;</span> &#125;,</span></span><br><span class="line"><span class="javascript">    &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;League of Legends&quot;</span> &#125;,</span></span><br><span class="line">  ]);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>以上有几个注意的点：</p>
<ul>
<li>slot 的 name 属性 <code>name=&quot;game-slot&quot;</code>，可以省略，当 slot 没有 name 属性，那父组件也不用起别名</li>
<li>slot 的 name 属性如果出现，那么在父组件的别名，例如：<code>v-slot:game-slot=&quot;params&quot;</code> 的<code>:game</code> 必须和 slot 的 name 属性一致</li>
<li>当 slot 的 name 属性值为 default 时，父组件的别名也可以省略</li>
</ul>
<h4 id="emit-事件"><a href="#emit-事件" class="headerlink" title="emit 事件"></a><code>emit</code> 事件</h4><p>这种方案其实我比较反感，因为上面的回调函数完全可以取代他，但既然框架提供了，那也得介绍一下</p>
<p>接着上面的例子，简单来说就是在子组件中</p>
<ul>
<li>将点击事件加上 <code>emit</code> api</li>
<li>根据 vue2 的文档，将命名由上面的驼峰法，改为 <code>kebab-case</code> 命名法则，即用 <code>-</code> 连接</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;emit(&#x27;send-toy-to-parent&#x27;, toy)&quot;</span>&gt;</span>send to parent<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// ...</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> emit = defineEmits([<span class="string">&quot;send-toy-to-parent&quot;</span>]);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>父组件中，接收子组件的点击事件，并做相应处理</p>
<ul>
<li>将原来的 <code>:click</code> 改为 vue2 的写法： <code>@send-toy-to-parent</code>，如下：</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Child</span> <span class="attr">:house</span>=<span class="string">&quot;house&quot;</span> @<span class="attr">send-toy-to-parent</span>=<span class="string">&quot;getToyFromChild&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="ref-gt-父子，-parent-gt-子父"><a href="#ref-gt-父子，-parent-gt-子父" class="headerlink" title="$ref -&gt; 父子， $parent -&gt; 子父"></a><code>$ref</code> -&gt; 父子， <code>$parent</code> -&gt; 子父</h4><p>先上代码，父组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;parent&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>parent comp<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>house: &#123;&#123; house &#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;getAllChildrenBooks($refs)&quot;</span>&gt;</span>+ Children 3 books<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Child1Comp</span> <span class="attr">ref</span>=<span class="string">&quot;child1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Child2Comp</span> <span class="attr">ref</span>=<span class="string">&quot;child2&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Child1Comp <span class="keyword">from</span> <span class="string">&quot;./Child1Comp.vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> Child2Comp <span class="keyword">from</span> <span class="string">&quot;./Child2Comp.vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> house = ref(<span class="number">4</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> getAllChildrenBooks = <span class="function">(<span class="params">refs: &#123; [x: string]: any &#125;</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> refs) &#123;</span></span><br><span class="line">      refs[key].books += 3;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  defineExpose(&#123; house &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>子组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;child&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Child 1 Comp<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h4</span>&gt;</span>books: &#123;&#123; books &#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;minusHouse($parent)&quot;</span>&gt;</span>take one house<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> books = ref(<span class="number">3</span>);</span></span><br><span class="line">  defineExpose(&#123; books &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> minusHouse = <span class="function">(<span class="params">parent: any</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (parent.house &lt;= <span class="number">0</span>) <span class="keyword">return</span>;</span></span><br><span class="line">    parent.house--;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>可以看出这个属性得配合 <code>defineExpose()</code> 使用，且必须是父子组件</li>
<li>在各自组件里，通过回调函数 <code>$parent</code> 获取父组件，通过 <code>$refs</code> 获取子组件</li>
<li>这种写法，允许在父组件获取多个子组件的变量值数据</li>
</ul>
<h3 id="隔代-跨代传值"><a href="#隔代-跨代传值" class="headerlink" title="隔代\跨代传值"></a>隔代\跨代传值</h3><h4 id="attr"><a href="#attr" class="headerlink" title="$attr"></a><code>$attr</code></h4><p><code>ParentComp.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;parent&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Parent Comp<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>a: &#123;&#123; a &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>b: &#123;&#123; b &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ChildComp</span> <span class="attr">:a</span>=<span class="string">&quot;a&quot;</span> <span class="attr">:b</span>=<span class="string">&quot;b&quot;</span> <span class="attr">v-bind</span>=<span class="string">&quot;&#123; x: 100 &#125;&quot;</span> <span class="attr">:updateA</span>=<span class="string">&quot;updateA&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> ChildComp <span class="keyword">from</span> <span class="string">&quot;./ChildComp.vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> a = ref(<span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> b = ref(<span class="number">2</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> updateA = <span class="function">(<span class="params">val: number</span>) =&gt;</span> &#123;</span></span><br><span class="line">    a.value += val;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>ChildComp.vue</code>中间的组件，仅写一个属性就够了 <code>v-bind=&quot;$attrs&quot;</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;child&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Child Comp<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">GrandChildComp</span> <span class="attr">v-bind</span>=<span class="string">&quot;$attrs&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> GrandChildComp <span class="keyword">from</span> <span class="string">&quot;./GrandChildComp.vue&quot;</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>GrandChildComp.vue</code>最底层的组件直接接收</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;grandChild&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Grand Child Comp<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>props from Parent:<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; a &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; b &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; x &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;updateA(3)&quot;</span>&gt;</span>cb to parent updateA<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  defineProps([<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;x&quot;</span>, <span class="string">&quot;updateA&quot;</span>]);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>从上面的代码可以看出，中间的层级如果只写 <code>v-bind=&quot;$attrs&quot;</code> 就可以无限层级的传参，而从最底层的子组件开始，如果要回传到最顶层，也只需写回调函数即可</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@1.55/articles/Vue3%E5%AD%A6%E4%B9%A0/%E5%A4%9A%E5%B1%82%E7%BA%A7%E4%BC%A0%E5%8F%82.gif" alt="多层级传参"></p>
<h4 id="provide-inject"><a href="#provide-inject" class="headerlink" title="provide + inject"></a><code>provide</code> + <code>inject</code></h4><p>这个比起上一个更简单，上一个中间组件还需要写一个 <code>v-bind=&quot;$attrs&quot;</code>属性，而这种方法中间组件不用添加任何属性</p>
<p>祖先组件用 provide 注入数据，后代组件用 inject 获取数据</p>
<p>祖先组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;parent&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Parent Comp<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>house: &#123;&#123; house &#125;&#125; 万元<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>car: &#123;&#123; car.price &#125;&#125; 万元<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ChildComp</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> ChildComp <span class="keyword">from</span> <span class="string">&quot;./ChildComp.vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref, reactive, provide &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> house = ref(<span class="number">800</span>);</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> car = reactive(&#123;</span></span><br><span class="line"><span class="javascript">    brand: <span class="string">&quot;Benz&quot;</span>,</span></span><br><span class="line">    price: 80,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> updateHousePrice = <span class="function">(<span class="params">value: number</span>) =&gt;</span> &#123;</span></span><br><span class="line">    house.value -= value;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">  provide(<span class="string">&quot;houseContext&quot;</span>, &#123; house, updateHousePrice &#125;);</span></span><br><span class="line"><span class="javascript">  provide(<span class="string">&quot;car&quot;</span>, car);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>最底层的孙子组件：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;grandgrandChild&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Grand Grand Child Comp<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>house &amp; car from parent:<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>house: &#123;&#123; house &#125;&#125; 万元<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>car: 一辆&#123;&#123; y.brand &#125;&#125;车，价值&#123;&#123; y.price &#125;&#125; 万元<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;updateHousePrice(1)&quot;</span>&gt;</span>修改house价值<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; inject &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 直接解构出回调函数updateHousePrice</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> &#123; house, updateHousePrice &#125; = inject(<span class="string">&quot;houseContext&quot;</span>, &#123;</span></span><br><span class="line">    house: 0,</span><br><span class="line"><span class="javascript">    updateHousePrice: <span class="function">(<span class="params">num: number</span>) =&gt;</span> &#123;&#125;,</span></span><br><span class="line">  &#125;);</span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> y = inject(<span class="string">&quot;car&quot;</span>, &#123; <span class="attr">brand</span>: <span class="string">&quot;BMW&quot;</span>, <span class="attr">price</span>: <span class="number">60</span> &#125;);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>从上面的代码可以看出：</p>
<ul>
<li><code>provide</code> 的第一个参数是定义所传的值的名字，第二个参数可以是单一值，也可以是复杂的对象</li>
<li><code>inject</code> 的第一个参数是定义所传的值的名字，第二个参数是默认值，如果传值失败，则使用默认值</li>
<li><code>provide</code> 和 <code>inject</code> 是 vue3 的新特性，在 vue2 中，可以通过 <code>$parent</code> 和 <code>$children</code> 来实现</li>
</ul>
<h3 id="任意组件互传"><a href="#任意组件互传" class="headerlink" title="任意组件互传"></a>任意组件互传</h3><h4 id="mitt"><a href="#mitt" class="headerlink" title="mitt"></a><code>mitt</code></h4><p>这是一个独立压缩后只有几百字节的库 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/mitt"><code>mitt</code></a>，node 环境下均可用，不仅仅局限于 vue</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mitt</span><br></pre></td></tr></table></figure>

<p>创建 <code>utils/emitter.ts</code> 文件</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mitt, &#123; <span class="keyword">type</span> Emitter &#125; <span class="keyword">from</span> <span class="string">&quot;mitt&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Events = &#123;</span><br><span class="line">  [key: <span class="built_in">string</span>]: <span class="built_in">string</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> emitter: Emitter&lt;Events&gt; = mitt();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> emitter;</span><br></pre></td></tr></table></figure>

<p>组件 1</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;comp1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>组件1<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>我的玩具：&#123;&#123; toyCar &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;emitter.emit(&#x27;send-to-comp2&#x27;, toyCar)&quot;</span>&gt;</span>发送给组件2<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> emitter <span class="keyword">from</span> <span class="string">&quot;@/utils/emitter&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> toyCar = ref(<span class="string">&quot;🚙&quot;</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>组件 2</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;comp2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span>my toy: &#123;&#123; toyCarFrComp1 &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref, onUnmounted &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> emitter <span class="keyword">from</span> <span class="string">&quot;@/utils/emitter&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> toyCarFrComp1 = ref(<span class="string">&quot;&quot;</span>);</span></span><br><span class="line"><span class="javascript">  emitter.on(<span class="string">&quot;send-to-comp2&quot;</span>, <span class="function">(<span class="params">value: string</span>) =&gt;</span> &#123;</span></span><br><span class="line">    toyCarFrComp1.value = value;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">  onUnmounted(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    emitter.off(<span class="string">&quot;send-to-comp2&quot;</span>);</span></span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>发送数据方，可以看到上面的 <code>emitter</code> 里调用了 <code>.emit()</code> 方法，<code>.emit()</code> 方法接收两个参数，第一个参数是事件名称，第二个参数是事件携带的数据。</li>
<li>接受数据方，可以看到上面的 <code>emitter</code> 里调用了 <code>.on()</code> 方法，<code>.on()</code> 方法接收两个参数，第一个参数是事件名称，第二个参数是事件监听函数。赋值给页面对应的变量名</li>
<li><code>onUnmounted</code> 的作用是在组件卸载时，也卸载掉监听事件，避免内存留存</li>
</ul>
<h4 id="Pinia"><a href="#Pinia" class="headerlink" title="Pinia"></a><code>Pinia</code></h4><p>这种在上面单独拎出来的讲了，这里就不多说了，直接看上面的例子</p>
<h2 id="customRef-自定义响应式"><a href="#customRef-自定义响应式" class="headerlink" title="customRef 自定义响应式"></a><code>customRef</code> 自定义响应式</h2><p>这是一个常用的 api，例如实现防抖，我们用普通 ref 时加上双向数据绑定时，input 框输入实时变化都会实时渲染，如果页面信息过多，那么会影响性能，所以需要用到 <code>customRef</code>实现防抖功能：</p>
<p>我们把他写为一个钩子函数：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; customRef &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useDelayInput = <span class="function">(<span class="params">initVal: <span class="built_in">string</span> = <span class="string">&quot;&quot;</span>, delay: <span class="built_in">number</span> = <span class="number">500</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> msg = customRef(<span class="function">(<span class="params">track, trigger</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="comment">// msg 被读取时调用：</span></span><br><span class="line">      <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        track(); <span class="comment">//</span></span><br><span class="line">        <span class="keyword">return</span> initVal;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// msg 被修改时调用：</span></span><br><span class="line">      <span class="function"><span class="title">set</span>(<span class="params">value</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">clearTimeout</span>(delay);</span><br><span class="line">        delay = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          initVal = value;</span><br><span class="line">          trigger();</span><br><span class="line">        &#125;, delay);</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> msg;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useDelayInput;</span><br></pre></td></tr></table></figure>

<p>使用：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;msg&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> useDelayInput <span class="keyword">from</span> <span class="string">&quot;../hooks/useDelayInput&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> msg = useDelayInput(<span class="string">&quot;customRef&quot;</span>, <span class="number">800</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>从钩子函数可以出：</p>
<ul>
<li><code>customRef</code> 里是一个函数，返回一个对象，对象里有 <code>get</code> 和 <code>set</code> 方法，<code>get</code> 方法是读取数据，<code>set</code> 方法是修改数据</li>
<li><code>track</code> 和 <code>trigger</code> 是两个函数，<code>track</code> 是读取数据时调用，<code>trigger</code> 是修改数据时调用</li>
<li><code>track</code> 的作用是告诉 vue 追踪依赖，<code>trigger</code> 是告诉 vue 触发依赖</li>
</ul>
<h2 id="shallowRef-和-shallowReactive"><a href="#shallowRef-和-shallowReactive" class="headerlink" title="shallowRef 和 shallowReactive"></a><code>shallowRef</code> 和 <code>shallowReactive</code></h2><p>这 2 个 api 旨在对付那些比较大的 Object，只监听第一层，层次比较深的数据不会被监听到</p>
<p><code>shallowRef</code> 举例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; shallowRef, shallowReactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 当修改以下数据时：</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> toy = shallowRef(&#123;</span></span><br><span class="line"><span class="javascript">    toy: <span class="string">&quot;🚗&quot;</span>,</span></span><br><span class="line">  &#125;);</span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> change = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// ❌ 无效修改：shallowRef 只监听第一层，只会监听到 toy.value</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// toy.value.toy = &quot;🚙&quot;;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// ✅ 修改成功</span></span></span><br><span class="line">    toy.value = &#123;</span><br><span class="line"><span class="javascript">      toy: <span class="string">&quot;🚙&quot;</span>,</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>shallowRef</code> 举例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; shallowReactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> nations = shallowRef(&#123;</span></span><br><span class="line"><span class="javascript">    China: <span class="string">&quot;CN&quot;</span>,</span></span><br><span class="line">  &#125;);</span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> changenations = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// ❌无效修改：</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// nations.value.China = &#x27;中国&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// ✅ 修改成功</span></span></span><br><span class="line">    nations.value = &#123;</span><br><span class="line"><span class="javascript">      China: <span class="string">&quot;中国&quot;</span>,</span></span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>shallowReactive</code> 举例：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> toys = shallowReactive(&#123;</span></span><br><span class="line"><span class="javascript">    car: <span class="string">&quot;🚗&quot;</span>,</span></span><br><span class="line"><span class="javascript">    animals: &#123; <span class="attr">dog</span>: <span class="string">&quot;🐭&quot;</span>, <span class="attr">cat</span>: <span class="string">&quot;🐱&quot;</span> &#125;,</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// ✅ 修改成功: 位于对象第一层：</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> changeToyCar = <span class="function">() =&gt;</span> (toys.car = <span class="string">&quot;🚙&quot;</span>);</span></span><br><span class="line"><span class="javascript">  <span class="comment">// ❌ 无效修改：位于对象更深的层次：</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> changeAnimals = <span class="function">() =&gt;</span> (toys.animals.dog = <span class="string">&quot;🐶&quot;</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>但当我把上面 <code>const changeToyCar = () =&gt; (toys.car = &quot;🚙&quot;);</code> 函数改为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// ✅ 修改成功:</span></span></span><br><span class="line"><span class="javascript">  <span class="comment">// ❗️但不推荐，因为对象会触发两次修改：</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> changeToyCar = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    toys.car = <span class="string">&quot;🚙&quot;</span>;</span></span><br><span class="line"><span class="javascript">    toys.animals.dog = <span class="string">&quot;🐶&quot;</span>;</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>确两个都成功了，<code>toys.animals.dog</code>，尽管这个属性不是响应式的，但因为之前对 <code>toys.car</code> 的修改已经触发了更新，所以任何依赖于 <code>toys</code> 的视图都会重新渲染，这时你会看到 <code>toys.animals.dog</code> 的新值。所以不推荐这种写法，他与<code>shallowRef</code>的原意背道而驰，直接用 <code>ref</code>即可。</p>
<h2 id="readOnly-和-shallowReadOnly"><a href="#readOnly-和-shallowReadOnly" class="headerlink" title="readOnly 和 shallowReadOnly"></a><code>readOnly</code> 和 <code>shallowReadOnly</code></h2><p>对象整体只读和浅层只读，只针对于 <code>reactive</code> 包裹的对象属性，看下面的例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Deep Readonly Car: &#123;&#123; deepReadonlyCar &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Shallow Readonly Car: &#123;&#123; shallowReadonlyCar &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">      Nested Property in Shallow Readonly: &#123;&#123; shallowReadonlyCar.details.color</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;tryToModify&quot;</span>&gt;</span>Try to Modify<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; readonly, shallowReadonly, reactive &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 创建一个响应式对象</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> car = reactive(&#123;</span></span><br><span class="line"><span class="javascript">    model: <span class="string">&quot;Tesla Model 3&quot;</span>,</span></span><br><span class="line">    details: &#123;</span><br><span class="line"><span class="javascript">      color: <span class="string">&quot;Red&quot;</span>,</span></span><br><span class="line">      year: 2023,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 使用 readonly 创建一个深层只读的响应式对象</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> deepReadonlyCar = readonly(car);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 使用 shallowReadonly 创建一个浅层只读的响应式对象</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> shallowReadonlyCar = shallowReadonly(car);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 尝试修改对象的函数</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> tryToModify = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// ❌ 这个对象只读，所以控制台会发出警告 warn 不能修改</span></span></span><br><span class="line"><span class="javascript">    deepReadonlyCar.model = <span class="string">&quot;Tesla Model S&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// ❌ 浅层只读对象，依然不能修改</span></span></span><br><span class="line"><span class="javascript">    shallowReadonlyCar.model = <span class="string">&quot;Tesla Model X&quot;</span>; <span class="comment">// 这将不会生效，并且控制台会给出警告</span></span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">// ✅ 成功，shallowReadonlyCar 的嵌套对象属性，因为 shallowReadonly 是浅层的</span></span></span><br><span class="line"><span class="javascript">    shallowReadonlyCar.details.color = <span class="string">&quot;Blue&quot;</span>; <span class="comment">// 这将生效，但修改不会触发响应式更新</span></span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="toRaw-和-markRaw"><a href="#toRaw-和-markRaw" class="headerlink" title="toRaw 和 markRaw"></a><code>toRaw</code> 和 <code>markRaw</code></h2><p><code>toRaw</code> : 这是一个可以用于临时读取而不引起代理访问/跟踪开销，或是写入而不触发更改的特辣方法。不建议保存对原始对象的持久引用，请还慎使用。<br><code>toRaw</code> 何时使用？—-在露要将响应式对象传递给非 Vue 的库或外部系统时，使用 toRaw 可以确保它们收到的是普通对象</p>
<p><code>markRaw</code> 标记一个对象，使其永远不会变成响应式的</p>
<p>例子：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Raw Value: &#123;&#123; rawValue.foo &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Marked Raw Value: &#123;&#123; markedRawValue.foo &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;modifyToRaw&quot;</span>&gt;</span>Modify to Raw<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;modifyMarkRaw&quot;</span>&gt;</span>Modify Marked Raw<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; reactive, toRaw, markRaw &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> reactiveValue = reactive(&#123; <span class="attr">foo</span>: <span class="string">&quot;Reactive Foo&quot;</span> &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// 使用 toRaw 获取响应式对象的原始对象</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> rawValue = toRaw(reactiveValue);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> originalObject = &#123; <span class="attr">foo</span>: <span class="string">&quot;Marked Raw Foo&quot;</span> &#125;;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> markedRawValue = markRaw(originalObject);</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> modifyToRaw = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 修改原始对象的属性，不会触发视图更新，因为它不是响应式的</span></span></span><br><span class="line"><span class="javascript">    rawValue.foo = <span class="string">&quot;Modified Raw Foo&quot;</span>;</span></span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> modifyMarkRaw = <span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 修改被标记为原始的对象，同样不会触发视图更新</span></span></span><br><span class="line"><span class="javascript">    markedRawValue.foo = <span class="string">&quot;Modified Marked Raw Foo&quot;</span>;</span></span><br><span class="line">  &#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Teleport"><a href="#Teleport" class="headerlink" title="Teleport"></a><code>Teleport</code></h2><p>这个类似 React 的 <a target="_blank" rel="noopener" href="https://react.dev/reference/react-dom/createPortal"><code>createPortal</code></a> 功能。<br>我们看看 React 官网的示例代码：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  &lt;SomeComponent /&gt;</span><br><span class="line">  &#123;createPortal(children, domNode, key?)&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>实际使用中，我们多把弹框从底层传送到 <code>&lt;body&gt;</code> 上，而不是某层的子组件上。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;showModal = true&quot;</span>&gt;</span>pop out modal<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">teleport</span> <span class="attr">to</span>=<span class="string">&quot;body&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-if</span>=<span class="string">&quot;showModal&quot;</span> <span class="attr">class</span>=<span class="string">&quot;modal&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>title<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>this is a modal create by teleport<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;showModal = false&quot;</span>&gt;</span>close<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">teleport</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> showModal = ref(<span class="literal">false</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="suspence-异步组件"><a href="#suspence-异步组件" class="headerlink" title="suspence 异步组件"></a><code>suspence</code> 异步组件</h2><p>参考了 React 18 的 <code>suspence</code> 组件，<code>suspence</code>也是 Vue3 的新特性，用于实现组件的懒加载。</p>
<p>使用例子如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Vue 3 Suspense Example<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Suspense</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> #<span class="attr">default</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;AsyncComponent /&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">FetchComp</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">template</span> #<span class="attr">fallback</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Loading...<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">FetchComp</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; defineAsyncComponent, Suspense &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> FetchComp <span class="keyword">from</span> <span class="string">&quot;./FetchComp.vue&quot;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="comment">// import()定义一个异步组件</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> AsyncComponent = defineAsyncComponent(<span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&quot;./AsyncComp.vue&quot;</span>));</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>FetchComp.vue</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>fetch comp<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;chlid&quot;</span>&gt;</span>&#123;&#123; content &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> request = <span class="keyword">await</span> fetch(</span></span><br><span class="line"><span class="javascript">    <span class="string">&quot;https://api.uomg.com/api/rand.qinghua?format=json&quot;</span></span></span><br><span class="line">  );</span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> &#123; content &#125; = <span class="keyword">await</span> request.json();</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="全局-api"><a href="#全局-api" class="headerlink" title="全局 api"></a>全局 api</h2><p>Vue3 在 <code>main.ts</code> 中，可以用全局 api 注册全局组件，</p>
<ol>
<li><code>app.component(name, component)</code> 注册全局组件</li>
<li><code>app.directive(name, directive)</code> 注册全局指令</li>
<li><code>app.provide(key, value)</code> 注册全局 provide/inject</li>
<li><code>app.config.globalProperties.$foo = &#39;bar&#39;</code> 注册全局属性</li>
<li><code>app.unmount(element)</code> 卸载应用</li>
<li><code>app.use(plugin)</code> 安装插件</li>
</ol>
<p>例子：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp &#125; <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&quot;./App.vue&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createPinia &#125; <span class="keyword">from</span> <span class="string">&quot;pinia&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&quot;./router&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> Hello <span class="keyword">from</span> <span class="string">&quot;./GlobalHello.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = createApp(App);</span><br><span class="line"><span class="keyword">const</span> pinia = createPinia();</span><br><span class="line">app.use(pinia);</span><br><span class="line">app.use(router);</span><br><span class="line">app.mount(<span class="string">&quot;#app&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义全局组件：</span></span><br><span class="line">app.component(<span class="string">&quot;globalHello&quot;</span>, Hello);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义全局变量：</span></span><br><span class="line">app.config.globalProperties.globalVariable = <span class="number">999</span>;</span><br><span class="line"><span class="comment">// 官方建议 type 声明：</span></span><br><span class="line"><span class="keyword">declare</span> <span class="built_in">module</span> <span class="string">&quot;vue&quot;</span> &#123;</span><br><span class="line">  <span class="keyword">interface</span> ComponentCustomProperties &#123;</span><br><span class="line">    globalVariable: <span class="built_in">number</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义指令：</span></span><br><span class="line">app.directive(<span class="string">&quot;focus&quot;</span>, <span class="function">(<span class="params">ele</span>) =&gt;</span> &#123;</span><br><span class="line">  ele.style.color = <span class="string">&quot;red&quot;</span>;</span><br><span class="line">  ele.style.backgoundColor = <span class="string">&quot;green&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在任意一个 src 下的组件中使用，且不需要 <code>import</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">GlobalHello</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; globalNumber &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-focus</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span> <span class="attr">setup</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>效果如下图：</p>
<p><img class="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" data-src="https://cdn.jsdelivr.net/gh/ys558/my-blog-imgs@1.56/articles/Vue3%E5%AD%A6%E4%B9%A0/global-api.gif" alt="App.vue文件引入typescript 文件报错"></p>
<h2 id="非兼容性改变"><a href="#非兼容性改变" class="headerlink" title="非兼容性改变"></a>非兼容性改变</h2><p>可以参考<a target="_blank" rel="noopener" href="https://v3-migration.vuejs.org/zh/breaking-changes/">官方文档</a></p>
<p>重点关注这些比较常用的：</p>
<ul>
<li>过渡类名 <code>v-enter</code> 修改为 <code>v-enter-from</code>、过渡类名 <code>v-leave</code> 修改为 <code>v-leave-from</code>。</li>
<li><code>keyCode</code> 作为 <code>v-on</code> 修饰符的支持</li>
<li><code>v-model</code> 指令在组件上的使用已经被重新设计，替换掉了 y-bind.sync</li>
<li><code>v-if</code> 和 <code>v-for</code> 在同一个元素身上使用时的优先级发生了变化。<code>v-if</code> 优先级 &gt; <code>v-for</code> 优先级</li>
<li>移除了 <code>$on</code>、<code>$off</code> 和 <code>$once</code> 实例方法。</li>
<li>移除了过滤器 <code>filter</code></li>
<li>移除了 <code>$children</code> 实例 <code>propert</code></li>
</ul>

<div class="article-footer fs14">
    <section id="license">
      <div class="header"><span>许可协议</span></div>
      <div class="body"><p>本文采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 4.0 国际</a> 许可协议，转载请注明出处。</p>
</div>
    </section>
    </div>
</article>
<div class="related-wrap" id="read-next"><section class="body"><div class="item" id="prev"><div class="note">较新文章</div><a href="/2024/05/15/%E3%80%902024-05-14%E3%80%91Nginx%E9%85%8D%E7%BD%AE/">Nginx 简介及配置 (24-05-15)</a></div><div class="item" id="next"><div class="note">较早文章</div><a href="/2024/04/29/%E3%80%902024-04-29%E3%80%91Node%20%E9%9D%A2%E8%AF%95%E9%A2%98/">Node面试题及原理总结</a></div></section></div>




  <div class="related-wrap md-text" id="comments">
    <section class='header cmt-title cap theme'>
      <p>快来参与讨论吧~</p>

    </section>
    <section class='body cmt-body utterances'>
      

<svg class="loading" style="vertical-align:middle;fill:currentColor;overflow:hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2709"><path d="M832 512c0-176-144-320-320-320V128c211.2 0 384 172.8 384 384h-64zM192 512c0 176 144 320 320 320v64C300.8 896 128 723.2 128 512h64z" p-id="2710"></path></svg>

<div id="utterances" repo="xaoxuu/blog-comments" issue-term="pathname" theme="preferred-color-scheme"></div>

    </section>
  </div>



<footer class="page-footer footnote"><hr><div class="text"><p>本站由 <a href="/">自由の翼</a> 使用 <a target="_blank" rel="noopener" href="https://github.com/xaoxuu/hexo-theme-stellar/tree/1.28.1">Stellar 1.28.1</a> 主题创建。<br>本博客所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议，转载请注明出处。</p>
</div></footer>
<div class="main-mask" onclick="sidebar.dismiss()"></div></div><aside class="l_right">
<div class="widgets">



<widget class="widget-wrapper toc" id="data-toc" collapse="false"><div class="widget-header dis-select"><span class="name">本文目录</span><a class="cap-action" onclick="sidebar.toggleTOC()" ><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg></a></div><div class="widget-body"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-text">创建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue3-%E5%85%A5%E5%8F%A3%E6%96%87%E4%BB%B6%E4%B8%80%E4%BA%9B%E6%A6%82%E5%BF%B5"><span class="toc-text">Vue3 入口文件一些概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Options-API-%E5%92%8C-Composition-API"><span class="toc-text">Options API 和 Composition API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#setup"><span class="toc-text">setup()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95%E7%B3%96-lt-script-setup-lang-quot-ts-quot-gt"><span class="toc-text">语法糖 &lt;script setup lang&#x3D;&quot;ts&quot;&gt;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#setup%E6%8F%92%E4%BB%B6-VueSetupExtend-%E5%A2%9E%E5%BC%BA-script-%E6%A0%87%E7%AD%BE%E7%94%A8%E6%B3%95"><span class="toc-text">setup插件: VueSetupExtend 增强 script 标签用法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ref-%E5%92%8C-reactive%EF%BC%8C%E5%B0%86%E6%95%B0%E5%8F%98%E4%B8%BA%E5%93%8D%E5%BA%94%E5%BC%8F"><span class="toc-text">ref 和 reactive，将数变为响应式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#computed-%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7"><span class="toc-text">computed 计算属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#watch-%E7%9B%91%E8%A7%86"><span class="toc-text">watch 监视</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#defineExpose-%E6%9A%B4%E9%9C%B2%E5%93%8D%E5%BA%94%E5%BC%8F%E6%95%B0%E6%8D%AE"><span class="toc-text">defineExpose 暴露响应式数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#props-defineProps-%E5%92%8C-withDefaults"><span class="toc-text">props, defineProps 和 withDefaults</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Custom-Hooks-%E6%A8%A1%E5%9D%97%E5%8C%96%E5%B0%81%E8%A3%85"><span class="toc-text">Custom Hooks 模块化封装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pinia-%E7%8A%B6%E6%80%81%E7%AE%A1%E7%90%86"><span class="toc-text">Pinia 状态管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#createApp"><span class="toc-text">createApp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#defineStore-state-actions"><span class="toc-text">defineStore, state, actions</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#defineStore-%E7%AC%AC%E4%BA%8C%E4%B8%AA%E5%8F%82%E6%95%B0%E6%94%B9%E5%86%99%E4%B8%BA%E7%BB%84%E5%90%88%E5%BC%8F-API"><span class="toc-text">defineStore 第二个参数改写为组合式 API</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#storeToRefs"><span class="toc-text">storeToRefs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#getters-%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE"><span class="toc-text">getters 处理数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#subscribe-store-%E7%9A%84%E8%AE%A2%E9%98%85"><span class="toc-text">$subscribe store 的订阅</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vue-router-%E8%B7%AF%E7%94%B1"><span class="toc-text">vue-router 路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%B7%AF%E7%94%B1"><span class="toc-text">创建路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%B7%AF%E7%94%B1"><span class="toc-text">使用路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E8%B7%AF%E7%94%B1"><span class="toc-text">子路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E4%BC%A0%E5%8F%82"><span class="toc-text">路由传参</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#query-%E4%BC%A0%E5%8F%82"><span class="toc-text">query 传参</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#params-%E4%BC%A0%E5%8F%82"><span class="toc-text">params 传参</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1props%E5%8F%82%E6%95%B0"><span class="toc-text">路由props参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#replace"><span class="toc-text">replace</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#useRouter-%E7%BC%96%E7%A8%8B%E5%BC%8F%E8%B7%AF%E7%94%B1%E5%AF%BC%E8%88%AA"><span class="toc-text">useRouter 编程式路由导航</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redirect-%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-text">redirect 重定向</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E9%97%B4%E9%80%9A%E4%BF%A1-ICC-inner-component-communication"><span class="toc-text">组件间通信 ICC inner-component communication</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%88%B6%E5%AD%90%E4%BA%92%E4%BC%A0"><span class="toc-text">父子互传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#definedProps-%E5%92%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0"><span class="toc-text">definedProps 和回调函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#v-model-%E5%8F%8C%E7%BB%91-gt-%E7%BB%84%E4%BB%B6%E5%B0%81%E8%A3%85"><span class="toc-text">v-model 双绑 -&gt; 组件封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#slot"><span class="toc-text">slot</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8C%BF%E5%90%8D%E6%8F%92%E6%A7%BD%EF%BC%9A%E6%95%B0%E6%8D%AE-%E7%88%B6-gt-%E5%AD%90"><span class="toc-text">匿名插槽：数据 父-&gt;子</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B7%E5%90%8D%E6%8F%92%E6%A7%BD%EF%BC%9A%E6%95%B0%E6%8D%AE-%E7%88%B6-gt-%E5%AD%90"><span class="toc-text">具名插槽：数据 父-&gt;子</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%8F%92%E6%A7%BD%EF%BC%9A%E6%95%B0%E6%8D%AE-%E5%AD%90-gt-%E7%88%B6"><span class="toc-text">作用域插槽：数据 子-&gt;父</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#emit-%E4%BA%8B%E4%BB%B6"><span class="toc-text">emit 事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ref-gt-%E7%88%B6%E5%AD%90%EF%BC%8C-parent-gt-%E5%AD%90%E7%88%B6"><span class="toc-text">$ref -&gt; 父子， $parent -&gt; 子父</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%94%E4%BB%A3-%E8%B7%A8%E4%BB%A3%E4%BC%A0%E5%80%BC"><span class="toc-text">隔代\跨代传值</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#attr"><span class="toc-text">$attr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#provide-inject"><span class="toc-text">provide + inject</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E6%84%8F%E7%BB%84%E4%BB%B6%E4%BA%92%E4%BC%A0"><span class="toc-text">任意组件互传</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mitt"><span class="toc-text">mitt</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pinia"><span class="toc-text">Pinia</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#customRef-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%93%8D%E5%BA%94%E5%BC%8F"><span class="toc-text">customRef 自定义响应式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#shallowRef-%E5%92%8C-shallowReactive"><span class="toc-text">shallowRef 和 shallowReactive</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#readOnly-%E5%92%8C-shallowReadOnly"><span class="toc-text">readOnly 和 shallowReadOnly</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#toRaw-%E5%92%8C-markRaw"><span class="toc-text">toRaw 和 markRaw</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Teleport"><span class="toc-text">Teleport</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#suspence-%E5%BC%82%E6%AD%A5%E7%BB%84%E4%BB%B6"><span class="toc-text">suspence 异步组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80-api"><span class="toc-text">全局 api</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E5%85%BC%E5%AE%B9%E6%80%A7%E6%94%B9%E5%8F%98"><span class="toc-text">非兼容性改变</span></a></li></ol></div><div class="widget-footer">

<a class="top" onclick="util.scrollTop()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12c0-4.714 0-7.071 1.464-8.536C4.93 2 7.286 2 12 2c4.714 0 7.071 0 8.535 1.464C22 4.93 22 7.286 22 12c0 4.714 0 7.071-1.465 8.535C19.072 22 16.714 22 12 22s-7.071 0-8.536-1.465C2 19.072 2 16.714 2 12Z"/><path stroke-linecap="round" stroke-linejoin="round" d="m9 15.5l3-3l3 3m-6-4l3-3l3 3"/></g></svg><span>回到顶部</span></a><a class="buttom" onclick="util.scrollComment()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M10.46 1.25h3.08c1.603 0 2.86 0 3.864.095c1.023.098 1.861.3 2.6.752a5.75 5.75 0 0 1 1.899 1.899c.452.738.654 1.577.752 2.6c.095 1.004.095 2.261.095 3.865v1.067c0 1.141 0 2.036-.05 2.759c-.05.735-.153 1.347-.388 1.913a5.75 5.75 0 0 1-3.112 3.112c-.805.334-1.721.408-2.977.43a10.81 10.81 0 0 0-.929.036c-.198.022-.275.054-.32.08c-.047.028-.112.078-.224.232c-.121.166-.258.396-.476.764l-.542.916c-.773 1.307-2.69 1.307-3.464 0l-.542-.916a10.605 10.605 0 0 0-.476-.764c-.112-.154-.177-.204-.224-.232c-.045-.026-.122-.058-.32-.08c-.212-.023-.49-.03-.93-.037c-1.255-.021-2.171-.095-2.976-.429A5.75 5.75 0 0 1 1.688 16.2c-.235-.566-.338-1.178-.389-1.913c-.049-.723-.049-1.618-.049-2.76v-1.066c0-1.604 0-2.86.095-3.865c.098-1.023.3-1.862.752-2.6a5.75 5.75 0 0 1 1.899-1.899c.738-.452 1.577-.654 2.6-.752C7.6 1.25 8.857 1.25 10.461 1.25M6.739 2.839c-.914.087-1.495.253-1.959.537A4.25 4.25 0 0 0 3.376 4.78c-.284.464-.45 1.045-.537 1.96c-.088.924-.089 2.11-.089 3.761v1c0 1.175 0 2.019.046 2.685c.045.659.131 1.089.278 1.441a4.25 4.25 0 0 0 2.3 2.3c.515.214 1.173.294 2.429.316h.031c.398.007.747.013 1.037.045c.311.035.616.104.909.274c.29.17.5.395.682.645c.169.232.342.525.538.856l.559.944a.52.52 0 0 0 .882 0l.559-.944c.196-.331.37-.624.538-.856c.182-.25.392-.476.682-.645c.293-.17.598-.24.909-.274c.29-.032.639-.038 1.037-.045h.032c1.255-.022 1.913-.102 2.428-.316a4.25 4.25 0 0 0 2.3-2.3c.147-.352.233-.782.278-1.441c.046-.666.046-1.51.046-2.685v-1c0-1.651 0-2.837-.089-3.762c-.087-.914-.253-1.495-.537-1.959a4.25 4.25 0 0 0-1.403-1.403c-.464-.284-1.045-.45-1.96-.537c-.924-.088-2.11-.089-3.761-.089h-3c-1.651 0-2.837 0-3.762.089" clip-rule="evenodd"/><path fill="currentColor" d="M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0a1 1 0 0 1 2 0"/></svg><span>参与讨论</span></a></div></widget>
</div></aside><div class='float-panel blur'>
  <button type='button' style='display:none' class='laptop-only rightbar-toggle mobile' onclick='sidebar.rightbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6h11m-11 6h11m-11 6h11M4 6h1v4m-1 0h2m0 8H4c0-1 2-2 2-3s-1-1.5-2-1"/></svg>
  </button>
  <button type='button' style='display:none' class='mobile-only leftbar-toggle mobile' onclick='sidebar.leftbar()'>
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 11c0-3.771 0-5.657 1.172-6.828C4.343 3 6.229 3 10 3h4c3.771 0 5.657 0 6.828 1.172C22 5.343 22 7.229 22 11v2c0 3.771 0 5.657-1.172 6.828C19.657 21 17.771 21 14 21h-4c-3.771 0-5.657 0-6.828-1.172C2 18.657 2 16.771 2 13z"/><path id="sep" stroke-linecap="round" d="M5.5 10h6m-5 4h4m4.5 7V3"/></g></svg>
  </button>
</div>
</div><div class="scripts">
<script type="text/javascript">
  const ctx = {
    date_suffix: {
      just: `刚刚`,
      min: `分钟前`,
      hour: `小时前`,
      day: `天前`,
    },
    root : `/`,
  };

  // required plugins (only load if needs)
  if (`local_search`) {
    ctx.search = {};
    ctx.search.service = `local_search`;
    if (ctx.search.service == 'local_search') {
      let service_obj = Object.assign({}, `{"field":"all","path":"/search.json","content":true,"sort":"-date"}`);
      ctx.search[ctx.search.service] = service_obj;
    }
  }
  const def = {
    avatar: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/avatar/round/3442075.svg`,
    cover: `https://gcore.jsdelivr.net/gh/cdn-x/placeholder@1.0.12/cover/76b86c0226ffd.svg`,
  };
  const deps = {
    jquery: `https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js`,
    marked: `https://cdn.bootcdn.net/ajax/libs/marked/4.0.18/marked.min.js`
  }
  

</script>

<script type="text/javascript">
  const utils = {
    // 懒加载 css https://github.com/filamentgroup/loadCSS
    css: (href, before, media, attributes) => {
      var doc = window.document;
      var ss = doc.createElement("link");
      var ref;
      if (before) {
        ref = before;
      } else {
        var refs = (doc.body || doc.getElementsByTagName("head")[0]).childNodes;
        ref = refs[refs.length - 1];
      }
      var sheets = doc.styleSheets;
      if (attributes) {
        for (var attributeName in attributes) {
          if (attributes.hasOwnProperty(attributeName)) {
            ss.setAttribute(attributeName, attributes[attributeName]);
          }
        }
      }
      ss.rel = "stylesheet";
      ss.href = href;
      ss.media = "only x";
      function ready(cb) {
        if (doc.body) {
          return cb();
        }
        setTimeout(function () {
          ready(cb);
        });
      }
      ready(function () {
        ref.parentNode.insertBefore(ss, before ? ref : ref.nextSibling);
      });
      var onloadcssdefined = function (cb) {
        var resolvedHref = ss.href;
        var i = sheets.length;
        while (i--) {
          if (sheets[i].href === resolvedHref) {
            return cb();
          }
        }
        setTimeout(function () {
          onloadcssdefined(cb);
        });
      };
      function loadCB() {
        if (ss.addEventListener) {
          ss.removeEventListener("load", loadCB);
        }
        ss.media = media || "all";
      }
      if (ss.addEventListener) {
        ss.addEventListener("load", loadCB);
      }
      ss.onloadcssdefined = onloadcssdefined;
      onloadcssdefined(loadCB);
      return ss;
    },

    js: (src, opt) => new Promise((resolve, reject) => {
      var script = document.createElement('script');
      if (src.startsWith('/')){
        src = ctx.root + src.substring(1);
      }
      script.src = src;
      if (opt) {
        for (let key of Object.keys(opt)) {
          script[key] = opt[key]
        }
      } else {
        // 默认异步，如果需要同步，第二个参数传入 {} 即可
        script.async = true
      }
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    }),

    jq: (fn) => {
      if (typeof jQuery === 'undefined') {
        utils.js(deps.jquery).then(fn)
      } else {
        fn()
      }
    },
    
    onLoading: (el) => {
      if (el) {
        $(el).append('<div class="loading-wrap"><svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" stroke-opacity=".3" d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="1.3s" values="60;0"/></path><path stroke-dasharray="15" stroke-dashoffset="15" d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.3s" values="15;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></g></svg></div>');
      }
    },
    onLoadSuccess: (el) => {
      if (el) {
        $(el).find('.loading-wrap').remove();
      }
    },
    onLoadFailure: (el) => {
      if (el) {
        $(el).find('.loading-wrap svg').remove();
        $(el).find('.loading-wrap').append('<svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path stroke-dasharray="60" stroke-dashoffset="60" d="M12 3L21 20H3L12 3Z"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.5s" values="60;0"/></path><path stroke-dasharray="6" stroke-dashoffset="6" d="M12 10V14"><animate fill="freeze" attributeName="stroke-dashoffset" begin="0.6s" dur="0.2s" values="6;0"/></path></g><circle cx="12" cy="17" r="1" fill="currentColor" fill-opacity="0"><animate fill="freeze" attributeName="fill-opacity" begin="0.8s" dur="0.4s" values="0;1"/></circle></svg>');
        $(el).find('.loading-wrap').addClass('error');
      }
    },
    request: (el, url, callback, onFailure) => {
      let retryTimes = 3;
      utils.onLoading(el);
      function req() {
        return new Promise((resolve, reject) => {
          let status = 0; // 0 等待 1 完成 2 超时
          let timer = setTimeout(() => {
            if (status === 0) {
              status = 2;
              timer = null;
              reject('请求超时');
              if (retryTimes == 0) {
                onFailure();
              }
            }
          }, 5000);
          fetch(url).then(function(response) {
            if (status !== 2) {
              clearTimeout(timer);
              resolve(response);
              timer = null;
              status = 1;
            }
            if (response.ok) {
              return response.json();
            }
            throw new Error('Network response was not ok.');
          }).then(function(data) {
            retryTimes = 0;
            utils.onLoadSuccess(el);
            callback(data);
          }).catch(function(error) {
            if (retryTimes > 0) {
              retryTimes -= 1;
              setTimeout(() => {
                req();
              }, 5000);
            } else {
              utils.onLoadFailure(el);
              onFailure();
            }
          });
        });
      }
      req();
    },
  };
</script>

<script>
  const sidebar = {
    leftbar: () => {
      if (l_body) {
        l_body.toggleAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    rightbar: () => {
      if (l_body) {
        l_body.toggleAttribute('rightbar');
        l_body.removeAttribute('leftbar');
      }
    },
    dismiss: () => {
      if (l_body) {
        l_body.removeAttribute('leftbar');
        l_body.removeAttribute('rightbar');
      }
    },
    toggleTOC: () => {
      document.querySelector('#data-toc').classList.toggle('collapse');
    }
  }
</script>

<!-- required -->
<script src="/js/main.js?v=1.28.1" async></script>

<!-- optional -->

  <script>
  function loadUtterances() {
    const els = document.querySelectorAll("#comments #utterances");
    if (els.length === 0) return;
    els.forEach((el, i) => {
      try {
        el.innerHTML = '';
      } catch (error) {
        console.error(error);
      }
      var script = document.createElement('script');
      script.src = 'https://utteranc.es/client.js';
      script.async = true;
      for (let key of Object.keys(el.attributes)) {
        let attr = el.attributes[key];
        if (['class', 'id'].includes(attr.name) === false) {
          script.setAttribute(attr.name, attr.value);
        }
      }
      el.appendChild(script);
    });
  }
  window.addEventListener('DOMContentLoaded', (event) => {
      loadUtterances();
  });
</script>




<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.services = Object.assign({}, JSON.parse(`{"mdrender":{"js":"/js/services/mdrender.js"},"siteinfo":{"js":"/js/services/siteinfo.js","api":null},"ghinfo":{"js":"/js/services/ghinfo.js"},"sites":{"js":"/js/services/sites.js"},"friends":{"js":"/js/services/friends.js"},"timeline":{"js":"/js/services/timeline.js"},"fcircle":{"js":"/js/services/fcircle.js"},"weibo":{"js":"/js/services/weibo.js"},"memos":{"js":"/js/services/memos.js"}}`));
    for (let id of Object.keys(ctx.services)) {
      const js = ctx.services[id].js;
      if (id == 'siteinfo') {
        ctx.cardlinks = document.querySelectorAll('a.link-card[cardlink]');
        if (ctx.cardlinks?.length > 0) {
          utils.js(js, { defer: true }).then(function () {
            setCardLink(ctx.cardlinks);
          });
        }
      } else {
        const els = document.getElementsByClassName(`ds-${id}`);
        if (els?.length > 0) {
          utils.jq(() => {
            if (id == 'timeline' || 'memos' || 'marked') {
              utils.js(deps.marked).then(function () {
                utils.js(js, { defer: true });
              });
            } else {
              utils.js(js, { defer: true });
            }
          });
        }
      }
    }
  });
</script>

<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    ctx.search = {
      path: `/search.json`,
    }
    utils.js('/js/search/local-search.js', { defer: true });
  });
</script><script>
  window.FPConfig = {
    delay: 0,
    ignoreKeywords: [],
    maxRPS: 5,
    hoverDelay: 25
  };
</script>
<script defer src="https://cdn.bootcdn.net/ajax/libs/flying-pages/2.1.2/flying-pages.min.js"></script><script defer src="https://cdn.bootcdn.net/ajax/libs/vanilla-lazyload/17.8.4/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazy",
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    window.lazyLoadInstance?.update();
  });
</script><script>
  ctx.fancybox = {
    selector: `.timenode p>img`,
    css: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.min.css`,
    js: `https://cdn.bootcdn.net/ajax/libs/fancyapps-ui/5.0.22/fancybox/fancybox.umd.min.js`
  };
  var selector = '[data-fancybox]:not(.error)';
  if (ctx.fancybox.selector) {
    selector += `, ${ctx.fancybox.selector}`
  }
  var needFancybox = document.querySelectorAll(selector).length !== 0;
  if (!needFancybox) {
    const els = document.getElementsByClassName('ds-memos');
    if (els != undefined && els.length > 0) {
      needFancybox = true;
    }
  }
  if (needFancybox) {
    utils.css(ctx.fancybox.css);
    utils.js(ctx.fancybox.js, { defer: true }).then(function () {
      Fancybox.bind(selector, {
        hideScrollbar: false,
        Thumbs: {
          autoStart: false,
        },
        caption: (fancybox, slide) => {
          return slide.triggerEl.alt || slide.triggerEl.dataset.caption || null
        }
      });
    })
  }
</script>
<script>
  window.addEventListener('DOMContentLoaded', (event) => {
    const swiper_api = document.getElementById('swiper-api');
    if (swiper_api != undefined) {
      utils.css(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.css`);
      utils.js(`https://unpkg.com/swiper@10.3.1/swiper-bundle.min.js`, { defer: true }).then(function () {
        const effect = swiper_api.getAttribute('effect') || '';
        var swiper = new Swiper('.swiper#swiper-api', {
          slidesPerView: 'auto',
          spaceBetween: 8,
          centeredSlides: true,
          effect: effect,
          rewind: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true,
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      })
    }
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    window.codeElements = document.querySelectorAll('.code');
    if (window.codeElements.length > 0) {
      ctx.copycode = {
        default_text: `Copy`,
        success_text: `Copied`,
        toast: `复制成功`,
      };
      utils.js('/js/plugins/copycode.js');
    }
  });
</script>


<!-- inject -->

</div></body></html>
